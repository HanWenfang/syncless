/* Generated by Cython 0.12.1 on Mon Feb 15 23:14:15 2010 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#else

#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#if PY_VERSION_HEX < 0x02040000
  #define METH_COEXIST 0
  #define PyDict_CheckExact(op) (Py_TYPE(op) == &PyDict_Type)
  #define PyDict_Contains(d,o)   PySequence_Contains(d,o)
#endif

#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PY_FORMAT_SIZE_T ""
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   PyInt_AsLong(o)
  #define PyNumber_Index(o)    PyNumber_Int(o)
  #define PyIndex_Check(o)     PyNumber_Check(o)
  #define PyErr_WarnEx(category, message, stacklevel) PyErr_Warn(category, message)
#endif

#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)

  typedef struct {
     void *buf;
     PyObject *obj;
     Py_ssize_t len;
     Py_ssize_t itemsize;
     int readonly;
     int ndim;
     char *format;
     Py_ssize_t *shape;
     Py_ssize_t *strides;
     Py_ssize_t *suboffsets;
     void *internal;
  } Py_buffer;

  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)

#endif

#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
#endif

#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif

#if (PY_VERSION_HEX < 0x02060000) || (PY_MAJOR_VERSION >= 3)
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif

#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyString_Type                PyUnicode_Type
  #define PyString_CheckExact          PyUnicode_CheckExact
#else
  #define PyBytes_Type                 PyString_Type
  #define PyBytes_CheckExact           PyString_CheckExact
#endif

#if PY_MAJOR_VERSION >= 3
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)

#endif

#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) PyInstanceMethod_New(func)
#endif

#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#else
  #define _USE_MATH_DEFINES
#endif

#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),((char *)(n)))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),((char *)(n)),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),((char *)(n)))
#else
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),(n))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),(n),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),(n))
#endif

#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_NAMESTR(n) ((char *)(n))
  #define __Pyx_DOCSTR(n)  ((char *)(n))
#else
  #define __Pyx_NAMESTR(n) (n)
  #define __Pyx_DOCSTR(n)  (n)
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#define __PYX_HAVE_API__coio
#include "sys/types.h"
#include "event.h"
#include "stdlib.h"
#include "unistd.h"
#include "string.h"
#include "errno.h"
#include "fcntl.h"
#include "signal.h"
#include "sys/socket.h"
#include "frameobject.h"
#include "core/stackless_structs.h"
#include "stackless_api.h"
#include "evdns.h"
#include "netdb.h"

#ifndef CYTHON_INLINE
  #if defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #else
    #define CYTHON_INLINE 
  #endif
#endif

typedef struct {PyObject **p; char *s; const long n; const char* encoding; const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry; /*proto*/


/* Type Conversion Predeclarations */

#if PY_MAJOR_VERSION < 3
#define __Pyx_PyBytes_FromString          PyString_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyString_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyString_AsString
#else
#define __Pyx_PyBytes_FromString          PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyBytes_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyBytes_AsString
#endif

#define __Pyx_PyBytes_FromUString(s)      __Pyx_PyBytes_FromString((char*)s)
#define __Pyx_PyBytes_AsUString(s)        ((unsigned char*) __Pyx_PyBytes_AsString(s))

#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x);

#if !defined(T_PYSSIZET)
#if PY_VERSION_HEX < 0x02050000
#define T_PYSSIZET T_INT
#elif !defined(T_LONGLONG)
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))  ? T_INT  : \
        ((sizeof(Py_ssize_t) == sizeof(long)) ? T_LONG : -1))
#else
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))          ? T_INT      : \
        ((sizeof(Py_ssize_t) == sizeof(long))         ? T_LONG     : \
        ((sizeof(Py_ssize_t) == sizeof(PY_LONG_LONG)) ? T_LONGLONG : -1)))
#endif
#endif


#if !defined(T_ULONGLONG)
#define __Pyx_T_UNSIGNED_INT(x) \
        ((sizeof(x) == sizeof(unsigned char))  ? T_UBYTE : \
        ((sizeof(x) == sizeof(unsigned short)) ? T_USHORT : \
        ((sizeof(x) == sizeof(unsigned int))   ? T_UINT : \
        ((sizeof(x) == sizeof(unsigned long))  ? T_ULONG : -1))))
#else
#define __Pyx_T_UNSIGNED_INT(x) \
        ((sizeof(x) == sizeof(unsigned char))  ? T_UBYTE : \
        ((sizeof(x) == sizeof(unsigned short)) ? T_USHORT : \
        ((sizeof(x) == sizeof(unsigned int))   ? T_UINT : \
        ((sizeof(x) == sizeof(unsigned long))  ? T_ULONG : \
        ((sizeof(x) == sizeof(unsigned PY_LONG_LONG)) ? T_ULONGLONG : -1)))))
#endif
#if !defined(T_LONGLONG)
#define __Pyx_T_SIGNED_INT(x) \
        ((sizeof(x) == sizeof(char))  ? T_BYTE : \
        ((sizeof(x) == sizeof(short)) ? T_SHORT : \
        ((sizeof(x) == sizeof(int))   ? T_INT : \
        ((sizeof(x) == sizeof(long))  ? T_LONG : -1))))
#else
#define __Pyx_T_SIGNED_INT(x) \
        ((sizeof(x) == sizeof(char))  ? T_BYTE : \
        ((sizeof(x) == sizeof(short)) ? T_SHORT : \
        ((sizeof(x) == sizeof(int))   ? T_INT : \
        ((sizeof(x) == sizeof(long))  ? T_LONG : \
        ((sizeof(x) == sizeof(PY_LONG_LONG))   ? T_LONGLONG : -1)))))
#endif

#define __Pyx_T_FLOATING(x) \
        ((sizeof(x) == sizeof(float)) ? T_FLOAT : \
        ((sizeof(x) == sizeof(double)) ? T_DOUBLE : -1))

#if !defined(T_SIZET)
#if !defined(T_ULONGLONG)
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))  ? T_UINT  : \
        ((sizeof(size_t) == sizeof(unsigned long)) ? T_ULONG : -1))
#else
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))          ? T_UINT      : \
        ((sizeof(size_t) == sizeof(unsigned long))         ? T_ULONG     : \
        ((sizeof(size_t) == sizeof(unsigned PY_LONG_LONG)) ? T_ULONGLONG : -1)))
#endif
#endif

static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
static CYTHON_INLINE size_t __Pyx_PyInt_AsSize_t(PyObject*);

#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))


#ifdef __GNUC__
/* Test for GCC > 2.95 */
#if __GNUC__ > 2 ||               (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)) 
#define likely(x)   __builtin_expect(!!(x), 1)
#define unlikely(x) __builtin_expect(!!(x), 0)
#else /* __GNUC__ > 2 ... */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ */
    
static PyObject *__pyx_m;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;
static const char **__pyx_f;


/* Type declarations */

typedef void (*__pyx_t_4coio_event_handler)(int, short, void *);

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":661
 *         n -= got
 * 
 * cdef enum dummy:             # <<<<<<<<<<<<<<
 *     DEFAULT_WRITE_BUFFER_LIMIT = 8192  # TODO(pts): Do speed tests.
 * 
 */

enum __pyx_t_4coio_dummy {
  __pyx_e_4coio_DEFAULT_WRITE_BUFFER_LIMIT = 8192
};

typedef int (*__pyx_t_4coio__evdns_call_t)(char const*, int, evdns_callback_type, void *);

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1087
 * # Forward declarations.
 * cdef class nbsocket
 * cdef class nbsslsocket             # <<<<<<<<<<<<<<
 * 
 * # With `cdef void', an exception here would be ignored, so
 */

struct __pyx_obj_4coio_nbsslsocket {
  PyObject_HEAD
  struct event wakeup_ev;
  int fd;
  float timeout_value;
  struct timeval tv;
  PyObject *realsock;
  PyObject *sslsock;
  PyObject *sslobj;
};

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":126
 *         dns_initialized = 0
 * 
 * cdef class dnsresult:             # <<<<<<<<<<<<<<
 *     """Result of a DNS lookup call.
 * 
 */

struct __pyx_obj_4coio_dnsresult {
  PyObject_HEAD
  char _t;
  int _ttl;
  PyObject *_values;
};

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":91
 *     (<object>arg).__simple_callback(evtype)
 * 
 * cdef class event:             # <<<<<<<<<<<<<<
 *     """event(callback, arg=None, evtype=0, handle=None) -> event object
 * 
 */

struct __pyx_obj_4coio_event {
  PyObject_HEAD
  struct event ev;
  PyObject *handle;
  PyObject *evtype;
  PyObject *callback;
  PyObject *args;
  float timeout;
  struct timeval tv;
};

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1985
 *     return nbsocket(socket_fromfd(*args)).setdoclose(1)
 * 
 * cdef class sleeper:             # <<<<<<<<<<<<<<
 *     # We must keep self.wakeup_ev on the heap (not on the C stack), because
 *     # hard switching in Stackless scheduling swaps the C stack, and libevent
 */

struct __pyx_obj_4coio_sleeper {
  PyObject_HEAD
  struct event wakeup_ev;
};

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1452
 * 
 * 
 * cdef class sockwrapper:             # <<<<<<<<<<<<<<
 *     """A helper class for holding a self._sock."""
 *     cdef object c_sock
 */

struct __pyx_obj_4coio_sockwrapper {
  PyObject_HEAD
  PyObject *c_sock;
};

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":336
 * #      p.next = c
 * 
 * cdef class evbuffer:             # <<<<<<<<<<<<<<
 *     """A Python wrapper around libevent's I/O buffer: struct evbuffer
 * 
 */

struct __pyx_obj_4coio_evbuffer {
  PyObject_HEAD
  struct evbuffer eb;
  struct event wakeup_ev;
};

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1086
 * 
 * # Forward declarations.
 * cdef class nbsocket             # <<<<<<<<<<<<<<
 * cdef class nbsslsocket
 * 
 */

struct __pyx_obj_4coio_nbsocket {
  PyObject_HEAD
  struct event wakeup_ev;
  int fd;
  float timeout_value;
  struct timeval tv;
  PyObject *realsock;
  char c_do_close;
};

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":667
 * # TODO(pts): Implement close().
 * # !! implement timeout (does socket._realsocket.makefile do that?)
 * cdef class nbfile:             # <<<<<<<<<<<<<<
 *     """A non-blocking file (I/O channel).
 * 
 */

struct __pyx_obj_4coio_nbfile {
  PyObject_HEAD
  PyObject *close_ref;
  struct event wakeup_ev;
  int read_fd;
  int write_fd;
  int c_write_buffer_limit;
  int c_read_limit;
  struct evbuffer read_eb;
  struct evbuffer write_eb;
  char c_do_close;
  char c_closed;
  char c_softspace;
  PyObject *c_mode;
  PyObject *c_name;
};

#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif

#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct * __Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule((char *)modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, (char *)"RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
  end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
  }
  #define __Pyx_RefNannySetupContext(name)           void *__pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
  #define __Pyx_RefNannyFinishContext()           __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r) __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r) __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r) __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XDECREF(r) do { if((r) != NULL) {__Pyx_DECREF(r);} } while(0)
#else
  #define __Pyx_RefNannySetupContext(name)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
#endif /* CYTHON_REFNANNY */
#define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);} } while(0)
#define __Pyx_XGOTREF(r) do { if((r) != NULL) {__Pyx_GOTREF(r);} } while(0)


static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}


#define __Pyx_GetItemInt_List(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_List_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyList_GET_SIZE(o)))) {
            PyObject *r = PyList_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyList_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyList_GET_ITEM(o, PyList_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}

#define __Pyx_GetItemInt_Tuple(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Tuple_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyTuple_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyTuple_GET_ITEM(o, PyTuple_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}


#define __Pyx_GetItemInt(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    PyObject *r;
    if (PyList_CheckExact(o) && ((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (PyTuple_CheckExact(o) && ((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
        r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_item && (likely(i >= 0))) {
        r = PySequence_GetItem(o, i);
    }
    else {
        r = __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
    }
    return r;
}

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name, PyObject* kw_name); /*proto*/

static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/

static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,     const char* function_name); /*proto*/

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static CYTHON_INLINE int __Pyx_CheckKeywordStrings(PyObject *kwdict,
    const char* function_name, int kw_allowed); /*proto*/

static CYTHON_INLINE long __Pyx_NegateNonNeg(long b) { return unlikely(b < 0) ? b : !b; }
static CYTHON_INLINE PyObject* __Pyx_PyBoolOrNull_FromLong(long b) {
    return unlikely(b < 0) ? NULL : __Pyx_PyBool_FromLong(b);
}

static PyObject* __Pyx_PyEval_CallObjectWithKeywords(PyObject*, PyObject*, PyObject*); /*proto*/

static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(void);

static PyObject *__Pyx_UnpackItem(PyObject *, Py_ssize_t index); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

#define __Pyx_SetItemInt(o, i, v, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_SetItemInt_Fast(o, i, v, size <= sizeof(long)) : \
                                                    __Pyx_SetItemInt_Generic(o, to_py_func(i), v))

static CYTHON_INLINE int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (!j) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}

static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int fits_long) {
    if (PyList_CheckExact(o) && ((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        Py_INCREF(v);
        Py_DECREF(PyList_GET_ITEM(o, i));
        PyList_SET_ITEM(o, i, v);
        return 1;
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_ass_item && (likely(i >= 0)))
        return PySequence_SetItem(o, i, v);
    else {
        PyObject *j = fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i);
        return __Pyx_SetItemInt_Generic(o, j, v);
    }
}

static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact); /*proto*/

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name, const char *modname); /*proto*/

#ifndef __PYX_FORCE_INIT_THREADS
  #if PY_VERSION_HEX < 0x02040200
    #define __PYX_FORCE_INIT_THREADS 1
  #else
    #define __PYX_FORCE_INIT_THREADS 0
  #endif
#endif

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static CYTHON_INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject *);

static CYTHON_INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject *);

static CYTHON_INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject *);

static CYTHON_INLINE char __Pyx_PyInt_AsChar(PyObject *);

static CYTHON_INLINE short __Pyx_PyInt_AsShort(PyObject *);

static CYTHON_INLINE int __Pyx_PyInt_AsInt(PyObject *);

static CYTHON_INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject *);

static CYTHON_INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject *);

static CYTHON_INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject *);

static CYTHON_INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject *);

static CYTHON_INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject *);

static CYTHON_INLINE long __Pyx_PyInt_AsLong(PyObject *);

static CYTHON_INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject *);

static CYTHON_INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject *);

static CYTHON_INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject *);

static void __Pyx_WriteUnraisable(const char *name); /*proto*/

static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name, long size, int strict);  /*proto*/

static PyObject *__Pyx_ImportModule(const char *name); /*proto*/

static void __Pyx_AddTraceback(const char *funcname); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/
/* Module declarations from stackless */

/* Module declarations from coio */

static PyTypeObject *__pyx_ptype_4coio_event = 0;
static PyTypeObject *__pyx_ptype_4coio_tasklet = 0;
static PyTypeObject *__pyx_ptype_4coio_bomb = 0;
static PyTypeObject *__pyx_ptype_4coio_evbuffer = 0;
static PyTypeObject *__pyx_ptype_4coio_nbfile = 0;
static PyTypeObject *__pyx_ptype_4coio_nbsocket = 0;
static PyTypeObject *__pyx_ptype_4coio_nbsslsocket = 0;
static PyTypeObject *__pyx_ptype_4coio_sockwrapper = 0;
static PyTypeObject *__pyx_ptype_4coio_sleeper = 0;
static PyTypeObject *__pyx_ptype_4coio_dnsresult = 0;
static int __pyx_v_4coio_SSL_ERROR_EOF;
static int __pyx_v_4coio_SSL_ERROR_WANT_READ;
static int __pyx_v_4coio_SSL_ERROR_WANT_WRITE;
static char __pyx_v_4coio_dns_initialized;
static PyTaskletObject *__pyx_v_4coio_link_helper_tasklet = 0;
static PyTaskletObject *__pyx_v_4coio_main_loop_tasklet = 0;
static void __pyx_f_4coio___event_abort(void); /*proto*/
static void __pyx_f_4coio___event_handler(int, short, void *); /*proto*/
static void __pyx_f_4coio___simple_event_handler(int, short, void *); /*proto*/
static void __pyx_f_4coio_set_fd_nonblocking(int); /*proto*/
static void __pyx_f_4coio_HandleCTimeoutWakeup(int, short, void *); /*proto*/
static void __pyx_f_4coio_HandleCWakeup(int, short, void *); /*proto*/
static PyObject *__pyx_f_4coio_write_to_fd(int, struct event *, char const*, Py_ssize_t); /*proto*/
static PyObject *__pyx_f_4coio_handle_eagain(struct __pyx_obj_4coio_nbsocket *, int); /*proto*/
static PyObject *__pyx_f_4coio_handle_ssl_eagain(struct __pyx_obj_4coio_nbsslsocket *, int); /*proto*/
static PyObject *__pyx_f_4coio_format_ipv6_word(unsigned int, unsigned int); /*proto*/
static void __pyx_f_4coio__dns_callback(int, char, int, int, void *, void *); /*proto*/
static char __pyx_f_4coio_is_valid_hex_digit(char); /*proto*/
static char __pyx_f_4coio_is_valid_ipv6(char *); /*proto*/
static char __pyx_f_4coio_is_valid_ipv4(char *); /*proto*/
static struct __pyx_obj_4coio_dnsresult *__pyx_f_4coio_dns_call(__pyx_t_4coio__evdns_call_t, char const*, int); /*proto*/
static PyObject *__pyx_f_4coio_raise_gaierror(PyObject *, char); /*proto*/
static PyObject *__pyx_f_4coio_raise_herror(PyObject *); /*proto*/
static PyObject *__pyx_f_4coio_c_gethostbyname(PyObject *, int); /*proto*/
#define __Pyx_MODULE_NAME "coio"
int __pyx_module_is_main_coio = 0;

/* Implementation of coio */
static PyObject *__pyx_builtin_ImportError;
static PyObject *__pyx_builtin_IOError;
static PyObject *__pyx_builtin_Exception;
static PyObject *__pyx_builtin_TypeError;
static PyObject *__pyx_builtin_xrange;
static PyObject *__pyx_builtin_RuntimeError;
static PyObject *__pyx_builtin_KeyboardInterrupt;
static PyObject *__pyx_builtin_MemoryError;
static PyObject *__pyx_builtin_StopIteration;
static PyObject *__pyx_builtin_ValueError;
static PyObject *__pyx_builtin_buffer;
static PyObject *__pyx_builtin_NotImplementedError;
static PyObject *__pyx_builtin_open;
static char __pyx_k_1[] = "<event flags=0x%x, handle=%s, callback=%s, arg=%s>";
static char __pyx_k_3[] = "LinkHelper tasklet called";
static char __pyx_k_4[] = "<evbuffer misalign=%s, totallen=%s, off=%s at 0x%x>";
static char __pyx_k_5[] = "";
static char __pyx_k_6[] = "\n";
static char __pyx_k_7[] = "r+";
static char __pyx_k_8[] = "c_write_buffer_limit";
static char __pyx_k_9[] = "timed out";
static char __pyx_k_10[] = "Timeout value out of range";
static char __pyx_k_11[] = "bad type for underlying socket: ";
static char __pyx_k_12[] = "do_handshake_on_connect";
static char __pyx_k_13[] = "_suppress_ragged_eofs";
static char __pyx_k_14[] = "suppress_ragged_eofs";
static char __pyx_k_15[] = "attempt to connect already-connected SSLSocket!";
static char __pyx_k_16[] = "No SSL wrapper around ";
static char __pyx_k_18[] = "flags=0 expected for recv on ";
static char __pyx_k_19[] = "flags=0 expected for send on ";
static char __pyx_k_20[] = "flags=0 expected for sendall on ";
static char __pyx_k_21[] = "<dnsresult t=%d, ttl=%d values=%r at 0x%x>";
static char __pyx_k_22[] = "%x";
static char __pyx_k_23[] = "%d.%d.%d.%d";
static char __pyx_k_24[] = ":";
static char __pyx_k_25[] = "unknown type";
static char __pyx_k_26[] = "bad type for ipv4";
static char __pyx_k_27[] = "bad type for ipv6";
static char __pyx_k_28[] = "bad type for reverse";
static char __pyx_k_29[] = "ip must be a string";
static char __pyx_k_30[] = ".";
static char __pyx_k_31[] = "bad ipv4 address";
static char __pyx_k_32[] = "bad ipv6 address";
static char __pyx_k_33[] = "unknown ip address syntax";
static char __pyx_k_34[] = "/etc/hosts";
static char __pyx_k_35[] = "#";
static char __pyx_k_36[] = "Name or service not known";
static char __pyx_k_37[] = "No address associated with hostname";
static char __pyx_k_38[] = "HERROR_HOST_NOT_FOUND";
static char __pyx_k_39[] = "Unknown host";
static char __pyx_k_40[] = "Address family for hostname not supported";
static char __pyx_k_41[] = "Maximum number of bytes to read from the file.\n        \n        Negative values stand for unlimited. After each read from the file\n        (not from the buffer), this property is decremented accordingly.\n        \n        It is possible to set this property.\n        ";
static char __pyx_k_42[] = "Return a socket._realsocket.\n\n        This makes it possible to pass an nbsocket to the ssl.SSLSocket\n        constructor.\n        ";
static char __pyx_k_43[] = "Return a nonnegative float, or -1.0 if there is no timeout.\n\n        socket._realsocket has a read-only .timeout, socket.socket doesn't\n        have an attribute named timeout.\n        ";
static char __pyx_k_44[] = "Return the corresponding SSLSocket instance.\n\n        Property _sslsock is not present in SSLSocket.\n        ";
static char __pyx_k_45[] = "Return a nonnegative float, or -1.0 if there is no timeout.";
static char __pyx_k_46[] = "Dug Song <dugsong@monkey.org>";
static char __pyx_k_47[] = "Martin Murray <mmurray@monkey.org>";
static char __pyx_k_48[] = "Copyright (c) 2004 Dug Song";
static char __pyx_k_49[] = "Copyright (c) 2003 Martin Murray";
static char __pyx_k_50[] = "http://monkey.org/~dugsong/pyevent/";
static char __pyx_k_51[] = "0.4";
static char __pyx_k_52[] = "SSL_ERROR_WANT_WRITE";
static char __pyx_k_53[] = "DNS_ERR_SERVERFAILED";
static char __pyx_k_54[] = "event.add (line 150)";
static char __pyx_k_55[] = "event.pending (line 169)";
static char __pyx_k_56[] = "event.delete (line 173)";
static char __pyx_k_57[] = "dispatch (line 186)";
static char __pyx_k_58[] = "loop (line 200)";
static char __pyx_k_59[] = "abort (line 216)";
static char __pyx_k_60[] = "SendExceptionAndRun (line 162)";
static char __pyx_k_61[] = "set_fd_blocking (line 278)";
static char __pyx_k_62[] = "evbuffer.reset (line 359)";
static char __pyx_k_63[] = "evbuffer.expand (line 379)";
static char __pyx_k_64[] = "evbuffer.consume (line 400)";
static char __pyx_k_65[] = "evbuffer.peek (line 415)";
static char __pyx_k_66[] = "evbuffer.append_clear (line 435)";
static char __pyx_k_67[] = "evbuffer.consumeline (line 443)";
static char __pyx_k_68[] = "evbuffer.nb_flush (line 476)";
static char __pyx_k_69[] = "evbuffer.peekline (line 541)";
static char __pyx_k_70[] = "evbuffer.read_from_fd (line 555)";
static char __pyx_k_71[] = "evbuffer.read_from_fd_again (line 575)";
static char __pyx_k_72[] = "evbuffer.write_to_fd (line 597)";
static char __pyx_k_73[] = "evbuffer.write_to_fd_again (line 618)";
static char __pyx_k_74[] = "nbfile.discard (line 852)";
static char __pyx_k_75[] = "nbfile.discard_to_read_limit (line 902)";
static char __pyx_k_76[] = "discard_to_read_limit";
static char __pyx_k_77[] = "nbfile.read (line 912)";
static char __pyx_k_78[] = "nbfile.read_at_most (line 958)";
static char __pyx_k_79[] = "nbsocket.setdoclose (line 1199)";
static char __pyx_k_80[] = "nbsocket.makefile_samefd (line 1409)";
static char __pyx_k_81[] = "nbsocket.makefile (line 1420)";
static char __pyx_k_82[] = "nbsslsocket.dup (line 1540)";
static char __pyx_k_83[] = "nbsslsocket.read (line 1665)";
static char __pyx_k_84[] = "nbsslsocket.write (line 1681)";
static char __pyx_k_85[] = "nbsslsocket.connect_ex (line 1751)";
static char __pyx_k_86[] = "nbsslsocket.recv (line 1816)";
static char __pyx_k_87[] = "nbsslsocket.makefile (line 1953)";
static char __pyx_k_88[] = "new_realsocket (line 1971)";
static char __pyx_k_89[] = "new_realsocket_fromfd (line 1981)";
static char __pyx_k_90[] = "new_realsocket_fromfd";
static char __pyx_k_91[] = "sleep (line 2005)";
static char __pyx_k_92[] = "fdopen (line 2011)";
static char __pyx_k_93[] = "dns_init (line 103)";
static char __pyx_k_94[] = "dns_init_force (line 112)";
static char __pyx_k_95[] = "dns_shutdown (line 120)";
static char __pyx_k_96[] = "dns_resolve_ipv4 (line 304)";
static char __pyx_k_97[] = "dns_resolve_ipv6 (line 315)";
static char __pyx_k_98[] = "dns_resolve_reverse (line 326)";
static char __pyx_k_99[] = "read_etc_hosts (line 377)";
static char __pyx_k__f[] = "f";
static char __pyx_k__n[] = "n";
static char __pyx_k__r[] = "r";
static char __pyx_k__t[] = "t";
static char __pyx_k__w[] = "w";
static char __pyx_k_100[] = "gethostbyname (line 437)";
static char __pyx_k_101[] = "gethostbyaddr (line 490)";
static char __pyx_k_102[] = "getfqdn (line 516)";
static char __pyx_k_103[] = "gethostbyname_ex (line 542)";
static char __pyx_k___t[] = "_t";
static char __pyx_k__eb[] = "eb";
static char __pyx_k__ev[] = "ev";
static char __pyx_k__fd[] = "fd";
static char __pyx_k__ip[] = "ip";
static char __pyx_k__tv[] = "tv";
static char __pyx_k__BSD[] = "BSD";
static char __pyx_k__add[] = "add";
static char __pyx_k__arg[] = "arg";
static char __pyx_k__buf[] = "buf";
static char __pyx_k__dup[] = "dup";
static char __pyx_k__len[] = "len";
static char __pyx_k__off[] = "off";
static char __pyx_k__pop[] = "pop";
static char __pyx_k__run[] = "run";
static char __pyx_k__sig[] = "sig";
static char __pyx_k__ssl[] = "ssl";
static char __pyx_k__sys[] = "sys";
static char __pyx_k__ttl[] = "ttl";
static char __pyx_k___ssl[] = "_ssl";
static char __pyx_k___ttl[] = "_ttl";
static char __pyx_k__args[] = "args";
static char __pyx_k__bind[] = "bind";
static char __pyx_k__data[] = "data";
static char __pyx_k__join[] = "join";
static char __pyx_k__loop[] = "loop";
static char __pyx_k__main[] = "main";
static char __pyx_k__mode[] = "mode";
static char __pyx_k__name[] = "name";
static char __pyx_k__next[] = "next";
static char __pyx_k__open[] = "open";
static char __pyx_k__peek[] = "peek";
static char __pyx_k__prev[] = "prev";
static char __pyx_k__read[] = "read";
static char __pyx_k__recv[] = "recv";
static char __pyx_k__send[] = "send";
static char __pyx_k__sock[] = "sock";
static char __pyx_k__type[] = "type";
static char __pyx_k___sock[] = "_sock";
static char __pyx_k__abort[] = "abort";
static char __pyx_k__close[] = "close";
static char __pyx_k__errno[] = "errno";
static char __pyx_k__error[] = "error";
static char __pyx_k__event[] = "event";
static char __pyx_k__flags[] = "flags";
static char __pyx_k__flush[] = "flush";
static char __pyx_k__proto[] = "proto";
static char __pyx_k__range[] = "range";
static char __pyx_k__reset[] = "reset";
static char __pyx_k__sleep[] = "sleep";
static char __pyx_k__split[] = "split";
static char __pyx_k__strip[] = "strip";
static char __pyx_k__types[] = "types";
static char __pyx_k__value[] = "value";
static char __pyx_k__write[] = "write";
static char __pyx_k__accept[] = "accept";
static char __pyx_k__buffer[] = "buffer";
static char __pyx_k__buflen[] = "buflen";
static char __pyx_k__c_mode[] = "c_mode";
static char __pyx_k__c_name[] = "c_name";
static char __pyx_k__c_sock[] = "c_sock";
static char __pyx_k__cipher[] = "cipher";
static char __pyx_k__delete[] = "delete";
static char __pyx_k__evtype[] = "evtype";
static char __pyx_k__expand[] = "expand";
static char __pyx_k__family[] = "family";
static char __pyx_k__fdopen[] = "fdopen";
static char __pyx_k__fileno[] = "fileno";
static char __pyx_k__fromfd[] = "fromfd";
static char __pyx_k__handle[] = "handle";
static char __pyx_k__herror[] = "herror";
static char __pyx_k__insert[] = "insert";
static char __pyx_k__listen[] = "listen";
static char __pyx_k__nbfile[] = "nbfile";
static char __pyx_k__remove[] = "remove";
static char __pyx_k__sendto[] = "sendto";
static char __pyx_k__simple[] = "simple";
static char __pyx_k__socket[] = "socket";
static char __pyx_k__sslobj[] = "sslobj";
static char __pyx_k__tv_sec[] = "tv_sec";
static char __pyx_k__values[] = "values";
static char __pyx_k__xrange[] = "xrange";
static char __pyx_k__DNS_PTR[] = "DNS_PTR";
static char __pyx_k__EV_READ[] = "EV_READ";
static char __pyx_k__IOError[] = "IOError";
static char __pyx_k____url__[] = "__url__";
static char __pyx_k___sslobj[] = "_sslobj";
static char __pyx_k___values[] = "_values";
static char __pyx_k__balance[] = "balance";
static char __pyx_k__blocked[] = "blocked";
static char __pyx_k__bufsize[] = "bufsize";
static char __pyx_k__cerfile[] = "cerfile";
static char __pyx_k__connect[] = "connect";
static char __pyx_k__consume[] = "consume";
static char __pyx_k__discard[] = "discard";
static char __pyx_k__getfqdn[] = "getfqdn";
static char __pyx_k__keyfile[] = "keyfile";
static char __pyx_k__pending[] = "pending";
static char __pyx_k__read_eb[] = "read_eb";
static char __pyx_k__read_fd[] = "read_fd";
static char __pyx_k__sslsock[] = "sslsock";
static char __pyx_k__sslwrap[] = "sslwrap";
static char __pyx_k__tasklet[] = "tasklet";
static char __pyx_k__tempval[] = "tempval";
static char __pyx_k__timeout[] = "timeout";
static char __pyx_k__tv_usec[] = "tv_usec";
static char __pyx_k__EV_WRITE[] = "EV_WRITE";
static char __pyx_k__MainLoop[] = "MainLoop";
static char __pyx_k__SSLError[] = "SSLError";
static char __pyx_k____main__[] = "__main__";
static char __pyx_k____test__[] = "__test__";
static char __pyx_k___channel[] = "_channel";
static char __pyx_k__c_closed[] = "c_closed";
static char __pyx_k__ca_certs[] = "ca_certs";
static char __pyx_k__callback[] = "callback";
static char __pyx_k__certfile[] = "certfile";
static char __pyx_k__dispatch[] = "dispatch";
static char __pyx_k__dns_init[] = "dns_init";
static char __pyx_k__do_close[] = "do_close";
static char __pyx_k__ev_flags[] = "ev_flags";
static char __pyx_k__evbuffer[] = "evbuffer";
static char __pyx_k__exc_info[] = "exc_info";
static char __pyx_k__filename[] = "filename";
static char __pyx_k__gaierror[] = "gaierror";
static char __pyx_k__makefile[] = "makefile";
static char __pyx_k__misalign[] = "misalign";
static char __pyx_k__nb_flush[] = "nb_flush";
static char __pyx_k__nbsocket[] = "nbsocket";
static char __pyx_k__nonblock[] = "nonblock";
static char __pyx_k__peekline[] = "peekline";
static char __pyx_k__readline[] = "readline";
static char __pyx_k__realsock[] = "realsock";
static char __pyx_k__recvfrom[] = "recvfrom";
static char __pyx_k__shutdown[] = "shutdown";
static char __pyx_k__totallen[] = "totallen";
static char __pyx_k__write_eb[] = "write_eb";
static char __pyx_k__write_fd[] = "write_fd";
static char __pyx_k__EV_SIGNAL[] = "EV_SIGNAL";
static char __pyx_k__Exception[] = "Exception";
static char __pyx_k__SSLSocket[] = "SSLSocket";
static char __pyx_k__TypeError[] = "TypeError";
static char __pyx_k____class__[] = "__class__";
static char __pyx_k__cert_reqs[] = "cert_reqs";
static char __pyx_k__close_ref[] = "close_ref";
static char __pyx_k__recv_into[] = "recv_into";
static char __pyx_k__stackless[] = "stackless";
static char __pyx_k__traceback[] = "traceback";
static char __pyx_k__wakeup_ev[] = "wakeup_ev";
static char __pyx_k__DNS_IPv4_A[] = "DNS_IPv4_A";
static char __pyx_k__EAI_NODATA[] = "EAI_NODATA";
static char __pyx_k__EAI_NONAME[] = "EAI_NONAME";
static char __pyx_k__EV_PERSIST[] = "EV_PERSIST";
static char __pyx_k__EV_TIMEOUT[] = "EV_TIMEOUT";
static char __pyx_k__LinkHelper[] = "LinkHelper";
static char __pyx_k__ValueError[] = "ValueError";
static char __pyx_k____author__[] = "__author__";
static char __pyx_k____callback[] = "__callback";
static char __pyx_k__c_do_close[] = "c_do_close";
static char __pyx_k__connect_ex[] = "connect_ex";
static char __pyx_k__getsockopt[] = "getsockopt";
static char __pyx_k__preference[] = "preference";
static char __pyx_k__setdefault[] = "setdefault";
static char __pyx_k__setdoclose[] = "setdoclose";
static char __pyx_k__setsockopt[] = "setsockopt";
static char __pyx_k__startswith[] = "startswith";
static char __pyx_k__ImportError[] = "ImportError";
static char __pyx_k__MemoryError[] = "MemoryError";
static char __pyx_k____event_exc[] = "__event_exc";
static char __pyx_k____license__[] = "__license__";
static char __pyx_k____version__[] = "__version__";
static char __pyx_k___fileobject[] = "_fileobject";
static char __pyx_k___realsocket[] = "_realsocket";
static char __pyx_k__binary_form[] = "binary_form";
static char __pyx_k__c_softspace[] = "c_softspace";
static char __pyx_k__consumeline[] = "consumeline";
static char __pyx_k__gethostname[] = "gethostname";
static char __pyx_k__getpeername[] = "getpeername";
static char __pyx_k__getsockname[] = "getsockname";
static char __pyx_k__is_blocking[] = "is_blocking";
static char __pyx_k__names_by_ip[] = "names_by_ip";
static char __pyx_k__nbsslsocket[] = "nbsslsocket";
static char __pyx_k__orig_buffer[] = "orig_buffer";
static char __pyx_k__server_side[] = "server_side";
static char __pyx_k__setblocking[] = "setblocking";
static char __pyx_k__socket_impl[] = "socket_impl";
static char __pyx_k__ssl_version[] = "ssl_version";
static char __pyx_k__tasklet_obj[] = "tasklet_obj";
static char __pyx_k__write_to_fd[] = "write_to_fd";
static char __pyx_k__DNS_ERR_NONE[] = "DNS_ERR_NONE";
static char __pyx_k__RuntimeError[] = "RuntimeError";
static char __pyx_k__append_clear[] = "append_clear";
static char __pyx_k__c_read_limit[] = "c_read_limit";
static char __pyx_k__dns_shutdown[] = "dns_shutdown";
static char __pyx_k__do_handshake[] = "do_handshake";
static char __pyx_k__read_at_most[] = "read_at_most";
static char __pyx_k__read_from_fd[] = "read_from_fd";
static char __pyx_k__DNS_IPv6_AAAA[] = "DNS_IPv6_AAAA";
static char __pyx_k__SSL_ERROR_EOF[] = "SSL_ERROR_EOF";
static char __pyx_k__SigIntHandler[] = "SigIntHandler";
static char __pyx_k__StopIteration[] = "StopIteration";
static char __pyx_k____copyright__[] = "__copyright__";
static char __pyx_k___closedsocket[] = "_closedsocket";
static char __pyx_k__fail_requests[] = "fail_requests";
static char __pyx_k__gethostbyaddr[] = "gethostbyaddr";
static char __pyx_k__gethostbyname[] = "gethostbyname";
static char __pyx_k__recvfrom_into[] = "recvfrom_into";
static char __pyx_k__socket_fromfd[] = "socket_fromfd";
static char __pyx_k__timeout_value[] = "timeout_value";
static char __pyx_k__DNS_ERR_FORMAT[] = "DNS_ERR_FORMAT";
static char __pyx_k__DnsLookupError[] = "DnsLookupError";
static char __pyx_k__EAI_ADDRFAMILY[] = "EAI_ADDRFAMILY";
static char __pyx_k__HERROR_NO_DATA[] = "HERROR_NO_DATA";
static char __pyx_k___makefile_refs[] = "_makefile_refs";
static char __pyx_k__dns_init_force[] = "dns_init_force";
static char __pyx_k__new_realsocket[] = "new_realsocket";
static char __pyx_k__read_etc_hosts[] = "read_etc_hosts";
static char __pyx_k__sslsocket_impl[] = "sslsocket_impl";
static char __pyx_k__DNS_ERR_NOTIMPL[] = "DNS_ERR_NOTIMPL";
static char __pyx_k__DNS_ERR_REFUSED[] = "DNS_ERR_REFUSED";
static char __pyx_k__DNS_ERR_TIMEOUT[] = "DNS_ERR_TIMEOUT";
static char __pyx_k__DNS_ERR_UNKNOWN[] = "DNS_ERR_UNKNOWN";
static char __pyx_k__makefile_samefd[] = "makefile_samefd";
static char __pyx_k__names_by_nameip[] = "names_by_nameip";
static char __pyx_k__set_fd_blocking[] = "set_fd_blocking";
static char __pyx_k__DNS_ERR_NOTEXIST[] = "DNS_ERR_NOTEXIST";
static char __pyx_k__DNS_ERR_SHUTDOWN[] = "DNS_ERR_SHUTDOWN";
static char __pyx_k__HERROR_TRY_AGAIN[] = "HERROR_TRY_AGAIN";
static char __pyx_k__dns_resolve_ipv4[] = "dns_resolve_ipv4";
static char __pyx_k__dns_resolve_ipv6[] = "dns_resolve_ipv6";
static char __pyx_k__gethostbyname_ex[] = "gethostbyname_ex";
static char __pyx_k__peer_certificate[] = "peer_certificate";
static char __pyx_k__DNS_ERR_TRUNCATED[] = "DNS_ERR_TRUNCATED";
static char __pyx_k__HERROR_NO_ADDRESS[] = "HERROR_NO_ADDRESS";
static char __pyx_k__KeyboardInterrupt[] = "KeyboardInterrupt";
static char __pyx_k____simple_callback[] = "__simple_callback";
static char __pyx_k__socket_realsocket[] = "socket_realsocket";
static char __pyx_k__write_to_fd_again[] = "write_to_fd_again";
static char __pyx_k__HERROR_NO_RECOVERY[] = "HERROR_NO_RECOVERY";
static char __pyx_k__read_from_fd_again[] = "read_from_fd_again";
static char __pyx_k__write_buffer_limit[] = "write_buffer_limit";
static char __pyx_k__DNS_QUERY_NO_SEARCH[] = "DNS_QUERY_NO_SEARCH";
static char __pyx_k__DnsResultParseError[] = "DnsResultParseError";
static char __pyx_k__NotImplementedError[] = "NotImplementedError";
static char __pyx_k__SSL_ERROR_WANT_READ[] = "SSL_ERROR_WANT_READ";
static char __pyx_k__SendExceptionAndRun[] = "SendExceptionAndRun";
static char __pyx_k__dns_resolve_reverse[] = "dns_resolve_reverse";
static PyObject *__pyx_kp_s_1;
static PyObject *__pyx_kp_s_10;
static PyObject *__pyx_kp_u_100;
static PyObject *__pyx_kp_u_101;
static PyObject *__pyx_kp_u_102;
static PyObject *__pyx_kp_u_103;
static PyObject *__pyx_kp_s_11;
static PyObject *__pyx_n_s_12;
static PyObject *__pyx_n_s_13;
static PyObject *__pyx_n_s_14;
static PyObject *__pyx_kp_s_15;
static PyObject *__pyx_kp_s_16;
static PyObject *__pyx_kp_s_18;
static PyObject *__pyx_kp_s_19;
static PyObject *__pyx_kp_s_20;
static PyObject *__pyx_kp_s_21;
static PyObject *__pyx_kp_s_22;
static PyObject *__pyx_kp_s_23;
static PyObject *__pyx_kp_s_24;
static PyObject *__pyx_kp_s_25;
static PyObject *__pyx_kp_s_26;
static PyObject *__pyx_kp_s_27;
static PyObject *__pyx_kp_s_28;
static PyObject *__pyx_kp_s_29;
static PyObject *__pyx_kp_s_3;
static PyObject *__pyx_kp_s_30;
static PyObject *__pyx_kp_s_31;
static PyObject *__pyx_kp_s_32;
static PyObject *__pyx_kp_s_33;
static PyObject *__pyx_kp_s_34;
static PyObject *__pyx_kp_s_35;
static PyObject *__pyx_kp_s_36;
static PyObject *__pyx_kp_s_37;
static PyObject *__pyx_n_s_38;
static PyObject *__pyx_kp_s_39;
static PyObject *__pyx_kp_s_4;
static PyObject *__pyx_kp_s_40;
static PyObject *__pyx_kp_s_46;
static PyObject *__pyx_kp_s_47;
static PyObject *__pyx_kp_s_48;
static PyObject *__pyx_kp_s_49;
static PyObject *__pyx_kp_s_5;
static PyObject *__pyx_kp_s_50;
static PyObject *__pyx_kp_s_51;
static PyObject *__pyx_n_s_52;
static PyObject *__pyx_n_s_53;
static PyObject *__pyx_kp_u_54;
static PyObject *__pyx_kp_u_55;
static PyObject *__pyx_kp_u_56;
static PyObject *__pyx_kp_u_57;
static PyObject *__pyx_kp_u_58;
static PyObject *__pyx_kp_u_59;
static PyObject *__pyx_kp_s_6;
static PyObject *__pyx_kp_u_60;
static PyObject *__pyx_kp_u_61;
static PyObject *__pyx_kp_u_62;
static PyObject *__pyx_kp_u_63;
static PyObject *__pyx_kp_u_64;
static PyObject *__pyx_kp_u_65;
static PyObject *__pyx_kp_u_66;
static PyObject *__pyx_kp_u_67;
static PyObject *__pyx_kp_u_68;
static PyObject *__pyx_kp_u_69;
static PyObject *__pyx_kp_s_7;
static PyObject *__pyx_kp_u_70;
static PyObject *__pyx_kp_u_71;
static PyObject *__pyx_kp_u_72;
static PyObject *__pyx_kp_u_73;
static PyObject *__pyx_kp_u_74;
static PyObject *__pyx_kp_u_75;
static PyObject *__pyx_n_s_76;
static PyObject *__pyx_kp_u_77;
static PyObject *__pyx_kp_u_78;
static PyObject *__pyx_kp_u_79;
static PyObject *__pyx_n_s_8;
static PyObject *__pyx_kp_u_80;
static PyObject *__pyx_kp_u_81;
static PyObject *__pyx_kp_u_82;
static PyObject *__pyx_kp_u_83;
static PyObject *__pyx_kp_u_84;
static PyObject *__pyx_kp_u_85;
static PyObject *__pyx_kp_u_86;
static PyObject *__pyx_kp_u_87;
static PyObject *__pyx_kp_u_88;
static PyObject *__pyx_kp_u_89;
static PyObject *__pyx_kp_s_9;
static PyObject *__pyx_n_s_90;
static PyObject *__pyx_kp_u_91;
static PyObject *__pyx_kp_u_92;
static PyObject *__pyx_kp_u_93;
static PyObject *__pyx_kp_u_94;
static PyObject *__pyx_kp_u_95;
static PyObject *__pyx_kp_u_96;
static PyObject *__pyx_kp_u_97;
static PyObject *__pyx_kp_u_98;
static PyObject *__pyx_kp_u_99;
static PyObject *__pyx_n_s__BSD;
static PyObject *__pyx_n_s__DNS_ERR_FORMAT;
static PyObject *__pyx_n_s__DNS_ERR_NONE;
static PyObject *__pyx_n_s__DNS_ERR_NOTEXIST;
static PyObject *__pyx_n_s__DNS_ERR_NOTIMPL;
static PyObject *__pyx_n_s__DNS_ERR_REFUSED;
static PyObject *__pyx_n_s__DNS_ERR_SHUTDOWN;
static PyObject *__pyx_n_s__DNS_ERR_TIMEOUT;
static PyObject *__pyx_n_s__DNS_ERR_TRUNCATED;
static PyObject *__pyx_n_s__DNS_ERR_UNKNOWN;
static PyObject *__pyx_n_s__DNS_IPv4_A;
static PyObject *__pyx_n_s__DNS_IPv6_AAAA;
static PyObject *__pyx_n_s__DNS_PTR;
static PyObject *__pyx_n_s__DNS_QUERY_NO_SEARCH;
static PyObject *__pyx_n_s__DnsLookupError;
static PyObject *__pyx_n_s__DnsResultParseError;
static PyObject *__pyx_n_s__EAI_ADDRFAMILY;
static PyObject *__pyx_n_s__EAI_NODATA;
static PyObject *__pyx_n_s__EAI_NONAME;
static PyObject *__pyx_n_s__EV_PERSIST;
static PyObject *__pyx_n_s__EV_READ;
static PyObject *__pyx_n_s__EV_SIGNAL;
static PyObject *__pyx_n_s__EV_TIMEOUT;
static PyObject *__pyx_n_s__EV_WRITE;
static PyObject *__pyx_n_s__Exception;
static PyObject *__pyx_n_s__HERROR_NO_ADDRESS;
static PyObject *__pyx_n_s__HERROR_NO_DATA;
static PyObject *__pyx_n_s__HERROR_NO_RECOVERY;
static PyObject *__pyx_n_s__HERROR_TRY_AGAIN;
static PyObject *__pyx_n_s__IOError;
static PyObject *__pyx_n_s__ImportError;
static PyObject *__pyx_n_s__KeyboardInterrupt;
static PyObject *__pyx_n_s__LinkHelper;
static PyObject *__pyx_n_s__MainLoop;
static PyObject *__pyx_n_s__MemoryError;
static PyObject *__pyx_n_s__NotImplementedError;
static PyObject *__pyx_n_s__RuntimeError;
static PyObject *__pyx_n_s__SSLError;
static PyObject *__pyx_n_s__SSLSocket;
static PyObject *__pyx_n_s__SSL_ERROR_EOF;
static PyObject *__pyx_n_s__SSL_ERROR_WANT_READ;
static PyObject *__pyx_n_s__SendExceptionAndRun;
static PyObject *__pyx_n_s__SigIntHandler;
static PyObject *__pyx_n_s__StopIteration;
static PyObject *__pyx_n_s__TypeError;
static PyObject *__pyx_n_s__ValueError;
static PyObject *__pyx_n_s____author__;
static PyObject *__pyx_n_s____callback;
static PyObject *__pyx_n_s____class__;
static PyObject *__pyx_n_s____copyright__;
static PyObject *__pyx_n_s____event_exc;
static PyObject *__pyx_n_s____license__;
static PyObject *__pyx_n_s____main__;
static PyObject *__pyx_n_s____simple_callback;
static PyObject *__pyx_n_s____test__;
static PyObject *__pyx_n_s____url__;
static PyObject *__pyx_n_s____version__;
static PyObject *__pyx_n_s___channel;
static PyObject *__pyx_n_s___closedsocket;
static PyObject *__pyx_n_s___fileobject;
static PyObject *__pyx_n_s___makefile_refs;
static PyObject *__pyx_n_s___realsocket;
static PyObject *__pyx_n_s___sock;
static PyObject *__pyx_n_s___ssl;
static PyObject *__pyx_n_s___sslobj;
static PyObject *__pyx_n_s___t;
static PyObject *__pyx_n_s___ttl;
static PyObject *__pyx_n_s___values;
static PyObject *__pyx_n_s__abort;
static PyObject *__pyx_n_s__accept;
static PyObject *__pyx_n_s__add;
static PyObject *__pyx_n_s__append_clear;
static PyObject *__pyx_n_s__arg;
static PyObject *__pyx_n_s__args;
static PyObject *__pyx_n_s__balance;
static PyObject *__pyx_n_s__binary_form;
static PyObject *__pyx_n_s__bind;
static PyObject *__pyx_n_s__blocked;
static PyObject *__pyx_n_s__buf;
static PyObject *__pyx_n_s__buffer;
static PyObject *__pyx_n_s__buflen;
static PyObject *__pyx_n_s__bufsize;
static PyObject *__pyx_n_s__c_closed;
static PyObject *__pyx_n_s__c_do_close;
static PyObject *__pyx_n_s__c_mode;
static PyObject *__pyx_n_s__c_name;
static PyObject *__pyx_n_s__c_read_limit;
static PyObject *__pyx_n_s__c_sock;
static PyObject *__pyx_n_s__c_softspace;
static PyObject *__pyx_n_s__ca_certs;
static PyObject *__pyx_n_s__callback;
static PyObject *__pyx_n_s__cerfile;
static PyObject *__pyx_n_s__cert_reqs;
static PyObject *__pyx_n_s__certfile;
static PyObject *__pyx_n_s__cipher;
static PyObject *__pyx_n_s__close;
static PyObject *__pyx_n_s__close_ref;
static PyObject *__pyx_n_s__connect;
static PyObject *__pyx_n_s__connect_ex;
static PyObject *__pyx_n_s__consume;
static PyObject *__pyx_n_s__consumeline;
static PyObject *__pyx_n_s__data;
static PyObject *__pyx_n_s__delete;
static PyObject *__pyx_n_s__discard;
static PyObject *__pyx_n_s__dispatch;
static PyObject *__pyx_n_s__dns_init;
static PyObject *__pyx_n_s__dns_init_force;
static PyObject *__pyx_n_s__dns_resolve_ipv4;
static PyObject *__pyx_n_s__dns_resolve_ipv6;
static PyObject *__pyx_n_s__dns_resolve_reverse;
static PyObject *__pyx_n_s__dns_shutdown;
static PyObject *__pyx_n_s__do_close;
static PyObject *__pyx_n_s__do_handshake;
static PyObject *__pyx_n_s__dup;
static PyObject *__pyx_n_s__eb;
static PyObject *__pyx_n_s__errno;
static PyObject *__pyx_n_s__error;
static PyObject *__pyx_n_s__ev;
static PyObject *__pyx_n_s__ev_flags;
static PyObject *__pyx_n_s__evbuffer;
static PyObject *__pyx_n_s__event;
static PyObject *__pyx_n_s__evtype;
static PyObject *__pyx_n_s__exc_info;
static PyObject *__pyx_n_s__expand;
static PyObject *__pyx_n_s__f;
static PyObject *__pyx_n_s__fail_requests;
static PyObject *__pyx_n_s__family;
static PyObject *__pyx_n_s__fd;
static PyObject *__pyx_n_s__fdopen;
static PyObject *__pyx_n_s__filename;
static PyObject *__pyx_n_s__fileno;
static PyObject *__pyx_n_s__flags;
static PyObject *__pyx_n_s__flush;
static PyObject *__pyx_n_s__fromfd;
static PyObject *__pyx_n_s__gaierror;
static PyObject *__pyx_n_s__getfqdn;
static PyObject *__pyx_n_s__gethostbyaddr;
static PyObject *__pyx_n_s__gethostbyname;
static PyObject *__pyx_n_s__gethostbyname_ex;
static PyObject *__pyx_n_s__gethostname;
static PyObject *__pyx_n_s__getpeername;
static PyObject *__pyx_n_s__getsockname;
static PyObject *__pyx_n_s__getsockopt;
static PyObject *__pyx_n_s__handle;
static PyObject *__pyx_n_s__herror;
static PyObject *__pyx_n_s__insert;
static PyObject *__pyx_n_s__ip;
static PyObject *__pyx_n_s__is_blocking;
static PyObject *__pyx_n_s__join;
static PyObject *__pyx_n_s__keyfile;
static PyObject *__pyx_n_s__len;
static PyObject *__pyx_n_s__listen;
static PyObject *__pyx_n_s__loop;
static PyObject *__pyx_n_s__main;
static PyObject *__pyx_n_s__makefile;
static PyObject *__pyx_n_s__makefile_samefd;
static PyObject *__pyx_n_s__misalign;
static PyObject *__pyx_n_s__mode;
static PyObject *__pyx_n_s__n;
static PyObject *__pyx_n_s__name;
static PyObject *__pyx_n_s__names_by_ip;
static PyObject *__pyx_n_s__names_by_nameip;
static PyObject *__pyx_n_s__nb_flush;
static PyObject *__pyx_n_s__nbfile;
static PyObject *__pyx_n_s__nbsocket;
static PyObject *__pyx_n_s__nbsslsocket;
static PyObject *__pyx_n_s__new_realsocket;
static PyObject *__pyx_n_s__next;
static PyObject *__pyx_n_s__nonblock;
static PyObject *__pyx_n_s__off;
static PyObject *__pyx_n_s__open;
static PyObject *__pyx_n_s__orig_buffer;
static PyObject *__pyx_n_s__peek;
static PyObject *__pyx_n_s__peekline;
static PyObject *__pyx_n_s__peer_certificate;
static PyObject *__pyx_n_s__pending;
static PyObject *__pyx_n_s__pop;
static PyObject *__pyx_n_s__preference;
static PyObject *__pyx_n_s__prev;
static PyObject *__pyx_n_s__proto;
static PyObject *__pyx_n_s__r;
static PyObject *__pyx_n_s__range;
static PyObject *__pyx_n_s__read;
static PyObject *__pyx_n_s__read_at_most;
static PyObject *__pyx_n_s__read_eb;
static PyObject *__pyx_n_s__read_etc_hosts;
static PyObject *__pyx_n_s__read_fd;
static PyObject *__pyx_n_s__read_from_fd;
static PyObject *__pyx_n_s__read_from_fd_again;
static PyObject *__pyx_n_s__readline;
static PyObject *__pyx_n_s__realsock;
static PyObject *__pyx_n_s__recv;
static PyObject *__pyx_n_s__recv_into;
static PyObject *__pyx_n_s__recvfrom;
static PyObject *__pyx_n_s__recvfrom_into;
static PyObject *__pyx_n_s__remove;
static PyObject *__pyx_n_s__reset;
static PyObject *__pyx_n_s__run;
static PyObject *__pyx_n_s__send;
static PyObject *__pyx_n_s__sendto;
static PyObject *__pyx_n_s__server_side;
static PyObject *__pyx_n_s__set_fd_blocking;
static PyObject *__pyx_n_s__setblocking;
static PyObject *__pyx_n_s__setdefault;
static PyObject *__pyx_n_s__setdoclose;
static PyObject *__pyx_n_s__setsockopt;
static PyObject *__pyx_n_s__shutdown;
static PyObject *__pyx_n_s__sig;
static PyObject *__pyx_n_s__simple;
static PyObject *__pyx_n_s__sleep;
static PyObject *__pyx_n_s__sock;
static PyObject *__pyx_n_s__socket;
static PyObject *__pyx_n_s__socket_fromfd;
static PyObject *__pyx_n_s__socket_impl;
static PyObject *__pyx_n_s__socket_realsocket;
static PyObject *__pyx_n_s__split;
static PyObject *__pyx_n_s__ssl;
static PyObject *__pyx_n_s__ssl_version;
static PyObject *__pyx_n_s__sslobj;
static PyObject *__pyx_n_s__sslsock;
static PyObject *__pyx_n_s__sslsocket_impl;
static PyObject *__pyx_n_s__sslwrap;
static PyObject *__pyx_n_s__stackless;
static PyObject *__pyx_n_s__startswith;
static PyObject *__pyx_n_s__strip;
static PyObject *__pyx_n_s__sys;
static PyObject *__pyx_n_s__t;
static PyObject *__pyx_n_s__tasklet;
static PyObject *__pyx_n_s__tasklet_obj;
static PyObject *__pyx_n_s__tempval;
static PyObject *__pyx_n_s__timeout;
static PyObject *__pyx_n_s__timeout_value;
static PyObject *__pyx_n_s__totallen;
static PyObject *__pyx_n_s__traceback;
static PyObject *__pyx_n_s__ttl;
static PyObject *__pyx_n_s__tv;
static PyObject *__pyx_n_s__tv_sec;
static PyObject *__pyx_n_s__tv_usec;
static PyObject *__pyx_n_s__type;
static PyObject *__pyx_n_s__types;
static PyObject *__pyx_n_s__value;
static PyObject *__pyx_n_s__values;
static PyObject *__pyx_n_s__w;
static PyObject *__pyx_n_s__wakeup_ev;
static PyObject *__pyx_n_s__write;
static PyObject *__pyx_n_s__write_buffer_limit;
static PyObject *__pyx_n_s__write_eb;
static PyObject *__pyx_n_s__write_fd;
static PyObject *__pyx_n_s__write_to_fd;
static PyObject *__pyx_n_s__write_to_fd_again;
static PyObject *__pyx_n_s__xrange;
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_neg_1;
static PyObject *__pyx_int_neg_800;
static PyObject *__pyx_int_1024;
static PyObject *__pyx_k_2;
static PyObject *__pyx_k_17;

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":77
 * __event_exc = None
 * 
 * cdef void __event_abort():             # <<<<<<<<<<<<<<
 *     global __event_exc
 *     cdef timeval tv
 */

static  void __pyx_f_4coio___event_abort(void) {
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("__event_abort");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":80
 *     global __event_exc
 *     cdef timeval tv
 *     event_loopbreak()             # <<<<<<<<<<<<<<
 *     __event_exc = sys.exc_info()
 *     if __event_exc[0] is None:
 */
  event_loopbreak();

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":81
 *     cdef timeval tv
 *     event_loopbreak()
 *     __event_exc = sys.exc_info()             # <<<<<<<<<<<<<<
 *     if __event_exc[0] is None:
 *         __event_exc = None
 */
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____event_exc, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":82
 *     event_loopbreak()
 *     __event_exc = sys.exc_info()
 *     if __event_exc[0] is None:             # <<<<<<<<<<<<<<
 *         __event_exc = None
 * 
 */
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s____event_exc); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 == Py_None);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":83
 *     __event_exc = sys.exc_info()
 *     if __event_exc[0] is None:
 *         __event_exc = None             # <<<<<<<<<<<<<<
 * 
 * cdef void __event_handler(int fd, short evtype, void *arg) with gil:
 */
    if (PyObject_SetAttr(__pyx_m, __pyx_n_s____event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_WriteUnraisable("coio.__event_abort");
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":85
 *         __event_exc = None
 * 
 * cdef void __event_handler(int fd, short evtype, void *arg) with gil:             # <<<<<<<<<<<<<<
 *     (<object>arg).__callback(evtype)
 * 
 */

static  void __pyx_f_4coio___event_handler(int __pyx_v_fd, short __pyx_v_evtype, void *__pyx_v_arg) {
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyGILState_STATE _save = PyGILState_Ensure();
  __Pyx_RefNannySetupContext("__event_handler");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":86
 * 
 * cdef void __event_handler(int fd, short evtype, void *arg) with gil:
 *     (<object>arg).__callback(evtype)             # <<<<<<<<<<<<<<
 * 
 * cdef void __simple_event_handler(int fd, short evtype, void *arg) with gil:
 */
  __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_arg), __pyx_n_s____callback); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(__pyx_v_evtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("coio.__event_handler");
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  PyGILState_Release(_save);
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":88
 *     (<object>arg).__callback(evtype)
 * 
 * cdef void __simple_event_handler(int fd, short evtype, void *arg) with gil:             # <<<<<<<<<<<<<<
 *     (<object>arg).__simple_callback(evtype)
 * 
 */

static  void __pyx_f_4coio___simple_event_handler(int __pyx_v_fd, short __pyx_v_evtype, void *__pyx_v_arg) {
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyGILState_STATE _save = PyGILState_Ensure();
  __Pyx_RefNannySetupContext("__simple_event_handler");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":89
 * 
 * cdef void __simple_event_handler(int fd, short evtype, void *arg) with gil:
 *     (<object>arg).__simple_callback(evtype)             # <<<<<<<<<<<<<<
 * 
 * cdef class event:
 */
  __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_arg), __pyx_n_s____simple_callback); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(__pyx_v_evtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("coio.__simple_event_handler");
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  PyGILState_Release(_save);
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":109
 *     cdef timeval tv
 * 
 *     def __init__(self, callback, arg=None, short evtype=0, handle=-1,             # <<<<<<<<<<<<<<
 *                  simple=0):
 *         cdef event_handler handler
 */

static int __pyx_pf_4coio_5event___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_4coio_5event___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_callback = 0;
  PyObject *__pyx_v_arg = 0;
  short __pyx_v_evtype;
  PyObject *__pyx_v_handle = 0;
  PyObject *__pyx_v_simple = 0;
  __pyx_t_4coio_event_handler __pyx_v_handler;
  int __pyx_r;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__callback,&__pyx_n_s__arg,&__pyx_n_s__evtype,&__pyx_n_s__handle,&__pyx_n_s__simple,0};
  __Pyx_RefNannySetupContext("__init__");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[5] = {0,0,0,0,0};
    values[1] = ((PyObject *)Py_None);
    values[3] = ((PyObject *)__pyx_int_neg_1);
    values[4] = ((PyObject *)__pyx_int_0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__callback);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__arg);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
      case  2:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__evtype);
        if (unlikely(value)) { values[2] = value; kw_args--; }
      }
      case  3:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__handle);
        if (unlikely(value)) { values[3] = value; kw_args--; }
      }
      case  4:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__simple);
        if (unlikely(value)) { values[4] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_callback = values[0];
    __pyx_v_arg = values[1];
    if (values[2]) {
      __pyx_v_evtype = __Pyx_PyInt_AsShort(values[2]); if (unlikely((__pyx_v_evtype == (short)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_evtype = ((short)0);
    }
    __pyx_v_handle = values[3];
    __pyx_v_simple = values[4];
  } else {
    __pyx_v_arg = ((PyObject *)Py_None);
    __pyx_v_evtype = ((short)0);
    __pyx_v_handle = ((PyObject *)__pyx_int_neg_1);
    __pyx_v_simple = ((PyObject *)__pyx_int_0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  5: __pyx_v_simple = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4: __pyx_v_handle = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: __pyx_v_evtype = __Pyx_PyInt_AsShort(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_evtype == (short)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  2: __pyx_v_arg = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: __pyx_v_callback = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.event.__init__");
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_callback);
  __Pyx_INCREF(__pyx_v_arg);
  __Pyx_INCREF(__pyx_v_handle);
  __Pyx_INCREF(__pyx_v_simple);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":113
 *         cdef event_handler handler
 * 
 *         self.callback = callback             # <<<<<<<<<<<<<<
 *         self.args = arg
 *         self.evtype = evtype
 */
  __Pyx_INCREF(__pyx_v_callback);
  __Pyx_GIVEREF(__pyx_v_callback);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  __Pyx_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback = __pyx_v_callback;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":114
 * 
 *         self.callback = callback
 *         self.args = arg             # <<<<<<<<<<<<<<
 *         self.evtype = evtype
 *         self.handle = handle
 */
  __Pyx_INCREF(__pyx_v_arg);
  __Pyx_GIVEREF(__pyx_v_arg);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  __Pyx_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->args = __pyx_v_arg;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":115
 *         self.callback = callback
 *         self.args = arg
 *         self.evtype = evtype             # <<<<<<<<<<<<<<
 *         self.handle = handle
 *         if simple:
 */
  __pyx_t_1 = PyInt_FromLong(__pyx_v_evtype); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->evtype);
  __Pyx_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->evtype);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->evtype = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":116
 *         self.args = arg
 *         self.evtype = evtype
 *         self.handle = handle             # <<<<<<<<<<<<<<
 *         if simple:
 *             handler = __simple_event_handler
 */
  __Pyx_INCREF(__pyx_v_handle);
  __Pyx_GIVEREF(__pyx_v_handle);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  __Pyx_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle = __pyx_v_handle;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":117
 *         self.evtype = evtype
 *         self.handle = handle
 *         if simple:             # <<<<<<<<<<<<<<
 *             handler = __simple_event_handler
 *         else:
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_simple); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":118
 *         self.handle = handle
 *         if simple:
 *             handler = __simple_event_handler             # <<<<<<<<<<<<<<
 *         else:
 *             handler = __event_handler
 */
    __pyx_v_handler = __pyx_f_4coio___simple_event_handler;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":120
 *             handler = __simple_event_handler
 *         else:
 *             handler = __event_handler             # <<<<<<<<<<<<<<
 *         if evtype == 0 and not handle:
 *             evtimer_set(&self.ev, handler, <void *>self)
 */
    __pyx_v_handler = __pyx_f_4coio___event_handler;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":121
 *         else:
 *             handler = __event_handler
 *         if evtype == 0 and not handle:             # <<<<<<<<<<<<<<
 *             evtimer_set(&self.ev, handler, <void *>self)
 *         else:
 */
  __pyx_t_2 = (__pyx_v_evtype == 0);
  if (__pyx_t_2) {
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_handle); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_4 = (!__pyx_t_3);
    __pyx_t_3 = __pyx_t_4;
  } else {
    __pyx_t_3 = __pyx_t_2;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":122
 *             handler = __event_handler
 *         if evtype == 0 and not handle:
 *             evtimer_set(&self.ev, handler, <void *>self)             # <<<<<<<<<<<<<<
 *         else:
 *             if not isinstance(handle, int):
 */
    evtimer_set((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), __pyx_v_handler, ((void *)__pyx_v_self));
    goto __pyx_L7;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":124
 *             evtimer_set(&self.ev, handler, <void *>self)
 *         else:
 *             if not isinstance(handle, int):             # <<<<<<<<<<<<<<
 *                 handle = handle.fileno()
 *             event_set(&self.ev, handle, evtype, handler, <void *>self)
 */
    __pyx_t_3 = PyObject_TypeCheck(__pyx_v_handle, ((PyTypeObject *)((PyObject*)&PyInt_Type))); 
    __pyx_t_2 = (!__pyx_t_3);
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":125
 *         else:
 *             if not isinstance(handle, int):
 *                 handle = handle.fileno()             # <<<<<<<<<<<<<<
 *             event_set(&self.ev, handle, evtype, handler, <void *>self)
 * 
 */
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_handle, __pyx_n_s__fileno); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_v_handle);
      __pyx_v_handle = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":126
 *             if not isinstance(handle, int):
 *                 handle = handle.fileno()
 *             event_set(&self.ev, handle, evtype, handler, <void *>self)             # <<<<<<<<<<<<<<
 * 
 *     def __simple_callback(self, short evtype):
 */
    __pyx_t_6 = __Pyx_PyInt_AsInt(__pyx_v_handle); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    event_set((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), __pyx_t_6, __pyx_v_evtype, __pyx_v_handler, ((void *)__pyx_v_self));
  }
  __pyx_L7:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.event.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_callback);
  __Pyx_DECREF(__pyx_v_arg);
  __Pyx_DECREF(__pyx_v_handle);
  __Pyx_DECREF(__pyx_v_simple);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":128
 *             event_set(&self.ev, handle, evtype, handler, <void *>self)
 * 
 *     def __simple_callback(self, short evtype):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.callback(*self.args) != None:
 */

static PyObject *__pyx_pf_4coio_5event___simple_callback(PyObject *__pyx_v_self, PyObject *__pyx_arg_evtype); /*proto*/
static PyObject *__pyx_pf_4coio_5event___simple_callback(PyObject *__pyx_v_self, PyObject *__pyx_arg_evtype) {
  short __pyx_v_evtype;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("__simple_callback");
  assert(__pyx_arg_evtype); {
    __pyx_v_evtype = __Pyx_PyInt_AsShort(__pyx_arg_evtype); if (unlikely((__pyx_v_evtype == (short)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.event.__simple_callback");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":129
 * 
 *     def __simple_callback(self, short evtype):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.callback(*self.args) != None:
 *                 if self.tv.tv_sec or self.tv.tv_usec:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":130
 *     def __simple_callback(self, short evtype):
 *         try:
 *             if self.callback(*self.args) != None:             # <<<<<<<<<<<<<<
 *                 if self.tv.tv_sec or self.tv.tv_usec:
 *                     event_add(&self.ev, &self.tv)
 */
      __pyx_t_1 = PySequence_Tuple(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      __pyx_t_2 = PyObject_Call(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, Py_None, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":131
 *         try:
 *             if self.callback(*self.args) != None:
 *                 if self.tv.tv_sec or self.tv.tv_usec:             # <<<<<<<<<<<<<<
 *                     event_add(&self.ev, &self.tv)
 *                 else:
 */
        if (!((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec) {
          __pyx_t_3 = ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_usec;
        } else {
          __pyx_t_3 = ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec;
        }
        if (__pyx_t_3) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":132
 *             if self.callback(*self.args) != None:
 *                 if self.tv.tv_sec or self.tv.tv_usec:
 *                     event_add(&self.ev, &self.tv)             # <<<<<<<<<<<<<<
 *                 else:
 *                     event_add(&self.ev, NULL)
 */
          event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), (&((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv));
          goto __pyx_L14;
        }
        /*else*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":134
 *                     event_add(&self.ev, &self.tv)
 *                 else:
 *                     event_add(&self.ev, NULL)             # <<<<<<<<<<<<<<
 *         except:
 *             __event_abort()
 */
          event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), NULL);
        }
        __pyx_L14:;
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L12_try_end;
    __pyx_L5_error:;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":135
 *                 else:
 *                     event_add(&self.ev, NULL)
 *         except:             # <<<<<<<<<<<<<<
 *             __event_abort()
 *         # XXX - account for event.signal() EV_PERSIST
 */
    /*except:*/ {
      __Pyx_AddTraceback("coio.event.__simple_callback");
      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_4);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":136
 *                     event_add(&self.ev, NULL)
 *         except:
 *             __event_abort()             # <<<<<<<<<<<<<<
 *         # XXX - account for event.signal() EV_PERSIST
 *         if not (evtype & c_EV_SIGNAL) and \
 */
      __pyx_f_4coio___event_abort();
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L6_exception_handled;
    }
    __pyx_L7_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L6_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L12_try_end:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":138
 *             __event_abort()
 *         # XXX - account for event.signal() EV_PERSIST
 *         if not (evtype & c_EV_SIGNAL) and \             # <<<<<<<<<<<<<<
 *            not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT, NULL):
 *             Py_DECREF(self)
 */
  __pyx_t_3 = (!(__pyx_v_evtype & EV_SIGNAL));
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":139
 *         # XXX - account for event.signal() EV_PERSIST
 *         if not (evtype & c_EV_SIGNAL) and \
 *            not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT, NULL):             # <<<<<<<<<<<<<<
 *             Py_DECREF(self)
 * 
 */
    __pyx_t_5 = (!event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), (((EV_READ | EV_WRITE) | EV_SIGNAL) | EV_TIMEOUT), NULL));
    __pyx_t_6 = __pyx_t_5;
  } else {
    __pyx_t_6 = __pyx_t_3;
  }
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":140
 *         if not (evtype & c_EV_SIGNAL) and \
 *            not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT, NULL):
 *             Py_DECREF(self)             # <<<<<<<<<<<<<<
 * 
 *     def __callback(self, short evtype):
 */
    Py_DECREF(__pyx_v_self);
    goto __pyx_L17;
  }
  __pyx_L17:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.event.__simple_callback");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":142
 *             Py_DECREF(self)
 * 
 *     def __callback(self, short evtype):             # <<<<<<<<<<<<<<
 *         try:
 *             self.callback(self, self.handle, evtype, self.args)
 */

static PyObject *__pyx_pf_4coio_5event___callback(PyObject *__pyx_v_self, PyObject *__pyx_arg_evtype); /*proto*/
static PyObject *__pyx_pf_4coio_5event___callback(PyObject *__pyx_v_self, PyObject *__pyx_arg_evtype) {
  short __pyx_v_evtype;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("__callback");
  assert(__pyx_arg_evtype); {
    __pyx_v_evtype = __Pyx_PyInt_AsShort(__pyx_arg_evtype); if (unlikely((__pyx_v_evtype == (short)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.event.__callback");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":143
 * 
 *     def __callback(self, short evtype):
 *         try:             # <<<<<<<<<<<<<<
 *             self.callback(self, self.handle, evtype, self.args)
 *         except:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":144
 *     def __callback(self, short evtype):
 *         try:
 *             self.callback(self, self.handle, evtype, self.args)             # <<<<<<<<<<<<<<
 *         except:
 *             __event_abort()
 */
      __pyx_t_1 = PyInt_FromLong(__pyx_v_evtype); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_v_self);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self);
      __Pyx_GIVEREF(__pyx_v_self);
      __Pyx_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
      PyTuple_SET_ITEM(__pyx_t_2, 1, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
      __Pyx_GIVEREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __Pyx_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
      PyTuple_SET_ITEM(__pyx_t_2, 3, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
      __Pyx_GIVEREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
      __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_Call(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L12_try_end;
    __pyx_L5_error:;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":145
 *         try:
 *             self.callback(self, self.handle, evtype, self.args)
 *         except:             # <<<<<<<<<<<<<<
 *             __event_abort()
 *         if not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT, NULL):
 */
    /*except:*/ {
      __Pyx_AddTraceback("coio.event.__callback");
      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_3);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":146
 *             self.callback(self, self.handle, evtype, self.args)
 *         except:
 *             __event_abort()             # <<<<<<<<<<<<<<
 *         if not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT, NULL):
 *             Py_DECREF(self)
 */
      __pyx_f_4coio___event_abort();
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L6_exception_handled;
    }
    __pyx_L7_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L6_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L12_try_end:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":147
 *         except:
 *             __event_abort()
 *         if not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT, NULL):             # <<<<<<<<<<<<<<
 *             Py_DECREF(self)
 * 
 */
  __pyx_t_4 = (!event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), (((EV_READ | EV_WRITE) | EV_SIGNAL) | EV_TIMEOUT), NULL));
  if (__pyx_t_4) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":148
 *             __event_abort()
 *         if not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT, NULL):
 *             Py_DECREF(self)             # <<<<<<<<<<<<<<
 * 
 *     def add(self, float timeout=-1):
 */
    Py_DECREF(__pyx_v_self);
    goto __pyx_L15;
  }
  __pyx_L15:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.event.__callback");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":150
 *             Py_DECREF(self)
 * 
 *     def add(self, float timeout=-1):             # <<<<<<<<<<<<<<
 *         """Add event to be executed after an optional timeout.
 * 
 */

static PyObject *__pyx_pf_4coio_5event_add(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_5event_add[] = "Add event to be executed after an optional timeout.\n\n        Arguments:\n        \n        timeout -- seconds after which the event will be executed\n        ";
static PyObject *__pyx_pf_4coio_5event_add(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  float __pyx_v_timeout;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__timeout,0};
  __Pyx_RefNannySetupContext("add");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__timeout);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "add") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    if (values[0]) {
      __pyx_v_timeout = __pyx_PyFloat_AsDouble(values[0]); if (unlikely((__pyx_v_timeout == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_timeout = ((float)-1);
    }
  } else {
    __pyx_v_timeout = ((float)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_timeout = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_timeout == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("add", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.event.add");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":158
 *         """
 *         if not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT,
 *                              NULL):             # <<<<<<<<<<<<<<
 *             Py_INCREF(self)
 *         self.timeout = timeout
 */
  __pyx_t_1 = (!event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), (((EV_READ | EV_WRITE) | EV_SIGNAL) | EV_TIMEOUT), NULL));
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":159
 *         if not event_pending(&self.ev, c_EV_READ|c_EV_WRITE|c_EV_SIGNAL|c_EV_TIMEOUT,
 *                              NULL):
 *             Py_INCREF(self)             # <<<<<<<<<<<<<<
 *         self.timeout = timeout
 *         if timeout >= 0.0:
 */
    Py_INCREF(__pyx_v_self);
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":160
 *                              NULL):
 *             Py_INCREF(self)
 *         self.timeout = timeout             # <<<<<<<<<<<<<<
 *         if timeout >= 0.0:
 *             self.tv.tv_sec = <long>timeout
 */
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->timeout = __pyx_v_timeout;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":161
 *             Py_INCREF(self)
 *         self.timeout = timeout
 *         if timeout >= 0.0:             # <<<<<<<<<<<<<<
 *             self.tv.tv_sec = <long>timeout
 *             self.tv.tv_usec = <unsigned int>((timeout - <float>self.tv.tv_sec) * 1000000.0)
 */
  __pyx_t_1 = (__pyx_v_timeout >= 0.0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":162
 *         self.timeout = timeout
 *         if timeout >= 0.0:
 *             self.tv.tv_sec = <long>timeout             # <<<<<<<<<<<<<<
 *             self.tv.tv_usec = <unsigned int>((timeout - <float>self.tv.tv_sec) * 1000000.0)
 *             event_add(&self.ev, &self.tv)
 */
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec = ((long)__pyx_v_timeout);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":163
 *         if timeout >= 0.0:
 *             self.tv.tv_sec = <long>timeout
 *             self.tv.tv_usec = <unsigned int>((timeout - <float>self.tv.tv_sec) * 1000000.0)             # <<<<<<<<<<<<<<
 *             event_add(&self.ev, &self.tv)
 *         else:
 */
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_usec = ((unsigned int)((__pyx_v_timeout - ((float)((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec)) * 1000000.0));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":164
 *             self.tv.tv_sec = <long>timeout
 *             self.tv.tv_usec = <unsigned int>((timeout - <float>self.tv.tv_sec) * 1000000.0)
 *             event_add(&self.ev, &self.tv)             # <<<<<<<<<<<<<<
 *         else:
 *             self.tv.tv_sec = self.tv.tv_usec = 0
 */
    event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), (&((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv));
    goto __pyx_L7;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":166
 *             event_add(&self.ev, &self.tv)
 *         else:
 *             self.tv.tv_sec = self.tv.tv_usec = 0             # <<<<<<<<<<<<<<
 *             event_add(&self.ev, NULL)
 * 
 */
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec = 0;
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_usec = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":167
 *         else:
 *             self.tv.tv_sec = self.tv.tv_usec = 0
 *             event_add(&self.ev, NULL)             # <<<<<<<<<<<<<<
 * 
 *     def pending(self):
 */
    event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), NULL);
  }
  __pyx_L7:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":169
 *             event_add(&self.ev, NULL)
 * 
 *     def pending(self):             # <<<<<<<<<<<<<<
 *         """Return 1 if the event is scheduled to run, or else 0."""
 *         return event_pending(&self.ev, c_EV_TIMEOUT|c_EV_SIGNAL|c_EV_READ|c_EV_WRITE, NULL)
 */

static PyObject *__pyx_pf_4coio_5event_pending(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_5event_pending[] = "Return 1 if the event is scheduled to run, or else 0.";
static PyObject *__pyx_pf_4coio_5event_pending(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("pending");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":171
 *     def pending(self):
 *         """Return 1 if the event is scheduled to run, or else 0."""
 *         return event_pending(&self.ev, c_EV_TIMEOUT|c_EV_SIGNAL|c_EV_READ|c_EV_WRITE, NULL)             # <<<<<<<<<<<<<<
 * 
 *     def delete(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev), (((EV_TIMEOUT | EV_SIGNAL) | EV_READ) | EV_WRITE), NULL)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.event.pending");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":173
 *         return event_pending(&self.ev, c_EV_TIMEOUT|c_EV_SIGNAL|c_EV_READ|c_EV_WRITE, NULL)
 * 
 *     def delete(self):             # <<<<<<<<<<<<<<
 *         """Remove event from the event queue."""
 *         if self.pending():
 */

static PyObject *__pyx_pf_4coio_5event_delete(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_5event_delete[] = "Remove event from the event queue.";
static PyObject *__pyx_pf_4coio_5event_delete(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("delete");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":175
 *     def delete(self):
 *         """Remove event from the event queue."""
 *         if self.pending():             # <<<<<<<<<<<<<<
 *             event_del(&self.ev)
 *             Py_DECREF(self)
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__pending); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":176
 *         """Remove event from the event queue."""
 *         if self.pending():
 *             event_del(&self.ev)             # <<<<<<<<<<<<<<
 *             Py_DECREF(self)
 * 
 */
    event_del((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":177
 *         if self.pending():
 *             event_del(&self.ev)
 *             Py_DECREF(self)             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
    Py_DECREF(__pyx_v_self);
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.event.delete");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":179
 *             Py_DECREF(self)
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         self.delete()
 * 
 */

static void __pyx_pf_4coio_5event___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pf_4coio_5event___dealloc__(PyObject *__pyx_v_self) {
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__dealloc__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":180
 * 
 *     def __dealloc__(self):
 *         self.delete()             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__delete); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.event.__dealloc__");
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":182
 *         self.delete()
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return '<event flags=0x%x, handle=%s, callback=%s, arg=%s>' % \
 *                (self.ev.ev_flags, self.handle, self.callback, self.args)
 */

static PyObject *__pyx_pf_4coio_5event___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_5event___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__repr__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":183
 * 
 *     def __repr__(self):
 *         return '<event flags=0x%x, handle=%s, callback=%s, arg=%s>' % \             # <<<<<<<<<<<<<<
 *                (self.ev.ev_flags, self.handle, self.callback, self.args)
 * 
 */
  __Pyx_XDECREF(__pyx_r);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":184
 *     def __repr__(self):
 *         return '<event flags=0x%x, handle=%s, callback=%s, arg=%s>' % \
 *                (self.ev.ev_flags, self.handle, self.callback, self.args)             # <<<<<<<<<<<<<<
 * 
 * def dispatch():
 */
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev.ev_flags); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  __Pyx_GIVEREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  __Pyx_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  PyTuple_SET_ITEM(__pyx_t_2, 2, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  __Pyx_GIVEREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  __Pyx_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  PyTuple_SET_ITEM(__pyx_t_2, 3, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  __Pyx_GIVEREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_1), __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.event.__repr__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":186
 *                (self.ev.ev_flags, self.handle, self.callback, self.args)
 * 
 * def dispatch():             # <<<<<<<<<<<<<<
 *     """Dispatch all events on the event queue.
 *     Returns -1 on error, 0 on success, and 1 if no events are registered.
 */

static PyObject *__pyx_pf_4coio_dispatch(PyObject *__pyx_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_dispatch[] = "Dispatch all events on the event queue.\n    Returns -1 on error, 0 on success, and 1 if no events are registered.\n    ";
static PyObject *__pyx_pf_4coio_dispatch(PyObject *__pyx_self, PyObject *unused) {
  int __pyx_v_ret;
  PyObject *__pyx_v_t;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("dispatch");
  __pyx_self = __pyx_self;
  __pyx_v_t = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":192
 *     cdef int ret
 *     global __event_exc
 *     with nogil:             # <<<<<<<<<<<<<<
 *         ret = event_dispatch()
 *     if __event_exc:
 */
  { PyThreadState *_save;
    Py_UNBLOCK_THREADS
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":193
 *     global __event_exc
 *     with nogil:
 *         ret = event_dispatch()             # <<<<<<<<<<<<<<
 *     if __event_exc:
 *         t = __event_exc
 */
      __pyx_v_ret = event_dispatch();
    }
    /*finally:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":192
 *     cdef int ret
 *     global __event_exc
 *     with nogil:             # <<<<<<<<<<<<<<
 *         ret = event_dispatch()
 *     if __event_exc:
 */
      Py_BLOCK_THREADS
    }
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":194
 *     with nogil:
 *         ret = event_dispatch()
 *     if __event_exc:             # <<<<<<<<<<<<<<
 *         t = __event_exc
 *         __event_exc = None
 */
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s____event_exc); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":195
 *         ret = event_dispatch()
 *     if __event_exc:
 *         t = __event_exc             # <<<<<<<<<<<<<<
 *         __event_exc = None
 *         raise t[0], t[1], t[2]
 */
    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s____event_exc); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_v_t);
    __pyx_v_t = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":196
 *     if __event_exc:
 *         t = __event_exc
 *         __event_exc = None             # <<<<<<<<<<<<<<
 *         raise t[0], t[1], t[2]
 *     return ret
 */
    if (PyObject_SetAttr(__pyx_m, __pyx_n_s____event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":197
 *         t = __event_exc
 *         __event_exc = None
 *         raise t[0], t[1], t[2]             # <<<<<<<<<<<<<<
 *     return ret
 * 
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_t, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_t, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_t, 2, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_Raise(__pyx_t_1, __pyx_t_3, __pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":198
 *         __event_exc = None
 *         raise t[0], t[1], t[2]
 *     return ret             # <<<<<<<<<<<<<<
 * 
 * def loop(nonblock=False):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.dispatch");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_t);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":200
 *     return ret
 * 
 * def loop(nonblock=False):             # <<<<<<<<<<<<<<
 *     """Dispatch all pending events on queue in a single pass.
 *     Returns -1 on error, 0 on success, and 1 if no events are registered."""
 */

static PyObject *__pyx_pf_4coio_loop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_loop[] = "Dispatch all pending events on queue in a single pass.\n    Returns -1 on error, 0 on success, and 1 if no events are registered.";
static PyObject *__pyx_pf_4coio_loop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_nonblock = 0;
  int __pyx_v_flags;
  int __pyx_v_ret;
  PyObject *__pyx_v_t;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__nonblock,0};
  __Pyx_RefNannySetupContext("loop");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    values[0] = __pyx_k_2;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__nonblock);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "loop") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_nonblock = values[0];
  } else {
    __pyx_v_nonblock = __pyx_k_2;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_nonblock = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("loop", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.loop");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_nonblock);
  __pyx_v_t = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":205
 *     cdef int flags, ret
 *     global __event_exc
 *     flags = EVLOOP_ONCE             # <<<<<<<<<<<<<<
 *     if nonblock:
 *         flags = EVLOOP_ONCE|EVLOOP_NONBLOCK
 */
  __pyx_v_flags = EVLOOP_ONCE;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":206
 *     global __event_exc
 *     flags = EVLOOP_ONCE
 *     if nonblock:             # <<<<<<<<<<<<<<
 *         flags = EVLOOP_ONCE|EVLOOP_NONBLOCK
 *     with nogil:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_nonblock); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":207
 *     flags = EVLOOP_ONCE
 *     if nonblock:
 *         flags = EVLOOP_ONCE|EVLOOP_NONBLOCK             # <<<<<<<<<<<<<<
 *     with nogil:
 *         ret = event_loop(flags)
 */
    __pyx_v_flags = (EVLOOP_ONCE | EVLOOP_NONBLOCK);
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":208
 *     if nonblock:
 *         flags = EVLOOP_ONCE|EVLOOP_NONBLOCK
 *     with nogil:             # <<<<<<<<<<<<<<
 *         ret = event_loop(flags)
 *     if __event_exc:
 */
  { PyThreadState *_save;
    Py_UNBLOCK_THREADS
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":209
 *         flags = EVLOOP_ONCE|EVLOOP_NONBLOCK
 *     with nogil:
 *         ret = event_loop(flags)             # <<<<<<<<<<<<<<
 *     if __event_exc:
 *         t = __event_exc
 */
      __pyx_v_ret = event_loop(__pyx_v_flags);
    }
    /*finally:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":208
 *     if nonblock:
 *         flags = EVLOOP_ONCE|EVLOOP_NONBLOCK
 *     with nogil:             # <<<<<<<<<<<<<<
 *         ret = event_loop(flags)
 *     if __event_exc:
 */
      Py_BLOCK_THREADS
    }
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":210
 *     with nogil:
 *         ret = event_loop(flags)
 *     if __event_exc:             # <<<<<<<<<<<<<<
 *         t = __event_exc
 *         __event_exc = None
 */
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s____event_exc); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":211
 *         ret = event_loop(flags)
 *     if __event_exc:
 *         t = __event_exc             # <<<<<<<<<<<<<<
 *         __event_exc = None
 *         raise t[0], t[1], t[2]
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s____event_exc); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_v_t);
    __pyx_v_t = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":212
 *     if __event_exc:
 *         t = __event_exc
 *         __event_exc = None             # <<<<<<<<<<<<<<
 *         raise t[0], t[1], t[2]
 *     return ret
 */
    if (PyObject_SetAttr(__pyx_m, __pyx_n_s____event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":213
 *         t = __event_exc
 *         __event_exc = None
 *         raise t[0], t[1], t[2]             # <<<<<<<<<<<<<<
 *     return ret
 * 
 */
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_t, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_t, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_t, 2, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_Raise(__pyx_t_2, __pyx_t_3, __pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L10;
  }
  __pyx_L10:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":214
 *         __event_exc = None
 *         raise t[0], t[1], t[2]
 *     return ret             # <<<<<<<<<<<<<<
 * 
 * def abort():
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.loop");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_t);
  __Pyx_DECREF(__pyx_v_nonblock);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":216
 *     return ret
 * 
 * def abort():             # <<<<<<<<<<<<<<
 *     """Abort event dispatch loop."""
 *     __event_abort()
 */

static PyObject *__pyx_pf_4coio_abort(PyObject *__pyx_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_abort[] = "Abort event dispatch loop.";
static PyObject *__pyx_pf_4coio_abort(PyObject *__pyx_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("abort");
  __pyx_self = __pyx_self;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":218
 * def abort():
 *     """Abort event dispatch loop."""
 *     __event_abort()             # <<<<<<<<<<<<<<
 */
  __pyx_f_4coio___event_abort();

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":162
 *     #tasklet PyTasklet_New(type type_type, object func);
 * 
 * def SendExceptionAndRun(tasklet tasklet_obj, exc_info):             # <<<<<<<<<<<<<<
 *     """Send exception to tasklet, even if it's blocked on a channel.
 * 
 */

static PyObject *__pyx_pf_4coio_SendExceptionAndRun(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_SendExceptionAndRun[] = "Send exception to tasklet, even if it's blocked on a channel.\n\n    To get the tasklet is activated (to handle the exception) after\n    SendException, call tasklet.run() after calling SendException.\n\n    tasklet.insert() is called automatically to ensure that it eventually gets\n    scheduled.\n    ";
static PyObject *__pyx_pf_4coio_SendExceptionAndRun(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyTaskletObject *__pyx_v_tasklet_obj = 0;
  PyObject *__pyx_v_exc_info = 0;
  PyObject *__pyx_v_bomb_obj;
  PyObject *__pyx_v_c;
  PyObject *__pyx_v_old_preference;
  PyObject *__pyx_v_i;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__tasklet_obj,&__pyx_n_s__exc_info,0};
  __Pyx_RefNannySetupContext("SendExceptionAndRun");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__tasklet_obj);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__exc_info);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("SendExceptionAndRun", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "SendExceptionAndRun") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_tasklet_obj = ((PyTaskletObject *)values[0]);
    __pyx_v_exc_info = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_tasklet_obj = ((PyTaskletObject *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_exc_info = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("SendExceptionAndRun", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.SendExceptionAndRun");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_tasklet_obj);
  __Pyx_INCREF(__pyx_v_exc_info);
  __pyx_v_bomb_obj = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_c = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_old_preference = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_i = Py_None; __Pyx_INCREF(Py_None);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tasklet_obj), __pyx_ptype_4coio_tasklet, 1, "tasklet_obj", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":171
 *     scheduled.
 *     """
 *     if not isinstance(exc_info, list) and not isinstance(exc_info, tuple):             # <<<<<<<<<<<<<<
 *         raise TypeError
 *     if tasklet_obj is PyStackless_GetCurrent():
 */
  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_exc_info, ((PyTypeObject *)((PyObject*)&PyList_Type))); 
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {
    __pyx_t_1 = PyObject_TypeCheck(__pyx_v_exc_info, ((PyTypeObject *)((PyObject*)&PyTuple_Type))); 
    __pyx_t_3 = (!__pyx_t_1);
    __pyx_t_1 = __pyx_t_3;
  } else {
    __pyx_t_1 = __pyx_t_2;
  }
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":172
 *     """
 *     if not isinstance(exc_info, list) and not isinstance(exc_info, tuple):
 *         raise TypeError             # <<<<<<<<<<<<<<
 *     if tasklet_obj is PyStackless_GetCurrent():
 *         if len(exc_info) < 3:
 */
    __Pyx_Raise(__pyx_builtin_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":173
 *     if not isinstance(exc_info, list) and not isinstance(exc_info, tuple):
 *         raise TypeError
 *     if tasklet_obj is PyStackless_GetCurrent():             # <<<<<<<<<<<<<<
 *         if len(exc_info) < 3:
 *             exc_info = list(exc_info) + [None, None]
 */
  __pyx_t_4 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = (__pyx_v_tasklet_obj == ((PyTaskletObject *)__pyx_t_4));
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":174
 *         raise TypeError
 *     if tasklet_obj is PyStackless_GetCurrent():
 *         if len(exc_info) < 3:             # <<<<<<<<<<<<<<
 *             exc_info = list(exc_info) + [None, None]
 *         raise exc_info[0], exc_info[1], exc_info[2]
 */
    __pyx_t_5 = PyObject_Length(__pyx_v_exc_info); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = (__pyx_t_5 < 3);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":175
 *     if tasklet_obj is PyStackless_GetCurrent():
 *         if len(exc_info) < 3:
 *             exc_info = list(exc_info) + [None, None]             # <<<<<<<<<<<<<<
 *         raise exc_info[0], exc_info[1], exc_info[2]
 *     bomb_obj = bomb(*exc_info)
 */
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_exc_info);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_exc_info);
      __Pyx_GIVEREF(__pyx_v_exc_info);
      __pyx_t_6 = PyObject_Call(((PyObject *)((PyObject*)&PyList_Type)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyList_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_4));
      __Pyx_INCREF(Py_None);
      PyList_SET_ITEM(__pyx_t_4, 0, Py_None);
      __Pyx_GIVEREF(Py_None);
      __Pyx_INCREF(Py_None);
      PyList_SET_ITEM(__pyx_t_4, 1, Py_None);
      __Pyx_GIVEREF(Py_None);
      __pyx_t_7 = PyNumber_Add(__pyx_t_6, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_v_exc_info);
      __pyx_v_exc_info = __pyx_t_7;
      __pyx_t_7 = 0;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":176
 *         if len(exc_info) < 3:
 *             exc_info = list(exc_info) + [None, None]
 *         raise exc_info[0], exc_info[1], exc_info[2]             # <<<<<<<<<<<<<<
 *     bomb_obj = bomb(*exc_info)
 *     if tasklet_obj.blocked:
 */
    __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_exc_info, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_exc_info, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_exc_info, 2, sizeof(long), PyInt_FromLong); if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_Raise(__pyx_t_7, __pyx_t_4, __pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":177
 *             exc_info = list(exc_info) + [None, None]
 *         raise exc_info[0], exc_info[1], exc_info[2]
 *     bomb_obj = bomb(*exc_info)             # <<<<<<<<<<<<<<
 *     if tasklet_obj.blocked:
 *         c = tasklet_obj._channel
 */
  __pyx_t_6 = PySequence_Tuple(__pyx_v_exc_info); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_6));
  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_bomb)), ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_v_bomb_obj);
  __pyx_v_bomb_obj = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":178
 *         raise exc_info[0], exc_info[1], exc_info[2]
 *     bomb_obj = bomb(*exc_info)
 *     if tasklet_obj.blocked:             # <<<<<<<<<<<<<<
 *         c = tasklet_obj._channel
 *         old_preference = c.preference
 */
  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_s__blocked); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":179
 *     bomb_obj = bomb(*exc_info)
 *     if tasklet_obj.blocked:
 *         c = tasklet_obj._channel             # <<<<<<<<<<<<<<
 *         old_preference = c.preference
 *         c.preference = 1    # Prefer the sender.
 */
    __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_s___channel); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_c);
    __pyx_v_c = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":180
 *     if tasklet_obj.blocked:
 *         c = tasklet_obj._channel
 *         old_preference = c.preference             # <<<<<<<<<<<<<<
 *         c.preference = 1    # Prefer the sender.
 *         for i in xrange(-c.balance):
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_c, __pyx_n_s__preference); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_old_preference);
    __pyx_v_old_preference = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":181
 *         c = tasklet_obj._channel
 *         old_preference = c.preference
 *         c.preference = 1    # Prefer the sender.             # <<<<<<<<<<<<<<
 *         for i in xrange(-c.balance):
 *             c.send(bomb_obj)
 */
    if (PyObject_SetAttr(__pyx_v_c, __pyx_n_s__preference, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":182
 *         old_preference = c.preference
 *         c.preference = 1    # Prefer the sender.
 *         for i in xrange(-c.balance):             # <<<<<<<<<<<<<<
 *             c.send(bomb_obj)
 *         c.preference = old_preference
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_c, __pyx_n_s__balance); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(__pyx_builtin_xrange, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (PyList_CheckExact(__pyx_t_6) || PyTuple_CheckExact(__pyx_t_6)) {
      __pyx_t_5 = 0; __pyx_t_4 = __pyx_t_6; __Pyx_INCREF(__pyx_t_4);
    } else {
      __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_4)) break;
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_6); __pyx_t_5++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_4))) {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_6); __pyx_t_5++;
      } else {
        __pyx_t_6 = PyIter_Next(__pyx_t_4);
        if (!__pyx_t_6) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_6);
      }
      __Pyx_DECREF(__pyx_v_i);
      __pyx_v_i = __pyx_t_6;
      __pyx_t_6 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":183
 *         c.preference = 1    # Prefer the sender.
 *         for i in xrange(-c.balance):
 *             c.send(bomb_obj)             # <<<<<<<<<<<<<<
 *         c.preference = old_preference
 *     else:
 */
      __pyx_t_6 = PyObject_GetAttr(__pyx_v_c, __pyx_n_s__send); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_INCREF(__pyx_v_bomb_obj);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_bomb_obj);
      __Pyx_GIVEREF(__pyx_v_bomb_obj);
      __pyx_t_8 = PyObject_Call(__pyx_t_6, __pyx_t_7, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":184
 *         for i in xrange(-c.balance):
 *             c.send(bomb_obj)
 *         c.preference = old_preference             # <<<<<<<<<<<<<<
 *     else:
 *         tasklet_obj.tempval = bomb_obj
 */
    if (PyObject_SetAttr(__pyx_v_c, __pyx_n_s__preference, __pyx_v_old_preference) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L9;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":186
 *         c.preference = old_preference
 *     else:
 *         tasklet_obj.tempval = bomb_obj             # <<<<<<<<<<<<<<
 *     tasklet_obj.insert()
 *     tasklet_obj.run()
 */
    __Pyx_INCREF(__pyx_v_bomb_obj);
    __Pyx_GIVEREF(__pyx_v_bomb_obj);
    __Pyx_GOTREF(__pyx_v_tasklet_obj->tempval);
    __Pyx_DECREF(__pyx_v_tasklet_obj->tempval);
    __pyx_v_tasklet_obj->tempval = __pyx_v_bomb_obj;
  }
  __pyx_L9:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":187
 *     else:
 *         tasklet_obj.tempval = bomb_obj
 *     tasklet_obj.insert()             # <<<<<<<<<<<<<<
 *     tasklet_obj.run()
 * 
 */
  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_s__insert); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":188
 *         tasklet_obj.tempval = bomb_obj
 *     tasklet_obj.insert()
 *     tasklet_obj.run()             # <<<<<<<<<<<<<<
 * 
 * # Example code:
 */
  __pyx_t_8 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_s__run); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.SendExceptionAndRun");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_bomb_obj);
  __Pyx_DECREF(__pyx_v_c);
  __Pyx_DECREF(__pyx_v_old_preference);
  __Pyx_DECREF(__pyx_v_i);
  __Pyx_DECREF((PyObject *)__pyx_v_tasklet_obj);
  __Pyx_DECREF(__pyx_v_exc_info);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":196
 * #        PyStackless_Schedule(None, 0)  # remove
 * 
 * def LinkHelper():             # <<<<<<<<<<<<<<
 *     raise RuntimeError('LinkHelper tasklet called')
 * 
 */

static PyObject *__pyx_pf_4coio_LinkHelper(PyObject *__pyx_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_LinkHelper(PyObject *__pyx_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("LinkHelper");
  __pyx_self = __pyx_self;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":197
 * 
 * def LinkHelper():
 *     raise RuntimeError('LinkHelper tasklet called')             # <<<<<<<<<<<<<<
 * 
 * # TODO(pts): Experiment calling these from Python instead of C.
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_3));
  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
  __pyx_t_2 = PyObject_Call(__pyx_builtin_RuntimeError, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_Raise(__pyx_t_2, 0, 0);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.LinkHelper");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":200
 * 
 * # TODO(pts): Experiment calling these from Python instead of C.
 * def MainLoop(tasklet link_helper_tasklet):             # <<<<<<<<<<<<<<
 *     #cdef PyTaskletObject *pprev
 *     #cdef PyTaskletObject *pnext
 */

static PyObject *__pyx_pf_4coio_MainLoop(PyObject *__pyx_self, PyObject *__pyx_v_link_helper_tasklet); /*proto*/
static PyObject *__pyx_pf_4coio_MainLoop(PyObject *__pyx_self, PyObject *__pyx_v_link_helper_tasklet) {
  PyTaskletObject *__pyx_v_ptemp;
  PyTaskletObject *__pyx_v_p;
  PyTaskletObject *__pyx_v_c;
  PyObject *__pyx_v_o;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("MainLoop");
  __pyx_self = __pyx_self;
  __Pyx_INCREF((PyObject *)__pyx_v_link_helper_tasklet);
  __pyx_v_o = Py_None; __Pyx_INCREF(Py_None);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_link_helper_tasklet), __pyx_ptype_4coio_tasklet, 1, "link_helper_tasklet", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":206
 *     cdef PyTaskletObject *p
 *     cdef PyTaskletObject *c
 *     o = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *     # Using c instead of o below prevents reference counting.
 *     c = <PyTaskletObject*>o
 */
  __pyx_t_1 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_v_o);
  __pyx_v_o = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":208
 *     o = PyStackless_GetCurrent()
 *     # Using c instead of o below prevents reference counting.
 *     c = <PyTaskletObject*>o             # <<<<<<<<<<<<<<
 *     p = <PyTaskletObject*>link_helper_tasklet
 *     assert c != p
 */
  __pyx_v_c = ((PyTaskletObject *)__pyx_v_o);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":209
 *     # Using c instead of o below prevents reference counting.
 *     c = <PyTaskletObject*>o
 *     p = <PyTaskletObject*>link_helper_tasklet             # <<<<<<<<<<<<<<
 *     assert c != p
 * 
 */
  __pyx_v_p = ((PyTaskletObject *)__pyx_v_link_helper_tasklet);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":210
 *     c = <PyTaskletObject*>o
 *     p = <PyTaskletObject*>link_helper_tasklet
 *     assert c != p             # <<<<<<<<<<<<<<
 * 
 *     while 1:  # ``while 1`'' is more efficient in Pyrex than ``while True''
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (unlikely(!(__pyx_v_c != __pyx_v_p))) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":212
 *     assert c != p
 * 
 *     while 1:  # ``while 1`'' is more efficient in Pyrex than ``while True''             # <<<<<<<<<<<<<<
 *         #print 'MainLoop', PyStackless_GetRunCount()
 *         # !! TODO(pts): what if nothing registered and we're running MainLoop
 */
  while (1) {
    __pyx_t_2 = 1;
    if (!__pyx_t_2) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":221
 *         # tasklets added by loop(...) below will be added between
 *         # link_helper_tasklet
 *         if p.next != NULL:             # <<<<<<<<<<<<<<
 *             PyTasklet_Remove(link_helper_tasklet)
 *         PyTasklet_Insert(link_helper_tasklet)
 */
    __pyx_t_2 = (__pyx_v_p->next != NULL);
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":222
 *         # link_helper_tasklet
 *         if p.next != NULL:
 *             PyTasklet_Remove(link_helper_tasklet)             # <<<<<<<<<<<<<<
 *         PyTasklet_Insert(link_helper_tasklet)
 * 
 */
      __pyx_t_3 = PyTasklet_Remove(((PyTaskletObject *)__pyx_v_link_helper_tasklet)); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":223
 *         if p.next != NULL:
 *             PyTasklet_Remove(link_helper_tasklet)
 *         PyTasklet_Insert(link_helper_tasklet)             # <<<<<<<<<<<<<<
 * 
 *         # This runs 1 iteration of the libevent main loop: waiting for
 */
    __pyx_t_3 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_link_helper_tasklet)); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":238
 *         # We compare against 2 because of stackless.current
 *         # (main_loop_tasklet) and link_helper_tasklet.
 *         loop(PyStackless_GetRunCount() > 2)             # <<<<<<<<<<<<<<
 * 
 *         # Swap link_helper_tasklet and stackless.current in the queue.  We
 */
    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__loop); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyBool_FromLong((PyStackless_GetRunCount() > 2)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":247
 *         # The swap implementation would work even for p == c, or if p and c
 *         # are adjacent.
 *         ptemp = p.next             # <<<<<<<<<<<<<<
 *         p.next = c.next
 *         c.next = ptemp
 */
    __pyx_v_ptemp = __pyx_v_p->next;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":248
 *         # are adjacent.
 *         ptemp = p.next
 *         p.next = c.next             # <<<<<<<<<<<<<<
 *         c.next = ptemp
 *         p.next.prev = p
 */
    __pyx_v_p->next = __pyx_v_c->next;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":249
 *         ptemp = p.next
 *         p.next = c.next
 *         c.next = ptemp             # <<<<<<<<<<<<<<
 *         p.next.prev = p
 *         c.next.prev = c
 */
    __pyx_v_c->next = __pyx_v_ptemp;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":250
 *         p.next = c.next
 *         c.next = ptemp
 *         p.next.prev = p             # <<<<<<<<<<<<<<
 *         c.next.prev = c
 *         ptemp = p.prev
 */
    __pyx_v_p->next->prev = __pyx_v_p;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":251
 *         c.next = ptemp
 *         p.next.prev = p
 *         c.next.prev = c             # <<<<<<<<<<<<<<
 *         ptemp = p.prev
 *         p.prev = c.prev
 */
    __pyx_v_c->next->prev = __pyx_v_c;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":252
 *         p.next.prev = p
 *         c.next.prev = c
 *         ptemp = p.prev             # <<<<<<<<<<<<<<
 *         p.prev = c.prev
 *         c.prev = ptemp
 */
    __pyx_v_ptemp = __pyx_v_p->prev;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":253
 *         c.next.prev = c
 *         ptemp = p.prev
 *         p.prev = c.prev             # <<<<<<<<<<<<<<
 *         c.prev = ptemp
 *         p.prev.next = p
 */
    __pyx_v_p->prev = __pyx_v_c->prev;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":254
 *         ptemp = p.prev
 *         p.prev = c.prev
 *         c.prev = ptemp             # <<<<<<<<<<<<<<
 *         p.prev.next = p
 *         c.prev.next = c
 */
    __pyx_v_c->prev = __pyx_v_ptemp;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":255
 *         p.prev = c.prev
 *         c.prev = ptemp
 *         p.prev.next = p             # <<<<<<<<<<<<<<
 *         c.prev.next = c
 * 
 */
    __pyx_v_p->prev->next = __pyx_v_p;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":256
 *         c.prev = ptemp
 *         p.prev.next = p
 *         c.prev.next = c             # <<<<<<<<<<<<<<
 * 
 *         PyTasklet_Remove(link_helper_tasklet)
 */
    __pyx_v_c->prev->next = __pyx_v_c;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":258
 *         c.prev.next = c
 * 
 *         PyTasklet_Remove(link_helper_tasklet)             # <<<<<<<<<<<<<<
 * 
 *         PyStackless_Schedule(None, 0)  # remove=0
 */
    __pyx_t_3 = PyTasklet_Remove(((PyTaskletObject *)__pyx_v_link_helper_tasklet)); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":260
 *         PyTasklet_Remove(link_helper_tasklet)
 * 
 *         PyStackless_Schedule(None, 0)  # remove=0             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_t_4 = PyStackless_Schedule(Py_None, 0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.MainLoop");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_o);
  __Pyx_DECREF((PyObject *)__pyx_v_link_helper_tasklet);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":266
 * # !! TODO(pts): Schedule the main thread upon the SIGINT, don't wait for
 * # cooperative scheduling.
 * def SigIntHandler(ev, sig, evtype, arg):             # <<<<<<<<<<<<<<
 *     SendExceptionAndRun(stackless.main, (KeyboardInterrupt,))
 * 
 */

static PyObject *__pyx_pf_4coio_SigIntHandler(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_SigIntHandler(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ev = 0;
  PyObject *__pyx_v_sig = 0;
  PyObject *__pyx_v_evtype = 0;
  PyObject *__pyx_v_arg = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__ev,&__pyx_n_s__sig,&__pyx_n_s__evtype,&__pyx_n_s__arg,0};
  __Pyx_RefNannySetupContext("SigIntHandler");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[4] = {0,0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ev);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__sig);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("SigIntHandler", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__evtype);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("SigIntHandler", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  3:
      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__arg);
      if (likely(values[3])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("SigIntHandler", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "SigIntHandler") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_ev = values[0];
    __pyx_v_sig = values[1];
    __pyx_v_evtype = values[2];
    __pyx_v_arg = values[3];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_ev = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_sig = PyTuple_GET_ITEM(__pyx_args, 1);
    __pyx_v_evtype = PyTuple_GET_ITEM(__pyx_args, 2);
    __pyx_v_arg = PyTuple_GET_ITEM(__pyx_args, 3);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("SigIntHandler", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.SigIntHandler");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":267
 * # cooperative scheduling.
 * def SigIntHandler(ev, sig, evtype, arg):
 *     SendExceptionAndRun(stackless.main, (KeyboardInterrupt,))             # <<<<<<<<<<<<<<
 * 
 * cdef void set_fd_nonblocking(int fd):
 */
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__SendExceptionAndRun); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__stackless); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__main); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_builtin_KeyboardInterrupt);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_builtin_KeyboardInterrupt);
  __Pyx_GIVEREF(__pyx_builtin_KeyboardInterrupt);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_3 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.SigIntHandler");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":269
 *     SendExceptionAndRun(stackless.main, (KeyboardInterrupt,))
 * 
 * cdef void set_fd_nonblocking(int fd):             # <<<<<<<<<<<<<<
 *     # This call works on Unix, but it's not portable (to e.g. Windows).
 *     # See also the #ifdefs in socketmodule.c:internal_setblocking().
 */

static  void __pyx_f_4coio_set_fd_nonblocking(int __pyx_v_fd) {
  int __pyx_v_old;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("set_fd_nonblocking");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":274
 *     cdef int old
 *     # TODO(pts): Don't silently ignore the errors.
 *     old = fcntl2(fd, F_GETFL)             # <<<<<<<<<<<<<<
 *     if old >= 0 and (old & ~O_NONBLOCK):
 *         fcntl3(fd, F_SETFL, old | O_NONBLOCK)
 */
  __pyx_v_old = fcntl(__pyx_v_fd, F_GETFL);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":275
 *     # TODO(pts): Don't silently ignore the errors.
 *     old = fcntl2(fd, F_GETFL)
 *     if old >= 0 and (old & ~O_NONBLOCK):             # <<<<<<<<<<<<<<
 *         fcntl3(fd, F_SETFL, old | O_NONBLOCK)
 * 
 */
  __pyx_t_1 = (__pyx_v_old >= 0);
  if (__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_old & (~O_NONBLOCK));
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":276
 *     old = fcntl2(fd, F_GETFL)
 *     if old >= 0 and (old & ~O_NONBLOCK):
 *         fcntl3(fd, F_SETFL, old | O_NONBLOCK)             # <<<<<<<<<<<<<<
 * 
 * def set_fd_blocking(int fd, is_blocking):
 */
    fcntl(__pyx_v_fd, F_SETFL, (__pyx_v_old | O_NONBLOCK));
    goto __pyx_L3;
  }
  __pyx_L3:;

  __Pyx_RefNannyFinishContext();
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":278
 *         fcntl3(fd, F_SETFL, old | O_NONBLOCK)
 * 
 * def set_fd_blocking(int fd, is_blocking):             # <<<<<<<<<<<<<<
 *     """Set a file descriptor blocking or nonblocking.
 * 
 */

static PyObject *__pyx_pf_4coio_set_fd_blocking(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_set_fd_blocking[] = "Set a file descriptor blocking or nonblocking.\n\n    Please note that this may affect more than expected, for example it may\n    affect sys.stderr when called for sys.stdout.\n\n    Returns:\n      The old blocking value (True or False).\n    ";
static PyObject *__pyx_pf_4coio_set_fd_blocking(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyObject *__pyx_v_is_blocking = 0;
  int __pyx_v_old;
  int __pyx_v_value;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__fd,&__pyx_n_s__is_blocking,0};
  __Pyx_RefNannySetupContext("set_fd_blocking");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fd);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__is_blocking);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("set_fd_blocking", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "set_fd_blocking") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_fd = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_is_blocking = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_is_blocking = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("set_fd_blocking", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.set_fd_blocking");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_is_blocking);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":290
 *     cdef int value
 *     # TODO(pts): Don't silently ignore the errors.
 *     old = fcntl2(fd, F_GETFL)             # <<<<<<<<<<<<<<
 *     if old < 0:
 *         return
 */
  __pyx_v_old = fcntl(__pyx_v_fd, F_GETFL);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":291
 *     # TODO(pts): Don't silently ignore the errors.
 *     old = fcntl2(fd, F_GETFL)
 *     if old < 0:             # <<<<<<<<<<<<<<
 *         return
 *     if is_blocking:
 */
  __pyx_t_1 = (__pyx_v_old < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":292
 *     old = fcntl2(fd, F_GETFL)
 *     if old < 0:
 *         return             # <<<<<<<<<<<<<<
 *     if is_blocking:
 *         value = old & ~O_NONBLOCK
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":293
 *     if old < 0:
 *         return
 *     if is_blocking:             # <<<<<<<<<<<<<<
 *         value = old & ~O_NONBLOCK
 *     else:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_is_blocking); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":294
 *         return
 *     if is_blocking:
 *         value = old & ~O_NONBLOCK             # <<<<<<<<<<<<<<
 *     else:
 *         value = old | O_NONBLOCK
 */
    __pyx_v_value = (__pyx_v_old & (~O_NONBLOCK));
    goto __pyx_L7;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":296
 *         value = old & ~O_NONBLOCK
 *     else:
 *         value = old | O_NONBLOCK             # <<<<<<<<<<<<<<
 *     if old != value:
 *         fcntl3(fd, F_SETFL, value)
 */
    __pyx_v_value = (__pyx_v_old | O_NONBLOCK);
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":297
 *     else:
 *         value = old | O_NONBLOCK
 *     if old != value:             # <<<<<<<<<<<<<<
 *         fcntl3(fd, F_SETFL, value)
 *     return bool(old & O_NONBLOCK)
 */
  __pyx_t_1 = (__pyx_v_old != __pyx_v_value);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":298
 *         value = old | O_NONBLOCK
 *     if old != value:
 *         fcntl3(fd, F_SETFL, value)             # <<<<<<<<<<<<<<
 *     return bool(old & O_NONBLOCK)
 * 
 */
    fcntl(__pyx_v_fd, F_SETFL, __pyx_v_value);
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":299
 *     if old != value:
 *         fcntl3(fd, F_SETFL, value)
 *     return bool(old & O_NONBLOCK)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyInt_FromLong((__pyx_v_old & O_NONBLOCK)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyBool_Type)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.set_fd_blocking");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_is_blocking);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":302
 * 
 * 
 * cdef void HandleCTimeoutWakeup(int fd, short evtype, void *arg) with gil:             # <<<<<<<<<<<<<<
 *     # PyStackless_Schedule will return this.
 *     # No easier way to assign a bool in Pyrex.
 */

static  void __pyx_f_4coio_HandleCTimeoutWakeup(int __pyx_v_fd, short __pyx_v_evtype, void *__pyx_v_arg) {
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyGILState_STATE _save = PyGILState_Ensure();
  __Pyx_RefNannySetupContext("HandleCTimeoutWakeup");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":305
 *     # PyStackless_Schedule will return this.
 *     # No easier way to assign a bool in Pyrex.
 *     if evtype == c_EV_TIMEOUT:             # <<<<<<<<<<<<<<
 *         (<tasklet>arg).tempval = True
 *     else:
 */
  __pyx_t_1 = (__pyx_v_evtype == EV_TIMEOUT);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":306
 *     # No easier way to assign a bool in Pyrex.
 *     if evtype == c_EV_TIMEOUT:
 *         (<tasklet>arg).tempval = True             # <<<<<<<<<<<<<<
 *     else:
 *         (<tasklet>arg).tempval = False
 */
    __pyx_t_2 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __Pyx_GOTREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    __Pyx_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":308
 *         (<tasklet>arg).tempval = True
 *     else:
 *         (<tasklet>arg).tempval = False             # <<<<<<<<<<<<<<
 *     PyTasklet_Insert(<tasklet>arg)  # No NULL- or type checking.
 * 
 */
    __pyx_t_2 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __Pyx_GOTREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    __Pyx_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":309
 *     else:
 *         (<tasklet>arg).tempval = False
 *     PyTasklet_Insert(<tasklet>arg)  # No NULL- or type checking.             # <<<<<<<<<<<<<<
 * 
 * cdef void HandleCWakeup(int fd, short evtype, void *arg) with gil:
 */
  __pyx_t_3 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_WriteUnraisable("coio.HandleCTimeoutWakeup");
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  PyGILState_Release(_save);
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":311
 *     PyTasklet_Insert(<tasklet>arg)  # No NULL- or type checking.
 * 
 * cdef void HandleCWakeup(int fd, short evtype, void *arg) with gil:             # <<<<<<<<<<<<<<
 *     PyTasklet_Insert(<tasklet>arg)
 * 
 */

static  void __pyx_f_4coio_HandleCWakeup(int __pyx_v_fd, short __pyx_v_evtype, void *__pyx_v_arg) {
  int __pyx_t_1;
  PyGILState_STATE _save = PyGILState_Ensure();
  __Pyx_RefNannySetupContext("HandleCWakeup");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":312
 * 
 * cdef void HandleCWakeup(int fd, short evtype, void *arg) with gil:
 *     PyTasklet_Insert(<tasklet>arg)             # <<<<<<<<<<<<<<
 * 
 * # This works, but it assumes that c.prev is kept in the runnable list during
 */
  __pyx_t_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_WriteUnraisable("coio.HandleCWakeup");
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  PyGILState_Release(_save);
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":351
 *     cdef event_t wakeup_ev
 * 
 *     def __repr__(evbuffer self):             # <<<<<<<<<<<<<<
 *         # TODO(pts): Use PyString_FromFormat?
 *         return '<evbuffer misalign=%s, totallen=%s, off=%s at 0x%x>' % (
 */

static PyObject *__pyx_pf_4coio_8evbuffer___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  unsigned int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("__repr__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":353
 *     def __repr__(evbuffer self):
 *         # TODO(pts): Use PyString_FromFormat?
 *         return '<evbuffer misalign=%s, totallen=%s, off=%s at 0x%x>' % (             # <<<<<<<<<<<<<<
 *             self.eb.misalign, self.eb.totallen, self.eb.off, <unsigned>self)
 * 
 */
  __Pyx_XDECREF(__pyx_r);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":354
 *         # TODO(pts): Use PyString_FromFormat?
 *         return '<evbuffer misalign=%s, totallen=%s, off=%s at 0x%x>' % (
 *             self.eb.misalign, self.eb.totallen, self.eb.off, <unsigned>self)             # <<<<<<<<<<<<<<
 * 
 *     def __len__(evbuffer self):
 */
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.misalign); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.totallen); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_AsUnsignedInt(__pyx_v_self); if (unlikely((__pyx_t_4 == (unsigned int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = PyLong_FromUnsignedLong(((unsigned int)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyTuple_New(4); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_6, 3, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_4), __pyx_t_6); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.evbuffer.__repr__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":356
 *             self.eb.misalign, self.eb.totallen, self.eb.off, <unsigned>self)
 * 
 *     def __len__(evbuffer self):             # <<<<<<<<<<<<<<
 *         return self.eb.off
 * 
 */

static Py_ssize_t __pyx_pf_4coio_8evbuffer___len__(PyObject *__pyx_v_self); /*proto*/
static Py_ssize_t __pyx_pf_4coio_8evbuffer___len__(PyObject *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  __Pyx_RefNannySetupContext("__len__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":357
 * 
 *     def __len__(evbuffer self):
 *         return self.eb.off             # <<<<<<<<<<<<<<
 * 
 *     def reset(evbuffer self):
 */
  __pyx_r = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":359
 *         return self.eb.off
 * 
 *     def reset(evbuffer self):             # <<<<<<<<<<<<<<
 *         """Clear the buffer and free associated memory."""
 *         cdef evbuffer_s *eb
 */

static PyObject *__pyx_pf_4coio_8evbuffer_reset(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_8evbuffer_reset[] = "Clear the buffer and free associated memory.";
static PyObject *__pyx_pf_4coio_8evbuffer_reset(PyObject *__pyx_v_self, PyObject *unused) {
  struct evbuffer *__pyx_v_eb;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("reset");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":362
 *         """Clear the buffer and free associated memory."""
 *         cdef evbuffer_s *eb
 *         eb = &self.eb             # <<<<<<<<<<<<<<
 *         free(eb.orig_buffer)
 *         # TODO(pts): Use memset().
 */
  __pyx_v_eb = (&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":363
 *         cdef evbuffer_s *eb
 *         eb = &self.eb
 *         free(eb.orig_buffer)             # <<<<<<<<<<<<<<
 *         # TODO(pts): Use memset().
 *         eb.buf = NULL
 */
  free(__pyx_v_eb->orig_buffer);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":365
 *         free(eb.orig_buffer)
 *         # TODO(pts): Use memset().
 *         eb.buf = NULL             # <<<<<<<<<<<<<<
 *         eb.orig_buffer = NULL
 *         eb.off = 0
 */
  __pyx_v_eb->buffer = NULL;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":366
 *         # TODO(pts): Use memset().
 *         eb.buf = NULL
 *         eb.orig_buffer = NULL             # <<<<<<<<<<<<<<
 *         eb.off = 0
 *         eb.totallen = 0
 */
  __pyx_v_eb->orig_buffer = NULL;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":367
 *         eb.buf = NULL
 *         eb.orig_buffer = NULL
 *         eb.off = 0             # <<<<<<<<<<<<<<
 *         eb.totallen = 0
 *         eb.misalign = 0
 */
  __pyx_v_eb->off = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":368
 *         eb.orig_buffer = NULL
 *         eb.off = 0
 *         eb.totallen = 0             # <<<<<<<<<<<<<<
 *         eb.misalign = 0
 * 
 */
  __pyx_v_eb->totallen = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":369
 *         eb.off = 0
 *         eb.totallen = 0
 *         eb.misalign = 0             # <<<<<<<<<<<<<<
 * 
 *     property totallen:
 */
  __pyx_v_eb->misalign = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":372
 * 
 *     property totallen:
 *         def __get__(evbuffer self):             # <<<<<<<<<<<<<<
 *             return self.eb.totallen
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_8totallen___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer_8totallen___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":373
 *     property totallen:
 *         def __get__(evbuffer self):
 *             return self.eb.totallen             # <<<<<<<<<<<<<<
 * 
 *     property misalign:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.totallen); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.evbuffer.totallen.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":376
 * 
 *     property misalign:
 *         def __get__(evbuffer self):             # <<<<<<<<<<<<<<
 *             return self.eb.misalign
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_8misalign___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer_8misalign___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":377
 *     property misalign:
 *         def __get__(evbuffer self):
 *             return self.eb.misalign             # <<<<<<<<<<<<<<
 * 
 *     def expand(evbuffer self, int n):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.misalign); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.evbuffer.misalign.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":379
 *             return self.eb.misalign
 * 
 *     def expand(evbuffer self, int n):             # <<<<<<<<<<<<<<
 *         """Expand the available buffer space (self.totallen) to >= n bytes.
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_expand(PyObject *__pyx_v_self, PyObject *__pyx_arg_n); /*proto*/
static char __pyx_doc_4coio_8evbuffer_expand[] = "Expand the available buffer space (self.totallen) to >= n bytes.\n\n        As a side effect, may discard consumed data (self.misalign = 0).\n\n        Please note that 256 bytes will always be reserved. Call self.reset()\n        to get rid of everything.\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_expand(PyObject *__pyx_v_self, PyObject *__pyx_arg_n) {
  int __pyx_v_n;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("expand");
  assert(__pyx_arg_n); {
    __pyx_v_n = __Pyx_PyInt_AsInt(__pyx_arg_n); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.expand");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":387
 *         to get rid of everything.
 *         """
 *         if evbuffer_expand(&self.eb, n):             # <<<<<<<<<<<<<<
 *             raise MemoryError
 * 
 */
  __pyx_t_1 = evbuffer_expand((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":388
 *         """
 *         if evbuffer_expand(&self.eb, n):
 *             raise MemoryError             # <<<<<<<<<<<<<<
 * 
 *     def drain(evbuffer self, int n):
 */
    __Pyx_Raise(__pyx_builtin_MemoryError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 388; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.evbuffer.expand");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":390
 *             raise MemoryError
 * 
 *     def drain(evbuffer self, int n):             # <<<<<<<<<<<<<<
 *         evbuffer_drain(&self.eb, n)
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_drain(PyObject *__pyx_v_self, PyObject *__pyx_arg_n); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer_drain(PyObject *__pyx_v_self, PyObject *__pyx_arg_n) {
  int __pyx_v_n;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("drain");
  assert(__pyx_arg_n); {
    __pyx_v_n = __Pyx_PyInt_AsInt(__pyx_arg_n); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.drain");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":391
 * 
 *     def drain(evbuffer self, int n):
 *         evbuffer_drain(&self.eb, n)             # <<<<<<<<<<<<<<
 * 
 *     def append(evbuffer self, buf):
 */
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":393
 *         evbuffer_drain(&self.eb, n)
 * 
 *     def append(evbuffer self, buf):             # <<<<<<<<<<<<<<
 *         cdef char_constp p
 *         cdef Py_ssize_t n
 */

static PyObject *__pyx_pf_4coio_8evbuffer_append(PyObject *__pyx_v_self, PyObject *__pyx_v_buf); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer_append(PyObject *__pyx_v_self, PyObject *__pyx_v_buf) {
  char const* __pyx_v_p;
  Py_ssize_t __pyx_v_n;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("append");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_buf);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":396
 *         cdef char_constp p
 *         cdef Py_ssize_t n
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:             # <<<<<<<<<<<<<<
 *             raise TypeError
 *         return evbuffer_add(&self.eb, <char*>p, n)
 */
  __pyx_t_1 = (PyObject_AsCharBuffer(__pyx_v_buf, (&__pyx_v_p), (&__pyx_v_n)) < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":397
 *         cdef Py_ssize_t n
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:
 *             raise TypeError             # <<<<<<<<<<<<<<
 *         return evbuffer_add(&self.eb, <char*>p, n)
 * 
 */
    __Pyx_Raise(__pyx_builtin_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":398
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:
 *             raise TypeError
 *         return evbuffer_add(&self.eb, <char*>p, n)             # <<<<<<<<<<<<<<
 * 
 *     def consume(evbuffer self, int n=-1):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyInt_FromLong(evbuffer_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), ((char *)__pyx_v_p), __pyx_v_n)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.evbuffer.append");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":400
 *         return evbuffer_add(&self.eb, <char*>p, n)
 * 
 *     def consume(evbuffer self, int n=-1):             # <<<<<<<<<<<<<<
 *         """Read, drain and return at most n (or all) from the beginning.
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_consume(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_consume[] = "Read, drain and return at most n (or all) from the beginning.\n\n        The corresponding C function is evbuffer_remove().";
static PyObject *__pyx_pf_4coio_8evbuffer_consume(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__n,0};
  __Pyx_RefNannySetupContext("consume");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__n);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "consume") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    if (values[0]) {
      __pyx_v_n = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_n = ((int)-1);
    }
  } else {
    __pyx_v_n = ((int)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_n = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("consume", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.consume");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_buf = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":406
 *         cdef int got
 *         cdef char *p
 *         if n > self.eb.off or n < 0:             # <<<<<<<<<<<<<<
 *             n = self.eb.off
 *         if n == 0:
 */
  __pyx_t_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_n < 0);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":407
 *         cdef char *p
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off             # <<<<<<<<<<<<<<
 *         if n == 0:
 *             return ''
 */
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":408
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off
 *         if n == 0:             # <<<<<<<<<<<<<<
 *             return ''
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 */
  __pyx_t_3 = (__pyx_v_n == 0);
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":409
 *             n = self.eb.off
 *         if n == 0:
 *             return ''             # <<<<<<<<<<<<<<
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
    __pyx_r = ((PyObject *)__pyx_kp_s_5);
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":410
 *         if n == 0:
 *             return ''
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)             # <<<<<<<<<<<<<<
 *         evbuffer_drain(&self.eb, n)
 *         return buf
 */
  __pyx_t_4 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":411
 *             return ''
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)             # <<<<<<<<<<<<<<
 *         return buf
 *         #assert got == n  # Assertions turned on by default. Good.
 */
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":412
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)
 *         return buf             # <<<<<<<<<<<<<<
 *         #assert got == n  # Assertions turned on by default. Good.
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.evbuffer.consume");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":415
 *         #assert got == n  # Assertions turned on by default. Good.
 * 
 *     def peek(evbuffer self, int n=-1):             # <<<<<<<<<<<<<<
 *         """Read and return at most n (or all) from the beginning, no drain."""
 *         cdef int got
 */

static PyObject *__pyx_pf_4coio_8evbuffer_peek(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_peek[] = "Read and return at most n (or all) from the beginning, no drain.";
static PyObject *__pyx_pf_4coio_8evbuffer_peek(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__n,0};
  __Pyx_RefNannySetupContext("peek");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__n);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "peek") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 415; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    if (values[0]) {
      __pyx_v_n = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 415; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_n = ((int)-1);
    }
  } else {
    __pyx_v_n = ((int)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_n = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 415; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("peek", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 415; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.peek");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":419
 *         cdef int got
 *         cdef char *p
 *         if n > self.eb.off or n < 0:             # <<<<<<<<<<<<<<
 *             n = self.eb.off
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 */
  __pyx_t_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_n < 0);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":420
 *         cdef char *p
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off             # <<<<<<<<<<<<<<
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 * 
 */
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":421
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf, n)             # <<<<<<<<<<<<<<
 * 
 *     def find(evbuffer self, buf):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.evbuffer.peek");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":423
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 * 
 *     def find(evbuffer self, buf):             # <<<<<<<<<<<<<<
 *         cdef Py_ssize_t n
 *         cdef char_constp p
 */

static PyObject *__pyx_pf_4coio_8evbuffer_find(PyObject *__pyx_v_self, PyObject *__pyx_v_buf); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer_find(PyObject *__pyx_v_self, PyObject *__pyx_v_buf) {
  Py_ssize_t __pyx_v_n;
  char const* __pyx_v_p;
  char *__pyx_v_q;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("find");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_buf);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":428
 *         cdef char *q
 *         # TODO(pts): Intern n == 1 strings.
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:             # <<<<<<<<<<<<<<
 *             raise TypeError
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>p, n)
 */
  __pyx_t_1 = (PyObject_AsCharBuffer(__pyx_v_buf, (&__pyx_v_p), (&__pyx_v_n)) < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":429
 *         # TODO(pts): Intern n == 1 strings.
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:
 *             raise TypeError             # <<<<<<<<<<<<<<
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>p, n)
 *         if q == NULL:
 */
    __Pyx_Raise(__pyx_builtin_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":430
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:
 *             raise TypeError
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>p, n)             # <<<<<<<<<<<<<<
 *         if q == NULL:
 *             return -1
 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), ((unsigned char const *)__pyx_v_p), __pyx_v_n));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":431
 *             raise TypeError
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>p, n)
 *         if q == NULL:             # <<<<<<<<<<<<<<
 *             return -1
 *         return q - <char*>self.eb.buf
 */
  __pyx_t_1 = (__pyx_v_q == NULL);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":432
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>p, n)
 *         if q == NULL:
 *             return -1             # <<<<<<<<<<<<<<
 *         return q - <char*>self.eb.buf
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_int_neg_1);
    __pyx_r = __pyx_int_neg_1;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":433
 *         if q == NULL:
 *             return -1
 *         return q - <char*>self.eb.buf             # <<<<<<<<<<<<<<
 * 
 *     def append_clear(evbuffer self, evbuffer source):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyInt_FromLong((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer))); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.evbuffer.find");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":435
 *         return q - <char*>self.eb.buf
 * 
 *     def append_clear(evbuffer self, evbuffer source):             # <<<<<<<<<<<<<<
 *         """Append source and clear source.
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_append_clear(PyObject *__pyx_v_self, PyObject *__pyx_v_source); /*proto*/
static char __pyx_doc_4coio_8evbuffer_append_clear[] = "Append source and clear source.\n\n        The corresponding C function is evbuffer_add_buffer().\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_append_clear(PyObject *__pyx_v_self, PyObject *__pyx_v_source) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("append_clear");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF((PyObject *)__pyx_v_source);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_source), __pyx_ptype_4coio_evbuffer, 1, "source", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":440
 *         The corresponding C function is evbuffer_add_buffer().
 *         """
 *         if 0 != evbuffer_add_buffer(&self.eb, &source.eb):             # <<<<<<<<<<<<<<
 *             raise RuntimeError
 * 
 */
  __pyx_t_1 = (0 != evbuffer_add_buffer((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), (&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_source)->eb)));
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":441
 *         """
 *         if 0 != evbuffer_add_buffer(&self.eb, &source.eb):
 *             raise RuntimeError             # <<<<<<<<<<<<<<
 * 
 *     def consumeline(evbuffer self):
 */
    __Pyx_Raise(__pyx_builtin_RuntimeError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.evbuffer.append_clear");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF((PyObject *)__pyx_v_source);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":443
 *             raise RuntimeError
 * 
 *     def consumeline(evbuffer self):             # <<<<<<<<<<<<<<
 *         """Read, drain and return string ending with '\\n', or ''.
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_consumeline(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_8evbuffer_consumeline[] = "Read, drain and return string ending with '\\n', or ''.\n\n        An empty string is returned instead of a partial line at the end of\n        the buffer.\n\n        This method doesn't use evbuffer_readline(), which is not binary\n        (char 0) safe.\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_consumeline(PyObject *__pyx_v_self, PyObject *unused) {
  int __pyx_v_n;
  char *__pyx_v_q;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("consumeline");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_buf = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":454
 *         cdef int n
 *         cdef char *q
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)             # <<<<<<<<<<<<<<
 *         if q == NULL:
 *             return ''
 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), ((unsigned char const *)__pyx_kp_s_6), 1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":455
 *         cdef char *q
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)
 *         if q == NULL:             # <<<<<<<<<<<<<<
 *             return ''
 *         n = q - <char*>self.eb.buf + 1
 */
  __pyx_t_1 = (__pyx_v_q == NULL);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":456
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)
 *         if q == NULL:
 *             return ''             # <<<<<<<<<<<<<<
 *         n = q - <char*>self.eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
    __pyx_r = ((PyObject *)__pyx_kp_s_5);
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":457
 *         if q == NULL:
 *             return ''
 *         n = q - <char*>self.eb.buf + 1             # <<<<<<<<<<<<<<
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)
 */
  __pyx_v_n = ((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer)) + 1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":458
 *             return ''
 *         n = q - <char*>self.eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)             # <<<<<<<<<<<<<<
 *         evbuffer_drain(&self.eb, n)
 *         return buf
 */
  __pyx_t_2 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":459
 *         n = q - <char*>self.eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)             # <<<<<<<<<<<<<<
 *         return buf
 * 
 */
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":460
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)
 *         return buf             # <<<<<<<<<<<<<<
 * 
 *     def nb_accept(evbuffer self, object sock):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.evbuffer.consumeline");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":462
 *         return buf
 * 
 *     def nb_accept(evbuffer self, object sock):             # <<<<<<<<<<<<<<
 *         cdef tasklet wakeup_tasklet
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_8evbuffer_nb_accept(PyObject *__pyx_v_self, PyObject *__pyx_v_sock); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer_nb_accept(PyObject *__pyx_v_self, PyObject *__pyx_v_sock) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("nb_accept");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_sock);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":464
 *     def nb_accept(evbuffer self, object sock):
 *         cdef tasklet wakeup_tasklet
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return sock.accept()
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":465
 *         cdef tasklet wakeup_tasklet
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return sock.accept()
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":466
 *         while 1:
 *             try:
 *                 return sock.accept()             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_sock, __pyx_n_s__accept); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_r = __pyx_t_3;
        __pyx_t_3 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":467
 *             try:
 *                 return sock.accept()
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__error); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_4 = PyErr_ExceptionMatches(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_4) {
        __Pyx_AddTraceback("coio.evbuffer.nb_accept");
        if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_3, &__pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_3;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":468
 *                 return sock.accept()
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":469
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, sock.fileno(), c_EV_READ,
 */
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_5);
          __Pyx_ErrRestore(__pyx_t_2, __pyx_t_3, __pyx_t_5);
          __pyx_t_2 = 0; __pyx_t_3 = 0; __pyx_t_5 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":470
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, sock.fileno(), c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 */
        __pyx_t_8 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
        __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_8);
        __pyx_t_8 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":471
 *                     raise
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, sock.fileno(), c_EV_READ,             # <<<<<<<<<<<<<<
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 */
        __pyx_t_8 = PyObject_GetAttr(__pyx_v_sock, __pyx_n_s__fileno); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_7 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_7); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":472
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, sock.fileno(), c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
        event_set((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev), __pyx_t_4, EV_READ, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":473
 *                 event_set(&self.wakeup_ev, sock.fileno(), c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 * 
 */
        event_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev), NULL);

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":474
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 * 
 *     def nb_flush(evbuffer self, int fd):
 */
        __pyx_t_7 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.evbuffer.nb_accept");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_sock);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":476
 *                 PyStackless_Schedule(None, 1)  # remove=1
 * 
 *     def nb_flush(evbuffer self, int fd):             # <<<<<<<<<<<<<<
 *         """Use self.append*, then self.nb_flush. Don't reuse self for reads."""
 *         # Please note that this method may raise an error even if parts of the
 */

static PyObject *__pyx_pf_4coio_8evbuffer_nb_flush(PyObject *__pyx_v_self, PyObject *__pyx_arg_fd); /*proto*/
static char __pyx_doc_4coio_8evbuffer_nb_flush[] = "Use self.append*, then self.nb_flush. Don't reuse self for reads.";
static PyObject *__pyx_pf_4coio_8evbuffer_nb_flush(PyObject *__pyx_v_self, PyObject *__pyx_arg_fd) {
  int __pyx_v_fd;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("nb_flush");
  assert(__pyx_arg_fd); {
    __pyx_v_fd = __Pyx_PyInt_AsInt(__pyx_arg_fd); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.nb_flush");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":482
 *         cdef tasklet wakeup_tasklet
 *         cdef int n
 *         while self.eb.off > 0:             # <<<<<<<<<<<<<<
 *             n = evbuffer_write(&self.eb, fd)
 *             if n < 0:
 */
  while (1) {
    __pyx_t_1 = (((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off > 0);
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":483
 *         cdef int n
 *         while self.eb.off > 0:
 *             n = evbuffer_write(&self.eb, fd)             # <<<<<<<<<<<<<<
 *             if n < 0:
 *                 if errno != EAGAIN:
 */
    __pyx_v_n = evbuffer_write((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_fd);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":484
 *         while self.eb.off > 0:
 *             n = evbuffer_write(&self.eb, fd)
 *             if n < 0:             # <<<<<<<<<<<<<<
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
    __pyx_t_1 = (__pyx_v_n < 0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":485
 *             n = evbuffer_write(&self.eb, fd)
 *             if n < 0:
 *                 if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))
 */
      __pyx_t_1 = (errno != EAGAIN);
      if (__pyx_t_1) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":487
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 */
        __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
        __pyx_t_2 = 0;
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_3, 0, 0);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":488
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 */
      __pyx_t_3 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_3);
      __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":490
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                           <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev), __pyx_v_fd, EV_WRITE, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":491
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 * 
 */
      event_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev), NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":492
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 * 
 *     def nb_readline(evbuffer self, int fd):
 */
      __pyx_t_3 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.evbuffer.nb_flush");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":494
 *                 PyStackless_Schedule(None, 1)  # remove=1
 * 
 *     def nb_readline(evbuffer self, int fd):             # <<<<<<<<<<<<<<
 *         cdef tasklet wakeup_tasklet
 *         cdef int n
 */

static PyObject *__pyx_pf_4coio_8evbuffer_nb_readline(PyObject *__pyx_v_self, PyObject *__pyx_arg_fd); /*proto*/
static PyObject *__pyx_pf_4coio_8evbuffer_nb_readline(PyObject *__pyx_v_self, PyObject *__pyx_arg_fd) {
  int __pyx_v_fd;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  int __pyx_v_got;
  char *__pyx_v_q;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("nb_readline");
  assert(__pyx_arg_fd); {
    __pyx_v_fd = __Pyx_PyInt_AsInt(__pyx_arg_fd); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 494; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.nb_readline");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_buf = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":499
 *         cdef int got
 *         cdef char *q
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)             # <<<<<<<<<<<<<<
 *         while q == NULL:
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), ((unsigned char const *)__pyx_kp_s_6), 1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":500
 *         cdef char *q
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)
 *         while q == NULL:             # <<<<<<<<<<<<<<
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 *             # !! where do we get totallen=32768? evbuffer_read has a strange
 */
  while (1) {
    __pyx_t_1 = (__pyx_v_q == NULL);
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":504
 *             # !! where do we get totallen=32768? evbuffer_read has a strange
 *             # buffer growing behavior.
 *             got = evbuffer_read(&self.eb, fd, 8192)             # <<<<<<<<<<<<<<
 *             if got < 0:
 *                 if errno != EAGAIN:
 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_fd, 8192);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":505
 *             # buffer growing behavior.
 *             got = evbuffer_read(&self.eb, fd, 8192)
 *             if got < 0:             # <<<<<<<<<<<<<<
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
    __pyx_t_1 = (__pyx_v_got < 0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":506
 *             got = evbuffer_read(&self.eb, fd, 8192)
 *             if got < 0:
 *                 if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))
 */
      __pyx_t_1 = (errno != EAGAIN);
      if (__pyx_t_1) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":508
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                 # PyStackless_GetCurrent() contains a
 *                 # Py_INCREF(wakeup_tasklet) call, and the beginning of the C
 */
        __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
        __pyx_t_2 = 0;
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_3, 0, 0);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":523
 *                 # Since self has a positive reference count, and it contains
 *                 # self.wakeup_ev, self.wakeup_ev won't be freed.
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, fd, c_EV_READ, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 */
      __pyx_t_3 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_3);
      __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":525
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, fd, c_EV_READ, HandleCWakeup,
 *                           <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev), __pyx_v_fd, EV_READ, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":526
 *                 event_set(&self.wakeup_ev, fd, c_EV_READ, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 */
      event_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev), NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":527
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 *                 n = self.eb.off
 */
      __pyx_t_3 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L7;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":528
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)             # <<<<<<<<<<<<<<
 *                 n = self.eb.off
 *                 buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 */
    __pyx_t_1 = (__pyx_v_got == 0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":529
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 *                 n = self.eb.off             # <<<<<<<<<<<<<<
 *                 buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *                 evbuffer_drain(&self.eb, n)
 */
      __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":530
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 *                 n = self.eb.off
 *                 buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)             # <<<<<<<<<<<<<<
 *                 evbuffer_drain(&self.eb, n)
 *                 return buf
 */
      __pyx_t_3 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 530; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_t_3;
      __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":531
 *                 n = self.eb.off
 *                 buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *                 evbuffer_drain(&self.eb, n)             # <<<<<<<<<<<<<<
 *                 return buf
 *             else:
 */
      evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":532
 *                 buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *                 evbuffer_drain(&self.eb, n)
 *                 return buf             # <<<<<<<<<<<<<<
 *             else:
 *                 # TODO(pts): Find from later than the beginning (just as read).
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":535
 *             else:
 *                 # TODO(pts): Find from later than the beginning (just as read).
 *                 q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)             # <<<<<<<<<<<<<<
 *         n = q - <char*>self.eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 */
      __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), ((unsigned char const *)__pyx_kp_s_6), 1));
    }
    __pyx_L7:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":536
 *                 # TODO(pts): Find from later than the beginning (just as read).
 *                 q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)
 *         n = q - <char*>self.eb.buf + 1             # <<<<<<<<<<<<<<
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)
 */
  __pyx_v_n = ((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer)) + 1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":537
 *                 q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)
 *         n = q - <char*>self.eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)             # <<<<<<<<<<<<<<
 *         evbuffer_drain(&self.eb, n)
 *         return buf
 */
  __pyx_t_3 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":538
 *         n = q - <char*>self.eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)             # <<<<<<<<<<<<<<
 *         return buf
 * 
 */
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":539
 *         buf = PyString_FromStringAndSize(<char_constp>self.eb.buf, n)
 *         evbuffer_drain(&self.eb, n)
 *         return buf             # <<<<<<<<<<<<<<
 * 
 *     def peekline(evbuffer self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.evbuffer.nb_readline");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":541
 *         return buf
 * 
 *     def peekline(evbuffer self):             # <<<<<<<<<<<<<<
 *         """Read and return string ending with '\\n', or '', no draining.
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_peekline(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_8evbuffer_peekline[] = "Read and return string ending with '\\n', or '', no draining.\n\n        An empty string is returned instead of a partial line at the end of\n        the buffer.\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_peekline(PyObject *__pyx_v_self, PyObject *unused) {
  char *__pyx_v_q;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("peekline");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":549
 *         cdef int n
 *         cdef char *q
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)             # <<<<<<<<<<<<<<
 *         if q == NULL:
 *             return ''
 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), ((unsigned char const *)__pyx_kp_s_6), 1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":550
 *         cdef char *q
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)
 *         if q == NULL:             # <<<<<<<<<<<<<<
 *             return ''
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf,
 */
  __pyx_t_1 = (__pyx_v_q == NULL);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":551
 *         q = <char*>evbuffer_find(&self.eb, <uchar_constp>'\n', 1)
 *         if q == NULL:
 *             return ''             # <<<<<<<<<<<<<<
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf,
 *                                           q - <char*>self.eb.buf + 1)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
    __pyx_r = ((PyObject *)__pyx_kp_s_5);
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":552
 *         if q == NULL:
 *             return ''
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf,             # <<<<<<<<<<<<<<
 *                                           q - <char*>self.eb.buf + 1)
 * 
 */
  __Pyx_XDECREF(__pyx_r);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":553
 *             return ''
 *         return PyString_FromStringAndSize(<char_constp>self.eb.buf,
 *                                           q - <char*>self.eb.buf + 1)             # <<<<<<<<<<<<<<
 * 
 *     def read_from_fd(evbuffer self, int fd, int n):
 */
  __pyx_t_2 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), ((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer)) + 1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 552; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.evbuffer.peekline");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":555
 *                                           q - <char*>self.eb.buf + 1)
 * 
 *     def read_from_fd(evbuffer self, int fd, int n):             # <<<<<<<<<<<<<<
 *         """Read from file descriptor, append to self,
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_read_from_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_read_from_fd[] = "Read from file descriptor, append to self,\n\n        Does a ioctl(fd, FIONREAD, &c) before reading to limit the wasted\n        buffer space.\n\n        The corresponding C function is evbuffer_read().\n\n        Returns:\n          The number of bytes read.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_read_from_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  int __pyx_v_got;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__fd,&__pyx_n_s__n,0};
  __Pyx_RefNannySetupContext("read_from_fd");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fd);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__n);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("read_from_fd", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "read_from_fd") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_fd = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_n = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_n = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("read_from_fd", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.read_from_fd");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":569
 *         """
 *         cdef int got
 *         got = evbuffer_read(&self.eb, fd, n)             # <<<<<<<<<<<<<<
 *         if got < 0:
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
  __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_fd, __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":570
 *         cdef int got
 *         got = evbuffer_read(&self.eb, fd, n)
 *         if got < 0:             # <<<<<<<<<<<<<<
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *             raise IOError(errno, strerror(errno))
 */
  __pyx_t_1 = (__pyx_v_got < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":572
 *         if got < 0:
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *             raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *         return got
 * 
 */
    __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":573
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *             raise IOError(errno, strerror(errno))
 *         return got             # <<<<<<<<<<<<<<
 * 
 *     def read_from_fd_again(evbuffer self, int fd, int n):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_got); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 573; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.evbuffer.read_from_fd");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":575
 *         return got
 * 
 *     def read_from_fd_again(evbuffer self, int fd, int n):             # <<<<<<<<<<<<<<
 *         """Read from file descriptor, append to self,
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_read_from_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_read_from_fd_again[] = "Read from file descriptor, append to self,\n\n        Does a ioctl(fd, FIONREAD, &c) before reading to limit the wasted\n        buffer space.\n\n        The corresponding C function is evbuffer_read().\n\n        Returns:\n          The number of bytes read, or None on EAGAIN.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_read_from_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  int __pyx_v_got;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__fd,&__pyx_n_s__n,0};
  __Pyx_RefNannySetupContext("read_from_fd_again");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fd);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__n);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("read_from_fd_again", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "read_from_fd_again") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_fd = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_n = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_n = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("read_from_fd_again", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.read_from_fd_again");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":589
 *         """
 *         cdef int got
 *         got = evbuffer_read(&self.eb, fd, n)             # <<<<<<<<<<<<<<
 *         if got < 0:
 *             if errno == EAGAIN:
 */
  __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_fd, __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":590
 *         cdef int got
 *         got = evbuffer_read(&self.eb, fd, n)
 *         if got < 0:             # <<<<<<<<<<<<<<
 *             if errno == EAGAIN:
 *                 return None
 */
  __pyx_t_1 = (__pyx_v_got < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":591
 *         got = evbuffer_read(&self.eb, fd, n)
 *         if got < 0:
 *             if errno == EAGAIN:             # <<<<<<<<<<<<<<
 *                 return None
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
    __pyx_t_1 = (errno == EAGAIN);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":592
 *         if got < 0:
 *             if errno == EAGAIN:
 *                 return None             # <<<<<<<<<<<<<<
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *             raise IOError(errno, strerror(errno))
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_None);
      __pyx_r = Py_None;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":594
 *                 return None
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *             raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *         return got
 * 
 */
    __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":595
 *             # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *             raise IOError(errno, strerror(errno))
 *         return got             # <<<<<<<<<<<<<<
 * 
 *     def write_to_fd(evbuffer self, int fd, int n=-1):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_got); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.evbuffer.read_from_fd_again");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":597
 *         return got
 * 
 *     def write_to_fd(evbuffer self, int fd, int n=-1):             # <<<<<<<<<<<<<<
 *         """Write and drain n bytes to file descriptor fd.
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_write_to_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_write_to_fd[] = "Write and drain n bytes to file descriptor fd.\n\n        A similar but weaker C function is evbuffer_write().\n\n        Returns:\n          The number of bytes written, which is not zero unless self is empty.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_write_to_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__fd,&__pyx_n_s__n,0};
  __Pyx_RefNannySetupContext("write_to_fd");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fd);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__n);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "write_to_fd") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_fd = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (values[1]) {
      __pyx_v_n = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_n = ((int)-1);
    }
  } else {
    __pyx_v_n = ((int)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_n = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("write_to_fd", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.write_to_fd");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":607
 *           IOError: With the corresponding errno.
 *         """
 *         if n > self.eb.off or n < 0:             # <<<<<<<<<<<<<<
 *             n = self.eb.off
 *         if n > 0:
 */
  __pyx_t_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_n < 0);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":608
 *         """
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off             # <<<<<<<<<<<<<<
 *         if n > 0:
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 */
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":609
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off
 *         if n > 0:             # <<<<<<<<<<<<<<
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 *             n = os_write(fd, <char_constp>self.eb.buf, n)
 */
  __pyx_t_3 = (__pyx_v_n > 0);
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":611
 *         if n > 0:
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 *             n = os_write(fd, <char_constp>self.eb.buf, n)             # <<<<<<<<<<<<<<
 *             if n < 0:
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
    __pyx_v_n = write(__pyx_v_fd, ((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), __pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":612
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 *             n = os_write(fd, <char_constp>self.eb.buf, n)
 *             if n < 0:             # <<<<<<<<<<<<<<
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))
 */
    __pyx_t_3 = (__pyx_v_n < 0);
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":614
 *             if n < 0:
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *             evbuffer_drain(&self.eb, n)
 *         return n
 */
      __pyx_t_4 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_5));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
      __pyx_t_4 = 0;
      __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":615
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))
 *             evbuffer_drain(&self.eb, n)             # <<<<<<<<<<<<<<
 *         return n
 * 
 */
    evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":616
 *                 raise IOError(errno, strerror(errno))
 *             evbuffer_drain(&self.eb, n)
 *         return n             # <<<<<<<<<<<<<<
 * 
 *     def write_to_fd_again(evbuffer self, int fd, int n=-1):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.evbuffer.write_to_fd");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":618
 *         return n
 * 
 *     def write_to_fd_again(evbuffer self, int fd, int n=-1):             # <<<<<<<<<<<<<<
 *         """Write and drain n bytes to file descriptor fd.
 * 
 */

static PyObject *__pyx_pf_4coio_8evbuffer_write_to_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_write_to_fd_again[] = "Write and drain n bytes to file descriptor fd.\n\n        A similar but weaker C function is evbuffer_write().\n\n        Returns:\n          The number of bytes written, which is not zero unless self is empty;\n          or None on EAGAIN.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_pf_4coio_8evbuffer_write_to_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__fd,&__pyx_n_s__n,0};
  __Pyx_RefNannySetupContext("write_to_fd_again");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fd);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__n);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "write_to_fd_again") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_fd = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (values[1]) {
      __pyx_v_n = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_n = ((int)-1);
    }
  } else {
    __pyx_v_n = ((int)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_n = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("write_to_fd_again", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.evbuffer.write_to_fd_again");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":629
 *           IOError: With the corresponding errno.
 *         """
 *         if n > self.eb.off or n < 0:             # <<<<<<<<<<<<<<
 *             n = self.eb.off
 *         if n > 0:
 */
  __pyx_t_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_n < 0);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":630
 *         """
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off             # <<<<<<<<<<<<<<
 *         if n > 0:
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 */
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":631
 *         if n > self.eb.off or n < 0:
 *             n = self.eb.off
 *         if n > 0:             # <<<<<<<<<<<<<<
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 *             n = os_write(fd, <char_constp>self.eb.buf, n)
 */
  __pyx_t_3 = (__pyx_v_n > 0);
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":633
 *         if n > 0:
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 *             n = os_write(fd, <char_constp>self.eb.buf, n)             # <<<<<<<<<<<<<<
 *             if n < 0:
 *                 if errno == EAGAIN:
 */
    __pyx_v_n = write(__pyx_v_fd, ((char const *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer), __pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":634
 *             # TODO(pts): Use send(...) or evbuffer_write() on Win32.
 *             n = os_write(fd, <char_constp>self.eb.buf, n)
 *             if n < 0:             # <<<<<<<<<<<<<<
 *                 if errno == EAGAIN:
 *                     return None
 */
    __pyx_t_3 = (__pyx_v_n < 0);
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":635
 *             n = os_write(fd, <char_constp>self.eb.buf, n)
 *             if n < 0:
 *                 if errno == EAGAIN:             # <<<<<<<<<<<<<<
 *                     return None
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
      __pyx_t_3 = (errno == EAGAIN);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":636
 *             if n < 0:
 *                 if errno == EAGAIN:
 *                     return None             # <<<<<<<<<<<<<<
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_None);
        __pyx_r = Py_None;
        goto __pyx_L0;
        goto __pyx_L9;
      }
      __pyx_L9:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":638
 *                     return None
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *             evbuffer_drain(&self.eb, n)
 *         return n
 */
      __pyx_t_4 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_5));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
      __pyx_t_4 = 0;
      __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":639
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))
 *             evbuffer_drain(&self.eb, n)             # <<<<<<<<<<<<<<
 *         return n
 * 
 */
    evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb), __pyx_v_n);
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":640
 *                 raise IOError(errno, strerror(errno))
 *             evbuffer_drain(&self.eb, n)
 *         return n             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.evbuffer.write_to_fd_again");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":643
 * 
 * 
 * cdef object write_to_fd(int fd, event_t *wakeup_ev, char_constp p, Py_ssize_t n):             # <<<<<<<<<<<<<<
 *     # wakeup_ev must be on the heap (not stack).
 *     cdef tasklet wakeup_tasklet
 */

static  PyObject *__pyx_f_4coio_write_to_fd(int __pyx_v_fd, struct event *__pyx_v_wakeup_ev, char const* __pyx_v_p, Py_ssize_t __pyx_v_n) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("write_to_fd");
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":647
 *     cdef tasklet wakeup_tasklet
 *     cdef int got
 *     while n > 0:             # <<<<<<<<<<<<<<
 *         got = os_write(fd, p, n)
 *         if got < 0:
 */
  while (1) {
    __pyx_t_1 = (__pyx_v_n > 0);
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":648
 *     cdef int got
 *     while n > 0:
 *         got = os_write(fd, p, n)             # <<<<<<<<<<<<<<
 *         if got < 0:
 *             if errno != EAGAIN:
 */
    __pyx_v_got = write(__pyx_v_fd, __pyx_v_p, __pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":649
 *     while n > 0:
 *         got = os_write(fd, p, n)
 *         if got < 0:             # <<<<<<<<<<<<<<
 *             if errno != EAGAIN:
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
    __pyx_t_1 = (__pyx_v_got < 0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":650
 *         got = os_write(fd, p, n)
 *         if got < 0:
 *             if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))
 */
      __pyx_t_1 = (errno != EAGAIN);
      if (__pyx_t_1) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":652
 *             if errno != EAGAIN:
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *             wakeup_tasklet = PyStackless_GetCurrent()
 *             event_set(wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 */
        __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
        __pyx_t_2 = 0;
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_3, 0, 0);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":653
 *                 # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                 raise IOError(errno, strerror(errno))
 *             wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *             event_set(wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                       <void *>wakeup_tasklet)
 */
      __pyx_t_3 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_3);
      __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":655
 *             wakeup_tasklet = PyStackless_GetCurrent()
 *             event_set(wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                       <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *             event_add(wakeup_ev, NULL)
 *             PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set(__pyx_v_wakeup_ev, __pyx_v_fd, EV_WRITE, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":656
 *             event_set(wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                       <void *>wakeup_tasklet)
 *             event_add(wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *             PyStackless_Schedule(None, 1)  # remove=1
 *         p += got
 */
      event_add(__pyx_v_wakeup_ev, NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":657
 *                       <void *>wakeup_tasklet)
 *             event_add(wakeup_ev, NULL)
 *             PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *         p += got
 *         n -= got
 */
      __pyx_t_3 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":658
 *             event_add(wakeup_ev, NULL)
 *             PyStackless_Schedule(None, 1)  # remove=1
 *         p += got             # <<<<<<<<<<<<<<
 *         n -= got
 * 
 */
    __pyx_v_p += __pyx_v_got;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":659
 *             PyStackless_Schedule(None, 1)  # remove=1
 *         p += got
 *         n -= got             # <<<<<<<<<<<<<<
 * 
 * cdef enum dummy:
 */
    __pyx_v_n -= __pyx_v_got;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.write_to_fd");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":690
 *     cdef object c_name
 * 
 *     def __init__(nbfile self, int read_fd, int write_fd,             # <<<<<<<<<<<<<<
 *                  int write_buffer_limit=-1, char do_close=0,
 *                  object close_ref=None, object mode='r+',
 */

static int __pyx_pf_4coio_6nbfile___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_4coio_6nbfile___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_read_fd;
  int __pyx_v_write_fd;
  int __pyx_v_write_buffer_limit;
  char __pyx_v_do_close;
  PyObject *__pyx_v_close_ref = 0;
  PyObject *__pyx_v_mode = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__read_fd,&__pyx_n_s__write_fd,&__pyx_n_s__write_buffer_limit,&__pyx_n_s__do_close,&__pyx_n_s__close_ref,&__pyx_n_s__mode,&__pyx_n_s__name,0};
  __Pyx_RefNannySetupContext("__init__");
  if (unlikely(__pyx_kwds)) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":693
 *                  int write_buffer_limit=-1, char do_close=0,
 *                  object close_ref=None, object mode='r+',
 *                  object name=None):             # <<<<<<<<<<<<<<
 *         assert read_fd >= 0 or mode == 'w'
 *         assert write_fd >= 0 or mode == 'r'
 */
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[7] = {0,0,0,0,0,0,0};
    values[4] = ((PyObject *)Py_None);
    values[5] = ((PyObject *)__pyx_kp_s_7);
    values[6] = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
      case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__read_fd);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__write_fd);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 7, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__write_buffer_limit);
        if (unlikely(value)) { values[2] = value; kw_args--; }
      }
      case  3:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__do_close);
        if (unlikely(value)) { values[3] = value; kw_args--; }
      }
      case  4:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__close_ref);
        if (unlikely(value)) { values[4] = value; kw_args--; }
      }
      case  5:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mode);
        if (unlikely(value)) { values[5] = value; kw_args--; }
      }
      case  6:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name);
        if (unlikely(value)) { values[6] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_read_fd = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_read_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_write_fd = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_write_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (values[2]) {
      __pyx_v_write_buffer_limit = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_write_buffer_limit == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_write_buffer_limit = ((int)-1);
    }
    if (values[3]) {
      __pyx_v_do_close = __Pyx_PyInt_AsChar(values[3]); if (unlikely((__pyx_v_do_close == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_do_close = ((char)0);
    }
    __pyx_v_close_ref = values[4];
    __pyx_v_mode = values[5];
    __pyx_v_name = values[6];
  } else {
    __pyx_v_write_buffer_limit = ((int)-1);
    __pyx_v_do_close = ((char)0);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":692
 *     def __init__(nbfile self, int read_fd, int write_fd,
 *                  int write_buffer_limit=-1, char do_close=0,
 *                  object close_ref=None, object mode='r+',             # <<<<<<<<<<<<<<
 *                  object name=None):
 *         assert read_fd >= 0 or mode == 'w'
 */
    __pyx_v_close_ref = ((PyObject *)Py_None);
    __pyx_v_mode = ((PyObject *)__pyx_kp_s_7);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":693
 *                  int write_buffer_limit=-1, char do_close=0,
 *                  object close_ref=None, object mode='r+',
 *                  object name=None):             # <<<<<<<<<<<<<<
 *         assert read_fd >= 0 or mode == 'w'
 *         assert write_fd >= 0 or mode == 'r'
 */
    __pyx_v_name = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  7:
      __pyx_v_name = PyTuple_GET_ITEM(__pyx_args, 6);
      case  6:
      __pyx_v_mode = PyTuple_GET_ITEM(__pyx_args, 5);
      case  5:
      __pyx_v_close_ref = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4:
      __pyx_v_do_close = __Pyx_PyInt_AsChar(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_do_close == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  3:
      __pyx_v_write_buffer_limit = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_write_buffer_limit == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  2:
      __pyx_v_write_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_write_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      __pyx_v_read_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_read_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 7, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbfile.__init__");
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_close_ref);
  __Pyx_INCREF(__pyx_v_mode);
  __Pyx_INCREF(__pyx_v_name);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":694
 *                  object close_ref=None, object mode='r+',
 *                  object name=None):
 *         assert read_fd >= 0 or mode == 'w'             # <<<<<<<<<<<<<<
 *         assert write_fd >= 0 or mode == 'r'
 *         self.c_read_limit = -1
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_t_1 = (__pyx_v_read_fd >= 0);
  if (!__pyx_t_1) {
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__w), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __pyx_t_3;
  } else {
    __pyx_t_4 = __pyx_t_1;
  }
  if (unlikely(!__pyx_t_4)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":695
 *                  object name=None):
 *         assert read_fd >= 0 or mode == 'w'
 *         assert write_fd >= 0 or mode == 'r'             # <<<<<<<<<<<<<<
 *         self.c_read_limit = -1
 *         self.c_do_close = do_close
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_t_4 = (__pyx_v_write_fd >= 0);
  if (!__pyx_t_4) {
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__r), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 695; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 695; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_t_1;
  } else {
    __pyx_t_3 = __pyx_t_4;
  }
  if (unlikely(!__pyx_t_3)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 695; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":696
 *         assert read_fd >= 0 or mode == 'w'
 *         assert write_fd >= 0 or mode == 'r'
 *         self.c_read_limit = -1             # <<<<<<<<<<<<<<
 *         self.c_do_close = do_close
 *         self.read_fd = read_fd
 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit = -1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":697
 *         assert write_fd >= 0 or mode == 'r'
 *         self.c_read_limit = -1
 *         self.c_do_close = do_close             # <<<<<<<<<<<<<<
 *         self.read_fd = read_fd
 *         self.write_fd = write_fd
 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close = __pyx_v_do_close;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":698
 *         self.c_read_limit = -1
 *         self.c_do_close = do_close
 *         self.read_fd = read_fd             # <<<<<<<<<<<<<<
 *         self.write_fd = write_fd
 *         if write_buffer_limit == -1:
 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd = __pyx_v_read_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":699
 *         self.c_do_close = do_close
 *         self.read_fd = read_fd
 *         self.write_fd = write_fd             # <<<<<<<<<<<<<<
 *         if write_buffer_limit == -1:
 *           self.c_write_buffer_limit = DEFAULT_WRITE_BUFFER_LIMIT
 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd = __pyx_v_write_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":700
 *         self.read_fd = read_fd
 *         self.write_fd = write_fd
 *         if write_buffer_limit == -1:             # <<<<<<<<<<<<<<
 *           self.c_write_buffer_limit = DEFAULT_WRITE_BUFFER_LIMIT
 *         else:
 */
  __pyx_t_3 = (__pyx_v_write_buffer_limit == -1);
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":701
 *         self.write_fd = write_fd
 *         if write_buffer_limit == -1:
 *           self.c_write_buffer_limit = DEFAULT_WRITE_BUFFER_LIMIT             # <<<<<<<<<<<<<<
 *         else:
 *           self.c_write_buffer_limit = write_buffer_limit
 */
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_e_4coio_DEFAULT_WRITE_BUFFER_LIMIT;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":703
 *           self.c_write_buffer_limit = DEFAULT_WRITE_BUFFER_LIMIT
 *         else:
 *           self.c_write_buffer_limit = write_buffer_limit             # <<<<<<<<<<<<<<
 *         self.close_ref = close_ref
 *         self.c_mode = mode
 */
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_v_write_buffer_limit;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":704
 *         else:
 *           self.c_write_buffer_limit = write_buffer_limit
 *         self.close_ref = close_ref             # <<<<<<<<<<<<<<
 *         self.c_mode = mode
 *         self.c_name = name
 */
  __Pyx_INCREF(__pyx_v_close_ref);
  __Pyx_GIVEREF(__pyx_v_close_ref);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref = __pyx_v_close_ref;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":705
 *           self.c_write_buffer_limit = write_buffer_limit
 *         self.close_ref = close_ref
 *         self.c_mode = mode             # <<<<<<<<<<<<<<
 *         self.c_name = name
 *         # evbuffer_new() clears the memory area of the object with zeroes,
 */
  __Pyx_INCREF(__pyx_v_mode);
  __Pyx_GIVEREF(__pyx_v_mode);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode = __pyx_v_mode;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":706
 *         self.close_ref = close_ref
 *         self.c_mode = mode
 *         self.c_name = name             # <<<<<<<<<<<<<<
 *         # evbuffer_new() clears the memory area of the object with zeroes,
 *         # but Pyrex (and __cinit__) ensure that happens, so we don't have to
 */
  __Pyx_INCREF(__pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name = __pyx_v_name;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbfile.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_close_ref);
  __Pyx_DECREF(__pyx_v_mode);
  __Pyx_DECREF(__pyx_v_name);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":711
 *         # do that.
 * 
 *     def fileno(nbfile self):             # <<<<<<<<<<<<<<
 *         if self.read_fd >= 0:
 *             return self.read_fd
 */

static PyObject *__pyx_pf_4coio_6nbfile_fileno(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_fileno(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("fileno");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":712
 * 
 *     def fileno(nbfile self):
 *         if self.read_fd >= 0:             # <<<<<<<<<<<<<<
 *             return self.read_fd
 *         else:
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd >= 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":713
 *     def fileno(nbfile self):
 *         if self.read_fd >= 0:
 *             return self.read_fd             # <<<<<<<<<<<<<<
 *         else:
 *             return self.write_fd
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":715
 *             return self.read_fd
 *         else:
 *             return self.write_fd             # <<<<<<<<<<<<<<
 * 
 *     # This method is not present in standard file.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbfile.fileno");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":718
 * 
 *     # This method is not present in standard file.
 *     def write_fileno(nbfile self):             # <<<<<<<<<<<<<<
 *         return self.write_fd
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_write_fileno(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_write_fileno(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("write_fileno");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":719
 *     # This method is not present in standard file.
 *     def write_fileno(nbfile self):
 *         return self.write_fd             # <<<<<<<<<<<<<<
 * 
 *     def close(nbfile self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbfile.write_fileno");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":721
 *         return self.write_fd
 * 
 *     def close(nbfile self):             # <<<<<<<<<<<<<<
 *         cdef int got
 *         try:
 */

static PyObject *__pyx_pf_4coio_6nbfile_close(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_close(PyObject *__pyx_v_self, PyObject *unused) {
  int __pyx_v_got;
  PyObject *__pyx_v_exc;
  PyObject *__pyx_v_close_ref;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("close");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_exc = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_close_ref = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":723
 *     def close(nbfile self):
 *         cdef int got
 *         try:             # <<<<<<<<<<<<<<
 *             if self.write_eb.off > 0:
 *                 self.flush()
 */
  /*try:*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":724
 *         cdef int got
 *         try:
 *             if self.write_eb.off > 0:             # <<<<<<<<<<<<<<
 *                 self.flush()
 *         finally:
 */
    __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off > 0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":725
 *         try:
 *             if self.write_eb.off > 0:
 *                 self.flush()             # <<<<<<<<<<<<<<
 *         finally:
 *             if not self.c_closed:
 */
      __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__flush); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L6;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L6;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L8;
    }
    __pyx_L8:;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L7;
    __pyx_L6: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":727
 *                 self.flush()
 *         finally:
 *             if not self.c_closed:             # <<<<<<<<<<<<<<
 *                 self.c_closed = 1
 *                 if self.c_do_close:
 */
    __pyx_t_1 = (!((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":728
 *         finally:
 *             if not self.c_closed:
 *                 self.c_closed = 1             # <<<<<<<<<<<<<<
 *                 if self.c_do_close:
 *                     if self.close_ref is None:
 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed = 1;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":729
 *             if not self.c_closed:
 *                 self.c_closed = 1
 *                 if self.c_do_close:             # <<<<<<<<<<<<<<
 *                     if self.close_ref is None:
 *                         got = close(self.read_fd)
 */
      __pyx_t_4 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close;
      if (__pyx_t_4) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":730
 *                 self.c_closed = 1
 *                 if self.c_do_close:
 *                     if self.close_ref is None:             # <<<<<<<<<<<<<<
 *                         got = close(self.read_fd)
 *                         if got < 0:
 */
        __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref == Py_None);
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":731
 *                 if self.c_do_close:
 *                     if self.close_ref is None:
 *                         got = close(self.read_fd)             # <<<<<<<<<<<<<<
 *                         if got < 0:
 *                             exc = IOError(errno, strerror(errno))
 */
          __pyx_v_got = close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd);

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":732
 *                     if self.close_ref is None:
 *                         got = close(self.read_fd)
 *                         if got < 0:             # <<<<<<<<<<<<<<
 *                             exc = IOError(errno, strerror(errno))
 *                             close(self.write_fd)
 */
          __pyx_t_1 = (__pyx_v_got < 0);
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":733
 *                         got = close(self.read_fd)
 *                         if got < 0:
 *                             exc = IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                             close(self.write_fd)
 *                             raise exc
 */
            __pyx_t_3 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __pyx_t_2 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(((PyObject *)__pyx_t_2));
            __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_5);
            PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
            __Pyx_GIVEREF(__pyx_t_3);
            PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_2));
            __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
            __pyx_t_3 = 0;
            __pyx_t_2 = 0;
            __pyx_t_2 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_DECREF(__pyx_v_exc);
            __pyx_v_exc = __pyx_t_2;
            __pyx_t_2 = 0;

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":734
 *                         if got < 0:
 *                             exc = IOError(errno, strerror(errno))
 *                             close(self.write_fd)             # <<<<<<<<<<<<<<
 *                             raise exc
 *                         got = close(self.write_fd)
 */
            close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd);

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":735
 *                             exc = IOError(errno, strerror(errno))
 *                             close(self.write_fd)
 *                             raise exc             # <<<<<<<<<<<<<<
 *                         got = close(self.write_fd)
 *                         if got < 0:
 */
            __Pyx_Raise(__pyx_v_exc, 0, 0);
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            goto __pyx_L13;
          }
          __pyx_L13:;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":736
 *                             close(self.write_fd)
 *                             raise exc
 *                         got = close(self.write_fd)             # <<<<<<<<<<<<<<
 *                         if got < 0:
 *                             raise IOError(errno, strerror(errno))
 */
          __pyx_v_got = close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd);

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":737
 *                             raise exc
 *                         got = close(self.write_fd)
 *                         if got < 0:             # <<<<<<<<<<<<<<
 *                             raise IOError(errno, strerror(errno))
 *                     else:
 */
          __pyx_t_1 = (__pyx_v_got < 0);
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":738
 *                         got = close(self.write_fd)
 *                         if got < 0:
 *                             raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                     else:
 *                         close_ref = self.close_ref
 */
            __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_2);
            __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(((PyObject *)__pyx_t_5));
            __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_3);
            PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
            __Pyx_GIVEREF(__pyx_t_2);
            PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_t_5));
            __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
            __pyx_t_2 = 0;
            __pyx_t_5 = 0;
            __pyx_t_5 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_Raise(__pyx_t_5, 0, 0);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            goto __pyx_L14;
          }
          __pyx_L14:;
          goto __pyx_L12;
        }
        /*else*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":740
 *                             raise IOError(errno, strerror(errno))
 *                     else:
 *                         close_ref = self.close_ref             # <<<<<<<<<<<<<<
 *                         self.close_ref = False
 *                         if close_ref is not False:
 */
          __Pyx_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
          __Pyx_DECREF(__pyx_v_close_ref);
          __pyx_v_close_ref = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":741
 *                     else:
 *                         close_ref = self.close_ref
 *                         self.close_ref = False             # <<<<<<<<<<<<<<
 *                         if close_ref is not False:
 *                             close_ref.close()
 */
          __pyx_t_5 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_5);
          __Pyx_GOTREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
          __Pyx_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
          ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref = __pyx_t_5;
          __pyx_t_5 = 0;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":742
 *                         close_ref = self.close_ref
 *                         self.close_ref = False
 *                         if close_ref is not False:             # <<<<<<<<<<<<<<
 *                             close_ref.close()
 * 
 */
          __pyx_t_5 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = (__pyx_v_close_ref != __pyx_t_5);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":743
 *                         self.close_ref = False
 *                         if close_ref is not False:
 *                             close_ref.close()             # <<<<<<<<<<<<<<
 * 
 *     property closed:
 */
            __pyx_t_5 = PyObject_GetAttr(__pyx_v_close_ref, __pyx_n_s__close); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_5);
            __pyx_t_3 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            goto __pyx_L15;
          }
          __pyx_L15:;
        }
        __pyx_L12:;
        goto __pyx_L11;
      }
      __pyx_L11:;
      goto __pyx_L10;
    }
    __pyx_L10:;
    goto __pyx_L16;
    __pyx_L9_error:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1_error;
    __pyx_L16:;
    switch (__pyx_why) {
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.nbfile.close");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_exc);
  __Pyx_DECREF(__pyx_v_close_ref);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":746
 * 
 *     property closed:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             if self.c_closed:
 *                 return True
 */

static PyObject *__pyx_pf_4coio_6nbfile_6closed___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_6closed___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  char __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__get__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":747
 *     property closed:
 *         def __get__(nbfile self):
 *             if self.c_closed:             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
  __pyx_t_1 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":748
 *         def __get__(nbfile self):
 *             if self.c_closed:
 *                 return True             # <<<<<<<<<<<<<<
 *             else:
 *                 return False
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":750
 *                 return True
 *             else:
 *                 return False             # <<<<<<<<<<<<<<
 * 
 *     # This is not a standard property of `file'.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbfile.closed.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":754
 *     # This is not a standard property of `file'.
 *     property do_close:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.c_do_close
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_8do_close___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_8do_close___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":755
 *     property do_close:
 *         def __get__(nbfile self):
 *             return self.c_do_close             # <<<<<<<<<<<<<<
 * 
 *     property read_limit:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbfile.do_close.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":766
 *         It is possible to set this property.
 *         """
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.c_read_limit
 *         def __set__(nbfile self, int new_value):
 */

static PyObject *__pyx_pf_4coio_6nbfile_10read_limit___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_10read_limit___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":767
 *         """
 *         def __get__(nbfile self):
 *             return self.c_read_limit             # <<<<<<<<<<<<<<
 *         def __set__(nbfile self, int new_value):
 *             self.c_read_limit = new_value
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbfile.read_limit.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":768
 *         def __get__(nbfile self):
 *             return self.c_read_limit
 *         def __set__(nbfile self, int new_value):             # <<<<<<<<<<<<<<
 *             self.c_read_limit = new_value
 * 
 */

static int __pyx_pf_4coio_6nbfile_10read_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_value); /*proto*/
static int __pyx_pf_4coio_6nbfile_10read_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_value) {
  int __pyx_v_new_value;
  int __pyx_r;
  __Pyx_RefNannySetupContext("__set__");
  assert(__pyx_arg_new_value); {
    __pyx_v_new_value = __Pyx_PyInt_AsInt(__pyx_arg_new_value); if (unlikely((__pyx_v_new_value == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 768; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbfile.read_limit.__set__");
  return -1;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":769
 *             return self.c_read_limit
 *         def __set__(nbfile self, int new_value):
 *             self.c_read_limit = new_value             # <<<<<<<<<<<<<<
 * 
 *     property mode:
 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit = __pyx_v_new_value;

  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":772
 * 
 *     property mode:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.c_mode
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_4mode___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_4mode___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":773
 *     property mode:
 *         def __get__(nbfile self):
 *             return self.c_mode             # <<<<<<<<<<<<<<
 * 
 *     property name:
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":776
 * 
 *     property name:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.c_name
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_4name___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_4name___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":777
 *     property name:
 *         def __get__(nbfile self):
 *             return self.c_name             # <<<<<<<<<<<<<<
 * 
 *     # file.softspace is used by `print'.
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":781
 *     # file.softspace is used by `print'.
 *     property softspace:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.c_softspace
 *         def __set__(nbfile self, char softspace):
 */

static PyObject *__pyx_pf_4coio_6nbfile_9softspace___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_9softspace___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":782
 *     property softspace:
 *         def __get__(nbfile self):
 *             return self.c_softspace             # <<<<<<<<<<<<<<
 *         def __set__(nbfile self, char softspace):
 *             self.c_softspace = softspace
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_softspace); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbfile.softspace.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":783
 *         def __get__(nbfile self):
 *             return self.c_softspace
 *         def __set__(nbfile self, char softspace):             # <<<<<<<<<<<<<<
 *             self.c_softspace = softspace
 * 
 */

static int __pyx_pf_4coio_6nbfile_9softspace___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_softspace); /*proto*/
static int __pyx_pf_4coio_6nbfile_9softspace___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_softspace) {
  char __pyx_v_softspace;
  int __pyx_r;
  __Pyx_RefNannySetupContext("__set__");
  assert(__pyx_arg_softspace); {
    __pyx_v_softspace = __Pyx_PyInt_AsChar(__pyx_arg_softspace); if (unlikely((__pyx_v_softspace == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbfile.softspace.__set__");
  return -1;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":784
 *             return self.c_softspace
 *         def __set__(nbfile self, char softspace):
 *             self.c_softspace = softspace             # <<<<<<<<<<<<<<
 * 
 *     # Simplification over `file'.
 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_softspace = __pyx_v_softspace;

  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":788
 *     # Simplification over `file'.
 *     property encoding:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return None
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_8encoding___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_8encoding___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":789
 *     property encoding:
 *         def __get__(nbfile self):
 *             return None             # <<<<<<<<<<<<<<
 * 
 *     # Simplification over `file'.
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":793
 *     # Simplification over `file'.
 *     property newlines:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return None
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_8newlines___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_8newlines___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":794
 *     property newlines:
 *         def __get__(nbfile self):
 *             return None             # <<<<<<<<<<<<<<
 * 
 *     # Unicode error handler. Simplification over `file'.
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":798
 *     # Unicode error handler. Simplification over `file'.
 *     property errors:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return None
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_6errors___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_6errors___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":799
 *     property errors:
 *         def __get__(nbfile self):
 *             return None             # <<<<<<<<<<<<<<
 * 
 *     def write(nbfile self, object buf):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":801
 *             return None
 * 
 *     def write(nbfile self, object buf):             # <<<<<<<<<<<<<<
 *         # TODO(pts): Flush the buffer eventually automatically.
 *         cdef char_constp p
 */

static PyObject *__pyx_pf_4coio_6nbfile_write(PyObject *__pyx_v_self, PyObject *__pyx_v_buf); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_write(PyObject *__pyx_v_self, PyObject *__pyx_v_buf) {
  char const* __pyx_v_p;
  Py_ssize_t __pyx_v_n;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("write");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_buf);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":806
 *         cdef Py_ssize_t n
 *         cdef int fd
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:             # <<<<<<<<<<<<<<
 *             raise TypeError
 *         if self.c_write_buffer_limit == 0:  # Direct output without buffering.
 */
  __pyx_t_1 = (PyObject_AsCharBuffer(__pyx_v_buf, (&__pyx_v_p), (&__pyx_v_n)) < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":807
 *         cdef int fd
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:
 *             raise TypeError             # <<<<<<<<<<<<<<
 *         if self.c_write_buffer_limit == 0:  # Direct output without buffering.
 *             # TODO(pts): Use the socket timeout.
 */
    __Pyx_Raise(__pyx_builtin_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":808
 *         if PyObject_AsCharBuffer(buf, &p, &n) < 0:
 *             raise TypeError
 *         if self.c_write_buffer_limit == 0:  # Direct output without buffering.             # <<<<<<<<<<<<<<
 *             # TODO(pts): Use the socket timeout.
 *             return write_to_fd(self.write_fd, &self.wakeup_ev, p, n)
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit == 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":810
 *         if self.c_write_buffer_limit == 0:  # Direct output without buffering.
 *             # TODO(pts): Use the socket timeout.
 *             return write_to_fd(self.write_fd, &self.wakeup_ev, p, n)             # <<<<<<<<<<<<<<
 *         # !! TODO(pts): Don't even temporarily overflow the buffer.
 *         # !! TODO(pts): Do line buffering with buffer size == 1.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __pyx_f_4coio_write_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd, (&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), __pyx_v_p, __pyx_v_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":813
 *         # !! TODO(pts): Don't even temporarily overflow the buffer.
 *         # !! TODO(pts): Do line buffering with buffer size == 1.
 *         evbuffer_add(&self.write_eb, <char*>p, n)             # <<<<<<<<<<<<<<
 *         if (self.write_buffer_limit > 0 and
 *             self.write_eb.off >= self.c_write_buffer_limit):
 */
  evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb), ((char *)__pyx_v_p), __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":814
 *         # !! TODO(pts): Do line buffering with buffer size == 1.
 *         evbuffer_add(&self.write_eb, <char*>p, n)
 *         if (self.write_buffer_limit > 0 and             # <<<<<<<<<<<<<<
 *             self.write_eb.off >= self.c_write_buffer_limit):
 *             self.flush()
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__write_buffer_limit); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_2, __pyx_int_0, Py_GT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":815
 *         evbuffer_add(&self.write_eb, <char*>p, n)
 *         if (self.write_buffer_limit > 0 and
 *             self.write_eb.off >= self.c_write_buffer_limit):             # <<<<<<<<<<<<<<
 *             self.flush()
 * 
 */
    __pyx_t_4 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off >= ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit);
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_1;
  }
  if (__pyx_t_5) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":816
 *         if (self.write_buffer_limit > 0 and
 *             self.write_eb.off >= self.c_write_buffer_limit):
 *             self.flush()             # <<<<<<<<<<<<<<
 * 
 *     def flush(nbfile self):
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__flush); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbfile.write");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":818
 *             self.flush()
 * 
 *     def flush(nbfile self):             # <<<<<<<<<<<<<<
 *         # Please note that this method may raise an error even if parts of the
 *         # buffer has been flushed.
 */

static PyObject *__pyx_pf_4coio_6nbfile_flush(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_flush(PyObject *__pyx_v_self, PyObject *unused) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  int __pyx_v_fd;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("flush");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":824
 *         cdef int n
 *         cdef int fd
 *         fd = self.read_fd             # <<<<<<<<<<<<<<
 *         while self.write_eb.off > 0:
 *             n = evbuffer_write(&self.write_eb, fd)
 */
  __pyx_v_fd = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":825
 *         cdef int fd
 *         fd = self.read_fd
 *         while self.write_eb.off > 0:             # <<<<<<<<<<<<<<
 *             n = evbuffer_write(&self.write_eb, fd)
 *             if n < 0:
 */
  while (1) {
    __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off > 0);
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":826
 *         fd = self.read_fd
 *         while self.write_eb.off > 0:
 *             n = evbuffer_write(&self.write_eb, fd)             # <<<<<<<<<<<<<<
 *             if n < 0:
 *                 if errno != EAGAIN:
 */
    __pyx_v_n = evbuffer_write((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb), __pyx_v_fd);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":827
 *         while self.write_eb.off > 0:
 *             n = evbuffer_write(&self.write_eb, fd)
 *             if n < 0:             # <<<<<<<<<<<<<<
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
    __pyx_t_1 = (__pyx_v_n < 0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":828
 *             n = evbuffer_write(&self.write_eb, fd)
 *             if n < 0:
 *                 if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))
 */
      __pyx_t_1 = (errno != EAGAIN);
      if (__pyx_t_1) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":830
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 */
        __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
        __pyx_t_2 = 0;
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_3, 0, 0);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":831
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 */
      __pyx_t_3 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 831; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_3);
      __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":833
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                           <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), __pyx_v_fd, EV_WRITE, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":834
 *                 event_set(&self.wakeup_ev, fd, c_EV_WRITE, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 * 
 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":835
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 * 
 *     property read_buffer_len:
 */
      __pyx_t_3 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbfile.flush");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":838
 * 
 *     property read_buffer_len:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.read_eb.off
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_15read_buffer_len___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_15read_buffer_len___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":839
 *     property read_buffer_len:
 *         def __get__(nbfile self):
 *             return self.read_eb.off             # <<<<<<<<<<<<<<
 * 
 *     property write_buffer_len:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 839; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbfile.read_buffer_len.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":842
 * 
 *     property write_buffer_len:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.write_eb.off
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_16write_buffer_len___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_16write_buffer_len___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":843
 *     property write_buffer_len:
 *         def __get__(nbfile self):
 *             return self.write_eb.off             # <<<<<<<<<<<<<<
 * 
 *     property write_buffer_limit:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbfile.write_buffer_len.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":846
 * 
 *     property write_buffer_limit:
 *         def __get__(nbfile self):             # <<<<<<<<<<<<<<
 *             return self.c_write_buffer_limit
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_18write_buffer_limit___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_18write_buffer_limit___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":847
 *     property write_buffer_limit:
 *         def __get__(nbfile self):
 *             return self.c_write_buffer_limit             # <<<<<<<<<<<<<<
 * 
 *     def discard_write_buffer(nbfile self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbfile.write_buffer_limit.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":849
 *             return self.c_write_buffer_limit
 * 
 *     def discard_write_buffer(nbfile self):             # <<<<<<<<<<<<<<
 *         evbuffer_drain(&self.write_eb, self.write_eb.off)
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_discard_write_buffer(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_discard_write_buffer(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("discard_write_buffer");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":850
 * 
 *     def discard_write_buffer(nbfile self):
 *         evbuffer_drain(&self.write_eb, self.write_eb.off)             # <<<<<<<<<<<<<<
 * 
 *     def discard(nbfile self, int n):
 */
  evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off);

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":852
 *         evbuffer_drain(&self.write_eb, self.write_eb.off)
 * 
 *     def discard(nbfile self, int n):             # <<<<<<<<<<<<<<
 *         """Read and discard exactly n bytes.
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_discard(PyObject *__pyx_v_self, PyObject *__pyx_arg_n); /*proto*/
static char __pyx_doc_4coio_6nbfile_discard[] = "Read and discard exactly n bytes.\n\n        Args:\n          n: Number of bytes to discard. Negative values are treated as 0.\n        Returns:\n          The number of bytes not discarded because of EOF.\n        Raises:\n          IOError: (but not EOFError)\n        ";
static PyObject *__pyx_pf_4coio_6nbfile_discard(PyObject *__pyx_v_self, PyObject *__pyx_arg_n) {
  int __pyx_v_n;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("discard");
  assert(__pyx_arg_n); {
    __pyx_v_n = __Pyx_PyInt_AsInt(__pyx_arg_n); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbfile.discard");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":864
 *         cdef tasklet wakeup_tasklet
 *         cdef int got
 *         if self.read_eb.off > 0:             # <<<<<<<<<<<<<<
 *             if self.read_eb.off >= n:
 *                 self.read_eb.off -= n
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":865
 *         cdef int got
 *         if self.read_eb.off > 0:
 *             if self.read_eb.off >= n:             # <<<<<<<<<<<<<<
 *                 self.read_eb.off -= n
 *                 return 0
 */
    __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off >= __pyx_v_n);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":866
 *         if self.read_eb.off > 0:
 *             if self.read_eb.off >= n:
 *                 self.read_eb.off -= n             # <<<<<<<<<<<<<<
 *                 return 0
 *             n -= self.read_eb.off
 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off -= __pyx_v_n;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":867
 *             if self.read_eb.off >= n:
 *                 self.read_eb.off -= n
 *                 return 0             # <<<<<<<<<<<<<<
 *             n -= self.read_eb.off
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_int_0);
      __pyx_r = __pyx_int_0;
      goto __pyx_L0;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":868
 *                 self.read_eb.off -= n
 *                 return 0
 *             n -= self.read_eb.off             # <<<<<<<<<<<<<<
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)
 *         if n <= 0:
 */
    __pyx_v_n -= ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":869
 *                 return 0
 *             n -= self.read_eb.off
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)             # <<<<<<<<<<<<<<
 *         if n <= 0:
 *             return 0
 */
    evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":870
 *             n -= self.read_eb.off
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)
 *         if n <= 0:             # <<<<<<<<<<<<<<
 *             return 0
 *         while 1:  # n > 0
 */
  __pyx_t_1 = (__pyx_v_n <= 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":871
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)
 *         if n <= 0:
 *             return 0             # <<<<<<<<<<<<<<
 *         while 1:  # n > 0
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_int_0);
    __pyx_r = __pyx_int_0;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":872
 *         if n <= 0:
 *             return 0
 *         while 1:  # n > 0             # <<<<<<<<<<<<<<
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:
 *                 got = self.c_read_limit
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":873
 *             return 0
 *         while 1:  # n > 0
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:             # <<<<<<<<<<<<<<
 *                 got = self.c_read_limit
 *                 if got == 0:
 */
    __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_t_1) {
      __pyx_t_2 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
      __pyx_t_3 = __pyx_t_2;
    } else {
      __pyx_t_3 = __pyx_t_1;
    }
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":874
 *         while 1:  # n > 0
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:
 *                 got = self.c_read_limit             # <<<<<<<<<<<<<<
 *                 if got == 0:
 *                     return n
 */
      __pyx_v_got = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":875
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:
 *                 got = self.c_read_limit
 *                 if got == 0:             # <<<<<<<<<<<<<<
 *                     return n
 *             else:
 */
      __pyx_t_3 = (__pyx_v_got == 0);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":876
 *                 got = self.c_read_limit
 *                 if got == 0:
 *                     return n             # <<<<<<<<<<<<<<
 *             else:
 *                 got = n
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_4 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L0;
        goto __pyx_L11;
      }
      __pyx_L11:;
      goto __pyx_L10;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":878
 *                     return n
 *             else:
 *                 got = n             # <<<<<<<<<<<<<<
 *             if got > 8192:  # TODO(pts): Get rid of this constant
 *                 got = 8192
 */
      __pyx_v_got = __pyx_v_n;
    }
    __pyx_L10:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":879
 *             else:
 *                 got = n
 *             if got > 8192:  # TODO(pts): Get rid of this constant             # <<<<<<<<<<<<<<
 *                 got = 8192
 *             #assert got > 0  # true, but don't check it for speed reasons
 */
    __pyx_t_3 = (__pyx_v_got > 8192);
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":880
 *                 got = n
 *             if got > 8192:  # TODO(pts): Get rid of this constant
 *                 got = 8192             # <<<<<<<<<<<<<<
 *             #assert got > 0  # true, but don't check it for speed reasons
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 */
      __pyx_v_got = 8192;
      goto __pyx_L12;
    }
    __pyx_L12:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":883
 *             #assert got > 0  # true, but don't check it for speed reasons
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 *             got = evbuffer_read(&self.read_eb, self.read_fd, got)             # <<<<<<<<<<<<<<
 *             if got < 0:
 *                 if errno != EAGAIN:
 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd, __pyx_v_got);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":884
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 *             got = evbuffer_read(&self.read_eb, self.read_fd, got)
 *             if got < 0:             # <<<<<<<<<<<<<<
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))
 */
    __pyx_t_3 = (__pyx_v_got < 0);
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":885
 *             got = evbuffer_read(&self.read_eb, self.read_fd, got)
 *             if got < 0:
 *                 if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 */
      __pyx_t_3 = (errno != EAGAIN);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":886
 *             if got < 0:
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 */
        __pyx_t_4 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_5));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":887
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 */
      __pyx_t_5 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 887; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_5);
      __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":889
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd, EV_READ, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":890
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF
 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":891
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *             elif got == 0:  # EOF
 *                 return n
 */
      __pyx_t_5 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L13;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":892
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF             # <<<<<<<<<<<<<<
 *                 return n
 *             else:
 */
    __pyx_t_3 = (__pyx_v_got == 0);
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":893
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF
 *                 return n             # <<<<<<<<<<<<<<
 *             else:
 *                 n -= got
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_5 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L0;
      goto __pyx_L13;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":895
 *                 return n
 *             else:
 *                 n -= got             # <<<<<<<<<<<<<<
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got
 */
      __pyx_v_n -= __pyx_v_got;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":896
 *             else:
 *                 n -= got
 *                 if self.c_read_limit >= 0:             # <<<<<<<<<<<<<<
 *                     self.c_read_limit -= got
 *                 evbuffer_drain(&self.read_eb, got)
 */
      __pyx_t_3 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":897
 *                 n -= got
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got             # <<<<<<<<<<<<<<
 *                 evbuffer_drain(&self.read_eb, got)
 *                 if n == 0:
 */
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":898
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got
 *                 evbuffer_drain(&self.read_eb, got)             # <<<<<<<<<<<<<<
 *                 if n == 0:
 *                     return 0
 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_got);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":899
 *                     self.c_read_limit -= got
 *                 evbuffer_drain(&self.read_eb, got)
 *                 if n == 0:             # <<<<<<<<<<<<<<
 *                     return 0
 * 
 */
      __pyx_t_3 = (__pyx_v_n == 0);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":900
 *                 evbuffer_drain(&self.read_eb, got)
 *                 if n == 0:
 *                     return 0             # <<<<<<<<<<<<<<
 * 
 *     def discard_to_read_limit(nbfile self):
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(__pyx_int_0);
        __pyx_r = __pyx_int_0;
        goto __pyx_L0;
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __pyx_L13:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.nbfile.discard");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":902
 *                     return 0
 * 
 *     def discard_to_read_limit(nbfile self):             # <<<<<<<<<<<<<<
 *         """Discard the read buffer, and discard bytes from read_fd."""
 *         if self.read_eb.off > 0:
 */

static PyObject *__pyx_pf_4coio_6nbfile_discard_to_read_limit(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_6nbfile_discard_to_read_limit[] = "Discard the read buffer, and discard bytes from read_fd.";
static PyObject *__pyx_pf_4coio_6nbfile_discard_to_read_limit(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("discard_to_read_limit");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":904
 *     def discard_to_read_limit(nbfile self):
 *         """Discard the read buffer, and discard bytes from read_fd."""
 *         if self.read_eb.off > 0:             # <<<<<<<<<<<<<<
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)
 *             #assert self.c_read_limit == 0
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":905
 *         """Discard the read buffer, and discard bytes from read_fd."""
 *         if self.read_eb.off > 0:
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)             # <<<<<<<<<<<<<<
 *             #assert self.c_read_limit == 0
 *         if self.c_read_limit > 0:
 */
    evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":907
 *             evbuffer_drain(&self.read_eb, self.read_eb.off)
 *             #assert self.c_read_limit == 0
 *         if self.c_read_limit > 0:             # <<<<<<<<<<<<<<
 *             # TODO(pts): Speed this up by not doing a Python method call.
 *             self.discard(self.c_read_limit)
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit > 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":909
 *         if self.c_read_limit > 0:
 *             # TODO(pts): Speed this up by not doing a Python method call.
 *             self.discard(self.c_read_limit)             # <<<<<<<<<<<<<<
 *             assert self.c_read_limit == 0
 * 
 */
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__discard); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":910
 *             # TODO(pts): Speed this up by not doing a Python method call.
 *             self.discard(self.c_read_limit)
 *             assert self.c_read_limit == 0             # <<<<<<<<<<<<<<
 * 
 *     def read(nbfile self, int n):
 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (unlikely(!(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit == 0))) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    #endif
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbfile.discard_to_read_limit");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":912
 *             assert self.c_read_limit == 0
 * 
 *     def read(nbfile self, int n):             # <<<<<<<<<<<<<<
 *         """Read exactly n bytes (or less on EOF), and return string
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_read(PyObject *__pyx_v_self, PyObject *__pyx_arg_n); /*proto*/
static char __pyx_doc_4coio_6nbfile_read[] = "Read exactly n bytes (or less on EOF), and return string\n\n        Args:\n          n: Number of bytes to read. Negative values are treated as 0.\n        Returns:\n          String containing the bytes read; an empty string on EOF.\n        Raises:\n          IOError: (but not EOFError)\n        ";
static PyObject *__pyx_pf_4coio_6nbfile_read(PyObject *__pyx_v_self, PyObject *__pyx_arg_n) {
  int __pyx_v_n;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("read");
  assert(__pyx_arg_n); {
    __pyx_v_n = __Pyx_PyInt_AsInt(__pyx_arg_n); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbfile.read");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_buf = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":925
 *         cdef int got
 *         cdef object buf
 *         if self.c_read_limit >= 0 and n > self.c_read_limit:             # <<<<<<<<<<<<<<
 *             n = self.c_read_limit
 *         if n <= 0:
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":926
 *         cdef object buf
 *         if self.c_read_limit >= 0 and n > self.c_read_limit:
 *             n = self.c_read_limit             # <<<<<<<<<<<<<<
 *         if n <= 0:
 *             return ''
 */
    __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":927
 *         if self.c_read_limit >= 0 and n > self.c_read_limit:
 *             n = self.c_read_limit
 *         if n <= 0:             # <<<<<<<<<<<<<<
 *             return ''
 *         while self.read_eb.off < n:  # Data not fully in the buffer.
 */
  __pyx_t_3 = (__pyx_v_n <= 0);
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":928
 *             n = self.c_read_limit
 *         if n <= 0:
 *             return ''             # <<<<<<<<<<<<<<
 *         while self.read_eb.off < n:  # Data not fully in the buffer.
 *             got = n - self.read_eb.off
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
    __pyx_r = ((PyObject *)__pyx_kp_s_5);
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":929
 *         if n <= 0:
 *             return ''
 *         while self.read_eb.off < n:  # Data not fully in the buffer.             # <<<<<<<<<<<<<<
 *             got = n - self.read_eb.off
 *             if got > 65536 and got > self.read_eb.totallen:
 */
  while (1) {
    __pyx_t_3 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off < __pyx_v_n);
    if (!__pyx_t_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":930
 *             return ''
 *         while self.read_eb.off < n:  # Data not fully in the buffer.
 *             got = n - self.read_eb.off             # <<<<<<<<<<<<<<
 *             if got > 65536 and got > self.read_eb.totallen:
 *                 # Limit the total number of bytes read to the double of the
 */
    __pyx_v_got = (__pyx_v_n - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":931
 *         while self.read_eb.off < n:  # Data not fully in the buffer.
 *             got = n - self.read_eb.off
 *             if got > 65536 and got > self.read_eb.totallen:             # <<<<<<<<<<<<<<
 *                 # Limit the total number of bytes read to the double of the
 *                 # read buffer size.
 */
    __pyx_t_3 = (__pyx_v_got > 65536);
    if (__pyx_t_3) {
      __pyx_t_1 = (__pyx_v_got > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen);
      __pyx_t_2 = __pyx_t_1;
    } else {
      __pyx_t_2 = __pyx_t_3;
    }
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":936
 *                 # evbuffer_read() does someting similar, also involving
 *                 # EVBUFFER_MAX_READ == 4096.
 *                 got = self.read_eb.totallen             # <<<<<<<<<<<<<<
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 *             got = evbuffer_read(&self.read_eb, self.read_fd, got)
 */
      __pyx_v_got = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":938
 *                 got = self.read_eb.totallen
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 *             got = evbuffer_read(&self.read_eb, self.read_fd, got)             # <<<<<<<<<<<<<<
 *             if got < 0:
 *                 if errno != EAGAIN:
 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd, __pyx_v_got);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":939
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 *             got = evbuffer_read(&self.read_eb, self.read_fd, got)
 *             if got < 0:             # <<<<<<<<<<<<<<
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))
 */
    __pyx_t_2 = (__pyx_v_got < 0);
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":940
 *             got = evbuffer_read(&self.read_eb, self.read_fd, got)
 *             if got < 0:
 *                 if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 */
      __pyx_t_2 = (errno != EAGAIN);
      if (__pyx_t_2) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":941
 *             if got < 0:
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 */
        __pyx_t_4 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 941; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 941; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 941; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_5));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 941; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 941; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":942
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 */
      __pyx_t_5 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_5);
      __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":944
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd, EV_READ, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":945
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF
 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":946
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *             elif got == 0:  # EOF
 *                 n = self.read_eb.off
 */
      __pyx_t_5 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 946; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L10;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":947
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF             # <<<<<<<<<<<<<<
 *                 n = self.read_eb.off
 *                 break
 */
    __pyx_t_2 = (__pyx_v_got == 0);
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":948
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF
 *                 n = self.read_eb.off             # <<<<<<<<<<<<<<
 *                 break
 *             else:
 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":949
 *             elif got == 0:  # EOF
 *                 n = self.read_eb.off
 *                 break             # <<<<<<<<<<<<<<
 *             else:
 *                 if self.c_read_limit >= 0:
 */
      goto __pyx_L8_break;
      goto __pyx_L10;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":951
 *                 break
 *             else:
 *                 if self.c_read_limit >= 0:             # <<<<<<<<<<<<<<
 *                     self.c_read_limit -= got
 *                 evbuffer_drain(&self.read_eb, got)
 */
      __pyx_t_2 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_t_2) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":952
 *             else:
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got             # <<<<<<<<<<<<<<
 *                 evbuffer_drain(&self.read_eb, got)
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 */
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L12;
      }
      __pyx_L12:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":953
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got
 *                 evbuffer_drain(&self.read_eb, got)             # <<<<<<<<<<<<<<
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *         evbuffer_drain(&self.read_eb, n)
 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_got);
    }
    __pyx_L10:;
  }
  __pyx_L8_break:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":954
 *                     self.c_read_limit -= got
 *                 evbuffer_drain(&self.read_eb, got)
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)             # <<<<<<<<<<<<<<
 *         evbuffer_drain(&self.read_eb, n)
 *         return buf
 */
  __pyx_t_5 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":955
 *                 evbuffer_drain(&self.read_eb, got)
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *         evbuffer_drain(&self.read_eb, n)             # <<<<<<<<<<<<<<
 *         return buf
 * 
 */
  evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":956
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *         evbuffer_drain(&self.read_eb, n)
 *         return buf             # <<<<<<<<<<<<<<
 * 
 *     def read_at_most(nbfile self, int n):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.nbfile.read");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":958
 *         return buf
 * 
 *     def read_at_most(nbfile self, int n):             # <<<<<<<<<<<<<<
 *         """Read at most n bytes and return the string.
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_read_at_most(PyObject *__pyx_v_self, PyObject *__pyx_arg_n); /*proto*/
static char __pyx_doc_4coio_6nbfile_read_at_most[] = "Read at most n bytes and return the string.\n\n        If the read buffer is not empty (self.read_buffer_len), data inside it\n        will be returned, and no attempt is done to read self.read_fd.\n        ";
static PyObject *__pyx_pf_4coio_6nbfile_read_at_most(PyObject *__pyx_v_self, PyObject *__pyx_arg_n) {
  int __pyx_v_n;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("read_at_most");
  assert(__pyx_arg_n); {
    __pyx_v_n = __Pyx_PyInt_AsInt(__pyx_arg_n); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 958; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbfile.read_at_most");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_buf = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":966
 *         cdef tasklet wakeup_tasklet
 *         cdef int got
 *         if n <= 0:             # <<<<<<<<<<<<<<
 *             return ''
 *         if self.read_eb.off > 0:
 */
  __pyx_t_1 = (__pyx_v_n <= 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":967
 *         cdef int got
 *         if n <= 0:
 *             return ''             # <<<<<<<<<<<<<<
 *         if self.read_eb.off > 0:
 *             if self.read_eb.off < n:
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
    __pyx_r = ((PyObject *)__pyx_kp_s_5);
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":968
 *         if n <= 0:
 *             return ''
 *         if self.read_eb.off > 0:             # <<<<<<<<<<<<<<
 *             if self.read_eb.off < n:
 *                 n = self.read_eb.off
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":969
 *             return ''
 *         if self.read_eb.off > 0:
 *             if self.read_eb.off < n:             # <<<<<<<<<<<<<<
 *                 n = self.read_eb.off
 *             buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 */
    __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off < __pyx_v_n);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":970
 *         if self.read_eb.off > 0:
 *             if self.read_eb.off < n:
 *                 n = self.read_eb.off             # <<<<<<<<<<<<<<
 *             buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *             evbuffer_drain(&self.read_eb, n)
 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":971
 *             if self.read_eb.off < n:
 *                 n = self.read_eb.off
 *             buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)             # <<<<<<<<<<<<<<
 *             evbuffer_drain(&self.read_eb, n)
 *             if self.c_read_limit >= 0:
 */
    __pyx_t_2 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 971; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_v_buf);
    __pyx_v_buf = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":972
 *                 n = self.read_eb.off
 *             buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *             evbuffer_drain(&self.read_eb, n)             # <<<<<<<<<<<<<<
 *             if self.c_read_limit >= 0:
 *                 self.c_read_limit -= n
 */
    evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":973
 *             buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *             evbuffer_drain(&self.read_eb, n)
 *             if self.c_read_limit >= 0:             # <<<<<<<<<<<<<<
 *                 self.c_read_limit -= n
 *             # TODO(pts): Maybe read more from fd, if available and flag.
 */
    __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":974
 *             evbuffer_drain(&self.read_eb, n)
 *             if self.c_read_limit >= 0:
 *                 self.c_read_limit -= n             # <<<<<<<<<<<<<<
 *             # TODO(pts): Maybe read more from fd, if available and flag.
 *             return buf
 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_n;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":976
 *                 self.c_read_limit -= n
 *             # TODO(pts): Maybe read more from fd, if available and flag.
 *             return buf             # <<<<<<<<<<<<<<
 *         if self.c_read_limit >= 0 and n > self.c_read_limit:
 *             n = self.c_read_limit
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_buf);
    __pyx_r = __pyx_v_buf;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":977
 *             # TODO(pts): Maybe read more from fd, if available and flag.
 *             return buf
 *         if self.c_read_limit >= 0 and n > self.c_read_limit:             # <<<<<<<<<<<<<<
 *             n = self.c_read_limit
 *         while 1:
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_t_1) {
    __pyx_t_3 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
    __pyx_t_4 = __pyx_t_3;
  } else {
    __pyx_t_4 = __pyx_t_1;
  }
  if (__pyx_t_4) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":978
 *             return buf
 *         if self.c_read_limit >= 0 and n > self.c_read_limit:
 *             n = self.c_read_limit             # <<<<<<<<<<<<<<
 *         while 1:
 *             # TODO(pts): Don't read it to the buffer, read without memcpy.
 */
    __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":979
 *         if self.c_read_limit >= 0 and n > self.c_read_limit:
 *             n = self.c_read_limit
 *         while 1:             # <<<<<<<<<<<<<<
 *             # TODO(pts): Don't read it to the buffer, read without memcpy.
 *             #            We'd need the readinto method for that.
 */
  while (1) {
    __pyx_t_4 = 1;
    if (!__pyx_t_4) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":982
 *             # TODO(pts): Don't read it to the buffer, read without memcpy.
 *             #            We'd need the readinto method for that.
 *             got = evbuffer_read(&self.read_eb, self.read_fd, n)             # <<<<<<<<<<<<<<
 *             if got < 0:
 *                 if errno != EAGAIN:
 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd, __pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":983
 *             #            We'd need the readinto method for that.
 *             got = evbuffer_read(&self.read_eb, self.read_fd, n)
 *             if got < 0:             # <<<<<<<<<<<<<<
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))
 */
    __pyx_t_4 = (__pyx_v_got < 0);
    if (__pyx_t_4) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":984
 *             got = evbuffer_read(&self.read_eb, self.read_fd, n)
 *             if got < 0:
 *                 if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 */
      __pyx_t_4 = (errno != EAGAIN);
      if (__pyx_t_4) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":985
 *             if got < 0:
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 */
        __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_5));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
        __pyx_t_2 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":986
 *                 if errno != EAGAIN:
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 */
      __pyx_t_5 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 986; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_5);
      __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":988
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd, EV_READ, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":989
 *                 event_set(&self.wakeup_ev, self.read_fd, c_EV_READ,
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:
 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":990
 *                           HandleCWakeup, <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *             elif got == 0:
 *                 return ''
 */
      __pyx_t_5 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 990; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L12;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":991
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:             # <<<<<<<<<<<<<<
 *                 return ''
 *             else:
 */
    __pyx_t_4 = (__pyx_v_got == 0);
    if (__pyx_t_4) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":992
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:
 *                 return ''             # <<<<<<<<<<<<<<
 *             else:
 *                 buf = PyString_FromStringAndSize(
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
      __pyx_r = ((PyObject *)__pyx_kp_s_5);
      goto __pyx_L0;
      goto __pyx_L12;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":995
 *             else:
 *                 buf = PyString_FromStringAndSize(
 *                     <char_constp>self.read_eb.buf, got)             # <<<<<<<<<<<<<<
 *                 evbuffer_drain(&self.read_eb, got)
 *                 if self.c_read_limit >= 0:
 */
      __pyx_t_5 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer), __pyx_v_got); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_t_5;
      __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":996
 *                 buf = PyString_FromStringAndSize(
 *                     <char_constp>self.read_eb.buf, got)
 *                 evbuffer_drain(&self.read_eb, got)             # <<<<<<<<<<<<<<
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got
 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_got);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":997
 *                     <char_constp>self.read_eb.buf, got)
 *                 evbuffer_drain(&self.read_eb, got)
 *                 if self.c_read_limit >= 0:             # <<<<<<<<<<<<<<
 *                     self.c_read_limit -= got
 *                 return buf
 */
      __pyx_t_4 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_t_4) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":998
 *                 evbuffer_drain(&self.read_eb, got)
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got             # <<<<<<<<<<<<<<
 *                 return buf
 * 
 */
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":999
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got
 *                 return buf             # <<<<<<<<<<<<<<
 * 
 *     def readline(nbfile self):
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
    }
    __pyx_L12:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.nbfile.read_at_most");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1001
 *                 return buf
 * 
 *     def readline(nbfile self):             # <<<<<<<<<<<<<<
 *         cdef tasklet wakeup_tasklet
 *         cdef int n
 */

static PyObject *__pyx_pf_4coio_6nbfile_readline(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_readline(PyObject *__pyx_v_self, PyObject *unused) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  int __pyx_v_got;
  char *__pyx_v_q;
  int __pyx_v_fd;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("readline");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_buf = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1007
 *         cdef char *q
 *         cdef int fd
 *         fd = self.write_fd             # <<<<<<<<<<<<<<
 *         q = <char*>evbuffer_find(&self.read_eb, <uchar_constp>'\n', 1)
 *         while q == NULL:
 */
  __pyx_v_fd = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1008
 *         cdef int fd
 *         fd = self.write_fd
 *         q = <char*>evbuffer_find(&self.read_eb, <uchar_constp>'\n', 1)             # <<<<<<<<<<<<<<
 *         while q == NULL:
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), ((unsigned char const *)__pyx_kp_s_6), 1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1009
 *         fd = self.write_fd
 *         q = <char*>evbuffer_find(&self.read_eb, <uchar_constp>'\n', 1)
 *         while q == NULL:             # <<<<<<<<<<<<<<
 *             # !! don't do ioctl(FIONREAD) if not necessary (in libevent)
 *             # !! where do we get totallen=32768? evbuffer_read has a strange
 */
  while (1) {
    __pyx_t_1 = (__pyx_v_q == NULL);
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1014
 *             # buffer growing behavior.
 *             # !! read more than 8192 bytes if the buffer has space for that
 *             n = 8192             # <<<<<<<<<<<<<<
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:
 *                 n = self.c_read_limit
 */
    __pyx_v_n = 8192;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1015
 *             # !! read more than 8192 bytes if the buffer has space for that
 *             n = 8192
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:             # <<<<<<<<<<<<<<
 *                 n = self.c_read_limit
 *                 if n == 0:
 */
    __pyx_t_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_t_1) {
      __pyx_t_2 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
      __pyx_t_3 = __pyx_t_2;
    } else {
      __pyx_t_3 = __pyx_t_1;
    }
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1016
 *             n = 8192
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:
 *                 n = self.c_read_limit             # <<<<<<<<<<<<<<
 *                 if n == 0:
 *                     n = self.read_eb.off
 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1017
 *             if self.c_read_limit >= 0 and n > self.c_read_limit:
 *                 n = self.c_read_limit
 *                 if n == 0:             # <<<<<<<<<<<<<<
 *                     n = self.read_eb.off
 *                     buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 */
      __pyx_t_3 = (__pyx_v_n == 0);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1018
 *                 n = self.c_read_limit
 *                 if n == 0:
 *                     n = self.read_eb.off             # <<<<<<<<<<<<<<
 *                     buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *                     evbuffer_drain(&self.read_eb, n)
 */
        __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1019
 *                 if n == 0:
 *                     n = self.read_eb.off
 *                     buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)             # <<<<<<<<<<<<<<
 *                     evbuffer_drain(&self.read_eb, n)
 *                     return buf
 */
        __pyx_t_4 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_buf);
        __pyx_v_buf = __pyx_t_4;
        __pyx_t_4 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1020
 *                     n = self.read_eb.off
 *                     buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *                     evbuffer_drain(&self.read_eb, n)             # <<<<<<<<<<<<<<
 *                     return buf
 *             got = evbuffer_read(&self.read_eb, fd, n)
 */
        evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_n);

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1021
 *                     buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *                     evbuffer_drain(&self.read_eb, n)
 *                     return buf             # <<<<<<<<<<<<<<
 *             got = evbuffer_read(&self.read_eb, fd, n)
 *             if got < 0:
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(__pyx_v_buf);
        __pyx_r = __pyx_v_buf;
        goto __pyx_L0;
        goto __pyx_L8;
      }
      __pyx_L8:;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1022
 *                     evbuffer_drain(&self.read_eb, n)
 *                     return buf
 *             got = evbuffer_read(&self.read_eb, fd, n)             # <<<<<<<<<<<<<<
 *             if got < 0:
 *                 if errno != EAGAIN:
 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_fd, __pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1023
 *                     return buf
 *             got = evbuffer_read(&self.read_eb, fd, n)
 *             if got < 0:             # <<<<<<<<<<<<<<
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 */
    __pyx_t_3 = (__pyx_v_got < 0);
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1024
 *             got = evbuffer_read(&self.read_eb, fd, n)
 *             if got < 0:
 *                 if errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))
 */
      __pyx_t_3 = (errno != EAGAIN);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1026
 *                 if errno != EAGAIN:
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, fd, c_EV_READ, HandleCWakeup,
 */
        __pyx_t_4 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1026; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1026; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1026; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_5));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1026; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1026; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1027
 *                     # TODO(pts): Do it more efficiently with pyrex? Twisted does this.
 *                     raise IOError(errno, strerror(errno))
 *                 wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *                 event_set(&self.wakeup_ev, fd, c_EV_READ, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 */
      __pyx_t_5 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1027; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_5);
      __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1029
 *                 wakeup_tasklet = PyStackless_GetCurrent()
 *                 event_set(&self.wakeup_ev, fd, c_EV_READ, HandleCWakeup,
 *                           <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 */
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), __pyx_v_fd, EV_READ, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1030
 *                 event_set(&self.wakeup_ev, fd, c_EV_READ, HandleCWakeup,
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev), NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1031
 *                           <void *>wakeup_tasklet)
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 *                 n = self.read_eb.off
 */
      __pyx_t_5 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1031; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L9;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1032
 *                 event_add(&self.wakeup_ev, NULL)
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)             # <<<<<<<<<<<<<<
 *                 n = self.read_eb.off
 *                 buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 */
    __pyx_t_3 = (__pyx_v_got == 0);
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1033
 *                 PyStackless_Schedule(None, 1)  # remove=1
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 *                 n = self.read_eb.off             # <<<<<<<<<<<<<<
 *                 buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *                 evbuffer_drain(&self.read_eb, n)
 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1034
 *             elif got == 0:  # EOF, return remaining bytes ('' or partial line)
 *                 n = self.read_eb.off
 *                 buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)             # <<<<<<<<<<<<<<
 *                 evbuffer_drain(&self.read_eb, n)
 *                 return buf
 */
      __pyx_t_5 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1034; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_t_5;
      __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1035
 *                 n = self.read_eb.off
 *                 buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *                 evbuffer_drain(&self.read_eb, n)             # <<<<<<<<<<<<<<
 *                 return buf
 *             else:
 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_n);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1036
 *                 buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *                 evbuffer_drain(&self.read_eb, n)
 *                 return buf             # <<<<<<<<<<<<<<
 *             else:
 *                 if self.c_read_limit >= 0:
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L9;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1038
 *                 return buf
 *             else:
 *                 if self.c_read_limit >= 0:             # <<<<<<<<<<<<<<
 *                     self.c_read_limit -= got
 *                 # TODO(pts): Find from later than the beginning (just as read).
 */
      __pyx_t_3 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_t_3) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1039
 *             else:
 *                 if self.c_read_limit >= 0:
 *                     self.c_read_limit -= got             # <<<<<<<<<<<<<<
 *                 # TODO(pts): Find from later than the beginning (just as read).
 *                 q = <char*>evbuffer_find(&self.read_eb, <uchar_constp>'\n', 1)
 */
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1041
 *                     self.c_read_limit -= got
 *                 # TODO(pts): Find from later than the beginning (just as read).
 *                 q = <char*>evbuffer_find(&self.read_eb, <uchar_constp>'\n', 1)             # <<<<<<<<<<<<<<
 *         n = q - <char*>self.read_eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 */
      __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), ((unsigned char const *)__pyx_kp_s_6), 1));
    }
    __pyx_L9:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1042
 *                 # TODO(pts): Find from later than the beginning (just as read).
 *                 q = <char*>evbuffer_find(&self.read_eb, <uchar_constp>'\n', 1)
 *         n = q - <char*>self.read_eb.buf + 1             # <<<<<<<<<<<<<<
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *         evbuffer_drain(&self.read_eb, n)
 */
  __pyx_v_n = ((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer)) + 1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1043
 *                 q = <char*>evbuffer_find(&self.read_eb, <uchar_constp>'\n', 1)
 *         n = q - <char*>self.read_eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)             # <<<<<<<<<<<<<<
 *         evbuffer_drain(&self.read_eb, n)
 *         return buf
 */
  __pyx_t_5 = PyString_FromStringAndSize(((char const *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer), __pyx_v_n); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1044
 *         n = q - <char*>self.read_eb.buf + 1
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *         evbuffer_drain(&self.read_eb, n)             # <<<<<<<<<<<<<<
 *         return buf
 * 
 */
  evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb), __pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1045
 *         buf = PyString_FromStringAndSize(<char_constp>self.read_eb.buf, n)
 *         evbuffer_drain(&self.read_eb, n)
 *         return buf             # <<<<<<<<<<<<<<
 * 
 *     def __next__(nbfile self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.nbfile.readline");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1047
 *         return buf
 * 
 *     def __next__(nbfile self):             # <<<<<<<<<<<<<<
 *         line = self.readline()
 *         if line:
 */

static PyObject *__pyx_pf_4coio_6nbfile___next__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile___next__(PyObject *__pyx_v_self) {
  PyObject *__pyx_v_line;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("__next__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_line = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1048
 * 
 *     def __next__(nbfile self):
 *         line = self.readline()             # <<<<<<<<<<<<<<
 *         if line:
 *             return line
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__readline); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_line);
  __pyx_v_line = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1049
 *     def __next__(nbfile self):
 *         line = self.readline()
 *         if line:             # <<<<<<<<<<<<<<
 *             return line
 *         raise StopIteration
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_line); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1049; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1050
 *         line = self.readline()
 *         if line:
 *             return line             # <<<<<<<<<<<<<<
 *         raise StopIteration
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_line);
    __pyx_r = __pyx_v_line;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1051
 *         if line:
 *             return line
 *         raise StopIteration             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(nbfile self):
 */
  __Pyx_Raise(__pyx_builtin_StopIteration, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbfile.__next__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_line);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1053
 *         raise StopIteration
 * 
 *     def __iter__(nbfile self):             # <<<<<<<<<<<<<<
 *         # We have to use __builtins__.iter because Pyrex expects 1 argument for
 *         # iter(...).
 */

static PyObject *__pyx_pf_4coio_6nbfile___iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile___iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__iter__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1057
 *         # iter(...).
 *         #return __builtin__.iter(self.readline, '')
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def xreadlines(nbfile self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1059
 *         return self
 * 
 *     def xreadlines(nbfile self):             # <<<<<<<<<<<<<<
 *         return self  # Just like file.xreadlines
 * 
 */

static PyObject *__pyx_pf_4coio_6nbfile_xreadlines(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_xreadlines(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("xreadlines");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1060
 * 
 *     def xreadlines(nbfile self):
 *         return self  # Just like file.xreadlines             # <<<<<<<<<<<<<<
 * 
 *     def isatty(nbfile self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1062
 *         return self  # Just like file.xreadlines
 * 
 *     def isatty(nbfile self):             # <<<<<<<<<<<<<<
 *         cdef int got
 *         got = isatty(self.read_fd)
 */

static PyObject *__pyx_pf_4coio_6nbfile_isatty(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_isatty(PyObject *__pyx_v_self, PyObject *unused) {
  int __pyx_v_got;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("isatty");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1064
 *     def isatty(nbfile self):
 *         cdef int got
 *         got = isatty(self.read_fd)             # <<<<<<<<<<<<<<
 *         if got < 0:
 *             raise IOError(errno, strerror(errno))
 */
  __pyx_v_got = isatty(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1065
 *         cdef int got
 *         got = isatty(self.read_fd)
 *         if got < 0:             # <<<<<<<<<<<<<<
 *             raise IOError(errno, strerror(errno))
 *         elif got:
 */
  __pyx_t_1 = (__pyx_v_got < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1066
 *         got = isatty(self.read_fd)
 *         if got < 0:
 *             raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *         elif got:
 *             return True
 */
    __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1066; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1066; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1066; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1066; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1066; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1067
 *         if got < 0:
 *             raise IOError(errno, strerror(errno))
 *         elif got:             # <<<<<<<<<<<<<<
 *             return True
 *         else:
 */
  __pyx_t_5 = __pyx_v_got;
  if (__pyx_t_5) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1068
 *             raise IOError(errno, strerror(errno))
 *         elif got:
 *             return True             # <<<<<<<<<<<<<<
 *         else:
 *             return False
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1070
 *             return True
 *         else:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *     def truncate(nbfile self, int size):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1070; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbfile.isatty");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1072
 *             return False
 * 
 *     def truncate(nbfile self, int size):             # <<<<<<<<<<<<<<
 *         # TODO(pts): Do we need this? It won't work for streams (like seek, tell)
 *         if ftruncate(self.read_fd, size) < 0:
 */

static PyObject *__pyx_pf_4coio_6nbfile_truncate(PyObject *__pyx_v_self, PyObject *__pyx_arg_size); /*proto*/
static PyObject *__pyx_pf_4coio_6nbfile_truncate(PyObject *__pyx_v_self, PyObject *__pyx_arg_size) {
  int __pyx_v_size;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("truncate");
  assert(__pyx_arg_size); {
    __pyx_v_size = __Pyx_PyInt_AsInt(__pyx_arg_size); if (unlikely((__pyx_v_size == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1072; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbfile.truncate");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1074
 *     def truncate(nbfile self, int size):
 *         # TODO(pts): Do we need this? It won't work for streams (like seek, tell)
 *         if ftruncate(self.read_fd, size) < 0:             # <<<<<<<<<<<<<<
 *             raise IOError(errno, strerror(errno))
 * 
 */
  __pyx_t_1 = (ftruncate(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd, __pyx_v_size) < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1075
 *         # TODO(pts): Do we need this? It won't work for streams (like seek, tell)
 *         if ftruncate(self.read_fd, size) < 0:
 *             raise IOError(errno, strerror(errno))             # <<<<<<<<<<<<<<
 * 
 * # !! implement open(...) properly, with modes etc.
 */
    __pyx_t_2 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_IOError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbfile.truncate");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1092
 * # we just do a `cdef object'. We don't make this a method so it won't
 * # be virtual.
 * cdef object handle_eagain(nbsocket self, int evtype):             # <<<<<<<<<<<<<<
 *     cdef tasklet wakeup_tasklet
 *     if self.timeout_value == 0.0:
 */

static  PyObject *__pyx_f_4coio_handle_eagain(struct __pyx_obj_4coio_nbsocket *__pyx_v_self, int __pyx_v_evtype) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("handle_eagain");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1094
 * cdef object handle_eagain(nbsocket self, int evtype):
 *     cdef tasklet wakeup_tasklet
 *     if self.timeout_value == 0.0:             # <<<<<<<<<<<<<<
 *         raise socket.error(EAGAIN, strerror(EAGAIN))
 *     wakeup_tasklet = PyStackless_GetCurrent()
 */
  __pyx_t_1 = (__pyx_v_self->timeout_value == 0.0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1095
 *     cdef tasklet wakeup_tasklet
 *     if self.timeout_value == 0.0:
 *         raise socket.error(EAGAIN, strerror(EAGAIN))             # <<<<<<<<<<<<<<
 *     wakeup_tasklet = PyStackless_GetCurrent()
 *     if self.timeout_value < 0.0:
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyBytes_FromString(strerror(EAGAIN)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1096
 *     if self.timeout_value == 0.0:
 *         raise socket.error(EAGAIN, strerror(EAGAIN))
 *     wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *     if self.timeout_value < 0.0:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 */
  __pyx_t_4 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1097
 *         raise socket.error(EAGAIN, strerror(EAGAIN))
 *     wakeup_tasklet = PyStackless_GetCurrent()
 *     if self.timeout_value < 0.0:             # <<<<<<<<<<<<<<
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCWakeup, <void *>wakeup_tasklet)
 */
  __pyx_t_1 = (__pyx_v_self->timeout_value < 0.0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1099
 *     if self.timeout_value < 0.0:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *         event_add(&self.wakeup_ev, NULL)
 *         PyStackless_Schedule(None, 1)  # remove=1
 */
    event_set((&__pyx_v_self->wakeup_ev), __pyx_v_self->fd, __pyx_v_evtype, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1100
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *         PyStackless_Schedule(None, 1)  # remove=1
 *     else:
 */
    event_add((&__pyx_v_self->wakeup_ev), NULL);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1101
 *                   HandleCWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, NULL)
 *         PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *     else:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 */
    __pyx_t_4 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1104
 *     else:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCTimeoutWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *         event_add(&self.wakeup_ev, &self.tv)
 *         if PyStackless_Schedule(None, 1):  # remove=1
 */
    event_set((&__pyx_v_self->wakeup_ev), __pyx_v_self->fd, __pyx_v_evtype, __pyx_f_4coio_HandleCTimeoutWakeup, ((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1105
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCTimeoutWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, &self.tv)             # <<<<<<<<<<<<<<
 *         if PyStackless_Schedule(None, 1):  # remove=1
 *             # Same error message as in socket.socket.
 */
    event_add((&__pyx_v_self->wakeup_ev), (&__pyx_v_self->tv));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1106
 *                   HandleCTimeoutWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, &self.tv)
 *         if PyStackless_Schedule(None, 1):  # remove=1             # <<<<<<<<<<<<<<
 *             # Same error message as in socket.socket.
 *             raise socket.error('timed out')
 */
    __pyx_t_4 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1108
 *         if PyStackless_Schedule(None, 1):  # remove=1
 *             # Same error message as in socket.socket.
 *             raise socket.error('timed out')             # <<<<<<<<<<<<<<
 * 
 * cdef object handle_ssl_eagain(nbsslsocket self, int evtype):
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_9));
      PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_9));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_9));
      __pyx_t_3 = PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  __pyx_L4:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.handle_eagain");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1110
 *             raise socket.error('timed out')
 * 
 * cdef object handle_ssl_eagain(nbsslsocket self, int evtype):             # <<<<<<<<<<<<<<
 *     cdef tasklet wakeup_tasklet
 *     if self.timeout_value == 0.0:
 */

static  PyObject *__pyx_f_4coio_handle_ssl_eagain(struct __pyx_obj_4coio_nbsslsocket *__pyx_v_self, int __pyx_v_evtype) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("handle_ssl_eagain");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1112
 * cdef object handle_ssl_eagain(nbsslsocket self, int evtype):
 *     cdef tasklet wakeup_tasklet
 *     if self.timeout_value == 0.0:             # <<<<<<<<<<<<<<
 *         raise socket.error(EAGAIN, strerror(EAGAIN))
 *     wakeup_tasklet = PyStackless_GetCurrent()
 */
  __pyx_t_1 = (__pyx_v_self->timeout_value == 0.0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1113
 *     cdef tasklet wakeup_tasklet
 *     if self.timeout_value == 0.0:
 *         raise socket.error(EAGAIN, strerror(EAGAIN))             # <<<<<<<<<<<<<<
 *     wakeup_tasklet = PyStackless_GetCurrent()
 *     if self.timeout_value < 0.0:
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyBytes_FromString(strerror(EAGAIN)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1114
 *     if self.timeout_value == 0.0:
 *         raise socket.error(EAGAIN, strerror(EAGAIN))
 *     wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *     if self.timeout_value < 0.0:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 */
  __pyx_t_4 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1115
 *         raise socket.error(EAGAIN, strerror(EAGAIN))
 *     wakeup_tasklet = PyStackless_GetCurrent()
 *     if self.timeout_value < 0.0:             # <<<<<<<<<<<<<<
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCWakeup, <void *>wakeup_tasklet)
 */
  __pyx_t_1 = (__pyx_v_self->timeout_value < 0.0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1117
 *     if self.timeout_value < 0.0:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *         event_add(&self.wakeup_ev, NULL)
 *         PyStackless_Schedule(None, 1)  # remove=1
 */
    event_set((&__pyx_v_self->wakeup_ev), __pyx_v_self->fd, __pyx_v_evtype, __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1118
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *         PyStackless_Schedule(None, 1)  # remove=1
 *     else:
 */
    event_add((&__pyx_v_self->wakeup_ev), NULL);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1119
 *                   HandleCWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, NULL)
 *         PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *     else:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 */
    __pyx_t_4 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1122
 *     else:
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCTimeoutWakeup, <void *>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *         event_add(&self.wakeup_ev, &self.tv)
 *         if PyStackless_Schedule(None, 1):  # remove=1
 */
    event_set((&__pyx_v_self->wakeup_ev), __pyx_v_self->fd, __pyx_v_evtype, __pyx_f_4coio_HandleCTimeoutWakeup, ((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1123
 *         event_set(&self.wakeup_ev, self.fd, evtype,
 *                   HandleCTimeoutWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, &self.tv)             # <<<<<<<<<<<<<<
 *         if PyStackless_Schedule(None, 1):  # remove=1
 *             # Same error message as in socket.socket.
 */
    event_add((&__pyx_v_self->wakeup_ev), (&__pyx_v_self->tv));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1124
 *                   HandleCTimeoutWakeup, <void *>wakeup_tasklet)
 *         event_add(&self.wakeup_ev, &self.tv)
 *         if PyStackless_Schedule(None, 1):  # remove=1             # <<<<<<<<<<<<<<
 *             # Same error message as in socket.socket.
 *             raise socket.error('timed out')
 */
    __pyx_t_4 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1126
 *         if PyStackless_Schedule(None, 1):  # remove=1
 *             # Same error message as in socket.socket.
 *             raise socket.error('timed out')             # <<<<<<<<<<<<<<
 * 
 * # Implementation backend class for sockets. Should be socket._socket.socket
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_9));
      PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_9));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_9));
      __pyx_t_3 = PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  __pyx_L4:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.handle_ssl_eagain");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1161
 *     cdef char c_do_close
 * 
 *     def __init__(nbsocket self, *args, **kwargs):             # <<<<<<<<<<<<<<
 *         if 'socket_impl' in kwargs:
 *             my_socket_impl = kwargs.pop('socket_impl')
 */

static int __pyx_pf_4coio_8nbsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_4coio_8nbsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_v_my_socket_impl;
  int __pyx_r;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__init__");
  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__init__", 1))) return -1;
  __pyx_v_kwargs = (__pyx_kwds) ? PyDict_Copy(__pyx_kwds) : PyDict_New();
  if (unlikely(!__pyx_v_kwargs)) return -1;
  __Pyx_GOTREF(__pyx_v_kwargs);
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_my_socket_impl = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1162
 * 
 *     def __init__(nbsocket self, *args, **kwargs):
 *         if 'socket_impl' in kwargs:             # <<<<<<<<<<<<<<
 *             my_socket_impl = kwargs.pop('socket_impl')
 *         else:
 */
  __pyx_t_1 = ((PySequence_Contains(__pyx_v_kwargs, ((PyObject *)__pyx_n_s__socket_impl)))); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1163
 *     def __init__(nbsocket self, *args, **kwargs):
 *         if 'socket_impl' in kwargs:
 *             my_socket_impl = kwargs.pop('socket_impl')             # <<<<<<<<<<<<<<
 *         else:
 *             my_socket_impl = socket_impl
 */
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_s__pop); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_n_s__socket_impl));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_n_s__socket_impl));
    __Pyx_GIVEREF(((PyObject *)__pyx_n_s__socket_impl));
    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_my_socket_impl);
    __pyx_v_my_socket_impl = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1165
 *             my_socket_impl = kwargs.pop('socket_impl')
 *         else:
 *             my_socket_impl = socket_impl             # <<<<<<<<<<<<<<
 *         if args and isinstance(args[0], my_socket_impl):
 *             self.realsock = args[0]
 */
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket_impl); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_my_socket_impl);
    __pyx_v_my_socket_impl = __pyx_t_4;
    __pyx_t_4 = 0;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1166
 *         else:
 *             my_socket_impl = socket_impl
 *         if args and isinstance(args[0], my_socket_impl):             # <<<<<<<<<<<<<<
 *             self.realsock = args[0]
 *             assert len(args) == 1
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_args); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_args, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_IsInstance(__pyx_t_4, __pyx_v_my_socket_impl); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __pyx_t_5;
  } else {
    __pyx_t_6 = __pyx_t_1;
  }
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1167
 *             my_socket_impl = socket_impl
 *         if args and isinstance(args[0], my_socket_impl):
 *             self.realsock = args[0]             # <<<<<<<<<<<<<<
 *             assert len(args) == 1
 *         else:
 */
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_args, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    __Pyx_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1168
 *         if args and isinstance(args[0], my_socket_impl):
 *             self.realsock = args[0]
 *             assert len(args) == 1             # <<<<<<<<<<<<<<
 *         else:
 *             self.realsock = my_socket_impl(*args, **kwargs)
 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    __pyx_t_7 = PyObject_Length(__pyx_v_args); if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (unlikely(!(__pyx_t_7 == 1))) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    #endif
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1170
 *             assert len(args) == 1
 *         else:
 *             self.realsock = my_socket_impl(*args, **kwargs)             # <<<<<<<<<<<<<<
 *         self.fd = self.realsock.fileno()
 *         # TODO(pts): self.realsock.setblocking(False) on non-Unix.
 */
    __pyx_t_4 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_3 = __Pyx_PyEval_CallObjectWithKeywords(__pyx_v_my_socket_impl, ((PyObject *)__pyx_t_4), __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    __Pyx_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_t_3;
    __pyx_t_3 = 0;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1171
 *         else:
 *             self.realsock = my_socket_impl(*args, **kwargs)
 *         self.fd = self.realsock.fileno()             # <<<<<<<<<<<<<<
 *         # TODO(pts): self.realsock.setblocking(False) on non-Unix.
 *         set_fd_nonblocking(self.fd)
 */
  __pyx_t_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__fileno); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_t_4); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd = __pyx_t_8;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1173
 *         self.fd = self.realsock.fileno()
 *         # TODO(pts): self.realsock.setblocking(False) on non-Unix.
 *         set_fd_nonblocking(self.fd)             # <<<<<<<<<<<<<<
 *         self.timeout_value = -1.0
 * 
 */
  __pyx_f_4coio_set_fd_nonblocking(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1174
 *         # TODO(pts): self.realsock.setblocking(False) on non-Unix.
 *         set_fd_nonblocking(self.fd)
 *         self.timeout_value = -1.0             # <<<<<<<<<<<<<<
 * 
 *     def fileno(nbsocket self):
 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = (-1.0);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsocket.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_DECREF(__pyx_v_my_socket_impl);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1176
 *         self.timeout_value = -1.0
 * 
 *     def fileno(nbsocket self):             # <<<<<<<<<<<<<<
 *         return self.fd
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_fileno(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_fileno(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("fileno");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1177
 * 
 *     def fileno(nbsocket self):
 *         return self.fd             # <<<<<<<<<<<<<<
 * 
 *     def dup(nbsocket self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsocket.fileno");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1179
 *         return self.fd
 * 
 *     def dup(nbsocket self):             # <<<<<<<<<<<<<<
 *         # TODO(pts): Skip the fcntl2 in the set_fd_nonblocking call in the
 *         # constructor.
 */

static PyObject *__pyx_pf_4coio_8nbsocket_dup(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_dup(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("dup");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1183
 *         # constructor.
 *         # !! TODO(pts): Is settimeout copied?
 *         return type(self)(self.realsock.dup())             # <<<<<<<<<<<<<<
 * 
 *     def close(nbsocket self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__dup); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(((PyObject *)Py_TYPE(__pyx_v_self)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsocket.dup");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1185
 *         return type(self)(self.realsock.dup())
 * 
 *     def close(nbsocket self):             # <<<<<<<<<<<<<<
 *         if self.c_do_close:
 *             # self.realsock.close() calls socket(2) + close(2) if the filehandle
 */

static PyObject *__pyx_pf_4coio_8nbsocket_close(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_close(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  char __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("close");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1186
 * 
 *     def close(nbsocket self):
 *         if self.c_do_close:             # <<<<<<<<<<<<<<
 *             # self.realsock.close() calls socket(2) + close(2) if the filehandle
 *             # was already closed.
 */
  __pyx_t_1 = ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1189
 *             # self.realsock.close() calls socket(2) + close(2) if the filehandle
 *             # was already closed.
 *             self.realsock.close()             # <<<<<<<<<<<<<<
 *         else:
 *             # TODO(pts): Make this faster, and work without a new object.
 */
    __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__close); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1192
 *         else:
 *             # TODO(pts): Make this faster, and work without a new object.
 *             self.realsock = socket._closedsocket()             # <<<<<<<<<<<<<<
 *         self.fd = -1
 *         # There is no method or attribute socket.closed or
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s___closedsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    __Pyx_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_t_3;
    __pyx_t_3 = 0;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1193
 *             # TODO(pts): Make this faster, and work without a new object.
 *             self.realsock = socket._closedsocket()
 *         self.fd = -1             # <<<<<<<<<<<<<<
 *         # There is no method or attribute socket.closed or
 *         # socket._real_socket.closed(), so we don't implement one either.
 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd = -1;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsocket.close");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1199
 *         # after-close behavior of the object.
 * 
 *     def setdoclose(nbsocket self, char do_close):             # <<<<<<<<<<<<<<
 *         """With True, makes self.close() close the filehandle.
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_setdoclose(PyObject *__pyx_v_self, PyObject *__pyx_arg_do_close); /*proto*/
static char __pyx_doc_4coio_8nbsocket_setdoclose[] = "With True, makes self.close() close the filehandle.\n\n        Returns:\n          self\n        ";
static PyObject *__pyx_pf_4coio_8nbsocket_setdoclose(PyObject *__pyx_v_self, PyObject *__pyx_arg_do_close) {
  char __pyx_v_do_close;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("setdoclose");
  assert(__pyx_arg_do_close); {
    __pyx_v_do_close = __Pyx_PyInt_AsChar(__pyx_arg_do_close); if (unlikely((__pyx_v_do_close == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1199; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsocket.setdoclose");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1205
 *           self
 *         """
 *         self.c_do_close = do_close             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close = __pyx_v_do_close;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1206
 *         """
 *         self.c_do_close = do_close
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     # This is not a standard property of `socket.socket'.
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1210
 *     # This is not a standard property of `socket.socket'.
 *     property do_close:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.c_do_close
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_8do_close___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_8do_close___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1211
 *     property do_close:
 *         def __get__(self):
 *             return self.c_do_close             # <<<<<<<<<<<<<<
 * 
 *     property _sock:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsocket.do_close.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1219
 *         constructor.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1220
 *         """
 *         def __get__(self):
 *             return self.realsock             # <<<<<<<<<<<<<<
 * 
 *     property type:
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1223
 * 
 *     property type:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock.type
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_4type___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_4type___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1224
 *     property type:
 *         def __get__(self):
 *             return self.realsock.type             # <<<<<<<<<<<<<<
 * 
 *     property family:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__type); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsocket.type.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1227
 * 
 *     property family:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock.family
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_6family___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_6family___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1228
 *     property family:
 *         def __get__(self):
 *             return self.realsock.family             # <<<<<<<<<<<<<<
 * 
 *     property timeout:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__family); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsocket.family.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1236
 *         have an attribute named timeout.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             if self.timeout_value < 0:
 *                 return None
 */

static PyObject *__pyx_pf_4coio_8nbsocket_7timeout___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_7timeout___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__get__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1237
 *         """
 *         def __get__(self):
 *             if self.timeout_value < 0:             # <<<<<<<<<<<<<<
 *                 return None
 *             else:
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1238
 *         def __get__(self):
 *             if self.timeout_value < 0:
 *                 return None             # <<<<<<<<<<<<<<
 *             else:
 *                 return self.timeout_value
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1240
 *                 return None
 *             else:
 *                 return self.timeout_value             # <<<<<<<<<<<<<<
 * 
 *     property proto:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsocket.timeout.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1243
 * 
 *     property proto:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock.proto
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_5proto___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_5proto___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1244
 *     property proto:
 *         def __get__(self):
 *             return self.realsock.proto             # <<<<<<<<<<<<<<
 * 
 *     def setsockopt(nbsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__proto); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsocket.proto.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1246
 *             return self.realsock.proto
 * 
 *     def setsockopt(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.setsockopt(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("setsockopt");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "setsockopt", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1247
 * 
 *     def setsockopt(nbsocket self, *args):
 *         return self.realsock.setsockopt(*args)             # <<<<<<<<<<<<<<
 * 
 *     def getsockopt(nbsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__setsockopt); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsocket.setsockopt");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1249
 *         return self.realsock.setsockopt(*args)
 * 
 *     def getsockopt(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.getsockopt(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("getsockopt");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "getsockopt", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1250
 * 
 *     def getsockopt(nbsocket self, *args):
 *         return self.realsock.getsockopt(*args)             # <<<<<<<<<<<<<<
 * 
 *     def getsockname(nbsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__getsockopt); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsocket.getsockopt");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1252
 *         return self.realsock.getsockopt(*args)
 * 
 *     def getsockname(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.getsockname(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("getsockname");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "getsockname", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1253
 * 
 *     def getsockname(nbsocket self, *args):
 *         return self.realsock.getsockname(*args)             # <<<<<<<<<<<<<<
 * 
 *     def getpeername(nbsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__getsockname); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsocket.getsockname");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1255
 *         return self.realsock.getsockname(*args)
 * 
 *     def getpeername(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.getpeername(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("getpeername");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "getpeername", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1256
 * 
 *     def getpeername(nbsocket self, *args):
 *         return self.realsock.getpeername(*args)             # <<<<<<<<<<<<<<
 * 
 *     def bind(nbsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__getpeername); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsocket.getpeername");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1258
 *         return self.realsock.getpeername(*args)
 * 
 *     def bind(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.bind(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("bind");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "bind", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1259
 * 
 *     def bind(nbsocket self, *args):
 *         return self.realsock.bind(*args)             # <<<<<<<<<<<<<<
 * 
 *     def listen(nbsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__bind); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsocket.bind");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1261
 *         return self.realsock.bind(*args)
 * 
 *     def listen(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.listen(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("listen");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "listen", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1262
 * 
 *     def listen(nbsocket self, *args):
 *         return self.realsock.listen(*args)             # <<<<<<<<<<<<<<
 * 
 *     def gettimeout(nbsocket self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__listen); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsocket.listen");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1264
 *         return self.realsock.listen(*args)
 * 
 *     def gettimeout(nbsocket self):             # <<<<<<<<<<<<<<
 *         if self.timeout_value < 0:
 *             return None
 */

static PyObject *__pyx_pf_4coio_8nbsocket_gettimeout(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_gettimeout(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("gettimeout");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1265
 * 
 *     def gettimeout(nbsocket self):
 *         if self.timeout_value < 0:             # <<<<<<<<<<<<<<
 *             return None
 *         else:
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1266
 *     def gettimeout(nbsocket self):
 *         if self.timeout_value < 0:
 *             return None             # <<<<<<<<<<<<<<
 *         else:
 *             return self.timeout_value
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1268
 *             return None
 *         else:
 *             return self.timeout_value             # <<<<<<<<<<<<<<
 * 
 *     def setblocking(nbsocket self, is_blocking):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsocket.gettimeout");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1270
 *             return self.timeout_value
 * 
 *     def setblocking(nbsocket self, is_blocking):             # <<<<<<<<<<<<<<
 *         if is_blocking:
 *             self.timeout_value = None
 */

static PyObject *__pyx_pf_4coio_8nbsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_v_is_blocking); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_v_is_blocking) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  float __pyx_t_2;
  __Pyx_RefNannySetupContext("setblocking");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_is_blocking);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1271
 * 
 *     def setblocking(nbsocket self, is_blocking):
 *         if is_blocking:             # <<<<<<<<<<<<<<
 *             self.timeout_value = None
 *         else:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_is_blocking); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1272
 *     def setblocking(nbsocket self, is_blocking):
 *         if is_blocking:
 *             self.timeout_value = None             # <<<<<<<<<<<<<<
 *         else:
 *             self.timeout_value = 0.0
 */
    __pyx_t_2 = __pyx_PyFloat_AsDouble(Py_None); if (unlikely((__pyx_t_2 == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = __pyx_t_2;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1274
 *             self.timeout_value = None
 *         else:
 *             self.timeout_value = 0.0             # <<<<<<<<<<<<<<
 *             self.tv.tv_sec = self.tv.tv_usec = 0
 * 
 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = 0.0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1275
 *         else:
 *             self.timeout_value = 0.0
 *             self.tv.tv_sec = self.tv.tv_usec = 0             # <<<<<<<<<<<<<<
 * 
 *     def settimeout(nbsocket self, timeout):
 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_sec = 0;
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_usec = 0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.nbsocket.setblocking");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_is_blocking);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1277
 *             self.tv.tv_sec = self.tv.tv_usec = 0
 * 
 *     def settimeout(nbsocket self, timeout):             # <<<<<<<<<<<<<<
 *         cdef float timeout_float
 *         if timeout is None:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_v_timeout); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_v_timeout) {
  float __pyx_v_timeout_float;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  float __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("settimeout");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_timeout);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1279
 *     def settimeout(nbsocket self, timeout):
 *         cdef float timeout_float
 *         if timeout is None:             # <<<<<<<<<<<<<<
 *             self.timeout_value = None
 *         else:
 */
  __pyx_t_1 = (__pyx_v_timeout == Py_None);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1280
 *         cdef float timeout_float
 *         if timeout is None:
 *             self.timeout_value = None             # <<<<<<<<<<<<<<
 *         else:
 *             timeout_float = timeout
 */
    __pyx_t_2 = __pyx_PyFloat_AsDouble(Py_None); if (unlikely((__pyx_t_2 == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = __pyx_t_2;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1282
 *             self.timeout_value = None
 *         else:
 *             timeout_float = timeout             # <<<<<<<<<<<<<<
 *             if timeout_float < 0.0:
 *                 raise ValueError('Timeout value out of range')
 */
    __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_v_timeout); if (unlikely((__pyx_t_2 == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_timeout_float = __pyx_t_2;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1283
 *         else:
 *             timeout_float = timeout
 *             if timeout_float < 0.0:             # <<<<<<<<<<<<<<
 *                 raise ValueError('Timeout value out of range')
 *             self.timeout_value = timeout_float
 */
    __pyx_t_1 = (__pyx_v_timeout_float < 0.0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1284
 *             timeout_float = timeout
 *             if timeout_float < 0.0:
 *                 raise ValueError('Timeout value out of range')             # <<<<<<<<<<<<<<
 *             self.timeout_value = timeout_float
 *             self.tv.tv_sec = <long>timeout_float
 */
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_10));
      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_s_10));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_10));
      __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1285
 *             if timeout_float < 0.0:
 *                 raise ValueError('Timeout value out of range')
 *             self.timeout_value = timeout_float             # <<<<<<<<<<<<<<
 *             self.tv.tv_sec = <long>timeout_float
 *             self.tv.tv_usec = <unsigned int>(
 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = __pyx_v_timeout_float;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1286
 *                 raise ValueError('Timeout value out of range')
 *             self.timeout_value = timeout_float
 *             self.tv.tv_sec = <long>timeout_float             # <<<<<<<<<<<<<<
 *             self.tv.tv_usec = <unsigned int>(
 *                 (timeout_float - <float>self.tv.tv_sec) * 1000000.0)
 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_sec = ((long)__pyx_v_timeout_float);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1287
 *             self.timeout_value = timeout_float
 *             self.tv.tv_sec = <long>timeout_float
 *             self.tv.tv_usec = <unsigned int>(             # <<<<<<<<<<<<<<
 *                 (timeout_float - <float>self.tv.tv_sec) * 1000000.0)
 * 
 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_usec = ((unsigned int)((__pyx_v_timeout_float - ((float)((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_sec)) * 1000000.0));
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsocket.settimeout");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_timeout);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1290
 *                 (timeout_float - <float>self.tv.tv_sec) * 1000000.0)
 * 
 *     def accept(nbsocket self):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_accept(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_accept(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_v_asock;
  PyObject *__pyx_v_addr;
  PyObject *__pyx_v_esock;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("accept");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_asock = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_addr = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_esock = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1291
 * 
 *     def accept(nbsocket self):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 asock, addr = self.realsock.accept()
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1292
 *     def accept(nbsocket self):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 asock, addr = self.realsock.accept()
 *                 esock = type(self)(asock)  # Create new nbsocket.
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1293
 *         while 1:
 *             try:
 *                 asock, addr = self.realsock.accept()             # <<<<<<<<<<<<<<
 *                 esock = type(self)(asock)  # Create new nbsocket.
 *                 return esock, addr
 */
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__accept); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (PyTuple_CheckExact(__pyx_t_3) && likely(PyTuple_GET_SIZE(__pyx_t_3) == 2)) {
          PyObject* tuple = __pyx_t_3;
          __pyx_t_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_2);
          __pyx_t_4 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_v_asock);
          __pyx_v_asock = __pyx_t_2;
          __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_v_addr);
          __pyx_v_addr = __pyx_t_4;
          __pyx_t_4 = 0;
        } else {
          __pyx_t_5 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_UnpackItem(__pyx_t_5, 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = __Pyx_UnpackItem(__pyx_t_5, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_GOTREF(__pyx_t_4);
          if (__Pyx_EndUnpack(__pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_v_asock);
          __pyx_v_asock = __pyx_t_2;
          __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_v_addr);
          __pyx_v_addr = __pyx_t_4;
          __pyx_t_4 = 0;
        }

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1294
 *             try:
 *                 asock, addr = self.realsock.accept()
 *                 esock = type(self)(asock)  # Create new nbsocket.             # <<<<<<<<<<<<<<
 *                 return esock, addr
 *             except socket.error, e:
 */
        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1294; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_v_asock);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_asock);
        __Pyx_GIVEREF(__pyx_v_asock);
        __pyx_t_4 = PyObject_Call(((PyObject *)Py_TYPE(__pyx_v_self)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1294; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_v_esock);
        __pyx_v_esock = __pyx_t_4;
        __pyx_t_4 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1295
 *                 asock, addr = self.realsock.accept()
 *                 esock = type(self)(asock)  # Create new nbsocket.
 *                 return esock, addr             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1295; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_v_esock);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_esock);
        __Pyx_GIVEREF(__pyx_v_esock);
        __Pyx_INCREF(__pyx_v_addr);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_addr);
        __Pyx_GIVEREF(__pyx_v_addr);
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1296
 *                 esock = type(self)(asock)  # Create new nbsocket.
 *                 return esock, addr
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1296; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1296; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_6 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_6) {
        __Pyx_AddTraceback("coio.nbsocket.accept");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1296; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1297
 *                 return esock, addr
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_READ)
 */
        __pyx_t_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1297; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1297; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_5, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1297; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1297; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1298
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1298; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1299
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def connect(nbsocket self, object address):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsocket.accept");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_asock);
  __Pyx_DECREF(__pyx_v_addr);
  __Pyx_DECREF(__pyx_v_esock);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1301
 *                 handle_eagain(self, c_EV_READ)
 * 
 *     def connect(nbsocket self, object address):             # <<<<<<<<<<<<<<
 *         # Do a non-blocking DNS lookup if needed.
 *         # There is no need to predeclare c_gethostbyname in Pyrex.
 */

static PyObject *__pyx_pf_4coio_8nbsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_v_address); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_v_address) {
  PyObject *__pyx_v_err;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("connect");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1304
 *         # Do a non-blocking DNS lookup if needed.
 *         # There is no need to predeclare c_gethostbyname in Pyrex.
 *         address = c_gethostbyname(address, self.realsock.family)             # <<<<<<<<<<<<<<
 * 
 *         while 1:
 */
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__family); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_2 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1306
 *         address = c_gethostbyname(address, self.realsock.family)
 * 
 *         while 1:             # <<<<<<<<<<<<<<
 *             err = self.realsock.connect_ex(address)
 *             if err:
 */
  while (1) {
    __pyx_t_3 = 1;
    if (!__pyx_t_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1307
 * 
 *         while 1:
 *             err = self.realsock.connect_ex(address)             # <<<<<<<<<<<<<<
 *             if err:
 *                 if err != EAGAIN and err != EINPROGRESS:
 */
    __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__connect_ex); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_address);
    __Pyx_GIVEREF(__pyx_v_address);
    __pyx_t_5 = PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1308
 *         while 1:
 *             err = self.realsock.connect_ex(address)
 *             if err:             # <<<<<<<<<<<<<<
 *                 if err != EAGAIN and err != EINPROGRESS:
 *                     raise socket.error(err, strerror(err))
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_err); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1309
 *             err = self.realsock.connect_ex(address)
 *             if err:
 *                 if err != EAGAIN and err != EINPROGRESS:             # <<<<<<<<<<<<<<
 *                     raise socket.error(err, strerror(err))
 *                 handle_eagain(self, c_EV_WRITE)
 */
      __pyx_t_5 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_err, __pyx_t_5, Py_NE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_3) {
        __pyx_t_4 = PyInt_FromLong(EINPROGRESS); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyObject_RichCompare(__pyx_v_err, __pyx_t_4, Py_NE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_7 = __pyx_t_6;
      } else {
        __pyx_t_7 = __pyx_t_3;
      }
      if (__pyx_t_7) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1310
 *             if err:
 *                 if err != EAGAIN and err != EINPROGRESS:
 *                     raise socket.error(err, strerror(err))             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_WRITE)
 *             else:
 */
        __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_4 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__error); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_2 = __Pyx_PyInt_AsInt(__pyx_v_err); if (unlikely((__pyx_t_2 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_err);
        __Pyx_GIVEREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_t_5));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
        __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1311
 *                 if err != EAGAIN and err != EINPROGRESS:
 *                     raise socket.error(err, strerror(err))
 *                 handle_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *             else:
 *                 return
 */
      __pyx_t_5 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1313
 *                 handle_eagain(self, c_EV_WRITE)
 *             else:
 *                 return             # <<<<<<<<<<<<<<
 * 
 *     def connect_ex(nbsocket self, object address):
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;
    }
    __pyx_L7:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.nbsocket.connect");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_err);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_address);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1315
 *                 return
 * 
 *     def connect_ex(nbsocket self, object address):             # <<<<<<<<<<<<<<
 *         # Do a non-blocking DNS lookup if needed.
 *         address = c_gethostbyname(address, self.realsock.family)
 */

static PyObject *__pyx_pf_4coio_8nbsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_v_address); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_v_address) {
  PyObject *__pyx_v_err;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("connect_ex");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1317
 *     def connect_ex(nbsocket self, object address):
 *         # Do a non-blocking DNS lookup if needed.
 *         address = c_gethostbyname(address, self.realsock.family)             # <<<<<<<<<<<<<<
 * 
 *         while 1:
 */
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__family); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_2 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1319
 *         address = c_gethostbyname(address, self.realsock.family)
 * 
 *         while 1:             # <<<<<<<<<<<<<<
 *             err = self.realsock.connect_ex(address)
 *             if err != EAGAIN and err != EINPROGRESS:
 */
  while (1) {
    __pyx_t_3 = 1;
    if (!__pyx_t_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1320
 * 
 *         while 1:
 *             err = self.realsock.connect_ex(address)             # <<<<<<<<<<<<<<
 *             if err != EAGAIN and err != EINPROGRESS:
 *                 return err  # Inclusing `0' for success.
 */
    __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__connect_ex); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_address);
    __Pyx_GIVEREF(__pyx_v_address);
    __pyx_t_5 = PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1321
 *         while 1:
 *             err = self.realsock.connect_ex(address)
 *             if err != EAGAIN and err != EINPROGRESS:             # <<<<<<<<<<<<<<
 *                 return err  # Inclusing `0' for success.
 *             handle_eagain(self, c_EV_WRITE)
 */
    __pyx_t_5 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = PyObject_RichCompare(__pyx_v_err, __pyx_t_5, Py_NE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_3) {
      __pyx_t_4 = PyInt_FromLong(EINPROGRESS); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_err, __pyx_t_4, Py_NE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __pyx_t_6;
    } else {
      __pyx_t_7 = __pyx_t_3;
    }
    if (__pyx_t_7) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1322
 *             err = self.realsock.connect_ex(address)
 *             if err != EAGAIN and err != EINPROGRESS:
 *                 return err  # Inclusing `0' for success.             # <<<<<<<<<<<<<<
 *             handle_eagain(self, c_EV_WRITE)
 * 
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1323
 *             if err != EAGAIN and err != EINPROGRESS:
 *                 return err  # Inclusing `0' for success.
 *             handle_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def shutdown(nbsocket self, object how):
 */
    __pyx_t_5 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.nbsocket.connect_ex");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_err);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_address);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1325
 *             handle_eagain(self, c_EV_WRITE)
 * 
 *     def shutdown(nbsocket self, object how):             # <<<<<<<<<<<<<<
 *         while 1:
 *             err = self.realsock.shutdown(how)
 */

static PyObject *__pyx_pf_4coio_8nbsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_v_how); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_v_how) {
  PyObject *__pyx_v_err;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("shutdown");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_how);
  __pyx_v_err = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1326
 * 
 *     def shutdown(nbsocket self, object how):
 *         while 1:             # <<<<<<<<<<<<<<
 *             err = self.realsock.shutdown(how)
 *             if err != EAGAIN:
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1327
 *     def shutdown(nbsocket self, object how):
 *         while 1:
 *             err = self.realsock.shutdown(how)             # <<<<<<<<<<<<<<
 *             if err != EAGAIN:
 *                 return err
 */
    __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__shutdown); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_how);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_how);
    __Pyx_GIVEREF(__pyx_v_how);
    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1328
 *         while 1:
 *             err = self.realsock.shutdown(how)
 *             if err != EAGAIN:             # <<<<<<<<<<<<<<
 *                 return err
 *             # TODO(pts): Can this happen (with SO_LINGER?).
 */
    __pyx_t_4 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_err, __pyx_t_4, Py_NE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1329
 *             err = self.realsock.shutdown(how)
 *             if err != EAGAIN:
 *                 return err             # <<<<<<<<<<<<<<
 *             # TODO(pts): Can this happen (with SO_LINGER?).
 *             handle_eagain(self, c_EV_WRITE)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1331
 *                 return err
 *             # TODO(pts): Can this happen (with SO_LINGER?).
 *             handle_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def recv(nbsocket self, *args):
 */
    __pyx_t_3 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsocket.shutdown");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_err);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_how);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1333
 *             handle_eagain(self, c_EV_WRITE)
 * 
 *     def recv(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("recv");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "recv", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1334
 * 
 *     def recv(nbsocket self, *args):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recv(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1335
 *     def recv(nbsocket self, *args):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recv(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1336
 *         while 1:
 *             try:
 *                 return self.realsock.recv(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__recv); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1336; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1336; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1336; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1337
 *             try:
 *                 return self.realsock.recv(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1337; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1337; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsocket.recv");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1337; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1338
 *                 return self.realsock.recv(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_READ)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1338; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1338; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1338; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1338; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1339
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1339; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1340
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def recvfrom(nbsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1340; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsocket.recv");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1342
 *                 handle_eagain(self, c_EV_READ)
 * 
 *     def recvfrom(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("recvfrom");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "recvfrom", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1343
 * 
 *     def recvfrom(nbsocket self, *args):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recvfrom(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1344
 *     def recvfrom(nbsocket self, *args):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recvfrom(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1345
 *         while 1:
 *             try:
 *                 return self.realsock.recvfrom(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__recvfrom); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1345; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1345; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1345; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1346
 *             try:
 *                 return self.realsock.recvfrom(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1346; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1346; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsocket.recvfrom");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1346; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1347
 *                 return self.realsock.recvfrom(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_READ)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1348
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1348; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1349
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def recv_into(nbsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1349; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsocket.recvfrom");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1351
 *                 handle_eagain(self, c_EV_READ)
 * 
 *     def recv_into(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("recv_into");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "recv_into", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1352
 * 
 *     def recv_into(nbsocket self, *args):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recv_into(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1353
 *     def recv_into(nbsocket self, *args):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recv_into(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1354
 *         while 1:
 *             try:
 *                 return self.realsock.recv_into(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__recv_into); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1355
 *             try:
 *                 return self.realsock.recv_into(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1355; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1355; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsocket.recv_into");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1355; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1356
 *                 return self.realsock.recv_into(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_READ)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1356; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1356; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1356; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1356; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1357
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1358
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def recvfrom_into(nbsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1358; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsocket.recv_into");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1360
 *                 handle_eagain(self, c_EV_READ)
 * 
 *     def recvfrom_into(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("recvfrom_into");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "recvfrom_into", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1361
 * 
 *     def recvfrom_into(nbsocket self, *args):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recvfrom_into(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1362
 *     def recvfrom_into(nbsocket self, *args):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recvfrom_into(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1363
 *         while 1:
 *             try:
 *                 return self.realsock.recvfrom_into(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__recvfrom_into); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1363; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1363; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1363; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1364
 *             try:
 *                 return self.realsock.recvfrom_into(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1364; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1364; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsocket.recvfrom_into");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1364; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1365
 *                 return self.realsock.recvfrom_into(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_READ)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1366
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1367
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def send(nbsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1367; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsocket.recvfrom_into");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1369
 *                 handle_eagain(self, c_EV_READ)
 * 
 *     def send(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("send");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "send", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1370
 * 
 *     def send(nbsocket self, *args):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.send(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1371
 *     def send(nbsocket self, *args):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.send(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1372
 *         while 1:
 *             try:
 *                 return self.realsock.send(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__send); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1373
 *             try:
 *                 return self.realsock.send(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1373; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1373; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsocket.send");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1373; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1374
 *                 return self.realsock.send(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_WRITE)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1375
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_WRITE)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1375; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1376
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def sendto(nbsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsocket.send");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1378
 *                 handle_eagain(self, c_EV_WRITE)
 * 
 *     def sendto(nbsocket self, *args):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_8nbsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("sendto");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "sendto", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1379
 * 
 *     def sendto(nbsocket self, *args):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.sendto(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1380
 *     def sendto(nbsocket self, *args):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.sendto(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1381
 *         while 1:
 *             try:
 *                 return self.realsock.sendto(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__sendto); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1382
 *             try:
 *                 return self.realsock.sendto(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1382; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1382; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsocket.sendto");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1382; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1383
 *                 return self.realsock.sendto(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_WRITE)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1384
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_WRITE)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1384; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1385
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def sendall(nbsocket self, object data, int flags=0):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1385; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsocket.sendto");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1387
 *                 handle_eagain(self, c_EV_WRITE)
 * 
 *     def sendall(nbsocket self, object data, int flags=0):             # <<<<<<<<<<<<<<
 *         cdef int got
 *         cdef int got2
 */

static PyObject *__pyx_pf_4coio_8nbsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_8nbsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  int __pyx_v_got;
  int __pyx_v_got2;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__data,&__pyx_n_s__flags,0};
  __Pyx_RefNannySetupContext("sendall");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "sendall") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1387; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_data = values[0];
    if (values[1]) {
      __pyx_v_flags = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1387; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_flags = ((int)0);
    }
  } else {
    __pyx_v_flags = ((int)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_flags = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1387; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_data = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("sendall", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1387; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsocket.sendall");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1390
 *         cdef int got
 *         cdef int got2
 *         try:             # <<<<<<<<<<<<<<
 *             # TODO(pts): Write directly to self.fd.
 *             got = self.realsock.send(data, flags)
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1392
 *         try:
 *             # TODO(pts): Write directly to self.fd.
 *             got = self.realsock.send(data, flags)             # <<<<<<<<<<<<<<
 *             assert got > 0
 *         except socket.error, e:
 */
      __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__send); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyInt_FromLong(__pyx_v_flags); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_data);
      __Pyx_GIVEREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_got = __pyx_t_4;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1393
 *             # TODO(pts): Write directly to self.fd.
 *             got = self.realsock.send(data, flags)
 *             assert got > 0             # <<<<<<<<<<<<<<
 *         except socket.error, e:
 *             if e.errno != EAGAIN:
 */
      #ifndef PYREX_WITHOUT_ASSERTIONS
      if (unlikely(!(__pyx_v_got > 0))) {
        PyErr_SetNone(PyExc_AssertionError);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      }
      #endif
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L13_try_end;
    __pyx_L6_error:;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1394
 *             got = self.realsock.send(data, flags)
 *             assert got > 0
 *         except socket.error, e:             # <<<<<<<<<<<<<<
 *             if e.errno != EAGAIN:
 *                 raise
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1394; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1394; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = PyErr_ExceptionMatches(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_4) {
      __Pyx_AddTraceback("coio.nbsocket.sendall");
      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1394; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_t_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1395
 *             assert got > 0
 *         except socket.error, e:
 *             if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                 raise
 *             handle_eagain(self, c_EV_WRITE)
 */
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1395; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1395; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyObject_RichCompare(__pyx_t_5, __pyx_t_6, Py_NE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1395; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1395; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_8) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1396
 *         except socket.error, e:
 *             if e.errno != EAGAIN:
 *                 raise             # <<<<<<<<<<<<<<
 *             handle_eagain(self, c_EV_WRITE)
 *             got = 0
 */
        __Pyx_GIVEREF(__pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_1);
        __Pyx_ErrRestore(__pyx_t_3, __pyx_t_2, __pyx_t_1);
        __pyx_t_3 = 0; __pyx_t_2 = 0; __pyx_t_1 = 0; 
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        goto __pyx_L16;
      }
      __pyx_L16:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1397
 *             if e.errno != EAGAIN:
 *                 raise
 *             handle_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *             got = 0
 *         while got < len(data):
 */
      __pyx_t_7 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1398
 *                 raise
 *             handle_eagain(self, c_EV_WRITE)
 *             got = 0             # <<<<<<<<<<<<<<
 *         while got < len(data):
 *             try:
 */
      __pyx_v_got = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L7_exception_handled;
    }
    __pyx_L8_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L7_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L13_try_end:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1399
 *             handle_eagain(self, c_EV_WRITE)
 *             got = 0
 *         while got < len(data):             # <<<<<<<<<<<<<<
 *             try:
 *                 got2 = self.realsock.send(buffer(data, got), flags)
 */
  while (1) {
    __pyx_t_9 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_8 = (__pyx_v_got < __pyx_t_9);
    if (!__pyx_t_8) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1400
 *             got = 0
 *         while got < len(data):
 *             try:             # <<<<<<<<<<<<<<
 *                 got2 = self.realsock.send(buffer(data, got), flags)
 *                 assert got2 > 0
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1401
 *         while got < len(data):
 *             try:
 *                 got2 = self.realsock.send(buffer(data, got), flags)             # <<<<<<<<<<<<<<
 *                 assert got2 > 0
 *                 got += got2
 */
        __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_s__send); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = PyInt_FromLong(__pyx_v_got); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_data);
        __Pyx_GIVEREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_2 = PyObject_Call(__pyx_builtin_buffer, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = PyInt_FromLong(__pyx_v_flags); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        __pyx_t_2 = 0;
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_v_got2 = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1402
 *             try:
 *                 got2 = self.realsock.send(buffer(data, got), flags)
 *                 assert got2 > 0             # <<<<<<<<<<<<<<
 *                 got += got2
 *             except socket.error, e:
 */
        #ifndef PYREX_WITHOUT_ASSERTIONS
        if (unlikely(!(__pyx_v_got2 > 0))) {
          PyErr_SetNone(PyExc_AssertionError);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        }
        #endif

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1403
 *                 got2 = self.realsock.send(buffer(data, got), flags)
 *                 assert got2 > 0
 *                 got += got2             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __pyx_v_got += __pyx_v_got2;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L26_try_end;
      __pyx_L19_error:;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1404
 *                 assert got2 > 0
 *                 got += got2
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1404; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__error); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1404; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_4 = PyErr_ExceptionMatches(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_4) {
        __Pyx_AddTraceback("coio.nbsocket.sendall");
        if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_3, &__pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1404; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_3;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1405
 *                 got += got2
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_eagain(self, c_EV_WRITE)
 */
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_6 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_5 = PyObject_RichCompare(__pyx_t_2, __pyx_t_6, Py_NE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_8) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1406
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_eagain(self, c_EV_WRITE)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_1);
          __Pyx_ErrRestore(__pyx_t_7, __pyx_t_3, __pyx_t_1);
          __pyx_t_7 = 0; __pyx_t_3 = 0; __pyx_t_1 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1406; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
          goto __pyx_L29;
        }
        __pyx_L29:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1407
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def makefile_samefd(nbsocket self, mode='r+', int bufsize=-1):
 */
        __pyx_t_5 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1407; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L20_exception_handled;
      }
      __pyx_L21_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L20_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L26_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("coio.nbsocket.sendall");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_data);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1409
 *                 handle_eagain(self, c_EV_WRITE)
 * 
 *     def makefile_samefd(nbsocket self, mode='r+', int bufsize=-1):             # <<<<<<<<<<<<<<
 *         """Create and return an nbfile with self.fd.
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_makefile_samefd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_makefile_samefd[] = "Create and return an nbfile with self.fd.\n\n        The nbfile will be buffered, and its close method won't be cause an\n        os.close(self.fd).\n\n        This method is not part of normal sockets.\n        ";
static PyObject *__pyx_pf_4coio_8nbsocket_makefile_samefd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__mode,&__pyx_n_s__bufsize,0};
  __Pyx_RefNannySetupContext("makefile_samefd");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    values[0] = ((PyObject *)__pyx_kp_s_7);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mode);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bufsize);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "makefile_samefd") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_mode = values[0];
    if (values[1]) {
      __pyx_v_bufsize = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_bufsize = ((int)-1);
    }
  } else {
    __pyx_v_mode = ((PyObject *)__pyx_kp_s_7);
    __pyx_v_bufsize = ((int)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_bufsize = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_mode = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("makefile_samefd", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsocket.makefile_samefd");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1417
 *         This method is not part of normal sockets.
 *         """
 *         assert mode == 'r+'  # !! TODO(pts): Implement other modes             # <<<<<<<<<<<<<<
 *         return nbfile(self.fd, self.fd, bufsize)
 * 
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_kp_s_7), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1418
 *         """
 *         assert mode == 'r+'  # !! TODO(pts): Implement other modes
 *         return nbfile(self.fd, self.fd, bufsize)             # <<<<<<<<<<<<<<
 * 
 *     def makefile(nbsocket self, mode='r', int bufsize=-1):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyInt_FromLong(__pyx_v_bufsize); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_nbfile)), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.nbsocket.makefile_samefd");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1420
 *         return nbfile(self.fd, self.fd, bufsize)
 * 
 *     def makefile(nbsocket self, mode='r', int bufsize=-1):             # <<<<<<<<<<<<<<
 *         """Create an nbfile (non-blocking file-like) object from self.
 * 
 */

static PyObject *__pyx_pf_4coio_8nbsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_makefile[] = "Create an nbfile (non-blocking file-like) object from self.\n\n        os.dup(self.fd) will be passed to the new nbfile object, and its\n        .close() method will close that file descriptor.\n\n        Args:\n          mode: 'r', 'w', 'r+' etc. The default is mode'r', just as for\n            socket.socket.makefile.\n        ";
static PyObject *__pyx_pf_4coio_8nbsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  int __pyx_v_fd;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__mode,&__pyx_n_s__bufsize,0};
  __Pyx_RefNannySetupContext("makefile");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    values[0] = ((PyObject *)__pyx_n_s__r);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mode);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bufsize);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "makefile") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1420; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_mode = values[0];
    if (values[1]) {
      __pyx_v_bufsize = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1420; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_bufsize = ((int)-1);
    }
  } else {
    __pyx_v_mode = ((PyObject *)__pyx_n_s__r);
    __pyx_v_bufsize = ((int)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_bufsize = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1420; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_mode = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("makefile", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1420; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsocket.makefile");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_mode);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1431
 *         """
 *         cdef int fd
 *         assert mode == 'r+'  # !! TODO(pts): Implement other modes             # <<<<<<<<<<<<<<
 *         fd = dup(self.fd)
 *         if fd < 0:
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_kp_s_7), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1432
 *         cdef int fd
 *         assert mode == 'r+'  # !! TODO(pts): Implement other modes
 *         fd = dup(self.fd)             # <<<<<<<<<<<<<<
 *         if fd < 0:
 *             raise socket.error(errno, strerror(errno))
 */
  __pyx_v_fd = dup(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1433
 *         assert mode == 'r+'  # !! TODO(pts): Implement other modes
 *         fd = dup(self.fd)
 *         if fd < 0:             # <<<<<<<<<<<<<<
 *             raise socket.error(errno, strerror(errno))
 *         # TODO(pts): Verify proper close semantics for _realsocket emulation.
 */
  __pyx_t_2 = (__pyx_v_fd < 0);
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1434
 *         fd = dup(self.fd)
 *         if fd < 0:
 *             raise socket.error(errno, strerror(errno))             # <<<<<<<<<<<<<<
 *         # TODO(pts): Verify proper close semantics for _realsocket emulation.
 *         return nbfile(fd, fd, bufsize, do_close=1, close_ref=self)
 */
    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyInt_FromLong(errno); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyBytes_FromString(strerror(errno)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __pyx_t_1 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1436
 *             raise socket.error(errno, strerror(errno))
 *         # TODO(pts): Verify proper close semantics for _realsocket emulation.
 *         return nbfile(fd, fd, bufsize, do_close=1, close_ref=self)             # <<<<<<<<<<<<<<
 * 
 * cdef int SSL_ERROR_EOF
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyInt_FromLong(__pyx_v_fd); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyInt_FromLong(__pyx_v_fd); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_bufsize); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__do_close), __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__close_ref), __pyx_v_self) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = PyEval_CallObjectWithKeywords(((PyObject *)((PyObject*)__pyx_ptype_4coio_nbfile)), __pyx_t_1, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.nbsocket.makefile");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_mode);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1456
 *     cdef object c_sock
 * 
 *     def __init__(sockwrapper self, sock):             # <<<<<<<<<<<<<<
 *         self.c_sock = sock
 * 
 */

static int __pyx_pf_4coio_11sockwrapper___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_4coio_11sockwrapper___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_sock = 0;
  int __pyx_r;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__sock,0};
  __Pyx_RefNannySetupContext("__init__");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__sock);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1456; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_sock = values[0];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_sock = PyTuple_GET_ITEM(__pyx_args, 0);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1456; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.sockwrapper.__init__");
  return -1;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1457
 * 
 *     def __init__(sockwrapper self, sock):
 *         self.c_sock = sock             # <<<<<<<<<<<<<<
 * 
 *     property _sock:
 */
  __Pyx_INCREF(__pyx_v_sock);
  __Pyx_GIVEREF(__pyx_v_sock);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock);
  __Pyx_DECREF(((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock);
  ((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock = __pyx_v_sock;

  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1460
 * 
 *     property _sock:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.c_sock
 * 
 */

static PyObject *__pyx_pf_4coio_11sockwrapper_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11sockwrapper_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1461
 *     property _sock:
 *         def __get__(self):
 *             return self.c_sock             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock);
  __pyx_r = ((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1507
 *     cdef object sslobj
 * 
 *     def __init__(nbsslsocket self, *args, **kwargs):             # <<<<<<<<<<<<<<
 *         if 'sslsocket_impl' in kwargs:
 *             my_sslsocket_impl = kwargs.pop('sslsocket_impl')
 */

static int __pyx_pf_4coio_11nbsslsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_4coio_11nbsslsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_v_my_sslsocket_impl;
  int __pyx_r;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("__init__");
  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__init__", 1))) return -1;
  __pyx_v_kwargs = (__pyx_kwds) ? PyDict_Copy(__pyx_kwds) : PyDict_New();
  if (unlikely(!__pyx_v_kwargs)) return -1;
  __Pyx_GOTREF(__pyx_v_kwargs);
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_my_sslsocket_impl = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1508
 * 
 *     def __init__(nbsslsocket self, *args, **kwargs):
 *         if 'sslsocket_impl' in kwargs:             # <<<<<<<<<<<<<<
 *             my_sslsocket_impl = kwargs.pop('sslsocket_impl')
 *         else:
 */
  __pyx_t_1 = ((PySequence_Contains(__pyx_v_kwargs, ((PyObject *)__pyx_n_s__sslsocket_impl)))); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1509
 *     def __init__(nbsslsocket self, *args, **kwargs):
 *         if 'sslsocket_impl' in kwargs:
 *             my_sslsocket_impl = kwargs.pop('sslsocket_impl')             # <<<<<<<<<<<<<<
 *         else:
 *             my_sslsocket_impl = sslsocket_impl
 */
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_s__pop); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_n_s__sslsocket_impl));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_n_s__sslsocket_impl));
    __Pyx_GIVEREF(((PyObject *)__pyx_n_s__sslsocket_impl));
    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_my_sslsocket_impl);
    __pyx_v_my_sslsocket_impl = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1511
 *             my_sslsocket_impl = kwargs.pop('sslsocket_impl')
 *         else:
 *             my_sslsocket_impl = sslsocket_impl             # <<<<<<<<<<<<<<
 *         if (hasattr(args[0], '_sock') and
 *             isinstance(args[0]._sock, socket_realsocket)):
 */
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__sslsocket_impl); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_my_sslsocket_impl);
    __pyx_v_my_sslsocket_impl = __pyx_t_4;
    __pyx_t_4 = 0;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1512
 *         else:
 *             my_sslsocket_impl = sslsocket_impl
 *         if (hasattr(args[0], '_sock') and             # <<<<<<<<<<<<<<
 *             isinstance(args[0]._sock, socket_realsocket)):
 *             # This works with isinstance(args[0], socket.socket) or
 */
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_args, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyObject_HasAttr(__pyx_t_4, ((PyObject *)__pyx_n_s___sock)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1513
 *             my_sslsocket_impl = sslsocket_impl
 *         if (hasattr(args[0], '_sock') and
 *             isinstance(args[0]._sock, socket_realsocket)):             # <<<<<<<<<<<<<<
 *             # This works with isinstance(args[0], socket.socket) or
 *             # isinstance(args[0], nbsocket).
 */
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_args, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s___sock); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket_realsocket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_IsInstance(__pyx_t_3, __pyx_t_4); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __pyx_t_5;
  } else {
    __pyx_t_6 = __pyx_t_1;
  }
  if (__pyx_t_6) {
    goto __pyx_L6;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1517
 *             # isinstance(args[0], nbsocket).
 *             pass
 *         elif isinstance(args[0], socket_realsocket):             # <<<<<<<<<<<<<<
 *             args = list(args)
 *             args[0] = sockwrapper(args[0])
 */
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_args, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket_realsocket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = PyObject_IsInstance(__pyx_t_4, __pyx_t_3); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1518
 *             pass
 *         elif isinstance(args[0], socket_realsocket):
 *             args = list(args)             # <<<<<<<<<<<<<<
 *             args[0] = sockwrapper(args[0])
 *         else:
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_args);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_args);
    __Pyx_GIVEREF(__pyx_v_args);
    __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)&PyList_Type)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_args);
    __pyx_v_args = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1519
 *         elif isinstance(args[0], socket_realsocket):
 *             args = list(args)
 *             args[0] = sockwrapper(args[0])             # <<<<<<<<<<<<<<
 *         else:
 *             raise TypeError('bad type for underlying socket: ' + str(args[0]))
 */
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_args, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1519; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1519; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_sockwrapper)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1519; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__Pyx_SetItemInt(__pyx_v_args, 0, __pyx_t_4, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1519; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1521
 *             args[0] = sockwrapper(args[0])
 *         else:
 *             raise TypeError('bad type for underlying socket: ' + str(args[0]))             # <<<<<<<<<<<<<<
 * 
 *         # TODO(pts): Make sure we do a non-blocking handshake (do_handshake)
 */
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_args, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Add(((PyObject *)__pyx_kp_s_11), __pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_TypeError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1525
 *         # TODO(pts): Make sure we do a non-blocking handshake (do_handshake)
 *         # in my_sslsocket_impl.__init__. Currently it's blocking.
 *         self.sslsock = my_sslsocket_impl(*args, **kwargs)             # <<<<<<<<<<<<<<
 *         self.realsock = self.sslsock._sock
 *         # This may be None so far.
 */
  __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __pyx_t_4 = __Pyx_PyEval_CallObjectWithKeywords(__pyx_v_my_sslsocket_impl, ((PyObject *)__pyx_t_3), __pyx_v_kwargs); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_GIVEREF(__pyx_t_4);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1526
 *         # in my_sslsocket_impl.__init__. Currently it's blocking.
 *         self.sslsock = my_sslsocket_impl(*args, **kwargs)
 *         self.realsock = self.sslsock._sock             # <<<<<<<<<<<<<<
 *         # This may be None so far.
 *         # TODO(pts): Update self.sslobj in .unwrap, .shutdown, .close,
 */
  __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___sock); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1526; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1530
 *         # TODO(pts): Update self.sslobj in .unwrap, .shutdown, .close,
 *         # .connect.
 *         self.sslobj = self.sslsock._sslobj             # <<<<<<<<<<<<<<
 *         self.fd = self.realsock.fileno()
 * 	# It seems that either of these setblocking calls are enough.
 */
  __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___sslobj); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1530; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1531
 *         # .connect.
 *         self.sslobj = self.sslsock._sslobj
 *         self.fd = self.realsock.fileno()             # <<<<<<<<<<<<<<
 * 	# It seems that either of these setblocking calls are enough.
 *         self.realsock.setblocking(False)
 */
  __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__fileno); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->fd = __pyx_t_7;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1533
 *         self.fd = self.realsock.fileno()
 * 	# It seems that either of these setblocking calls are enough.
 *         self.realsock.setblocking(False)             # <<<<<<<<<<<<<<
 *         #self.sslsock.setblocking(False)
 *         self.timeout_value = -1.0
 */
  __pyx_t_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__setblocking); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1535
 *         self.realsock.setblocking(False)
 *         #self.sslsock.setblocking(False)
 *         self.timeout_value = -1.0             # <<<<<<<<<<<<<<
 * 
 *     def fileno(nbsslsocket self):
 */
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = (-1.0);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsslsocket.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_DECREF(__pyx_v_my_sslsocket_impl);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1537
 *         self.timeout_value = -1.0
 * 
 *     def fileno(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         return self.fd
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_fileno(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_fileno(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("fileno");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1538
 * 
 *     def fileno(nbsslsocket self):
 *         return self.fd             # <<<<<<<<<<<<<<
 * 
 *     def dup(nbsslsocket self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->fd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1538; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.fileno");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1540
 *         return self.fd
 * 
 *     def dup(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         """Duplicates to a non-SSL socket (as in SSLSocket.dup)."""
 *         # !! TODO(pts): Is settimeout copied?
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_dup(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_dup[] = "Duplicates to a non-SSL socket (as in SSLSocket.dup).";
static PyObject *__pyx_pf_4coio_11nbsslsocket_dup(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("dup");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1545
 *         # TODO(pts): Skip the fcntl2 in the set_fd_nonblocking call in the
 *         # constructor.
 *         return nbsocket(self.realsock.dup())             # <<<<<<<<<<<<<<
 * 
 *     def close(nbsslsocket self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__dup); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_nbsocket)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsslsocket.dup");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1547
 *         return nbsocket(self.realsock.dup())
 * 
 *     def close(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         self.sslsock.close()
 *         self.sslobj = self.sslsock._sslobj
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_close(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_close(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("close");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1548
 * 
 *     def close(nbsslsocket self):
 *         self.sslsock.close()             # <<<<<<<<<<<<<<
 *         self.sslobj = self.sslsock._sslobj
 * 
 */
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__close); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1549
 *     def close(nbsslsocket self):
 *         self.sslsock.close()
 *         self.sslobj = self.sslsock._sslobj             # <<<<<<<<<<<<<<
 * 
 *     property type:
 */
  __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___sslobj); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_t_2;
  __pyx_t_2 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsslsocket.close");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1552
 * 
 *     property type:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock.type
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_4type___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_4type___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1553
 *     property type:
 *         def __get__(self):
 *             return self.realsock.type             # <<<<<<<<<<<<<<
 * 
 *     property family:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__type); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.type.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1556
 * 
 *     property family:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock.family
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_6family___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_6family___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1557
 *     property family:
 *         def __get__(self):
 *             return self.realsock.family             # <<<<<<<<<<<<<<
 * 
 *     property proto:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__family); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.family.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1560
 * 
 *     property proto:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock.proto
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_5proto___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_5proto___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1561
 *     property proto:
 *         def __get__(self):
 *             return self.realsock.proto             # <<<<<<<<<<<<<<
 * 
 *     property _sslobj:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__proto); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.proto.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1564
 * 
 *     property _sslobj:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslobj
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_7_sslobj___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_7_sslobj___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1565
 *     property _sslobj:
 *         def __get__(self):
 *             return self.sslobj             # <<<<<<<<<<<<<<
 * 
 *     property _sock:
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1568
 * 
 *     property _sock:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.realsock
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1569
 *     property _sock:
 *         def __get__(self):
 *             return self.realsock             # <<<<<<<<<<<<<<
 * 
 *     property _sslsock:
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1576
 *         Property _sslsock is not present in SSLSocket.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_8_sslsock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_8_sslsock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1577
 *         """
 *         def __get__(self):
 *             return self.sslsock             # <<<<<<<<<<<<<<
 * 
 *     property keyfile:
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1580
 * 
 *     property keyfile:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock.keyfile
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_7keyfile___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_7keyfile___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1581
 *     property keyfile:
 *         def __get__(self):
 *             return self.sslsock.keyfile             # <<<<<<<<<<<<<<
 * 
 *     property certfile:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__keyfile); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1581; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.keyfile.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1584
 * 
 *     property certfile:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock.cerfile
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_8certfile___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_8certfile___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1585
 *     property certfile:
 *         def __get__(self):
 *             return self.sslsock.cerfile             # <<<<<<<<<<<<<<
 * 
 *     property cert_reqs:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__cerfile); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1585; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.certfile.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1588
 * 
 *     property cert_reqs:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock.cert_reqs
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_9cert_reqs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_9cert_reqs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1589
 *     property cert_reqs:
 *         def __get__(self):
 *             return self.sslsock.cert_reqs             # <<<<<<<<<<<<<<
 * 
 *     property ssl_version:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__cert_reqs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.cert_reqs.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1592
 * 
 *     property ssl_version:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock.ssl_version
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_11ssl_version___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_11ssl_version___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1593
 *     property ssl_version:
 *         def __get__(self):
 *             return self.sslsock.ssl_version             # <<<<<<<<<<<<<<
 * 
 *     property ca_certs:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__ssl_version); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1593; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.ssl_version.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1596
 * 
 *     property ca_certs:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock.ca_certs
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_8ca_certs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_8ca_certs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1597
 *     property ca_certs:
 *         def __get__(self):
 *             return self.sslsock.ca_certs             # <<<<<<<<<<<<<<
 * 
 *     property do_handshake_on_connect:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__ca_certs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1597; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.ca_certs.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1600
 * 
 *     property do_handshake_on_connect:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock.do_handshake_on_connect
 *         def __set__(self, val):
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_23do_handshake_on_connect___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_23do_handshake_on_connect___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1601
 *     property do_handshake_on_connect:
 *         def __get__(self):
 *             return self.sslsock.do_handshake_on_connect             # <<<<<<<<<<<<<<
 *         def __set__(self, val):
 *             self.sslsock.do_handshake_on_connect = bool(val)
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s_12); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake_on_connect.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1602
 *         def __get__(self):
 *             return self.sslsock.do_handshake_on_connect
 *         def __set__(self, val):             # <<<<<<<<<<<<<<
 *             self.sslsock.do_handshake_on_connect = bool(val)
 * 
 */

static int __pyx_pf_4coio_11nbsslsocket_23do_handshake_on_connect___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_val); /*proto*/
static int __pyx_pf_4coio_11nbsslsocket_23do_handshake_on_connect___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_val) {
  int __pyx_r;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__set__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1603
 *             return self.sslsock.do_handshake_on_connect
 *         def __set__(self, val):
 *             self.sslsock.do_handshake_on_connect = bool(val)             # <<<<<<<<<<<<<<
 * 
 *     property suppress_ragged_eofs:
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_val);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_val);
  __Pyx_GIVEREF(__pyx_v_val);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyBool_Type)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s_12, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake_on_connect.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1606
 * 
 *     property suppress_ragged_eofs:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock._suppress_ragged_eofs
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1607
 *     property suppress_ragged_eofs:
 *         def __get__(self):
 *             return self.sslsock._suppress_ragged_eofs             # <<<<<<<<<<<<<<
 * 
 *     property _makefile_refs:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s_13); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket.suppress_ragged_eofs.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1610
 * 
 *     property _makefile_refs:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self.sslsock._makefile_refs
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_14_makefile_refs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_14_makefile_refs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1611
 *     property _makefile_refs:
 *         def __get__(self):
 *             return self.sslsock._makefile_refs             # <<<<<<<<<<<<<<
 * 
 *     property timeout:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___makefile_refs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1611; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.nbsslsocket._makefile_refs.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1615
 *     property timeout:
 *         """Return a nonnegative float, or -1.0 if there is no timeout."""
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             if self.timeout_value < 0:
 *                 return None
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_7timeout___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_7timeout___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__get__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1616
 *         """Return a nonnegative float, or -1.0 if there is no timeout."""
 *         def __get__(self):
 *             if self.timeout_value < 0:             # <<<<<<<<<<<<<<
 *                 return None
 *             else:
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1617
 *         def __get__(self):
 *             if self.timeout_value < 0:
 *                 return None             # <<<<<<<<<<<<<<
 *             else:
 *                 return self.timeout_value
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1619
 *                 return None
 *             else:
 *                 return self.timeout_value             # <<<<<<<<<<<<<<
 * 
 *     def setsockopt(nbsslsocket self, *args):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsslsocket.timeout.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1621
 *                 return self.timeout_value
 * 
 *     def setsockopt(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.setsockopt(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("setsockopt");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "setsockopt", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1622
 * 
 *     def setsockopt(nbsslsocket self, *args):
 *         return self.realsock.setsockopt(*args)             # <<<<<<<<<<<<<<
 * 
 *     def getsockopt(nbsslsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__setsockopt); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.setsockopt");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1624
 *         return self.realsock.setsockopt(*args)
 * 
 *     def getsockopt(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.getsockopt(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("getsockopt");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "getsockopt", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1625
 * 
 *     def getsockopt(nbsslsocket self, *args):
 *         return self.realsock.getsockopt(*args)             # <<<<<<<<<<<<<<
 * 
 *     def getsockname(nbsslsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__getsockopt); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getsockopt");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1627
 *         return self.realsock.getsockopt(*args)
 * 
 *     def getsockname(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.getsockname(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("getsockname");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "getsockname", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1628
 * 
 *     def getsockname(nbsslsocket self, *args):
 *         return self.realsock.getsockname(*args)             # <<<<<<<<<<<<<<
 * 
 *     def getpeername(nbsslsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__getsockname); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getsockname");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1630
 *         return self.realsock.getsockname(*args)
 * 
 *     def getpeername(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.getpeername(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("getpeername");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "getpeername", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1631
 * 
 *     def getpeername(nbsslsocket self, *args):
 *         return self.realsock.getpeername(*args)             # <<<<<<<<<<<<<<
 * 
 *     def bind(nbsslsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__getpeername); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getpeername");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1633
 *         return self.realsock.getpeername(*args)
 * 
 *     def bind(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.bind(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("bind");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "bind", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1634
 * 
 *     def bind(nbsslsocket self, *args):
 *         return self.realsock.bind(*args)             # <<<<<<<<<<<<<<
 * 
 *     def listen(nbsslsocket self, *args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__bind); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.bind");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1636
 *         return self.realsock.bind(*args)
 * 
 *     def listen(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         return self.realsock.listen(*args)
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("listen");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "listen", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1637
 * 
 *     def listen(nbsslsocket self, *args):
 *         return self.realsock.listen(*args)             # <<<<<<<<<<<<<<
 * 
 *     def gettimeout(nbsslsocket self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__listen); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.listen");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1639
 *         return self.realsock.listen(*args)
 * 
 *     def gettimeout(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         if self.timeout_value < 0:
 *             return None
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_gettimeout(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_gettimeout(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("gettimeout");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1640
 * 
 *     def gettimeout(nbsslsocket self):
 *         if self.timeout_value < 0:             # <<<<<<<<<<<<<<
 *             return None
 *         else:
 */
  __pyx_t_1 = (((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1641
 *     def gettimeout(nbsslsocket self):
 *         if self.timeout_value < 0:
 *             return None             # <<<<<<<<<<<<<<
 *         else:
 *             return self.timeout_value
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1643
 *             return None
 *         else:
 *             return self.timeout_value             # <<<<<<<<<<<<<<
 * 
 *     def setblocking(nbsslsocket self, is_blocking):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsslsocket.gettimeout");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1645
 *             return self.timeout_value
 * 
 *     def setblocking(nbsslsocket self, is_blocking):             # <<<<<<<<<<<<<<
 *         if is_blocking:
 *             self.timeout_value = None
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_v_is_blocking); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_v_is_blocking) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  float __pyx_t_2;
  __Pyx_RefNannySetupContext("setblocking");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_is_blocking);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1646
 * 
 *     def setblocking(nbsslsocket self, is_blocking):
 *         if is_blocking:             # <<<<<<<<<<<<<<
 *             self.timeout_value = None
 *         else:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_is_blocking); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1646; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1647
 *     def setblocking(nbsslsocket self, is_blocking):
 *         if is_blocking:
 *             self.timeout_value = None             # <<<<<<<<<<<<<<
 *         else:
 *             self.timeout_value = 0.0
 */
    __pyx_t_2 = __pyx_PyFloat_AsDouble(Py_None); if (unlikely((__pyx_t_2 == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = __pyx_t_2;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1649
 *             self.timeout_value = None
 *         else:
 *             self.timeout_value = 0.0             # <<<<<<<<<<<<<<
 *             self.tv.tv_sec = self.tv.tv_usec = 0
 * 
 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = 0.0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1650
 *         else:
 *             self.timeout_value = 0.0
 *             self.tv.tv_sec = self.tv.tv_usec = 0             # <<<<<<<<<<<<<<
 * 
 *     def settimeout(nbsslsocket self, timeout):
 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_sec = 0;
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_usec = 0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.nbsslsocket.setblocking");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_is_blocking);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1652
 *             self.tv.tv_sec = self.tv.tv_usec = 0
 * 
 *     def settimeout(nbsslsocket self, timeout):             # <<<<<<<<<<<<<<
 *         cdef float timeout_float
 *         if timeout is None:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_v_timeout); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_v_timeout) {
  float __pyx_v_timeout_float;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  float __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("settimeout");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_timeout);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1654
 *     def settimeout(nbsslsocket self, timeout):
 *         cdef float timeout_float
 *         if timeout is None:             # <<<<<<<<<<<<<<
 *             self.timeout_value = None
 *         else:
 */
  __pyx_t_1 = (__pyx_v_timeout == Py_None);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1655
 *         cdef float timeout_float
 *         if timeout is None:
 *             self.timeout_value = None             # <<<<<<<<<<<<<<
 *         else:
 *             timeout_float = timeout
 */
    __pyx_t_2 = __pyx_PyFloat_AsDouble(Py_None); if (unlikely((__pyx_t_2 == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = __pyx_t_2;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1657
 *             self.timeout_value = None
 *         else:
 *             timeout_float = timeout             # <<<<<<<<<<<<<<
 *             if timeout_float < 0.0:
 *                 raise ValueError('Timeout value out of range')
 */
    __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_v_timeout); if (unlikely((__pyx_t_2 == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_timeout_float = __pyx_t_2;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1658
 *         else:
 *             timeout_float = timeout
 *             if timeout_float < 0.0:             # <<<<<<<<<<<<<<
 *                 raise ValueError('Timeout value out of range')
 *             self.timeout_value = timeout_float
 */
    __pyx_t_1 = (__pyx_v_timeout_float < 0.0);
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1659
 *             timeout_float = timeout
 *             if timeout_float < 0.0:
 *                 raise ValueError('Timeout value out of range')             # <<<<<<<<<<<<<<
 *             self.timeout_value = timeout_float
 *             self.tv.tv_sec = <long>timeout_float
 */
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_10));
      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_s_10));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_10));
      __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1660
 *             if timeout_float < 0.0:
 *                 raise ValueError('Timeout value out of range')
 *             self.timeout_value = timeout_float             # <<<<<<<<<<<<<<
 *             self.tv.tv_sec = <long>timeout_float
 *             self.tv.tv_usec = <unsigned int>(
 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = __pyx_v_timeout_float;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1661
 *                 raise ValueError('Timeout value out of range')
 *             self.timeout_value = timeout_float
 *             self.tv.tv_sec = <long>timeout_float             # <<<<<<<<<<<<<<
 *             self.tv.tv_usec = <unsigned int>(
 *                 (timeout_float - <float>self.tv.tv_sec) * 1000000.0)
 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_sec = ((long)__pyx_v_timeout_float);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1662
 *             self.timeout_value = timeout_float
 *             self.tv.tv_sec = <long>timeout_float
 *             self.tv.tv_usec = <unsigned int>(             # <<<<<<<<<<<<<<
 *                 (timeout_float - <float>self.tv.tv_sec) * 1000000.0)
 * 
 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_usec = ((unsigned int)((__pyx_v_timeout_float - ((float)((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_sec)) * 1000000.0));
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsslsocket.settimeout");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_timeout);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1665
 *                 (timeout_float - <float>self.tv.tv_sec) * 1000000.0)
 * 
 *     def read(nbsslsocket self, len=1024):             # <<<<<<<<<<<<<<
 *         """Emulate ssl.SSLSocket.read, doesn't make much sense."""
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_read[] = "Emulate ssl.SSLSocket.read, doesn't make much sense.";
static PyObject *__pyx_pf_4coio_11nbsslsocket_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_len = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_t_10;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__len,0};
  __Pyx_RefNannySetupContext("read");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_int_1024);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__len);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "read") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_len = values[0];
  } else {
    __pyx_v_len = ((PyObject *)__pyx_int_1024);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_len = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("read", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsslsocket.read");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_len);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1667
 *     def read(nbsslsocket self, len=1024):
 *         """Emulate ssl.SSLSocket.read, doesn't make much sense."""
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.sslobj.read(len)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1668
 *         """Emulate ssl.SSLSocket.read, doesn't make much sense."""
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.sslobj.read(len)
 *             except SSLError, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1669
 *         while 1:
 *             try:
 *                 return self.sslobj.read(len)             # <<<<<<<<<<<<<<
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__read); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1669; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1669; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_v_len);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_len);
        __Pyx_GIVEREF(__pyx_v_len);
        __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1669; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L12_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L15_try_end;
      __pyx_L12_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L8_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1670
 *             try:
 *                 return self.sslobj.read(len)
 *             except SSLError, e:             # <<<<<<<<<<<<<<
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1670; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsslsocket.read");
        if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_3, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1670; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_3;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1671
 *                 return self.sslobj.read(len)
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:             # <<<<<<<<<<<<<<
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1671; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1671; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1671; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1671; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1672
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 */
          __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1672; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          goto __pyx_L18;
        }

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1673
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:             # <<<<<<<<<<<<<<
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 elif (e.errno == SSL_ERROR_EOF and
 */
        __pyx_t_8 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_6 = PyObject_RichCompare(__pyx_t_8, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1674
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 *                     handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *                 elif (e.errno == SSL_ERROR_EOF and
 *                       self.sslobj.suppress_ragged_eofs):
 */
          __pyx_t_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1674; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          goto __pyx_L18;
        }

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1675
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 elif (e.errno == SSL_ERROR_EOF and             # <<<<<<<<<<<<<<
 *                       self.sslobj.suppress_ragged_eofs):
 *                     return ''
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_EOF); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1676
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 elif (e.errno == SSL_ERROR_EOF and
 *                       self.sslobj.suppress_ragged_eofs):             # <<<<<<<<<<<<<<
 *                     return ''
 *                 else:
 */
          __pyx_t_8 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s_14); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1676; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1676; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_10 = __pyx_t_9;
        } else {
          __pyx_t_10 = __pyx_t_1;
        }
        if (__pyx_t_10) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1677
 *                 elif (e.errno == SSL_ERROR_EOF and
 *                       self.sslobj.suppress_ragged_eofs):
 *                     return ''             # <<<<<<<<<<<<<<
 *                 else:
 *                     raise
 */
          __Pyx_XDECREF(__pyx_r);
          __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
          __pyx_r = ((PyObject *)__pyx_kp_s_5);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          goto __pyx_L11_except_return;
          goto __pyx_L18;
        }
        /*else*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1679
 *                     return ''
 *                 else:
 *                     raise             # <<<<<<<<<<<<<<
 * 
 *     def write(nbsslsocket self, data):
 */
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_4, __pyx_t_3, __pyx_t_2);
          __pyx_t_4 = 0; __pyx_t_3 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1679; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        }
        __pyx_L18:;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L9_exception_handled;
      }
      __pyx_L10_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L11_except_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L9_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L15_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.read");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_len);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1681
 *                     raise
 * 
 *     def write(nbsslsocket self, data):             # <<<<<<<<<<<<<<
 *         """Emulate ssl.SSLSocket.write, doesn't make much sense."""
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_write(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_write[] = "Emulate ssl.SSLSocket.write, doesn't make much sense.";
static PyObject *__pyx_pf_4coio_11nbsslsocket_write(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("write");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1683
 *     def write(nbsslsocket self, data):
 *         """Emulate ssl.SSLSocket.write, doesn't make much sense."""
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.sslobj.write(data)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1684
 *         """Emulate ssl.SSLSocket.write, doesn't make much sense."""
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.sslobj.write(data)
 *             except SSLError, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1685
 *         while 1:
 *             try:
 *                 return self.sslobj.write(data)             # <<<<<<<<<<<<<<
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__write); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_data);
        __Pyx_GIVEREF(__pyx_v_data);
        __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1686
 *             try:
 *                 return self.sslobj.write(data)
 *             except SSLError, e:             # <<<<<<<<<<<<<<
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1686; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsslsocket.write");
        if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_3, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1686; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_3;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1687
 *                 return self.sslobj.write(data)
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:             # <<<<<<<<<<<<<<
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1687; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1687; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1687; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1687; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1688
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 */
          __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          goto __pyx_L17;
        }

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1689
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:             # <<<<<<<<<<<<<<
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 else:
 */
        __pyx_t_8 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1689; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1689; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_6 = PyObject_RichCompare(__pyx_t_8, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1689; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1689; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1690
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 *                     handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *                 else:
 *                     raise
 */
          __pyx_t_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1690; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          goto __pyx_L17;
        }
        /*else*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1692
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 else:
 *                     raise             # <<<<<<<<<<<<<<
 * 
 *     def accept(nbsslsocket self):
 */
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_4, __pyx_t_3, __pyx_t_2);
          __pyx_t_4 = 0; __pyx_t_3 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1692; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        }
        __pyx_L17:;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.write");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_data);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1694
 *                     raise
 * 
 *     def accept(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         cdef nbsslsocket asslsock
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_accept(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_accept(PyObject *__pyx_v_self, PyObject *unused) {
  struct __pyx_obj_4coio_nbsslsocket *__pyx_v_asslsock;
  PyObject *__pyx_v_asock;
  PyObject *__pyx_v_addr;
  PyObject *__pyx_v_e;
  PyObject *__pyx_v_asock_to_close;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("accept");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_asslsock = ((struct __pyx_obj_4coio_nbsslsocket *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_asock = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_addr = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_asock_to_close = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1696
 *     def accept(nbsslsocket self):
 *         cdef nbsslsocket asslsock
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 asock, addr = self.realsock.accept()
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1697
 *         cdef nbsslsocket asslsock
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 asock, addr = self.realsock.accept()
 *                 break
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1698
 *         while 1:
 *             try:
 *                 asock, addr = self.realsock.accept()             # <<<<<<<<<<<<<<
 *                 break
 *             except socket.error, e:
 */
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__accept); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (PyTuple_CheckExact(__pyx_t_3) && likely(PyTuple_GET_SIZE(__pyx_t_3) == 2)) {
          PyObject* tuple = __pyx_t_3;
          __pyx_t_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_2);
          __pyx_t_4 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_v_asock);
          __pyx_v_asock = __pyx_t_2;
          __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_v_addr);
          __pyx_v_addr = __pyx_t_4;
          __pyx_t_4 = 0;
        } else {
          __pyx_t_5 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_UnpackItem(__pyx_t_5, 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = __Pyx_UnpackItem(__pyx_t_5, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_GOTREF(__pyx_t_4);
          if (__Pyx_EndUnpack(__pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_v_asock);
          __pyx_v_asock = __pyx_t_2;
          __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_v_addr);
          __pyx_v_addr = __pyx_t_4;
          __pyx_t_4 = 0;
        }

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1699
 *             try:
 *                 asock, addr = self.realsock.accept()
 *                 break             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        goto __pyx_L12_try_break;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1700
 *                 asock, addr = self.realsock.accept()
 *                 break
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1700; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__error); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1700; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_6 = PyErr_ExceptionMatches(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_6) {
        __Pyx_AddTraceback("coio.nbsslsocket.accept");
        if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_3, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1700; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_3;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1701
 *                 break
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)
 */
        __pyx_t_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1701; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1701; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_5, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1701; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1701; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1702
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_READ)
 *         asock_to_close = asock
 */
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_4, __pyx_t_3, __pyx_t_2);
          __pyx_t_4 = 0; __pyx_t_3 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1702; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1703
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 *         asock_to_close = asock
 *         try:
 */
        __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1703; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L12_try_break:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L6_break;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }
  __pyx_L6_break:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1704
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)
 *         asock_to_close = asock             # <<<<<<<<<<<<<<
 *         try:
 *             asslsock = nbsslsocket(
 */
  __Pyx_INCREF(__pyx_v_asock);
  __Pyx_DECREF(__pyx_v_asock_to_close);
  __pyx_v_asock_to_close = __pyx_v_asock;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1705
 *                 handle_ssl_eagain(self, c_EV_READ)
 *         asock_to_close = asock
 *         try:             # <<<<<<<<<<<<<<
 *             asslsock = nbsslsocket(
 *                 sockwrapper(asock),
 */
  /*try:*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1707
 *         try:
 *             asslsock = nbsslsocket(
 *                 sockwrapper(asock),             # <<<<<<<<<<<<<<
 *                 keyfile=self.sslsock.keyfile,
 *                 certfile=self.sslsock.certfile,
 */
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1707; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_asock);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_asock);
    __Pyx_GIVEREF(__pyx_v_asock);
    __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_sockwrapper)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1707; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1706
 *         asock_to_close = asock
 *         try:
 *             asslsock = nbsslsocket(             # <<<<<<<<<<<<<<
 *                 sockwrapper(asock),
 *                 keyfile=self.sslsock.keyfile,
 */
    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1708
 *             asslsock = nbsslsocket(
 *                 sockwrapper(asock),
 *                 keyfile=self.sslsock.keyfile,             # <<<<<<<<<<<<<<
 *                 certfile=self.sslsock.certfile,
 *                 server_side=True,
 */
    __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__keyfile); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1708; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__keyfile), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1709
 *                 sockwrapper(asock),
 *                 keyfile=self.sslsock.keyfile,
 *                 certfile=self.sslsock.certfile,             # <<<<<<<<<<<<<<
 *                 server_side=True,
 *                 cert_reqs=self.sslsock.cert_reqs,
 */
    __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__certfile); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1709; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__certfile), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1710
 *                 keyfile=self.sslsock.keyfile,
 *                 certfile=self.sslsock.certfile,
 *                 server_side=True,             # <<<<<<<<<<<<<<
 *                 cert_reqs=self.sslsock.cert_reqs,
 *                 ssl_version=self.sslsock.ssl_version,
 */
    __pyx_t_4 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__server_side), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1711
 *                 certfile=self.sslsock.certfile,
 *                 server_side=True,
 *                 cert_reqs=self.sslsock.cert_reqs,             # <<<<<<<<<<<<<<
 *                 ssl_version=self.sslsock.ssl_version,
 *                 ca_certs=self.sslsock.ca_certs,
 */
    __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__cert_reqs); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__cert_reqs), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1712
 *                 server_side=True,
 *                 cert_reqs=self.sslsock.cert_reqs,
 *                 ssl_version=self.sslsock.ssl_version,             # <<<<<<<<<<<<<<
 *                 ca_certs=self.sslsock.ca_certs,
 *                 do_handshake_on_connect=False,
 */
    __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__ssl_version); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1712; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__ssl_version), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1713
 *                 cert_reqs=self.sslsock.cert_reqs,
 *                 ssl_version=self.sslsock.ssl_version,
 *                 ca_certs=self.sslsock.ca_certs,             # <<<<<<<<<<<<<<
 *                 do_handshake_on_connect=False,
 *                 suppress_ragged_eofs=self.sslsock.suppress_ragged_eofs)
 */
    __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__ca_certs); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1713; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__ca_certs), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1714
 *                 ssl_version=self.sslsock.ssl_version,
 *                 ca_certs=self.sslsock.ca_certs,
 *                 do_handshake_on_connect=False,             # <<<<<<<<<<<<<<
 *                 suppress_ragged_eofs=self.sslsock.suppress_ragged_eofs)
 *             if self.sslsock.do_handshake_on_connect:
 */
    __pyx_t_4 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1714; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s_12), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1715
 *                 ca_certs=self.sslsock.ca_certs,
 *                 do_handshake_on_connect=False,
 *                 suppress_ragged_eofs=self.sslsock.suppress_ragged_eofs)             # <<<<<<<<<<<<<<
 *             if self.sslsock.do_handshake_on_connect:
 *                 asslsock.sslsock.do_handshake_on_connect = True
 */
    __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s_14); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s_14), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyEval_CallObjectWithKeywords(((PyObject *)((PyObject*)__pyx_ptype_4coio_nbsslsocket)), __pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_v_asslsock));
    __pyx_v_asslsock = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1716
 *                 do_handshake_on_connect=False,
 *                 suppress_ragged_eofs=self.sslsock.suppress_ragged_eofs)
 *             if self.sslsock.do_handshake_on_connect:             # <<<<<<<<<<<<<<
 *                 asslsock.sslsock.do_handshake_on_connect = True
 *                 asslsock.do_handshake()  # Non-blocking.
 */
    __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s_12); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L19;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1717
 *                 suppress_ragged_eofs=self.sslsock.suppress_ragged_eofs)
 *             if self.sslsock.do_handshake_on_connect:
 *                 asslsock.sslsock.do_handshake_on_connect = True             # <<<<<<<<<<<<<<
 *                 asslsock.do_handshake()  # Non-blocking.
 *             asock_to_close = None
 */
      __pyx_t_4 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L19;}
      __Pyx_GOTREF(__pyx_t_4);
      if (PyObject_SetAttr(__pyx_v_asslsock->sslsock, __pyx_n_s_12, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L19;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1718
 *             if self.sslsock.do_handshake_on_connect:
 *                 asslsock.sslsock.do_handshake_on_connect = True
 *                 asslsock.do_handshake()  # Non-blocking.             # <<<<<<<<<<<<<<
 *             asock_to_close = None
 *         finally:
 */
      __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_asslsock), __pyx_n_s__do_handshake); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L19;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L19;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L21;
    }
    __pyx_L21:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1719
 *                 asslsock.sslsock.do_handshake_on_connect = True
 *                 asslsock.do_handshake()  # Non-blocking.
 *             asock_to_close = None             # <<<<<<<<<<<<<<
 *         finally:
 *             # Close the new connection upon an exception (such as keyfile=
 */
    __Pyx_INCREF(Py_None);
    __Pyx_DECREF(__pyx_v_asock_to_close);
    __pyx_v_asock_to_close = Py_None;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L20;
    __pyx_L19: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L20;
    }
    __pyx_L20:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1723
 *             # Close the new connection upon an exception (such as keyfile=
 *             # not found).
 *             asock_to_close.close()             # <<<<<<<<<<<<<<
 *         return (asslsock, addr)
 * 
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_asock_to_close, __pyx_n_s__close); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1723; __pyx_clineno = __LINE__; goto __pyx_L22_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1723; __pyx_clineno = __LINE__; goto __pyx_L22_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L23;
    __pyx_L22_error:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1_error;
    __pyx_L23:;
    switch (__pyx_why) {
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1724
 *             # not found).
 *             asock_to_close.close()
 *         return (asslsock, addr)             # <<<<<<<<<<<<<<
 * 
 *     def connect(nbsslsocket self, object address):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1724; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject *)__pyx_v_asslsock));
  PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_asslsock));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_asslsock));
  __Pyx_INCREF(__pyx_v_addr);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_addr);
  __Pyx_GIVEREF(__pyx_v_addr);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.accept");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_asslsock);
  __Pyx_DECREF(__pyx_v_asock);
  __Pyx_DECREF(__pyx_v_addr);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF(__pyx_v_asock_to_close);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1726
 *         return (asslsock, addr)
 * 
 *     def connect(nbsslsocket self, object address):             # <<<<<<<<<<<<<<
 *         if self._sslobj:
 *             raise ValueError('attempt to connect already-connected SSLSocket!')
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_v_address); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_v_address) {
  PyObject *__pyx_v_err;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  __Pyx_RefNannySetupContext("connect");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1727
 * 
 *     def connect(nbsslsocket self, object address):
 *         if self._sslobj:             # <<<<<<<<<<<<<<
 *             raise ValueError('attempt to connect already-connected SSLSocket!')
 * 
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___sslobj); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1727; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1727; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1728
 *     def connect(nbsslsocket self, object address):
 *         if self._sslobj:
 *             raise ValueError('attempt to connect already-connected SSLSocket!')             # <<<<<<<<<<<<<<
 * 
 *         # Do a non-blocking DNS lookup if needed.
 */
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1728; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_15));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_15));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_15));
    __pyx_t_3 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1728; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1728; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1732
 *         # Do a non-blocking DNS lookup if needed.
 *         # There is no need to predeclare c_gethostbyname in Pyrex.
 *         address = c_gethostbyname(address, self.realsock.family)             # <<<<<<<<<<<<<<
 * 
 *         while 1:
 */
  __pyx_t_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__family); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address, __pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1734
 *         address = c_gethostbyname(address, self.realsock.family)
 * 
 *         while 1:             # <<<<<<<<<<<<<<
 *             err = self.realsock.connect_ex(address)
 *             if err:
 */
  while (1) {
    __pyx_t_2 = 1;
    if (!__pyx_t_2) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1735
 * 
 *         while 1:
 *             err = self.realsock.connect_ex(address)             # <<<<<<<<<<<<<<
 *             if err:
 *                 if err != EAGAIN and err != EINPROGRESS:
 */
    __pyx_t_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__connect_ex); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_address);
    __Pyx_GIVEREF(__pyx_v_address);
    __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1736
 *         while 1:
 *             err = self.realsock.connect_ex(address)
 *             if err:             # <<<<<<<<<<<<<<
 *                 if err != EAGAIN and err != EINPROGRESS:
 *                     raise socket.error(err, strerror(err))
 */
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_err); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1737
 *             err = self.realsock.connect_ex(address)
 *             if err:
 *                 if err != EAGAIN and err != EINPROGRESS:             # <<<<<<<<<<<<<<
 *                     raise socket.error(err, strerror(err))
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 */
      __pyx_t_5 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_err, __pyx_t_5, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_2) {
        __pyx_t_1 = PyInt_FromLong(EINPROGRESS); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = PyObject_RichCompare(__pyx_v_err, __pyx_t_1, Py_NE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_7 = __pyx_t_6;
      } else {
        __pyx_t_7 = __pyx_t_2;
      }
      if (__pyx_t_7) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1738
 *             if err:
 *                 if err != EAGAIN and err != EINPROGRESS:
 *                     raise socket.error(err, strerror(err))             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 *             else:
 */
        __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__error); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_v_err); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_5 = __Pyx_PyBytes_FromString(strerror(__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_err);
        __Pyx_GIVEREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_t_5));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
        __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L9;
      }
      __pyx_L9:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1739
 *                 if err != EAGAIN and err != EINPROGRESS:
 *                     raise socket.error(err, strerror(err))
 *                 handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *             else:
 *                 break
 */
      __pyx_t_5 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L8;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1741
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 *             else:
 *                 break             # <<<<<<<<<<<<<<
 * 
 *         self.sslsock._sslobj = self.sslobj = ssl._ssl.sslwrap(
 */
      goto __pyx_L7_break;
    }
    __pyx_L8:;
  }
  __pyx_L7_break:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1743
 *                 break
 * 
 *         self.sslsock._sslobj = self.sslobj = ssl._ssl.sslwrap(             # <<<<<<<<<<<<<<
 *             self.realsock, False, self.sslsock.keyfile,
 *             self.sslsock.certfile, self.sslsock.cert_reqs,
 */
  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__ssl); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s___ssl); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__sslwrap); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1744
 * 
 *         self.sslsock._sslobj = self.sslobj = ssl._ssl.sslwrap(
 *             self.realsock, False, self.sslsock.keyfile,             # <<<<<<<<<<<<<<
 *             self.sslsock.certfile, self.sslsock.cert_reqs,
 *             self.sslsock.ssl_version, self.sslsock.ca_certs)
 */
  __pyx_t_3 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__keyfile); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1745
 *         self.sslsock._sslobj = self.sslobj = ssl._ssl.sslwrap(
 *             self.realsock, False, self.sslsock.keyfile,
 *             self.sslsock.certfile, self.sslsock.cert_reqs,             # <<<<<<<<<<<<<<
 *             self.sslsock.ssl_version, self.sslsock.ca_certs)
 * 
 */
  __pyx_t_8 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__certfile); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__cert_reqs); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1746
 *             self.realsock, False, self.sslsock.keyfile,
 *             self.sslsock.certfile, self.sslsock.cert_reqs,
 *             self.sslsock.ssl_version, self.sslsock.ca_certs)             # <<<<<<<<<<<<<<
 * 
 *         if self.sslsock.do_handshake_on_connect:
 */
  __pyx_t_10 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__ssl_version); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_11 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__ca_certs); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = PyTuple_New(7); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  PyTuple_SET_ITEM(__pyx_t_12, 0, ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  __Pyx_GIVEREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_12, 3, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_12, 4, __pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_12, 5, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_12, 6, __pyx_t_11);
  __Pyx_GIVEREF(__pyx_t_11);
  __pyx_t_3 = 0;
  __pyx_t_1 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_t_11 = PyObject_Call(__pyx_t_5, __pyx_t_12, NULL); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1743
 *                 break
 * 
 *         self.sslsock._sslobj = self.sslobj = ssl._ssl.sslwrap(             # <<<<<<<<<<<<<<
 *             self.realsock, False, self.sslsock.keyfile,
 *             self.sslsock.certfile, self.sslsock.cert_reqs,
 */
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___sslobj, __pyx_t_11) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_INCREF(__pyx_t_11);
  __Pyx_GIVEREF(__pyx_t_11);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_t_11;
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1748
 *             self.sslsock.ssl_version, self.sslsock.ca_certs)
 * 
 *         if self.sslsock.do_handshake_on_connect:             # <<<<<<<<<<<<<<
 *             self.do_handshake()
 * 
 */
  __pyx_t_11 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s_12); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (__pyx_t_7) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1749
 * 
 *         if self.sslsock.do_handshake_on_connect:
 *             self.do_handshake()             # <<<<<<<<<<<<<<
 * 
 *     def connect_ex(nbsslsocket self, object address):
 */
    __pyx_t_11 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__do_handshake); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_12 = PyObject_Call(__pyx_t_11, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("coio.nbsslsocket.connect");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_err);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_address);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1751
 *             self.do_handshake()
 * 
 *     def connect_ex(nbsslsocket self, object address):             # <<<<<<<<<<<<<<
 *         """Do a connect(2), and return 0 or the error code.
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_v_address); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_connect_ex[] = "Do a connect(2), and return 0 or the error code.\n\n        The implementation of connect_ex is not optimized for speed.\n\n        This is incompatible with SSLSocket.connect_ex, which doesn't do the\n        SSL handshake, and connects only the socket._realsocket.\n        \n        Returns:\n          0 on success; errno for socket.error and -800 - errno for\n          ssl.SSLError.\n        ";
static PyObject *__pyx_pf_4coio_11nbsslsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_v_address) {
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("connect_ex");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_address);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1763
 *           ssl.SSLError.
 *         """
 *         try:             # <<<<<<<<<<<<<<
 *             self.connect(address)
 *         except socket.error, e:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1764
 *         """
 *         try:
 *             self.connect(address)             # <<<<<<<<<<<<<<
 *         except socket.error, e:
 *             return e.errno
 */
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__connect); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1764; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1764; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_v_address);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_address);
      __Pyx_GIVEREF(__pyx_v_address);
      __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1764; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L12_try_end;
    __pyx_L5_error:;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1765
 *         try:
 *             self.connect(address)
 *         except socket.error, e:             # <<<<<<<<<<<<<<
 *             return e.errno
 *         except ssl.SSLError, e:
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1765; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__error); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1765; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_4 = PyErr_ExceptionMatches(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_4) {
      __Pyx_AddTraceback("coio.nbsslsocket.connect_ex");
      if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_3, &__pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1765; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_t_3;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1766
 *             self.connect(address)
 *         except socket.error, e:
 *             return e.errno             # <<<<<<<<<<<<<<
 *         except ssl.SSLError, e:
 *             return -800 - e.errno  # TODO(pts): Better reporting
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L8_except_return;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L6_exception_handled;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1767
 *         except socket.error, e:
 *             return e.errno
 *         except ssl.SSLError, e:             # <<<<<<<<<<<<<<
 *             return -800 - e.errno  # TODO(pts): Better reporting
 *         return 0
 */
    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__ssl); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = PyErr_ExceptionMatches(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_4) {
      __Pyx_AddTraceback("coio.nbsslsocket.connect_ex");
      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_1, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_t_1;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1768
 *             return e.errno
 *         except ssl.SSLError, e:
 *             return -800 - e.errno  # TODO(pts): Better reporting             # <<<<<<<<<<<<<<
 *         return 0
 * 
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyNumber_Subtract(__pyx_int_neg_800, __pyx_t_5); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_r = __pyx_t_6;
      __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L8_except_return;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L6_exception_handled;
    }
    __pyx_L7_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L8_except_return:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L0;
    __pyx_L6_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L12_try_end:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1769
 *         except ssl.SSLError, e:
 *             return -800 - e.errno  # TODO(pts): Better reporting
 *         return 0             # <<<<<<<<<<<<<<
 * 
 *     def shutdown(nbsslsocket self, object how):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_int_0);
  __pyx_r = __pyx_int_0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("coio.nbsslsocket.connect_ex");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_address);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1771
 *         return 0
 * 
 *     def shutdown(nbsslsocket self, object how):             # <<<<<<<<<<<<<<
 *         # Clearing sslobj mimics the behavior of ssl.SSLSocket.shutdown.
 *         self.sslsock._sslobj = None
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_v_how); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_v_how) {
  PyObject *__pyx_v_err;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("shutdown");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_how);
  __pyx_v_err = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1773
 *     def shutdown(nbsslsocket self, object how):
 *         # Clearing sslobj mimics the behavior of ssl.SSLSocket.shutdown.
 *         self.sslsock._sslobj = None             # <<<<<<<<<<<<<<
 *         self.sslobj = None
 *         while 1:
 */
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___sslobj, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1774
 *         # Clearing sslobj mimics the behavior of ssl.SSLSocket.shutdown.
 *         self.sslsock._sslobj = None
 *         self.sslobj = None             # <<<<<<<<<<<<<<
 *         while 1:
 *             err = self.realsock.shutdown(how)
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  __Pyx_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = Py_None;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1775
 *         self.sslsock._sslobj = None
 *         self.sslobj = None
 *         while 1:             # <<<<<<<<<<<<<<
 *             err = self.realsock.shutdown(how)
 *             if err != EAGAIN:
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1776
 *         self.sslobj = None
 *         while 1:
 *             err = self.realsock.shutdown(how)             # <<<<<<<<<<<<<<
 *             if err != EAGAIN:
 *                 return err
 */
    __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__shutdown); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_how);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_how);
    __Pyx_GIVEREF(__pyx_v_how);
    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1777
 *         while 1:
 *             err = self.realsock.shutdown(how)
 *             if err != EAGAIN:             # <<<<<<<<<<<<<<
 *                 return err
 *             # TODO(pts): Can this happen (with SO_LINGER?).
 */
    __pyx_t_4 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_err, __pyx_t_4, Py_NE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1778
 *             err = self.realsock.shutdown(how)
 *             if err != EAGAIN:
 *                 return err             # <<<<<<<<<<<<<<
 *             # TODO(pts): Can this happen (with SO_LINGER?).
 *             handle_ssl_eagain(self, c_EV_WRITE)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1780
 *                 return err
 *             # TODO(pts): Can this happen (with SO_LINGER?).
 *             handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def pending(nbsslsocket self):
 */
    __pyx_t_3 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsslsocket.shutdown");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_err);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_how);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1782
 *             handle_ssl_eagain(self, c_EV_WRITE)
 * 
 *     def pending(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         # TODO(pts): How is this method useful?
 *         return self.sslsock.pending()
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_pending(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_pending(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("pending");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1784
 *     def pending(nbsslsocket self):
 *         # TODO(pts): How is this method useful?
 *         return self.sslsock.pending()             # <<<<<<<<<<<<<<
 * 
 *     def unwrap(nbsslsocket self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s__pending); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.nbsslsocket.pending");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1786
 *         return self.sslsock.pending()
 * 
 *     def unwrap(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         if self.sslobj:
 *             s = self.sslobj.shutdown()
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_unwrap(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_unwrap(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_v_s;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("unwrap");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_s = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1787
 * 
 *     def unwrap(nbsslsocket self):
 *         if self.sslobj:             # <<<<<<<<<<<<<<
 *             s = self.sslobj.shutdown()
 *             self.sslsock._sslobj = None
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1788
 *     def unwrap(nbsslsocket self):
 *         if self.sslobj:
 *             s = self.sslobj.shutdown()             # <<<<<<<<<<<<<<
 *             self.sslsock._sslobj = None
 *             self.sslobj = None
 */
    __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__shutdown); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_s);
    __pyx_v_s = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1789
 *         if self.sslobj:
 *             s = self.sslobj.shutdown()
 *             self.sslsock._sslobj = None             # <<<<<<<<<<<<<<
 *             self.sslobj = None
 *             return s
 */
    if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___sslobj, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1790
 *             s = self.sslobj.shutdown()
 *             self.sslsock._sslobj = None
 *             self.sslobj = None             # <<<<<<<<<<<<<<
 *             return s
 *         raise ValueError('No SSL wrapper around ' + str(self.sslsock))
 */
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    __Pyx_GOTREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
    __Pyx_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = Py_None;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1791
 *             self.sslsock._sslobj = None
 *             self.sslobj = None
 *             return s             # <<<<<<<<<<<<<<
 *         raise ValueError('No SSL wrapper around ' + str(self.sslsock))
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_s);
    __pyx_r = __pyx_v_s;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1792
 *             self.sslobj = None
 *             return s
 *         raise ValueError('No SSL wrapper around ' + str(self.sslsock))             # <<<<<<<<<<<<<<
 * 
 *     def do_handshake(nbsslsocket self):
 */
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __Pyx_GIVEREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Add(((PyObject *)__pyx_kp_s_16), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_Raise(__pyx_t_3, 0, 0);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.unwrap");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_s);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1794
 *         raise ValueError('No SSL wrapper around ' + str(self.sslsock))
 * 
 *     def do_handshake(nbsslsocket self):             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_do_handshake(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_do_handshake(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("do_handshake");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1795
 * 
 *     def do_handshake(nbsslsocket self):
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 self.sslobj.do_handshake()
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1796
 *     def do_handshake(nbsslsocket self):
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 self.sslobj.do_handshake()
 *                 return
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1797
 *         while 1:
 *             try:
 *                 self.sslobj.do_handshake()             # <<<<<<<<<<<<<<
 *                 return
 *             except SSLError, e:
 */
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__do_handshake); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1797; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1797; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1798
 *             try:
 *                 self.sslobj.do_handshake()
 *                 return             # <<<<<<<<<<<<<<
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_r = Py_None; __Pyx_INCREF(Py_None);
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1799
 *                 self.sslobj.do_handshake()
 *                 return
 *             except SSLError, e:             # <<<<<<<<<<<<<<
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1799; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_4) {
        __Pyx_AddTraceback("coio.nbsslsocket.do_handshake");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1799; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_2;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1800
 *                 return
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:             # <<<<<<<<<<<<<<
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1800; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1800; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1800; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1800; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1801
 *             except SSLError, e:
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 */
          __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1801; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          goto __pyx_L17;
        }

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1802
 *                 if e.errno == SSL_ERROR_WANT_READ:
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:             # <<<<<<<<<<<<<<
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 else:
 */
        __pyx_t_8 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_6 = PyObject_RichCompare(__pyx_t_8, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1803
 *                     handle_ssl_eagain(self, c_EV_READ)
 *                 elif e.errno == SSL_ERROR_WANT_WRITE:
 *                     handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *                 else:
 *                     raise
 */
          __pyx_t_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          goto __pyx_L17;
        }
        /*else*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1805
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 else:
 *                     raise             # <<<<<<<<<<<<<<
 * 
 *     def getpeercert(nbsslsocket self, binary_form=False):
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_5);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_2, __pyx_t_5);
          __pyx_t_3 = 0; __pyx_t_2 = 0; __pyx_t_5 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1805; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        }
        __pyx_L17:;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1807
 *                     raise
 * 
 *     def getpeercert(nbsslsocket self, binary_form=False):             # <<<<<<<<<<<<<<
 *         return self.sslobj.peer_certificate(binary_form)
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_getpeercert(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_getpeercert(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_binary_form = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__binary_form,0};
  __Pyx_RefNannySetupContext("getpeercert");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    values[0] = __pyx_k_17;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__binary_form);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "getpeercert") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1807; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_binary_form = values[0];
  } else {
    __pyx_v_binary_form = __pyx_k_17;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_binary_form = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("getpeercert", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1807; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsslsocket.getpeercert");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1808
 * 
 *     def getpeercert(nbsslsocket self, binary_form=False):
 *         return self.sslobj.peer_certificate(binary_form)             # <<<<<<<<<<<<<<
 * 
 *     def cipher(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__peer_certificate); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1808; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1808; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_binary_form);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_binary_form);
  __Pyx_GIVEREF(__pyx_v_binary_form);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1808; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getpeercert");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1810
 *         return self.sslobj.peer_certificate(binary_form)
 * 
 *     def cipher(self):             # <<<<<<<<<<<<<<
 *         if not self.sslobj:
 *             return None
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_cipher(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_cipher(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("cipher");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1811
 * 
 *     def cipher(self):
 *         if not self.sslobj:             # <<<<<<<<<<<<<<
 *             return None
 *         else:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1812
 *     def cipher(self):
 *         if not self.sslobj:
 *             return None             # <<<<<<<<<<<<<<
 *         else:
 *             return self.sslobj.cipher()
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1814
 *             return None
 *         else:
 *             return self.sslobj.cipher()             # <<<<<<<<<<<<<<
 * 
 *     def recv(nbsslsocket self, int buflen=1024, int flags=0):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__cipher); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsslsocket.cipher");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1816
 *             return self.sslobj.cipher()
 * 
 *     def recv(nbsslsocket self, int buflen=1024, int flags=0):             # <<<<<<<<<<<<<<
 *         """Receive data from the SSL or non-SSL connection.
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_recv[] = "Receive data from the SSL or non-SSL connection.\n\n        The defaults for buflen and flags are the same as in ssl.SSLSocket.\n        ";
static PyObject *__pyx_pf_4coio_11nbsslsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_buflen;
  int __pyx_v_flags;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_t_10;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__buflen,&__pyx_n_s__flags,0};
  __Pyx_RefNannySetupContext("recv");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__buflen);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "recv") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1816; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    if (values[0]) {
      __pyx_v_buflen = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_buflen == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1816; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_buflen = ((int)1024);
    }
    if (values[1]) {
      __pyx_v_flags = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1816; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_flags = ((int)0);
    }
  } else {
    __pyx_v_buflen = ((int)1024);
    __pyx_v_flags = ((int)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_flags = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1816; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_buflen = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_buflen == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1816; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("recv", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1816; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsslsocket.recv");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1821
 *         The defaults for buflen and flags are the same as in ssl.SSLSocket.
 *         """
 *         if self.sslobj:             # <<<<<<<<<<<<<<
 *             if flags:
 *                 raise ValueError(
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1822
 *         """
 *         if self.sslobj:
 *             if flags:             # <<<<<<<<<<<<<<
 *                 raise ValueError(
 *                     'flags=0 expected for recv on ' + str(self.__class__))
 */
    __pyx_t_2 = __pyx_v_flags;
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1824
 *             if flags:
 *                 raise ValueError(
 *                     'flags=0 expected for recv on ' + str(self.__class__))             # <<<<<<<<<<<<<<
 *             while 1:
 *                 try:
 */
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s____class__); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Add(((PyObject *)__pyx_kp_s_18), __pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1825
 *                 raise ValueError(
 *                     'flags=0 expected for recv on ' + str(self.__class__))
 *             while 1:             # <<<<<<<<<<<<<<
 *                 try:
 *                     return self.sslobj.read(buflen)
 */
    while (1) {
      __pyx_t_1 = 1;
      if (!__pyx_t_1) break;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1826
 *                     'flags=0 expected for recv on ' + str(self.__class__))
 *             while 1:
 *                 try:             # <<<<<<<<<<<<<<
 *                     return self.sslobj.read(buflen)
 *                 except SSLError, e:
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1827
 *             while 1:
 *                 try:
 *                     return self.sslobj.read(buflen)             # <<<<<<<<<<<<<<
 *                 except SSLError, e:
 *                     if e.errno == SSL_ERROR_WANT_READ:
 */
          __Pyx_XDECREF(__pyx_r);
          __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__read); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1827; __pyx_clineno = __LINE__; goto __pyx_L10_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_3 = PyInt_FromLong(__pyx_v_buflen); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1827; __pyx_clineno = __LINE__; goto __pyx_L10_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1827; __pyx_clineno = __LINE__; goto __pyx_L10_error;}
          __Pyx_GOTREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_3);
          __pyx_t_3 = 0;
          __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1827; __pyx_clineno = __LINE__; goto __pyx_L10_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_r = __pyx_t_3;
          __pyx_t_3 = 0;
          goto __pyx_L14_try_return;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L17_try_end;
        __pyx_L14_try_return:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L0;
        __pyx_L10_error:;
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1828
 *                 try:
 *                     return self.sslobj.read(buflen)
 *                 except SSLError, e:             # <<<<<<<<<<<<<<
 *                     if e.errno == SSL_ERROR_WANT_READ:
 *                         handle_ssl_eagain(self, c_EV_READ)
 */
        __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1828; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_2 = PyErr_ExceptionMatches(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (__pyx_t_2) {
          __Pyx_AddTraceback("coio.nbsslsocket.recv");
          if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_5, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1828; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_v_e);
          __pyx_v_e = __pyx_t_5;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1829
 *                     return self.sslobj.read(buflen)
 *                 except SSLError, e:
 *                     if e.errno == SSL_ERROR_WANT_READ:             # <<<<<<<<<<<<<<
 *                         handle_ssl_eagain(self, c_EV_READ)
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:
 */
          __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1830
 *                 except SSLError, e:
 *                     if e.errno == SSL_ERROR_WANT_READ:
 *                         handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:
 *                         handle_ssl_eagain(self, c_EV_WRITE)
 */
            __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1830; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            goto __pyx_L20;
          }

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1831
 *                     if e.errno == SSL_ERROR_WANT_READ:
 *                         handle_ssl_eagain(self, c_EV_READ)
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:             # <<<<<<<<<<<<<<
 *                         handle_ssl_eagain(self, c_EV_WRITE)
 *                     elif (e.errno == SSL_ERROR_EOF and
 */
          __pyx_t_8 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1831; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1831; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_6 = PyObject_RichCompare(__pyx_t_8, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1831; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1831; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1832
 *                         handle_ssl_eagain(self, c_EV_READ)
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:
 *                         handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *                     elif (e.errno == SSL_ERROR_EOF and
 *                           self.sslobj.suppress_ragged_eofs):
 */
            __pyx_t_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L20;
          }

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1833
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:
 *                         handle_ssl_eagain(self, c_EV_WRITE)
 *                     elif (e.errno == SSL_ERROR_EOF and             # <<<<<<<<<<<<<<
 *                           self.sslobj.suppress_ragged_eofs):
 *                         return ''
 */
          __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1833; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_EOF); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1833; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1833; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1833; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1834
 *                         handle_ssl_eagain(self, c_EV_WRITE)
 *                     elif (e.errno == SSL_ERROR_EOF and
 *                           self.sslobj.suppress_ragged_eofs):             # <<<<<<<<<<<<<<
 *                         return ''
 *                     else:
 */
            __pyx_t_8 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s_14); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1834; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1834; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_10 = __pyx_t_9;
          } else {
            __pyx_t_10 = __pyx_t_1;
          }
          if (__pyx_t_10) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1835
 *                     elif (e.errno == SSL_ERROR_EOF and
 *                           self.sslobj.suppress_ragged_eofs):
 *                         return ''             # <<<<<<<<<<<<<<
 *                     else:
 *                         raise
 */
            __Pyx_XDECREF(__pyx_r);
            __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
            __pyx_r = ((PyObject *)__pyx_kp_s_5);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            goto __pyx_L13_except_return;
            goto __pyx_L20;
          }
          /*else*/ {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1837
 *                         return ''
 *                     else:
 *                         raise             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */
            __Pyx_GIVEREF(__pyx_t_3);
            __Pyx_GIVEREF(__pyx_t_5);
            __Pyx_GIVEREF(__pyx_t_4);
            __Pyx_ErrRestore(__pyx_t_3, __pyx_t_5, __pyx_t_4);
            __pyx_t_3 = 0; __pyx_t_5 = 0; __pyx_t_4 = 0; 
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1837; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          }
          __pyx_L20:;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          goto __pyx_L11_exception_handled;
        }
        __pyx_L12_except_error:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L13_except_return:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L0;
        __pyx_L11_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L17_try_end:;
      }
    }
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1838
 *                     else:
 *                         raise
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recv(buflen, flags)
 */
  while (1) {
    __pyx_t_10 = 1;
    if (!__pyx_t_10) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1839
 *                         raise
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recv(buflen, flags)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1840
 *         while 1:
 *             try:
 *                 return self.realsock.recv(buflen, flags)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__recv); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyInt_FromLong(__pyx_v_buflen); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_3 = PyInt_FromLong(__pyx_v_flags); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        __pyx_t_5 = 0;
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_8, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_r = __pyx_t_3;
        __pyx_t_3 = 0;
        goto __pyx_L27_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L30_try_end;
      __pyx_L27_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L23_error:;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1841
 *             try:
 *                 return self.realsock.recv(buflen, flags)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__error); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_2 = PyErr_ExceptionMatches(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (__pyx_t_2) {
        __Pyx_AddTraceback("coio.nbsslsocket.recv");
        if (__Pyx_GetException(&__pyx_t_8, &__pyx_t_3, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_3;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1842
 *                 return self.realsock.recv(buflen, flags)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)
 */
        __pyx_t_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1842; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1842; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1842; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1842; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (__pyx_t_10) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1843
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_8);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_ErrRestore(__pyx_t_8, __pyx_t_3, __pyx_t_4);
          __pyx_t_8 = 0; __pyx_t_3 = 0; __pyx_t_4 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
          goto __pyx_L33;
        }
        __pyx_L33:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1844
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def recvfrom(nbsslsocket self, *args):
 */
        __pyx_t_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1844; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        goto __pyx_L24_exception_handled;
      }
      __pyx_L25_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L24_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L30_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.recv");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1846
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 *     def recvfrom(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         raise NotImplementedError  # !!
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("recvfrom");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "recvfrom", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1847
 * 
 *     def recvfrom(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */
  __Pyx_Raise(__pyx_builtin_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1848
 *     def recvfrom(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recvfrom(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1849
 *         raise NotImplementedError  # !!
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recvfrom(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1850
 *         while 1:
 *             try:
 *                 return self.realsock.recvfrom(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__recvfrom); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1851
 *             try:
 *                 return self.realsock.recvfrom(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1851; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1851; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsslsocket.recvfrom");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1851; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1852
 *                 return self.realsock.recvfrom(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1852; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1852; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1852; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1852; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1853
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1853; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1854
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def recv_into(nbsslsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1854; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.recvfrom");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1856
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 *     def recv_into(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         raise NotImplementedError  # !!
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("recv_into");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "recv_into", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1857
 * 
 *     def recv_into(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */
  __Pyx_Raise(__pyx_builtin_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1857; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1858
 *     def recv_into(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recv_into(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1859
 *         raise NotImplementedError  # !!
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recv_into(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1860
 *         while 1:
 *             try:
 *                 return self.realsock.recv_into(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__recv_into); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1860; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1860; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1860; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1861
 *             try:
 *                 return self.realsock.recv_into(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsslsocket.recv_into");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1862
 *                 return self.realsock.recv_into(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1863
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1863; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1864
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def recvfrom_into(nbsslsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1864; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.recv_into");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1866
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 *     def recvfrom_into(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         raise NotImplementedError  # !!
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("recvfrom_into");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "recvfrom_into", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1867
 * 
 *     def recvfrom_into(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */
  __Pyx_Raise(__pyx_builtin_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1868
 *     def recvfrom_into(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.recvfrom_into(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1869
 *         raise NotImplementedError  # !!
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.recvfrom_into(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1870
 *         while 1:
 *             try:
 *                 return self.realsock.recvfrom_into(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__recvfrom_into); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1870; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1870; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1870; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1871
 *             try:
 *                 return self.realsock.recvfrom_into(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1871; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1871; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsslsocket.recvfrom_into");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1871; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1872
 *                 return self.realsock.recvfrom_into(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1873
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1874
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 * 
 *     def send(nbsslsocket self, data, int flags=0):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1874; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.recvfrom_into");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1876
 *                 handle_ssl_eagain(self, c_EV_READ)
 * 
 *     def send(nbsslsocket self, data, int flags=0):             # <<<<<<<<<<<<<<
 *         if self.sslobj:
 *             if flags:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__data,&__pyx_n_s__flags,0};
  __Pyx_RefNannySetupContext("send");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "send") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1876; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_data = values[0];
    if (values[1]) {
      __pyx_v_flags = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1876; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_flags = ((int)0);
    }
  } else {
    __pyx_v_flags = ((int)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_flags = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1876; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_data = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("send", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1876; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsslsocket.send");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1877
 * 
 *     def send(nbsslsocket self, data, int flags=0):
 *         if self.sslobj:             # <<<<<<<<<<<<<<
 *             if flags:
 *                 raise ValueError(
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1878
 *     def send(nbsslsocket self, data, int flags=0):
 *         if self.sslobj:
 *             if flags:             # <<<<<<<<<<<<<<
 *                 raise ValueError(
 *                     'flags=0 expected for send on ' + str(self.__class__))
 */
    __pyx_t_2 = __pyx_v_flags;
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1880
 *             if flags:
 *                 raise ValueError(
 *                     'flags=0 expected for send on ' + str(self.__class__))             # <<<<<<<<<<<<<<
 *             while 1:
 *                 try:
 */
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s____class__); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Add(((PyObject *)__pyx_kp_s_19), __pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1881
 *                 raise ValueError(
 *                     'flags=0 expected for send on ' + str(self.__class__))
 *             while 1:             # <<<<<<<<<<<<<<
 *                 try:
 *                     return self.sslobj.write(data)
 */
    while (1) {
      __pyx_t_1 = 1;
      if (!__pyx_t_1) break;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1882
 *                     'flags=0 expected for send on ' + str(self.__class__))
 *             while 1:
 *                 try:             # <<<<<<<<<<<<<<
 *                     return self.sslobj.write(data)
 *                 except SSLError, e:
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1883
 *             while 1:
 *                 try:
 *                     return self.sslobj.write(data)             # <<<<<<<<<<<<<<
 *                 except SSLError, e:
 *                     if e.errno == SSL_ERROR_WANT_READ:
 */
          __Pyx_XDECREF(__pyx_r);
          __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__write); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1883; __pyx_clineno = __LINE__; goto __pyx_L10_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1883; __pyx_clineno = __LINE__; goto __pyx_L10_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_v_data);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_data);
          __Pyx_GIVEREF(__pyx_v_data);
          __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1883; __pyx_clineno = __LINE__; goto __pyx_L10_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_r = __pyx_t_5;
          __pyx_t_5 = 0;
          goto __pyx_L14_try_return;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L17_try_end;
        __pyx_L14_try_return:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L0;
        __pyx_L10_error:;
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1884
 *                 try:
 *                     return self.sslobj.write(data)
 *                 except SSLError, e:             # <<<<<<<<<<<<<<
 *                     if e.errno == SSL_ERROR_WANT_READ:
 *                         handle_ssl_eagain(self, c_EV_READ)
 */
        __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_2 = PyErr_ExceptionMatches(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_2) {
          __Pyx_AddTraceback("coio.nbsslsocket.send");
          if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_3, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_v_e);
          __pyx_v_e = __pyx_t_3;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1885
 *                     return self.sslobj.write(data)
 *                 except SSLError, e:
 *                     if e.errno == SSL_ERROR_WANT_READ:             # <<<<<<<<<<<<<<
 *                         handle_ssl_eagain(self, c_EV_READ)
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:
 */
          __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1886
 *                 except SSLError, e:
 *                     if e.errno == SSL_ERROR_WANT_READ:
 *                         handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:
 *                         handle_ssl_eagain(self, c_EV_WRITE)
 */
            __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1886; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            goto __pyx_L20;
          }

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1887
 *                     if e.errno == SSL_ERROR_WANT_READ:
 *                         handle_ssl_eagain(self, c_EV_READ)
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:             # <<<<<<<<<<<<<<
 *                         handle_ssl_eagain(self, c_EV_WRITE)
 *                     else:
 */
          __pyx_t_8 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1887; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1887; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_6 = PyObject_RichCompare(__pyx_t_8, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1887; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1887; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1888
 *                         handle_ssl_eagain(self, c_EV_READ)
 *                     elif e.errno == SSL_ERROR_WANT_WRITE:
 *                         handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *                     else:
 *                         raise
 */
            __pyx_t_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L20;
          }
          /*else*/ {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1890
 *                         handle_ssl_eagain(self, c_EV_WRITE)
 *                     else:
 *                         raise             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */
            __Pyx_GIVEREF(__pyx_t_5);
            __Pyx_GIVEREF(__pyx_t_3);
            __Pyx_GIVEREF(__pyx_t_4);
            __Pyx_ErrRestore(__pyx_t_5, __pyx_t_3, __pyx_t_4);
            __pyx_t_5 = 0; __pyx_t_3 = 0; __pyx_t_4 = 0; 
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1890; __pyx_clineno = __LINE__; goto __pyx_L12_except_error;}
          }
          __pyx_L20:;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          goto __pyx_L11_exception_handled;
        }
        __pyx_L12_except_error:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L11_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L17_try_end:;
      }
    }
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1891
 *                     else:
 *                         raise
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.send(data, flags)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1892
 *                         raise
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.send(data, flags)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1893
 *         while 1:
 *             try:
 *                 return self.realsock.send(data, flags)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__send); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_3 = PyInt_FromLong(__pyx_v_flags); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_data);
        __Pyx_GIVEREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L23_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_3;
        __pyx_t_3 = 0;
        goto __pyx_L27_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L30_try_end;
      __pyx_L27_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L23_error:;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1894
 *             try:
 *                 return self.realsock.send(data, flags)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_5 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__error); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_2 = PyErr_ExceptionMatches(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_2) {
        __Pyx_AddTraceback("coio.nbsslsocket.send");
        if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_3, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_3;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1895
 *                 return self.realsock.send(data, flags)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1895; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1895; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1895; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1895; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1896
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_ErrRestore(__pyx_t_5, __pyx_t_3, __pyx_t_4);
          __pyx_t_5 = 0; __pyx_t_3 = 0; __pyx_t_4 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
          goto __pyx_L33;
        }
        __pyx_L33:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1897
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def sendto(nbsslsocket self, *args):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1897; __pyx_clineno = __LINE__; goto __pyx_L25_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        goto __pyx_L24_exception_handled;
      }
      __pyx_L25_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L24_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L30_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.send");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_data);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1899
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 * 
 *     def sendto(nbsslsocket self, *args):             # <<<<<<<<<<<<<<
 *         raise NotImplementedError  # !!
 *         while 1:
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("sendto");
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "sendto", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1900
 * 
 *     def sendto(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!             # <<<<<<<<<<<<<<
 *         while 1:
 *             try:
 */
  __Pyx_Raise(__pyx_builtin_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1901
 *     def sendto(nbsslsocket self, *args):
 *         raise NotImplementedError  # !!
 *         while 1:             # <<<<<<<<<<<<<<
 *             try:
 *                 return self.realsock.sendto(*args)
 */
  while (1) {
    __pyx_t_1 = 1;
    if (!__pyx_t_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1902
 *         raise NotImplementedError  # !!
 *         while 1:
 *             try:             # <<<<<<<<<<<<<<
 *                 return self.realsock.sendto(*args)
 *             except socket.error, e:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1903
 *         while 1:
 *             try:
 *                 return self.realsock.sendto(*args)             # <<<<<<<<<<<<<<
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__sendto); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L11_try_return;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L11_try_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1904
 *             try:
 *                 return self.realsock.sendto(*args)
 *             except socket.error, e:             # <<<<<<<<<<<<<<
 *                 if e.errno != EAGAIN:
 *                     raise
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_5) {
        __Pyx_AddTraceback("coio.nbsslsocket.sendto");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_t_4;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1905
 *                 return self.realsock.sendto(*args)
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 */
        __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1905; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1905; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1905; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1905; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1906
 *             except socket.error, e:
 *                 if e.errno != EAGAIN:
 *                     raise             # <<<<<<<<<<<<<<
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 * 
 */
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_2);
          __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_2);
          __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_2 = 0; 
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1906; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1907
 *                 if e.errno != EAGAIN:
 *                     raise
 *                 handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 * 
 *     def sendall(nbsslsocket self, object data, int flags=0):
 */
        __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L8_exception_handled;
      }
      __pyx_L9_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.sendto");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1909
 *                 handle_ssl_eagain(self, c_EV_WRITE)
 * 
 *     def sendall(nbsslsocket self, object data, int flags=0):             # <<<<<<<<<<<<<<
 *         cdef int got
 *         cdef int got2
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_4coio_11nbsslsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  int __pyx_v_got;
  int __pyx_v_got2;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__data,&__pyx_n_s__flags,0};
  __Pyx_RefNannySetupContext("sendall");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "sendall") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1909; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_data = values[0];
    if (values[1]) {
      __pyx_v_flags = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1909; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_flags = ((int)0);
    }
  } else {
    __pyx_v_flags = ((int)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_flags = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1909; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_data = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("sendall", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1909; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsslsocket.sendall");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_data);
  __pyx_v_buf = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1912
 *         cdef int got
 *         cdef int got2
 *         got = 0             # <<<<<<<<<<<<<<
 *         buf = data   # TODO(pts): Verify buffer or str (no unicode).
 *         if data:
 */
  __pyx_v_got = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1913
 *         cdef int got2
 *         got = 0
 *         buf = data   # TODO(pts): Verify buffer or str (no unicode).             # <<<<<<<<<<<<<<
 *         if data:
 *             if self.sslobj:
 */
  __Pyx_INCREF(__pyx_v_data);
  __Pyx_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_v_data;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1914
 *         got = 0
 *         buf = data   # TODO(pts): Verify buffer or str (no unicode).
 *         if data:             # <<<<<<<<<<<<<<
 *             if self.sslobj:
 *                 if flags:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_data); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1914; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1915
 *         buf = data   # TODO(pts): Verify buffer or str (no unicode).
 *         if data:
 *             if self.sslobj:             # <<<<<<<<<<<<<<
 *                 if flags:
 *                     raise ValueError(
 */
    __pyx_t_1 = __Pyx_PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1915; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1916
 *         if data:
 *             if self.sslobj:
 *                 if flags:             # <<<<<<<<<<<<<<
 *                     raise ValueError(
 *                         'flags=0 expected for sendall on ' +
 */
      __pyx_t_2 = __pyx_v_flags;
      if (__pyx_t_2) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1919
 *                     raise ValueError(
 *                         'flags=0 expected for sendall on ' +
 *                         str(self.__class__))             # <<<<<<<<<<<<<<
 *                 while 1:
 *                     try:
 */
        __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s____class__); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyNumber_Add(((PyObject *)__pyx_kp_s_20), __pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1918; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1917; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1917; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_Raise(__pyx_t_4, 0, 0);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1917; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1920
 *                         'flags=0 expected for sendall on ' +
 *                         str(self.__class__))
 *                 while 1:             # <<<<<<<<<<<<<<
 *                     try:
 *                         got2 = 0  # Pacify gcc warning.
 */
      while (1) {
        __pyx_t_1 = 1;
        if (!__pyx_t_1) break;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1921
 *                         str(self.__class__))
 *                 while 1:
 *                     try:             # <<<<<<<<<<<<<<
 *                         got2 = 0  # Pacify gcc warning.
 *                         got2 = self.sslobj.write(buf)
 */
        {
          PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
          __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
          __Pyx_XGOTREF(__pyx_save_exc_type);
          __Pyx_XGOTREF(__pyx_save_exc_value);
          __Pyx_XGOTREF(__pyx_save_exc_tb);
          /*try:*/ {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1922
 *                 while 1:
 *                     try:
 *                         got2 = 0  # Pacify gcc warning.             # <<<<<<<<<<<<<<
 *                         got2 = self.sslobj.write(buf)
 *                     except SSLError, e:
 */
            __pyx_v_got2 = 0;

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1923
 *                     try:
 *                         got2 = 0  # Pacify gcc warning.
 *                         got2 = self.sslobj.write(buf)             # <<<<<<<<<<<<<<
 *                     except SSLError, e:
 *                         if e.errno == SSL_ERROR_WANT_READ:
 */
            __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_s__write); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_INCREF(__pyx_v_buf);
            PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_buf);
            __Pyx_GIVEREF(__pyx_v_buf);
            __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_2 = __Pyx_PyInt_AsInt(__pyx_t_5); if (unlikely((__pyx_t_2 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_v_got2 = __pyx_t_2;
          }
          __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
          __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
          __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
          goto __pyx_L18_try_end;
          __pyx_L11_error:;
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1924
 *                         got2 = 0  # Pacify gcc warning.
 *                         got2 = self.sslobj.write(buf)
 *                     except SSLError, e:             # <<<<<<<<<<<<<<
 *                         if e.errno == SSL_ERROR_WANT_READ:
 *                             handle_ssl_eagain(self, c_EV_READ)
 */
          __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_2 = PyErr_ExceptionMatches(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (__pyx_t_2) {
            __Pyx_AddTraceback("coio.nbsslsocket.sendall");
            if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_3, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_v_e);
            __pyx_v_e = __pyx_t_3;

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1925
 *                         got2 = self.sslobj.write(buf)
 *                     except SSLError, e:
 *                         if e.errno == SSL_ERROR_WANT_READ:             # <<<<<<<<<<<<<<
 *                             handle_ssl_eagain(self, c_EV_READ)
 *                         elif e.errno == SSL_ERROR_WANT_WRITE:
 */
            __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1925; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1925; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_GOTREF(__pyx_t_7);
            __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1925; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1925; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (__pyx_t_1) {

              /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1926
 *                     except SSLError, e:
 *                         if e.errno == SSL_ERROR_WANT_READ:
 *                             handle_ssl_eagain(self, c_EV_READ)             # <<<<<<<<<<<<<<
 *                         elif e.errno == SSL_ERROR_WANT_WRITE:
 *                             handle_ssl_eagain(self, c_EV_WRITE)
 */
              __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_READ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              goto __pyx_L21;
            }

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1927
 *                         if e.errno == SSL_ERROR_WANT_READ:
 *                             handle_ssl_eagain(self, c_EV_READ)
 *                         elif e.errno == SSL_ERROR_WANT_WRITE:             # <<<<<<<<<<<<<<
 *                             handle_ssl_eagain(self, c_EV_WRITE)
 *                         else:
 */
            __pyx_t_8 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_GOTREF(__pyx_t_7);
            __pyx_t_6 = PyObject_RichCompare(__pyx_t_8, __pyx_t_7, Py_EQ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            if (__pyx_t_1) {

              /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1928
 *                             handle_ssl_eagain(self, c_EV_READ)
 *                         elif e.errno == SSL_ERROR_WANT_WRITE:
 *                             handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *                         else:
 *                             raise
 */
              __pyx_t_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1928; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
              __Pyx_GOTREF(__pyx_t_6);
              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
              goto __pyx_L21;
            }
            /*else*/ {

              /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1930
 *                             handle_ssl_eagain(self, c_EV_WRITE)
 *                         else:
 *                             raise             # <<<<<<<<<<<<<<
 *                     assert got2 > 0
 *                     got += got2
 */
              __Pyx_GIVEREF(__pyx_t_5);
              __Pyx_GIVEREF(__pyx_t_3);
              __Pyx_GIVEREF(__pyx_t_4);
              __Pyx_ErrRestore(__pyx_t_5, __pyx_t_3, __pyx_t_4);
              __pyx_t_5 = 0; __pyx_t_3 = 0; __pyx_t_4 = 0; 
              {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1930; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
            }
            __pyx_L21:;
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            goto __pyx_L12_exception_handled;
          }
          __pyx_L13_except_error:;
          __Pyx_XGIVEREF(__pyx_save_exc_type);
          __Pyx_XGIVEREF(__pyx_save_exc_value);
          __Pyx_XGIVEREF(__pyx_save_exc_tb);
          __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
          goto __pyx_L1_error;
          __pyx_L12_exception_handled:;
          __Pyx_XGIVEREF(__pyx_save_exc_type);
          __Pyx_XGIVEREF(__pyx_save_exc_value);
          __Pyx_XGIVEREF(__pyx_save_exc_tb);
          __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
          __pyx_L18_try_end:;
        }

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1931
 *                         else:
 *                             raise
 *                     assert got2 > 0             # <<<<<<<<<<<<<<
 *                     got += got2
 *                     if got >= len(data):
 */
        #ifndef PYREX_WITHOUT_ASSERTIONS
        if (unlikely(!(__pyx_v_got2 > 0))) {
          PyErr_SetNone(PyExc_AssertionError);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1931; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #endif

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1932
 *                             raise
 *                     assert got2 > 0
 *                     got += got2             # <<<<<<<<<<<<<<
 *                     if got >= len(data):
 *                         return
 */
        __pyx_v_got += __pyx_v_got2;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1933
 *                     assert got2 > 0
 *                     got += got2
 *                     if got >= len(data):             # <<<<<<<<<<<<<<
 *                         return
 *                     buf = buffer(data, got)
 */
        __pyx_t_9 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_1 = (__pyx_v_got >= __pyx_t_9);
        if (__pyx_t_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1934
 *                     got += got2
 *                     if got >= len(data):
 *                         return             # <<<<<<<<<<<<<<
 *                     buf = buffer(data, got)
 * 
 */
          __Pyx_XDECREF(__pyx_r);
          __pyx_r = Py_None; __Pyx_INCREF(Py_None);
          goto __pyx_L0;
          goto __pyx_L22;
        }
        __pyx_L22:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1935
 *                     if got >= len(data):
 *                         return
 *                     buf = buffer(data, got)             # <<<<<<<<<<<<<<
 * 
 *             while 1:
 */
        __pyx_t_4 = PyInt_FromLong(__pyx_v_got); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_data);
        __Pyx_GIVEREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_4 = PyObject_Call(__pyx_builtin_buffer, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_v_buf);
        __pyx_v_buf = __pyx_t_4;
        __pyx_t_4 = 0;
      }
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1937
 *                     buf = buffer(data, got)
 * 
 *             while 1:             # <<<<<<<<<<<<<<
 *                 try:
 *                     got2 = 0  # Pacify gcc warning.
 */
    while (1) {
      __pyx_t_1 = 1;
      if (!__pyx_t_1) break;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1938
 * 
 *             while 1:
 *                 try:             # <<<<<<<<<<<<<<
 *                     got2 = 0  # Pacify gcc warning.
 *                     got2 = self.realsock.send(buf, flags)
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1939
 *             while 1:
 *                 try:
 *                     got2 = 0  # Pacify gcc warning.             # <<<<<<<<<<<<<<
 *                     got2 = self.realsock.send(buf, flags)
 *                 except socket.error, e:
 */
          __pyx_v_got2 = 0;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1940
 *                 try:
 *                     got2 = 0  # Pacify gcc warning.
 *                     got2 = self.realsock.send(buf, flags)             # <<<<<<<<<<<<<<
 *                 except socket.error, e:
 *                     if e.errno != EAGAIN:
 */
          __pyx_t_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_s__send); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L25_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_3 = PyInt_FromLong(__pyx_v_flags); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L25_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L25_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_INCREF(__pyx_v_buf);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_buf);
          __Pyx_GIVEREF(__pyx_v_buf);
          PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_3);
          __pyx_t_3 = 0;
          __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L25_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_2 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_2 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L25_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_v_got2 = __pyx_t_2;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L32_try_end;
        __pyx_L25_error:;
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1941
 *                     got2 = 0  # Pacify gcc warning.
 *                     got2 = self.realsock.send(buf, flags)
 *                 except socket.error, e:             # <<<<<<<<<<<<<<
 *                     if e.errno != EAGAIN:
 *                         raise
 */
        __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1941; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_5 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__error); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1941; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_2 = PyErr_ExceptionMatches(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_2) {
          __Pyx_AddTraceback("coio.nbsslsocket.sendall");
          if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_3, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1941; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_v_e);
          __pyx_v_e = __pyx_t_3;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1942
 *                     got2 = self.realsock.send(buf, flags)
 *                 except socket.error, e:
 *                     if e.errno != EAGAIN:             # <<<<<<<<<<<<<<
 *                         raise
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 */
          __pyx_t_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_s__errno); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1942; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_7 = PyInt_FromLong(EAGAIN); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1942; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_8 = PyObject_RichCompare(__pyx_t_6, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1942; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1942; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          if (__pyx_t_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1943
 *                 except socket.error, e:
 *                     if e.errno != EAGAIN:
 *                         raise             # <<<<<<<<<<<<<<
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 assert got2 > 0
 */
            __Pyx_GIVEREF(__pyx_t_5);
            __Pyx_GIVEREF(__pyx_t_3);
            __Pyx_GIVEREF(__pyx_t_4);
            __Pyx_ErrRestore(__pyx_t_5, __pyx_t_3, __pyx_t_4);
            __pyx_t_5 = 0; __pyx_t_3 = 0; __pyx_t_4 = 0; 
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1943; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
            goto __pyx_L35;
          }
          __pyx_L35:;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1944
 *                     if e.errno != EAGAIN:
 *                         raise
 *                     handle_ssl_eagain(self, c_EV_WRITE)             # <<<<<<<<<<<<<<
 *                 assert got2 > 0
 *                 got += got2
 */
          __pyx_t_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self), EV_WRITE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1944; __pyx_clineno = __LINE__; goto __pyx_L27_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          goto __pyx_L26_exception_handled;
        }
        __pyx_L27_except_error:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L26_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L32_try_end:;
      }

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1945
 *                         raise
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 assert got2 > 0             # <<<<<<<<<<<<<<
 *                 got += got2
 *                 if got >= len(data):
 */
      #ifndef PYREX_WITHOUT_ASSERTIONS
      if (unlikely(!(__pyx_v_got2 > 0))) {
        PyErr_SetNone(PyExc_AssertionError);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #endif

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1946
 *                     handle_ssl_eagain(self, c_EV_WRITE)
 *                 assert got2 > 0
 *                 got += got2             # <<<<<<<<<<<<<<
 *                 if got >= len(data):
 *                     return
 */
      __pyx_v_got += __pyx_v_got2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1947
 *                 assert got2 > 0
 *                 got += got2
 *                 if got >= len(data):             # <<<<<<<<<<<<<<
 *                     return
 *                 # It's not possible to modify (slice) an existing buffer, so
 */
      __pyx_t_9 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_1 = (__pyx_v_got >= __pyx_t_9);
      if (__pyx_t_1) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1948
 *                 got += got2
 *                 if got >= len(data):
 *                     return             # <<<<<<<<<<<<<<
 *                 # It's not possible to modify (slice) an existing buffer, so
 *                 # we create a new one.
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_r = Py_None; __Pyx_INCREF(Py_None);
        goto __pyx_L0;
        goto __pyx_L36;
      }
      __pyx_L36:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1951
 *                 # It's not possible to modify (slice) an existing buffer, so
 *                 # we create a new one.
 *                 buf = buffer(data, got)             # <<<<<<<<<<<<<<
 * 
 *     def makefile(nbsocket self, mode='r+', int bufsize=-1):
 */
      __pyx_t_4 = PyInt_FromLong(__pyx_v_got); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_data);
      __Pyx_GIVEREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_Call(__pyx_builtin_buffer, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_t_4;
      __pyx_t_4 = 0;
    }
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.nbsslsocket.sendall");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_buf);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_data);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1953
 *                 buf = buffer(data, got)
 * 
 *     def makefile(nbsocket self, mode='r+', int bufsize=-1):             # <<<<<<<<<<<<<<
 *         """Create an nbfile (non-blocking file-like) object from self.
 * 
 */

static PyObject *__pyx_pf_4coio_11nbsslsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_makefile[] = "Create an nbfile (non-blocking file-like) object from self.\n\n        os.dup(self.fd) will be passed to the new nbfile object, and its\n        .close() method will close that file descriptor.\n\n        As of now, the returned file object is slow (uses a pure Python\n        implementation of socket._fileobject).\n\n        Args:\n          mode: 'r', 'w', 'r+' etc. The default is mode'r', just as for\n            socket.socket.makefile.\n        ";
static PyObject *__pyx_pf_4coio_11nbsslsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__mode,&__pyx_n_s__bufsize,0};
  __Pyx_RefNannySetupContext("makefile");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    values[0] = ((PyObject *)__pyx_kp_s_7);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mode);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bufsize);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "makefile") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_mode = values[0];
    if (values[1]) {
      __pyx_v_bufsize = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_bufsize = ((int)-1);
    }
  } else {
    __pyx_v_mode = ((PyObject *)__pyx_kp_s_7);
    __pyx_v_bufsize = ((int)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_bufsize = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_mode = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("makefile", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.nbsslsocket.makefile");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1968
 *         # TODO(pts): Implement .makefile_samefd() using our fast buffering
 *         # (something similar to nbfile).
 *         self.sslsock._makefile_refs += 1             # <<<<<<<<<<<<<<
 *         return socket._fileobject(self, mode, bufsize, close=True)
 * 
 */
  __pyx_t_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___makefile_refs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1968; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_t_1, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1968; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_s___makefile_refs, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1968; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1969
 *         # (something similar to nbfile).
 *         self.sslsock._makefile_refs += 1
 *         return socket._fileobject(self, mode, bufsize, close=True)             # <<<<<<<<<<<<<<
 * 
 * def new_realsocket(*args):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s___fileobject); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyInt_FromLong(__pyx_v_bufsize); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self);
  __Pyx_GIVEREF(__pyx_v_self);
  __Pyx_INCREF(__pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_mode);
  __Pyx_GIVEREF(__pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_4 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__close), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_1, __pyx_t_3, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.nbsslsocket.makefile");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1971
 *         return socket._fileobject(self, mode, bufsize, close=True)
 * 
 * def new_realsocket(*args):             # <<<<<<<<<<<<<<
 *     """Non-blocking drop-in replacement for socket._realsocket.
 * 
 */

static PyObject *__pyx_pf_4coio_new_realsocket(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_new_realsocket[] = "Non-blocking drop-in replacement for socket._realsocket.\n\n    The most important difference between socket.socket and socket._realsocket\n    is that socket._realsocket.close() closes the filehandle immediately,\n    while socket.socket.close() just breaks the reference.\n    ";
static PyObject *__pyx_pf_4coio_new_realsocket(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("new_realsocket");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "new_realsocket", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1978
 *     while socket.socket.close() just breaks the reference.
 *     """
 *     return nbsocket(*args).setdoclose(1)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_nbsocket)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__setdoclose); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.new_realsocket");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1981
 * 
 * 
 * def new_realsocket_fromfd(*args):             # <<<<<<<<<<<<<<
 *     """Non-blocking drop-in replacement for socket.fromfd."""
 *     return nbsocket(socket_fromfd(*args)).setdoclose(1)
 */

static PyObject *__pyx_pf_4coio_new_realsocket_fromfd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_new_realsocket_fromfd[] = "Non-blocking drop-in replacement for socket.fromfd.";
static PyObject *__pyx_pf_4coio_new_realsocket_fromfd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("new_realsocket_fromfd");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "new_realsocket_fromfd", 0))) return NULL;
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1983
 * def new_realsocket_fromfd(*args):
 *     """Non-blocking drop-in replacement for socket.fromfd."""
 *     return nbsocket(socket_fromfd(*args)).setdoclose(1)             # <<<<<<<<<<<<<<
 * 
 * cdef class sleeper:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket_fromfd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_nbsocket)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__setdoclose); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.new_realsocket_fromfd");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1991
 *     cdef event_t wakeup_ev
 * 
 *     def sleep(sleeper self, float duration):             # <<<<<<<<<<<<<<
 *         cdef tasklet wakeup_tasklet
 *         cdef timeval tv
 */

static PyObject *__pyx_pf_4coio_7sleeper_sleep(PyObject *__pyx_v_self, PyObject *__pyx_arg_duration); /*proto*/
static PyObject *__pyx_pf_4coio_7sleeper_sleep(PyObject *__pyx_v_self, PyObject *__pyx_arg_duration) {
  float __pyx_v_duration;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  struct timeval __pyx_v_tv;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("sleep");
  assert(__pyx_arg_duration); {
    __pyx_v_duration = __pyx_PyFloat_AsDouble(__pyx_arg_duration); if (unlikely((__pyx_v_duration == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1991; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.sleeper.sleep");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1994
 *         cdef tasklet wakeup_tasklet
 *         cdef timeval tv
 *         if duration > 0:             # <<<<<<<<<<<<<<
 *             wakeup_tasklet = PyStackless_GetCurrent()
 *             evtimer_set(&self.wakeup_ev, HandleCWakeup, <void*>wakeup_tasklet)
 */
  __pyx_t_1 = (__pyx_v_duration > 0);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1995
 *         cdef timeval tv
 *         if duration > 0:
 *             wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *             evtimer_set(&self.wakeup_ev, HandleCWakeup, <void*>wakeup_tasklet)
 *             event_add(&self.wakeup_ev, NULL)
 */
    __pyx_t_2 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
    __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_2);
    __pyx_t_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1996
 *         if duration > 0:
 *             wakeup_tasklet = PyStackless_GetCurrent()
 *             evtimer_set(&self.wakeup_ev, HandleCWakeup, <void*>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *             event_add(&self.wakeup_ev, NULL)
 *             # TODO(pts): Optimize this for integers.
 */
    evtimer_set((&((struct __pyx_obj_4coio_sleeper *)__pyx_v_self)->wakeup_ev), __pyx_f_4coio_HandleCWakeup, ((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1997
 *             wakeup_tasklet = PyStackless_GetCurrent()
 *             evtimer_set(&self.wakeup_ev, HandleCWakeup, <void*>wakeup_tasklet)
 *             event_add(&self.wakeup_ev, NULL)             # <<<<<<<<<<<<<<
 *             # TODO(pts): Optimize this for integers.
 *             tv.tv_sec = <long>duration
 */
    event_add((&((struct __pyx_obj_4coio_sleeper *)__pyx_v_self)->wakeup_ev), NULL);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1999
 *             event_add(&self.wakeup_ev, NULL)
 *             # TODO(pts): Optimize this for integers.
 *             tv.tv_sec = <long>duration             # <<<<<<<<<<<<<<
 *             tv.tv_usec = <unsigned int>(
 *                 (duration - <float>tv.tv_sec) * 1000000.0)
 */
    __pyx_v_tv.tv_sec = ((long)__pyx_v_duration);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2000
 *             # TODO(pts): Optimize this for integers.
 *             tv.tv_sec = <long>duration
 *             tv.tv_usec = <unsigned int>(             # <<<<<<<<<<<<<<
 *                 (duration - <float>tv.tv_sec) * 1000000.0)
 *             event_add(&self.wakeup_ev, &tv)
 */
    __pyx_v_tv.tv_usec = ((unsigned int)((__pyx_v_duration - ((float)__pyx_v_tv.tv_sec)) * 1000000.0));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2002
 *             tv.tv_usec = <unsigned int>(
 *                 (duration - <float>tv.tv_sec) * 1000000.0)
 *             event_add(&self.wakeup_ev, &tv)             # <<<<<<<<<<<<<<
 *             PyStackless_Schedule(None, 1)  # remove=1
 * 
 */
    event_add((&((struct __pyx_obj_4coio_sleeper *)__pyx_v_self)->wakeup_ev), (&__pyx_v_tv));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2003
 *                 (duration - <float>tv.tv_sec) * 1000000.0)
 *             event_add(&self.wakeup_ev, &tv)
 *             PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 * 
 * def sleep(float duration):
 */
    __pyx_t_2 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2003; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.sleeper.sleep");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2005
 *             PyStackless_Schedule(None, 1)  # remove=1
 * 
 * def sleep(float duration):             # <<<<<<<<<<<<<<
 *     """Non-blocking drop-in replacement for time.sleep."""
 *     # TODO(pts): Reuse existing sleepers (thread-local?) to speed this up.
 */

static PyObject *__pyx_pf_4coio_sleep(PyObject *__pyx_self, PyObject *__pyx_arg_duration); /*proto*/
static char __pyx_doc_4coio_sleep[] = "Non-blocking drop-in replacement for time.sleep.";
static PyObject *__pyx_pf_4coio_sleep(PyObject *__pyx_self, PyObject *__pyx_arg_duration) {
  float __pyx_v_duration;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("sleep");
  __pyx_self = __pyx_self;
  assert(__pyx_arg_duration); {
    __pyx_v_duration = __pyx_PyFloat_AsDouble(__pyx_arg_duration); if (unlikely((__pyx_v_duration == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2005; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.sleep");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2008
 *     """Non-blocking drop-in replacement for time.sleep."""
 *     # TODO(pts): Reuse existing sleepers (thread-local?) to speed this up.
 *     sleeper().sleep(duration)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_sleeper)), ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__sleep); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_duration); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("coio.sleep");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2011
 * 
 * 
 * def fdopen(int fd, mode='r', int bufsize=-1, char do_close=1,             # <<<<<<<<<<<<<<
 *            object name=None):
 *     """Non-blocking, almost drop-in replacement for os.fdopen."""
 */

static PyObject *__pyx_pf_4coio_fdopen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_fdopen[] = "Non-blocking, almost drop-in replacement for os.fdopen.";
static PyObject *__pyx_pf_4coio_fdopen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  char __pyx_v_do_close;
  PyObject *__pyx_v_name = 0;
  int __pyx_v_read_fd;
  int __pyx_v_write_fd;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__fd,&__pyx_n_s__mode,&__pyx_n_s__bufsize,&__pyx_n_s__do_close,&__pyx_n_s__name,0};
  __Pyx_RefNannySetupContext("fdopen");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2012
 * 
 * def fdopen(int fd, mode='r', int bufsize=-1, char do_close=1,
 *            object name=None):             # <<<<<<<<<<<<<<
 *     """Non-blocking, almost drop-in replacement for os.fdopen."""
 *     cdef int read_fd
 */
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[5] = {0,0,0,0,0};
    values[1] = ((PyObject *)__pyx_n_s__r);
    values[4] = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fd);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mode);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
      case  2:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bufsize);
        if (unlikely(value)) { values[2] = value; kw_args--; }
      }
      case  3:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__do_close);
        if (unlikely(value)) { values[3] = value; kw_args--; }
      }
      case  4:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name);
        if (unlikely(value)) { values[4] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "fdopen") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_fd = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_mode = values[1];
    if (values[2]) {
      __pyx_v_bufsize = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_bufsize = ((int)-1);
    }
    if (values[3]) {
      __pyx_v_do_close = __Pyx_PyInt_AsChar(values[3]); if (unlikely((__pyx_v_do_close == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_do_close = ((char)1);
    }
    __pyx_v_name = values[4];
  } else {
    __pyx_v_mode = ((PyObject *)__pyx_n_s__r);
    __pyx_v_bufsize = ((int)-1);
    __pyx_v_do_close = ((char)1);
    __pyx_v_name = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  5: __pyx_v_name = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4: __pyx_v_do_close = __Pyx_PyInt_AsChar(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_do_close == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  3: __pyx_v_bufsize = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_bufsize == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  2: __pyx_v_mode = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: __pyx_v_fd = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_fd == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("fdopen", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.fdopen");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_mode);
  __Pyx_INCREF(__pyx_v_name);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2016
 *     cdef int read_fd
 *     cdef int write_fd
 *     assert fd >= 0             # <<<<<<<<<<<<<<
 *     set_fd_nonblocking(fd)
 *     read_fd = fd
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (unlikely(!(__pyx_v_fd >= 0))) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2016; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2017
 *     cdef int write_fd
 *     assert fd >= 0
 *     set_fd_nonblocking(fd)             # <<<<<<<<<<<<<<
 *     read_fd = fd
 *     write_fd = fd
 */
  __pyx_f_4coio_set_fd_nonblocking(__pyx_v_fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2018
 *     assert fd >= 0
 *     set_fd_nonblocking(fd)
 *     read_fd = fd             # <<<<<<<<<<<<<<
 *     write_fd = fd
 *     # TODO(pts): Handle mode='rb' etc.
 */
  __pyx_v_read_fd = __pyx_v_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2019
 *     set_fd_nonblocking(fd)
 *     read_fd = fd
 *     write_fd = fd             # <<<<<<<<<<<<<<
 *     # TODO(pts): Handle mode='rb' etc.
 *     if mode == 'r':
 */
  __pyx_v_write_fd = __pyx_v_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2021
 *     write_fd = fd
 *     # TODO(pts): Handle mode='rb' etc.
 *     if mode == 'r':             # <<<<<<<<<<<<<<
 *         write_fd = -1
 *     elif mode == 'w':
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__r), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2021; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2021; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2022
 *     # TODO(pts): Handle mode='rb' etc.
 *     if mode == 'r':
 *         write_fd = -1             # <<<<<<<<<<<<<<
 *     elif mode == 'w':
 *         read_fd = -1
 */
    __pyx_v_write_fd = -1;
    goto __pyx_L6;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2023
 *     if mode == 'r':
 *         write_fd = -1
 *     elif mode == 'w':             # <<<<<<<<<<<<<<
 *         read_fd = -1
 *     return nbfile(read_fd, write_fd, write_buffer_limit=bufsize,
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__w), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2023; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2023; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2024
 *         write_fd = -1
 *     elif mode == 'w':
 *         read_fd = -1             # <<<<<<<<<<<<<<
 *     return nbfile(read_fd, write_fd, write_buffer_limit=bufsize,
 *                   do_close=do_close, mode=mode)
 */
    __pyx_v_read_fd = -1;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2025
 *     elif mode == 'w':
 *         read_fd = -1
 *     return nbfile(read_fd, write_fd, write_buffer_limit=bufsize,             # <<<<<<<<<<<<<<
 *                   do_close=do_close, mode=mode)
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(__pyx_v_read_fd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_write_fd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __pyx_t_1 = PyInt_FromLong(__pyx_v_bufsize); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__write_buffer_limit), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":2026
 *         read_fd = -1
 *     return nbfile(read_fd, write_fd, write_buffer_limit=bufsize,
 *                   do_close=do_close, mode=mode)             # <<<<<<<<<<<<<<
 * 
 * # TODO(pts): Add new_file and nbfile(...)
 */
  __pyx_t_1 = PyInt_FromLong(__pyx_v_do_close); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2026; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__do_close), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__mode), __pyx_v_mode) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(((PyObject *)((PyObject*)__pyx_ptype_4coio_nbfile)), __pyx_t_4, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.fdopen");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_mode);
  __Pyx_DECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":103
 * dns_initialized = 0
 * 
 * def dns_init():             # <<<<<<<<<<<<<<
 *     """Initialize async DNS resolver unless already intitialized.
 * 
 */

static PyObject *__pyx_pf_4coio_dns_init(PyObject *__pyx_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_dns_init[] = "Initialize async DNS resolver unless already intitialized.\n\n    The resolver functions call this automatically if needed.    \n    ";
static PyObject *__pyx_pf_4coio_dns_init(PyObject *__pyx_self, PyObject *unused) {
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("dns_init");
  __pyx_self = __pyx_self;
  __pyx_v_dns_initialized = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":108
 *     The resolver functions call this automatically if needed.
 *     """
 *     if not dns_initialized:             # <<<<<<<<<<<<<<
 *         evdns_init()
 *         dns_initialized = 1
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_dns_initialized); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":109
 *     """
 *     if not dns_initialized:
 *         evdns_init()             # <<<<<<<<<<<<<<
 *         dns_initialized = 1
 * 
 */
    evdns_init();

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":110
 *     if not dns_initialized:
 *         evdns_init()
 *         dns_initialized = 1             # <<<<<<<<<<<<<<
 * 
 * def dns_init_force():
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_int_1;
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.dns_init");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_dns_initialized);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":112
 *         dns_initialized = 1
 * 
 * def dns_init_force():             # <<<<<<<<<<<<<<
 *     """Initialize async DNS resolver, force reinit"""
 *     if dns_initialized:
 */

static PyObject *__pyx_pf_4coio_dns_init_force(PyObject *__pyx_self, PyObject *unused); /*proto*/
static char __pyx_doc_4coio_dns_init_force[] = "Initialize async DNS resolver, force reinit";
static PyObject *__pyx_pf_4coio_dns_init_force(PyObject *__pyx_self, PyObject *unused) {
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("dns_init_force");
  __pyx_self = __pyx_self;
  __pyx_v_dns_initialized = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":114
 * def dns_init_force():
 *     """Initialize async DNS resolver, force reinit"""
 *     if dns_initialized:             # <<<<<<<<<<<<<<
 *         evdns_shutdown(1)
 *         dns_initialized = 0
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_dns_initialized); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":115
 *     """Initialize async DNS resolver, force reinit"""
 *     if dns_initialized:
 *         evdns_shutdown(1)             # <<<<<<<<<<<<<<
 *         dns_initialized = 0
 *     evdns_init()
 */
    evdns_shutdown(1);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":116
 *     if dns_initialized:
 *         evdns_shutdown(1)
 *         dns_initialized = 0             # <<<<<<<<<<<<<<
 *     evdns_init()
 *     dns_initialized = 1
 */
    __Pyx_INCREF(__pyx_int_0);
    __Pyx_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_int_0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":117
 *         evdns_shutdown(1)
 *         dns_initialized = 0
 *     evdns_init()             # <<<<<<<<<<<<<<
 *     dns_initialized = 1
 * 
 */
  evdns_init();

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":118
 *         dns_initialized = 0
 *     evdns_init()
 *     dns_initialized = 1             # <<<<<<<<<<<<<<
 * 
 * def dns_shutdown(int fail_requests=1):
 */
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_DECREF(__pyx_v_dns_initialized);
  __pyx_v_dns_initialized = __pyx_int_1;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.dns_init_force");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_dns_initialized);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":120
 *     dns_initialized = 1
 * 
 * def dns_shutdown(int fail_requests=1):             # <<<<<<<<<<<<<<
 *     """Shutdown the async DNS resolver and terminate all active requests."""
 *     if dns_initialized:
 */

static PyObject *__pyx_pf_4coio_dns_shutdown(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_shutdown[] = "Shutdown the async DNS resolver and terminate all active requests.";
static PyObject *__pyx_pf_4coio_dns_shutdown(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fail_requests;
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__fail_requests,0};
  __Pyx_RefNannySetupContext("dns_shutdown");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fail_requests);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "dns_shutdown") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    if (values[0]) {
      __pyx_v_fail_requests = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_fail_requests == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_fail_requests = ((int)1);
    }
  } else {
    __pyx_v_fail_requests = ((int)1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_fail_requests = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_fail_requests == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("dns_shutdown", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.dns_shutdown");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_v_dns_initialized = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":122
 * def dns_shutdown(int fail_requests=1):
 *     """Shutdown the async DNS resolver and terminate all active requests."""
 *     if dns_initialized:             # <<<<<<<<<<<<<<
 *         evdns_shutdown(fail_requests)
 *         dns_initialized = 0
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_dns_initialized); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":123
 *     """Shutdown the async DNS resolver and terminate all active requests."""
 *     if dns_initialized:
 *         evdns_shutdown(fail_requests)             # <<<<<<<<<<<<<<
 *         dns_initialized = 0
 * 
 */
    evdns_shutdown(__pyx_v_fail_requests);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":124
 *     if dns_initialized:
 *         evdns_shutdown(fail_requests)
 *         dns_initialized = 0             # <<<<<<<<<<<<<<
 * 
 * cdef class dnsresult:
 */
    __Pyx_INCREF(__pyx_int_0);
    __Pyx_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_int_0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.dns_shutdown");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_dns_initialized);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":141
 * 
 *     property t:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._t
 * 
 */

static PyObject *__pyx_pf_4coio_9dnsresult_1t___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_9dnsresult_1t___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":142
 *     property t:
 *         def __get__(self):
 *             return self._t             # <<<<<<<<<<<<<<
 * 
 *     property ttl:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.dnsresult.t.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":145
 * 
 *     property ttl:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._ttl
 * 
 */

static PyObject *__pyx_pf_4coio_9dnsresult_3ttl___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_9dnsresult_3ttl___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":146
 *     property ttl:
 *         def __get__(self):
 *             return self._ttl             # <<<<<<<<<<<<<<
 * 
 *     property values:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.dnsresult.ttl.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":149
 * 
 *     property values:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._values
 * 
 */

static PyObject *__pyx_pf_4coio_9dnsresult_6values___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_9dnsresult_6values___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__get__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":150
 *     property values:
 *         def __get__(self):
 *             return self._values             # <<<<<<<<<<<<<<
 * 
 *     def __cinit__(dnsresult self, char t, int ttl, list values):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  __pyx_r = ((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":152
 *             return self._values
 * 
 *     def __cinit__(dnsresult self, char t, int ttl, list values):             # <<<<<<<<<<<<<<
 *         self._t = t
 *         self._ttl = ttl
 */

static int __pyx_pf_4coio_9dnsresult___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_4coio_9dnsresult___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char __pyx_v_t;
  int __pyx_v_ttl;
  PyObject *__pyx_v_values = 0;
  int __pyx_r;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__t,&__pyx_n_s__ttl,&__pyx_n_s__values,0};
  __Pyx_RefNannySetupContext("__cinit__");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[3] = {0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__t);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ttl);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__values);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__cinit__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_t = __Pyx_PyInt_AsChar(values[0]); if (unlikely((__pyx_v_t == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_ttl = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_ttl == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_values = ((PyObject *)values[2]);
  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_t = __Pyx_PyInt_AsChar(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_t == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_ttl = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_ttl == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_values = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 2));
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.dnsresult.__cinit__");
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_values), &PyList_Type, 1, "values", 1))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":153
 * 
 *     def __cinit__(dnsresult self, char t, int ttl, list values):
 *         self._t = t             # <<<<<<<<<<<<<<
 *         self._ttl = ttl
 *         self._values = values
 */
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t = __pyx_v_t;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":154
 *     def __cinit__(dnsresult self, char t, int ttl, list values):
 *         self._t = t
 *         self._ttl = ttl             # <<<<<<<<<<<<<<
 *         self._values = values
 * 
 */
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl = __pyx_v_ttl;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":155
 *         self._t = t
 *         self._ttl = ttl
 *         self._values = values             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(dnsresult self):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_values));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_values));
  __Pyx_GOTREF(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values);
  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values = __pyx_v_values;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("coio.dnsresult.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":157
 *         self._values = values
 * 
 *     def __repr__(dnsresult self):             # <<<<<<<<<<<<<<
 *         return '<dnsresult t=%d, ttl=%d values=%r at 0x%x>' % (
 *             self._t, self._ttl, self._values, <unsigned>self)
 */

static PyObject *__pyx_pf_4coio_9dnsresult___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_4coio_9dnsresult___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  unsigned int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__repr__");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":158
 * 
 *     def __repr__(dnsresult self):
 *         return '<dnsresult t=%d, ttl=%d values=%r at 0x%x>' % (             # <<<<<<<<<<<<<<
 *             self._t, self._ttl, self._values, <unsigned>self)
 * 
 */
  __Pyx_XDECREF(__pyx_r);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":159
 *     def __repr__(dnsresult self):
 *         return '<dnsresult t=%d, ttl=%d values=%r at 0x%x>' % (
 *             self._t, self._ttl, self._values, <unsigned>self)             # <<<<<<<<<<<<<<
 * 
 * cdef object format_ipv6_word(unsigned hi, unsigned lo):
 */
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_AsUnsignedInt(__pyx_v_self); if (unlikely((__pyx_t_3 == (unsigned int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = PyLong_FromUnsignedLong(((unsigned int)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  PyTuple_SET_ITEM(__pyx_t_5, 2, ((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  __Pyx_GIVEREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_21), __pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.dnsresult.__repr__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":161
 *             self._t, self._ttl, self._values, <unsigned>self)
 * 
 * cdef object format_ipv6_word(unsigned hi, unsigned lo):             # <<<<<<<<<<<<<<
 *     lo += hi << 8
 *     if lo:
 */

static  PyObject *__pyx_f_4coio_format_ipv6_word(unsigned int __pyx_v_hi, unsigned int __pyx_v_lo) {
  PyObject *__pyx_r = NULL;
  unsigned int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("format_ipv6_word");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":162
 * 
 * cdef object format_ipv6_word(unsigned hi, unsigned lo):
 *     lo += hi << 8             # <<<<<<<<<<<<<<
 *     if lo:
 *         # TODO(pts): Faster.
 */
  __pyx_v_lo += (__pyx_v_hi << 8);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":163
 * cdef object format_ipv6_word(unsigned hi, unsigned lo):
 *     lo += hi << 8
 *     if lo:             # <<<<<<<<<<<<<<
 *         # TODO(pts): Faster.
 *         return PyString_FromFormat(<char_constp>'%x', lo)
 */
  __pyx_t_1 = __pyx_v_lo;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":165
 *     if lo:
 *         # TODO(pts): Faster.
 *         return PyString_FromFormat(<char_constp>'%x', lo)             # <<<<<<<<<<<<<<
 *     else:
 *         return ''
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyString_FromFormat(((char const *)__pyx_kp_s_22), __pyx_v_lo); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":167
 *         return PyString_FromFormat(<char_constp>'%x', lo)
 *     else:
 *         return ''             # <<<<<<<<<<<<<<
 * 
 * class DnsLookupError(IOError):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
    __pyx_r = ((PyObject *)__pyx_kp_s_5);
    goto __pyx_L0;
  }
  __pyx_L3:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("coio.format_ipv6_word");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":175
 *     pass
 * 
 * cdef void _dns_callback(int resultcode, char t, int count, int ttl,             # <<<<<<<<<<<<<<
 *                         void *addrs, void *arg) with gil:
 *     cdef object exc
 */

static  void __pyx_f_4coio__dns_callback(int __pyx_v_resultcode, char __pyx_v_t, int __pyx_v_count, int __pyx_v_ttl, void *__pyx_v_addrs, void *__pyx_v_arg) {
  PyObject *__pyx_v_exc;
  int __pyx_v_i;
  unsigned char *__pyx_v_p;
  PyObject *__pyx_v_xlist;
  PyObject *__pyx_v_x;
  PyObject *__pyx_v_words;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyGILState_STATE _save = PyGILState_Ensure();
  __Pyx_RefNannySetupContext("_dns_callback");
  __pyx_v_exc = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_xlist = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_x = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_words = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":182
 *     cdef list xlist
 * 
 *     if resultcode:  # not c_DNS_ERR_NONE:             # <<<<<<<<<<<<<<
 *         # Make it negative to prevent confusion with errno objects,
 *         # just like socket.gaierror (gethostbyname).
 */
  __pyx_t_1 = __pyx_v_resultcode;
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":185
 *         # Make it negative to prevent confusion with errno objects,
 *         # just like socket.gaierror (gethostbyname).
 *         exc = DnsLookupError(-resultcode, evdns_err_to_string(resultcode))             # <<<<<<<<<<<<<<
 *         (<tasklet>arg).tempval = bomb(
 *             type(exc), exc, None)
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyInt_FromLong((-__pyx_v_resultcode)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyBytes_FromString(evdns_err_to_string(__pyx_v_resultcode)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_v_exc);
    __pyx_v_exc = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":187
 *         exc = DnsLookupError(-resultcode, evdns_err_to_string(resultcode))
 *         (<tasklet>arg).tempval = bomb(
 *             type(exc), exc, None)             # <<<<<<<<<<<<<<
 *         PyTasklet_Insert(<tasklet>arg)
 *         return
 */
    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(((PyObject *)Py_TYPE(__pyx_v_exc)));
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)Py_TYPE(__pyx_v_exc)));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(__pyx_v_exc)));
    __Pyx_INCREF(__pyx_v_exc);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_exc);
    __Pyx_GIVEREF(__pyx_v_exc);
    __Pyx_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_4, 2, Py_None);
    __Pyx_GIVEREF(Py_None);
    __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_bomb)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":186
 *         # just like socket.gaierror (gethostbyname).
 *         exc = DnsLookupError(-resultcode, evdns_err_to_string(resultcode))
 *         (<tasklet>arg).tempval = bomb(             # <<<<<<<<<<<<<<
 *             type(exc), exc, None)
 *         PyTasklet_Insert(<tasklet>arg)
 */
    __Pyx_GIVEREF(__pyx_t_5);
    __Pyx_GOTREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    __Pyx_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":188
 *         (<tasklet>arg).tempval = bomb(
 *             type(exc), exc, None)
 *         PyTasklet_Insert(<tasklet>arg)             # <<<<<<<<<<<<<<
 *         return
 *     if t == c_DNS_IPv4_A and count > 0:
 */
    __pyx_t_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":189
 *             type(exc), exc, None)
 *         PyTasklet_Insert(<tasklet>arg)
 *         return             # <<<<<<<<<<<<<<
 *     if t == c_DNS_IPv4_A and count > 0:
 *         xlist = []
 */
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":190
 *         PyTasklet_Insert(<tasklet>arg)
 *         return
 *     if t == c_DNS_IPv4_A and count > 0:             # <<<<<<<<<<<<<<
 *         xlist = []
 *         p = <unsigned char*>addrs
 */
  __pyx_t_6 = (__pyx_v_t == DNS_IPv4_A);
  if (__pyx_t_6) {
    __pyx_t_7 = (__pyx_v_count > 0);
    __pyx_t_8 = __pyx_t_7;
  } else {
    __pyx_t_8 = __pyx_t_6;
  }
  if (__pyx_t_8) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":191
 *         return
 *     if t == c_DNS_IPv4_A and count > 0:
 *         xlist = []             # <<<<<<<<<<<<<<
 *         p = <unsigned char*>addrs
 *         for i from 0 <= i < count:
 */
    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __Pyx_DECREF(((PyObject *)__pyx_v_xlist));
    __pyx_v_xlist = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":192
 *     if t == c_DNS_IPv4_A and count > 0:
 *         xlist = []
 *         p = <unsigned char*>addrs             # <<<<<<<<<<<<<<
 *         for i from 0 <= i < count:
 *             # TODO(pts): Replace all % by PyString_FromFormat.
 */
    __pyx_v_p = ((unsigned char *)__pyx_v_addrs);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":193
 *         xlist = []
 *         p = <unsigned char*>addrs
 *         for i from 0 <= i < count:             # <<<<<<<<<<<<<<
 *             # TODO(pts): Replace all % by PyString_FromFormat.
 *             xlist.append(PyString_FromFormat(
 */
    __pyx_t_1 = __pyx_v_count;
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_1; __pyx_v_i++) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":195
 *         for i from 0 <= i < count:
 *             # TODO(pts): Replace all % by PyString_FromFormat.
 *             xlist.append(PyString_FromFormat(             # <<<<<<<<<<<<<<
 *                 <char_constp>'%d.%d.%d.%d', p[0], p[1], p[2], p[3]))
 *             p += 4
 */
      if (unlikely(__pyx_v_xlist == Py_None)) {
        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
      }

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":196
 *             # TODO(pts): Replace all % by PyString_FromFormat.
 *             xlist.append(PyString_FromFormat(
 *                 <char_constp>'%d.%d.%d.%d', p[0], p[1], p[2], p[3]))             # <<<<<<<<<<<<<<
 *             p += 4
 *         x = xlist
 */
      __pyx_t_5 = PyString_FromFormat(((char const *)__pyx_kp_s_23), (__pyx_v_p[0]), (__pyx_v_p[1]), (__pyx_v_p[2]), (__pyx_v_p[3])); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_9 = PyList_Append(((PyObject *)__pyx_v_xlist), __pyx_t_5); if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":197
 *             xlist.append(PyString_FromFormat(
 *                 <char_constp>'%d.%d.%d.%d', p[0], p[1], p[2], p[3]))
 *             p += 4             # <<<<<<<<<<<<<<
 *         x = xlist
 *     elif t == c_DNS_IPv6_AAAA and count > 0:
 */
      __pyx_v_p += 4;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":198
 *                 <char_constp>'%d.%d.%d.%d', p[0], p[1], p[2], p[3]))
 *             p += 4
 *         x = xlist             # <<<<<<<<<<<<<<
 *     elif t == c_DNS_IPv6_AAAA and count > 0:
 *         xlist = []
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_xlist));
    __Pyx_DECREF(__pyx_v_x);
    __pyx_v_x = ((PyObject *)__pyx_v_xlist);
    goto __pyx_L4;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":199
 *             p += 4
 *         x = xlist
 *     elif t == c_DNS_IPv6_AAAA and count > 0:             # <<<<<<<<<<<<<<
 *         xlist = []
 *         p = <unsigned char*>addrs
 */
  __pyx_t_8 = (__pyx_v_t == DNS_IPv6_AAAA);
  if (__pyx_t_8) {
    __pyx_t_6 = (__pyx_v_count > 0);
    __pyx_t_7 = __pyx_t_6;
  } else {
    __pyx_t_7 = __pyx_t_8;
  }
  if (__pyx_t_7) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":200
 *         x = xlist
 *     elif t == c_DNS_IPv6_AAAA and count > 0:
 *         xlist = []             # <<<<<<<<<<<<<<
 *         p = <unsigned char*>addrs
 *         for i from 0 <= i < count:
 */
    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __Pyx_DECREF(((PyObject *)__pyx_v_xlist));
    __pyx_v_xlist = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":201
 *     elif t == c_DNS_IPv6_AAAA and count > 0:
 *         xlist = []
 *         p = <unsigned char*>addrs             # <<<<<<<<<<<<<<
 *         for i from 0 <= i < count:
 *             words = [format_ipv6_word(p[0], p[1]),
 */
    __pyx_v_p = ((unsigned char *)__pyx_v_addrs);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":202
 *         xlist = []
 *         p = <unsigned char*>addrs
 *         for i from 0 <= i < count:             # <<<<<<<<<<<<<<
 *             words = [format_ipv6_word(p[0], p[1]),
 *                      format_ipv6_word(p[2], p[3]),
 */
    __pyx_t_1 = __pyx_v_count;
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_1; __pyx_v_i++) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":203
 *         p = <unsigned char*>addrs
 *         for i from 0 <= i < count:
 *             words = [format_ipv6_word(p[0], p[1]),             # <<<<<<<<<<<<<<
 *                      format_ipv6_word(p[2], p[3]),
 *                      format_ipv6_word(p[4], p[5]),
 */
      __pyx_t_5 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[0]), (__pyx_v_p[1])); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":204
 *         for i from 0 <= i < count:
 *             words = [format_ipv6_word(p[0], p[1]),
 *                      format_ipv6_word(p[2], p[3]),             # <<<<<<<<<<<<<<
 *                      format_ipv6_word(p[4], p[5]),
 *                      format_ipv6_word(p[6], p[7]),
 */
      __pyx_t_4 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[2]), (__pyx_v_p[3])); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":205
 *             words = [format_ipv6_word(p[0], p[1]),
 *                      format_ipv6_word(p[2], p[3]),
 *                      format_ipv6_word(p[4], p[5]),             # <<<<<<<<<<<<<<
 *                      format_ipv6_word(p[6], p[7]),
 *                      format_ipv6_word(p[8], p[9]),
 */
      __pyx_t_2 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[4]), (__pyx_v_p[5])); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":206
 *                      format_ipv6_word(p[2], p[3]),
 *                      format_ipv6_word(p[4], p[5]),
 *                      format_ipv6_word(p[6], p[7]),             # <<<<<<<<<<<<<<
 *                      format_ipv6_word(p[8], p[9]),
 *                      format_ipv6_word(p[10], p[11]),
 */
      __pyx_t_3 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[6]), (__pyx_v_p[7])); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":207
 *                      format_ipv6_word(p[4], p[5]),
 *                      format_ipv6_word(p[6], p[7]),
 *                      format_ipv6_word(p[8], p[9]),             # <<<<<<<<<<<<<<
 *                      format_ipv6_word(p[10], p[11]),
 *                      format_ipv6_word(p[12], p[13]),
 */
      __pyx_t_10 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[8]), (__pyx_v_p[9])); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":208
 *                      format_ipv6_word(p[6], p[7]),
 *                      format_ipv6_word(p[8], p[9]),
 *                      format_ipv6_word(p[10], p[11]),             # <<<<<<<<<<<<<<
 *                      format_ipv6_word(p[12], p[13]),
 *                      format_ipv6_word(p[14], p[15])]
 */
      __pyx_t_11 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[10]), (__pyx_v_p[11])); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":209
 *                      format_ipv6_word(p[8], p[9]),
 *                      format_ipv6_word(p[10], p[11]),
 *                      format_ipv6_word(p[12], p[13]),             # <<<<<<<<<<<<<<
 *                      format_ipv6_word(p[14], p[15])]
 *             p += 16
 */
      __pyx_t_12 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[12]), (__pyx_v_p[13])); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":210
 *                      format_ipv6_word(p[10], p[11]),
 *                      format_ipv6_word(p[12], p[13]),
 *                      format_ipv6_word(p[14], p[15])]             # <<<<<<<<<<<<<<
 *             p += 16
 *             xlist.append(':'.join(words))
 */
      __pyx_t_13 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[14]), (__pyx_v_p[15])); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_13);
      __pyx_t_14 = PyList_New(8); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_14));
      PyList_SET_ITEM(__pyx_t_14, 0, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      PyList_SET_ITEM(__pyx_t_14, 1, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyList_SET_ITEM(__pyx_t_14, 2, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      PyList_SET_ITEM(__pyx_t_14, 3, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      PyList_SET_ITEM(__pyx_t_14, 4, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyList_SET_ITEM(__pyx_t_14, 5, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_11);
      PyList_SET_ITEM(__pyx_t_14, 6, __pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_12);
      PyList_SET_ITEM(__pyx_t_14, 7, __pyx_t_13);
      __Pyx_GIVEREF(__pyx_t_13);
      __pyx_t_5 = 0;
      __pyx_t_4 = 0;
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_10 = 0;
      __pyx_t_11 = 0;
      __pyx_t_12 = 0;
      __pyx_t_13 = 0;
      __Pyx_DECREF(__pyx_v_words);
      __pyx_v_words = ((PyObject *)__pyx_t_14);
      __pyx_t_14 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":211
 *                      format_ipv6_word(p[12], p[13]),
 *                      format_ipv6_word(p[14], p[15])]
 *             p += 16             # <<<<<<<<<<<<<<
 *             xlist.append(':'.join(words))
 *         x = xlist
 */
      __pyx_v_p += 16;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":212
 *                      format_ipv6_word(p[14], p[15])]
 *             p += 16
 *             xlist.append(':'.join(words))             # <<<<<<<<<<<<<<
 *         x = xlist
 *     elif t == c_DNS_PTR and count == 1:  # only 1 PTR possible, for reverse
 */
      if (unlikely(__pyx_v_xlist == Py_None)) {
        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
      }
      __pyx_t_14 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_24), __pyx_n_s__join); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_14);
      __pyx_t_13 = PyTuple_New(1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_13);
      __Pyx_INCREF(__pyx_v_words);
      PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_v_words);
      __Pyx_GIVEREF(__pyx_v_words);
      __pyx_t_12 = PyObject_Call(__pyx_t_14, __pyx_t_13, NULL); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      __pyx_t_9 = PyList_Append(((PyObject *)__pyx_v_xlist), __pyx_t_12); if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":213
 *             p += 16
 *             xlist.append(':'.join(words))
 *         x = xlist             # <<<<<<<<<<<<<<
 *     elif t == c_DNS_PTR and count == 1:  # only 1 PTR possible, for reverse
 *         x = [PyString_FromString((<char_constp*>addrs)[0])]
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_xlist));
    __Pyx_DECREF(__pyx_v_x);
    __pyx_v_x = ((PyObject *)__pyx_v_xlist);
    goto __pyx_L4;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":214
 *             xlist.append(':'.join(words))
 *         x = xlist
 *     elif t == c_DNS_PTR and count == 1:  # only 1 PTR possible, for reverse             # <<<<<<<<<<<<<<
 *         x = [PyString_FromString((<char_constp*>addrs)[0])]
 *     else:
 */
  __pyx_t_7 = (__pyx_v_t == DNS_PTR);
  if (__pyx_t_7) {
    __pyx_t_8 = (__pyx_v_count == 1);
    __pyx_t_6 = __pyx_t_8;
  } else {
    __pyx_t_6 = __pyx_t_7;
  }
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":215
 *         x = xlist
 *     elif t == c_DNS_PTR and count == 1:  # only 1 PTR possible, for reverse
 *         x = [PyString_FromString((<char_constp*>addrs)[0])]             # <<<<<<<<<<<<<<
 *     else:
 *         x = None
 */
    __pyx_t_12 = PyString_FromString((((char const* *)__pyx_v_addrs)[0])); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_13));
    PyList_SET_ITEM(__pyx_t_13, 0, __pyx_t_12);
    __Pyx_GIVEREF(__pyx_t_12);
    __pyx_t_12 = 0;
    __Pyx_DECREF(__pyx_v_x);
    __pyx_v_x = ((PyObject *)__pyx_t_13);
    __pyx_t_13 = 0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":217
 *         x = [PyString_FromString((<char_constp*>addrs)[0])]
 *     else:
 *         x = None             # <<<<<<<<<<<<<<
 *     if x is None:
 *         (<tasklet>arg).tempval = bomb(
 */
    __Pyx_INCREF(Py_None);
    __Pyx_DECREF(__pyx_v_x);
    __pyx_v_x = Py_None;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":218
 *     else:
 *         x = None
 *     if x is None:             # <<<<<<<<<<<<<<
 *         (<tasklet>arg).tempval = bomb(
 *             DnsResultParseError, 'unknown type', None)
 */
  __pyx_t_6 = (__pyx_v_x == Py_None);
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":220
 *     if x is None:
 *         (<tasklet>arg).tempval = bomb(
 *             DnsResultParseError, 'unknown type', None)             # <<<<<<<<<<<<<<
 *     else:
 *         (<tasklet>arg).tempval = dnsresult(t, ttl, x)
 */
    __pyx_t_13 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsResultParseError); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_13);
    __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_13);
    __Pyx_GIVEREF(__pyx_t_13);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_25));
    PyTuple_SET_ITEM(__pyx_t_12, 1, ((PyObject *)__pyx_kp_s_25));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_25));
    __Pyx_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_12, 2, Py_None);
    __Pyx_GIVEREF(Py_None);
    __pyx_t_13 = 0;
    __pyx_t_13 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_bomb)), __pyx_t_12, NULL); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_13);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":219
 *         x = None
 *     if x is None:
 *         (<tasklet>arg).tempval = bomb(             # <<<<<<<<<<<<<<
 *             DnsResultParseError, 'unknown type', None)
 *     else:
 */
    __Pyx_GIVEREF(__pyx_t_13);
    __Pyx_GOTREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    __Pyx_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_t_13;
    __pyx_t_13 = 0;
    goto __pyx_L9;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":222
 *             DnsResultParseError, 'unknown type', None)
 *     else:
 *         (<tasklet>arg).tempval = dnsresult(t, ttl, x)             # <<<<<<<<<<<<<<
 *     PyTasklet_Insert(<tasklet>arg)
 * 
 */
    __pyx_t_13 = PyInt_FromLong(__pyx_v_t); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_13);
    __pyx_t_12 = PyInt_FromLong(__pyx_v_ttl); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_14);
    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13);
    __Pyx_GIVEREF(__pyx_t_13);
    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_12);
    __Pyx_GIVEREF(__pyx_t_12);
    __Pyx_INCREF(__pyx_v_x);
    PyTuple_SET_ITEM(__pyx_t_14, 2, __pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    __pyx_t_13 = 0;
    __pyx_t_12 = 0;
    __pyx_t_12 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4coio_dnsresult)), __pyx_t_14, NULL); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_GIVEREF(__pyx_t_12);
    __Pyx_GOTREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    __Pyx_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_t_12;
    __pyx_t_12 = 0;
  }
  __pyx_L9:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":223
 *     else:
 *         (<tasklet>arg).tempval = dnsresult(t, ttl, x)
 *     PyTasklet_Insert(<tasklet>arg)             # <<<<<<<<<<<<<<
 * 
 * cdef char is_valid_hex_digit(char p):
 */
  __pyx_t_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_WriteUnraisable("coio._dns_callback");
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_exc);
  __Pyx_DECREF(__pyx_v_xlist);
  __Pyx_DECREF(__pyx_v_x);
  __Pyx_DECREF(__pyx_v_words);
  __Pyx_RefNannyFinishContext();
  PyGILState_Release(_save);
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":225
 *     PyTasklet_Insert(<tasklet>arg)
 * 
 * cdef char is_valid_hex_digit(char p):             # <<<<<<<<<<<<<<
 *     if p >= c'0' and p <= c'9':
 *         return 1
 */

static  char __pyx_f_4coio_is_valid_hex_digit(char __pyx_v_p) {
  char __pyx_r;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("is_valid_hex_digit");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":226
 * 
 * cdef char is_valid_hex_digit(char p):
 *     if p >= c'0' and p <= c'9':             # <<<<<<<<<<<<<<
 *         return 1
 *     elif p >= c'a' and p <= c'f':
 */
  __pyx_t_1 = (__pyx_v_p >= '0');
  if (__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_p <= '9');
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":227
 * cdef char is_valid_hex_digit(char p):
 *     if p >= c'0' and p <= c'9':
 *         return 1             # <<<<<<<<<<<<<<
 *     elif p >= c'a' and p <= c'f':
 *         return 1
 */
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L3;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":228
 *     if p >= c'0' and p <= c'9':
 *         return 1
 *     elif p >= c'a' and p <= c'f':             # <<<<<<<<<<<<<<
 *         return 1
 *     elif p >= c'A' and p <= c'F':
 */
  __pyx_t_3 = (__pyx_v_p >= 'a');
  if (__pyx_t_3) {
    __pyx_t_1 = (__pyx_v_p <= 'f');
    __pyx_t_2 = __pyx_t_1;
  } else {
    __pyx_t_2 = __pyx_t_3;
  }
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":229
 *         return 1
 *     elif p >= c'a' and p <= c'f':
 *         return 1             # <<<<<<<<<<<<<<
 *     elif p >= c'A' and p <= c'F':
 *         return 1
 */
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L3;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":230
 *     elif p >= c'a' and p <= c'f':
 *         return 1
 *     elif p >= c'A' and p <= c'F':             # <<<<<<<<<<<<<<
 *         return 1
 *     else:
 */
  __pyx_t_2 = (__pyx_v_p >= 'A');
  if (__pyx_t_2) {
    __pyx_t_3 = (__pyx_v_p <= 'F');
    __pyx_t_1 = __pyx_t_3;
  } else {
    __pyx_t_1 = __pyx_t_2;
  }
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":231
 *         return 1
 *     elif p >= c'A' and p <= c'F':
 *         return 1             # <<<<<<<<<<<<<<
 *     else:
 *         return 0
 */
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":233
 *         return 1
 *     else:
 *         return 0             # <<<<<<<<<<<<<<
 * 
 * cdef char is_valid_ipv6(char *p):
 */
    __pyx_r = 0;
    goto __pyx_L0;
  }
  __pyx_L3:;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":235
 *         return 0
 * 
 * cdef char is_valid_ipv6(char *p):             # <<<<<<<<<<<<<<
 *     # TODO(pts): Parse properly, according to
 *     # http://en.wikipedia.org/wiki/IPv6_address
 */

static  char __pyx_f_4coio_is_valid_ipv6(char *__pyx_v_p) {
  int __pyx_v_i;
  char __pyx_r;
  int __pyx_t_1;
  char __pyx_t_2;
  __Pyx_RefNannySetupContext("is_valid_ipv6");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":240
 *     # ::, ::1, ff02::2,
 *     cdef int i
 *     if not is_valid_hex_digit(p[0]):             # <<<<<<<<<<<<<<
 *         return 0  # as far as socket.gethostbyaddr is concerned
 *     for i from 1 <= i < 8:
 */
  __pyx_t_1 = (!__pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0])));
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":241
 *     cdef int i
 *     if not is_valid_hex_digit(p[0]):
 *         return 0  # as far as socket.gethostbyaddr is concerned             # <<<<<<<<<<<<<<
 *     for i from 1 <= i < 8:
 *         while is_valid_hex_digit(p[0]):
 */
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":242
 *     if not is_valid_hex_digit(p[0]):
 *         return 0  # as far as socket.gethostbyaddr is concerned
 *     for i from 1 <= i < 8:             # <<<<<<<<<<<<<<
 *         while is_valid_hex_digit(p[0]):
 *             p += 1
 */
  for (__pyx_v_i = 1; __pyx_v_i < 8; __pyx_v_i++) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":243
 *         return 0  # as far as socket.gethostbyaddr is concerned
 *     for i from 1 <= i < 8:
 *         while is_valid_hex_digit(p[0]):             # <<<<<<<<<<<<<<
 *             p += 1
 *         if p[0] != c':':
 */
    while (1) {
      __pyx_t_2 = __pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0]));
      if (!__pyx_t_2) break;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":244
 *     for i from 1 <= i < 8:
 *         while is_valid_hex_digit(p[0]):
 *             p += 1             # <<<<<<<<<<<<<<
 *         if p[0] != c':':
 *             return 0
 */
      __pyx_v_p += 1;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":245
 *         while is_valid_hex_digit(p[0]):
 *             p += 1
 *         if p[0] != c':':             # <<<<<<<<<<<<<<
 *             return 0
 *         p += 1
 */
    __pyx_t_1 = ((__pyx_v_p[0]) != ':');
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":246
 *             p += 1
 *         if p[0] != c':':
 *             return 0             # <<<<<<<<<<<<<<
 *         p += 1
 *     while is_valid_hex_digit(p[0]):
 */
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":247
 *         if p[0] != c':':
 *             return 0
 *         p += 1             # <<<<<<<<<<<<<<
 *     while is_valid_hex_digit(p[0]):
 *         p += 1
 */
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":248
 *             return 0
 *         p += 1
 *     while is_valid_hex_digit(p[0]):             # <<<<<<<<<<<<<<
 *         p += 1
 *     return p[0] == c'\0'
 */
  while (1) {
    __pyx_t_2 = __pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0]));
    if (!__pyx_t_2) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":249
 *         p += 1
 *     while is_valid_hex_digit(p[0]):
 *         p += 1             # <<<<<<<<<<<<<<
 *     return p[0] == c'\0'
 * 
 */
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":250
 *     while is_valid_hex_digit(p[0]):
 *         p += 1
 *     return p[0] == c'\0'             # <<<<<<<<<<<<<<
 * 
 * cdef char is_valid_ipv4(char *p):
 */
  __pyx_r = ((__pyx_v_p[0]) == '\x00');
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":252
 *     return p[0] == c'\0'
 * 
 * cdef char is_valid_ipv4(char *p):             # <<<<<<<<<<<<<<
 *     cdef int i
 *     for i from 1 <= i < 4:
 */

static  char __pyx_f_4coio_is_valid_ipv4(char *__pyx_v_p) {
  int __pyx_v_i;
  char __pyx_r;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("is_valid_ipv4");

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":254
 * cdef char is_valid_ipv4(char *p):
 *     cdef int i
 *     for i from 1 <= i < 4:             # <<<<<<<<<<<<<<
 *         if p[0] < c'0' or p[0] > c'9':
 *             return 0
 */
  for (__pyx_v_i = 1; __pyx_v_i < 4; __pyx_v_i++) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":255
 *     cdef int i
 *     for i from 1 <= i < 4:
 *         if p[0] < c'0' or p[0] > c'9':             # <<<<<<<<<<<<<<
 *             return 0
 *         p += 1
 */
    __pyx_t_1 = ((__pyx_v_p[0]) < '0');
    if (!__pyx_t_1) {
      __pyx_t_2 = ((__pyx_v_p[0]) > '9');
      __pyx_t_3 = __pyx_t_2;
    } else {
      __pyx_t_3 = __pyx_t_1;
    }
    if (__pyx_t_3) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":256
 *     for i from 1 <= i < 4:
 *         if p[0] < c'0' or p[0] > c'9':
 *             return 0             # <<<<<<<<<<<<<<
 *         p += 1
 *         while p[0] >= c'0' and p[0] <= c'9':
 */
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":257
 *         if p[0] < c'0' or p[0] > c'9':
 *             return 0
 *         p += 1             # <<<<<<<<<<<<<<
 *         while p[0] >= c'0' and p[0] <= c'9':
 *             p += 1
 */
    __pyx_v_p += 1;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":258
 *             return 0
 *         p += 1
 *         while p[0] >= c'0' and p[0] <= c'9':             # <<<<<<<<<<<<<<
 *             p += 1
 *         if p[0] != c'.':
 */
    while (1) {
      __pyx_t_3 = ((__pyx_v_p[0]) >= '0');
      if (__pyx_t_3) {
        __pyx_t_1 = ((__pyx_v_p[0]) <= '9');
        __pyx_t_2 = __pyx_t_1;
      } else {
        __pyx_t_2 = __pyx_t_3;
      }
      if (!__pyx_t_2) break;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":259
 *         p += 1
 *         while p[0] >= c'0' and p[0] <= c'9':
 *             p += 1             # <<<<<<<<<<<<<<
 *         if p[0] != c'.':
 *             return 0
 */
      __pyx_v_p += 1;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":260
 *         while p[0] >= c'0' and p[0] <= c'9':
 *             p += 1
 *         if p[0] != c'.':             # <<<<<<<<<<<<<<
 *             return 0
 *         p += 1
 */
    __pyx_t_2 = ((__pyx_v_p[0]) != '.');
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":261
 *             p += 1
 *         if p[0] != c'.':
 *             return 0             # <<<<<<<<<<<<<<
 *         p += 1
 *     if p[0] < c'0' or p[0] > c'9':
 */
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":262
 *         if p[0] != c'.':
 *             return 0
 *         p += 1             # <<<<<<<<<<<<<<
 *     if p[0] < c'0' or p[0] > c'9':
 *         return 0
 */
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":263
 *             return 0
 *         p += 1
 *     if p[0] < c'0' or p[0] > c'9':             # <<<<<<<<<<<<<<
 *         return 0
 *     p += 1
 */
  __pyx_t_2 = ((__pyx_v_p[0]) < '0');
  if (!__pyx_t_2) {
    __pyx_t_3 = ((__pyx_v_p[0]) > '9');
    __pyx_t_1 = __pyx_t_3;
  } else {
    __pyx_t_1 = __pyx_t_2;
  }
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":264
 *         p += 1
 *     if p[0] < c'0' or p[0] > c'9':
 *         return 0             # <<<<<<<<<<<<<<
 *     p += 1
 *     while p[0] >= c'0' and p[0] <= c'9':
 */
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":265
 *     if p[0] < c'0' or p[0] > c'9':
 *         return 0
 *     p += 1             # <<<<<<<<<<<<<<
 *     while p[0] >= c'0' and p[0] <= c'9':
 *         p += 1
 */
  __pyx_v_p += 1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":266
 *         return 0
 *     p += 1
 *     while p[0] >= c'0' and p[0] <= c'9':             # <<<<<<<<<<<<<<
 *         p += 1
 *     return p[0] == c'\0'
 */
  while (1) {
    __pyx_t_1 = ((__pyx_v_p[0]) >= '0');
    if (__pyx_t_1) {
      __pyx_t_2 = ((__pyx_v_p[0]) <= '9');
      __pyx_t_3 = __pyx_t_2;
    } else {
      __pyx_t_3 = __pyx_t_1;
    }
    if (!__pyx_t_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":267
 *     p += 1
 *     while p[0] >= c'0' and p[0] <= c'9':
 *         p += 1             # <<<<<<<<<<<<<<
 *     return p[0] == c'\0'
 * 
 */
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":268
 *     while p[0] >= c'0' and p[0] <= c'9':
 *         p += 1
 *     return p[0] == c'\0'             # <<<<<<<<<<<<<<
 * 
 * cdef dnsresult dns_call(_evdns_call_t call, char_constp name, int flags):
 */
  __pyx_r = ((__pyx_v_p[0]) == '\x00');
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":270
 *     return p[0] == c'\0'
 * 
 * cdef dnsresult dns_call(_evdns_call_t call, char_constp name, int flags):             # <<<<<<<<<<<<<<
 *     cdef tasklet wakeup_tasklet
 *     cdef object tempval
 */

static  struct __pyx_obj_4coio_dnsresult *__pyx_f_4coio_dns_call(__pyx_t_4coio__evdns_call_t __pyx_v_call, char const* __pyx_v_name, int __pyx_v_flags) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_v_tempval;
  int __pyx_v_result;
  struct __pyx_obj_4coio_dnsresult *__pyx_v_dnsresult_obj;
  PyObject *__pyx_v_dns_initialized;
  struct __pyx_obj_4coio_dnsresult *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("dns_call");
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_tempval = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_dnsresult_obj = ((struct __pyx_obj_4coio_dnsresult *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_dns_initialized = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":275
 *     cdef int result
 *     cdef dnsresult dnsresult_obj
 *     if not dns_initialized:             # <<<<<<<<<<<<<<
 *         evdns_init()
 *         dns_initialized = 1
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_dns_initialized); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":276
 *     cdef dnsresult dnsresult_obj
 *     if not dns_initialized:
 *         evdns_init()             # <<<<<<<<<<<<<<
 *         dns_initialized = 1
 *     wakeup_tasklet = PyStackless_GetCurrent()
 */
    evdns_init();

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":277
 *     if not dns_initialized:
 *         evdns_init()
 *         dns_initialized = 1             # <<<<<<<<<<<<<<
 *     wakeup_tasklet = PyStackless_GetCurrent()
 *     wakeup_tasklet.tempval = None
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_int_1;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":278
 *         evdns_init()
 *         dns_initialized = 1
 *     wakeup_tasklet = PyStackless_GetCurrent()             # <<<<<<<<<<<<<<
 *     wakeup_tasklet.tempval = None
 *     result = call(name, flags, _dns_callback, <void*>wakeup_tasklet)
 */
  __pyx_t_3 = ((PyObject *)PyStackless_GetCurrent()); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":279
 *         dns_initialized = 1
 *     wakeup_tasklet = PyStackless_GetCurrent()
 *     wakeup_tasklet.tempval = None             # <<<<<<<<<<<<<<
 *     result = call(name, flags, _dns_callback, <void*>wakeup_tasklet)
 *     if result:
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_wakeup_tasklet->tempval);
  __Pyx_DECREF(__pyx_v_wakeup_tasklet->tempval);
  __pyx_v_wakeup_tasklet->tempval = Py_None;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":280
 *     wakeup_tasklet = PyStackless_GetCurrent()
 *     wakeup_tasklet.tempval = None
 *     result = call(name, flags, _dns_callback, <void*>wakeup_tasklet)             # <<<<<<<<<<<<<<
 *     if result:
 *         raise DnsLookupError(-result, evdns_err_to_string(result))
 */
  __pyx_v_result = __pyx_v_call(__pyx_v_name, __pyx_v_flags, __pyx_f_4coio__dns_callback, ((void *)__pyx_v_wakeup_tasklet));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":281
 *     wakeup_tasklet.tempval = None
 *     result = call(name, flags, _dns_callback, <void*>wakeup_tasklet)
 *     if result:             # <<<<<<<<<<<<<<
 *         raise DnsLookupError(-result, evdns_err_to_string(result))
 *     if wakeup_tasklet.tempval is None:
 */
  __pyx_t_4 = __pyx_v_result;
  if (__pyx_t_4) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":282
 *     result = call(name, flags, _dns_callback, <void*>wakeup_tasklet)
 *     if result:
 *         raise DnsLookupError(-result, evdns_err_to_string(result))             # <<<<<<<<<<<<<<
 *     if wakeup_tasklet.tempval is None:
 *         tempval = PyStackless_Schedule(None, 1)  # remove=1
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = PyInt_FromLong((-__pyx_v_result)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyBytes_FromString(evdns_err_to_string(__pyx_v_result)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_6));
    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_7, 1, ((PyObject *)__pyx_t_6));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_Raise(__pyx_t_6, 0, 0);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":283
 *     if result:
 *         raise DnsLookupError(-result, evdns_err_to_string(result))
 *     if wakeup_tasklet.tempval is None:             # <<<<<<<<<<<<<<
 *         tempval = PyStackless_Schedule(None, 1)  # remove=1
 *     else:  # Not a single wait was needed.
 */
  __pyx_t_2 = (__pyx_v_wakeup_tasklet->tempval == Py_None);
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":284
 *         raise DnsLookupError(-result, evdns_err_to_string(result))
 *     if wakeup_tasklet.tempval is None:
 *         tempval = PyStackless_Schedule(None, 1)  # remove=1             # <<<<<<<<<<<<<<
 *     else:  # Not a single wait was needed.
 *         # TODO(pts): Test this.
 */
    __pyx_t_6 = PyStackless_Schedule(Py_None, 1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_v_tempval);
    __pyx_v_tempval = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":287
 *     else:  # Not a single wait was needed.
 *         # TODO(pts): Test this.
 *         tempval = wakeup_tasklet.tempval             # <<<<<<<<<<<<<<
 *         wakeup_tasklet.tempval = None
 *         if isinstance(tempval, bomb):
 */
    __Pyx_INCREF(__pyx_v_wakeup_tasklet->tempval);
    __Pyx_DECREF(__pyx_v_tempval);
    __pyx_v_tempval = __pyx_v_wakeup_tasklet->tempval;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":288
 *         # TODO(pts): Test this.
 *         tempval = wakeup_tasklet.tempval
 *         wakeup_tasklet.tempval = None             # <<<<<<<<<<<<<<
 *         if isinstance(tempval, bomb):
 *             raise tempval.type, tempval.value, tempval.traceback
 */
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    __Pyx_GOTREF(__pyx_v_wakeup_tasklet->tempval);
    __Pyx_DECREF(__pyx_v_wakeup_tasklet->tempval);
    __pyx_v_wakeup_tasklet->tempval = Py_None;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":289
 *         tempval = wakeup_tasklet.tempval
 *         wakeup_tasklet.tempval = None
 *         if isinstance(tempval, bomb):             # <<<<<<<<<<<<<<
 *             raise tempval.type, tempval.value, tempval.traceback
 *     dnsresult_obj = tempval
 */
    __pyx_t_2 = PyObject_TypeCheck(__pyx_v_tempval, ((PyTypeObject *)((PyObject*)__pyx_ptype_4coio_bomb))); 
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":290
 *         wakeup_tasklet.tempval = None
 *         if isinstance(tempval, bomb):
 *             raise tempval.type, tempval.value, tempval.traceback             # <<<<<<<<<<<<<<
 *     dnsresult_obj = tempval
 *     if call == &evdns_resolve_ipv4:
 */
      __pyx_t_6 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_s__type); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_s__value); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_s__traceback); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_Raise(__pyx_t_6, __pyx_t_7, __pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":291
 *         if isinstance(tempval, bomb):
 *             raise tempval.type, tempval.value, tempval.traceback
 *     dnsresult_obj = tempval             # <<<<<<<<<<<<<<
 *     if call == &evdns_resolve_ipv4:
 *         if dnsresult_obj.t != c_DNS_IPv4_A:
 */
  if (!(likely(((__pyx_v_tempval) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_tempval, __pyx_ptype_4coio_dnsresult))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_INCREF(__pyx_v_tempval);
  __Pyx_DECREF(((PyObject *)__pyx_v_dnsresult_obj));
  __pyx_v_dnsresult_obj = ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_tempval);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":292
 *             raise tempval.type, tempval.value, tempval.traceback
 *     dnsresult_obj = tempval
 *     if call == &evdns_resolve_ipv4:             # <<<<<<<<<<<<<<
 *         if dnsresult_obj.t != c_DNS_IPv4_A:
 *              raise DnsResultParseError('bad type for ipv4')
 */
  __pyx_t_2 = (__pyx_v_call == (&evdns_resolve_ipv4));
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":293
 *     dnsresult_obj = tempval
 *     if call == &evdns_resolve_ipv4:
 *         if dnsresult_obj.t != c_DNS_IPv4_A:             # <<<<<<<<<<<<<<
 *              raise DnsResultParseError('bad type for ipv4')
 *     elif call == &evdns_resolve_ipv6:
 */
    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_s__t); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = PyInt_FromLong(DNS_IPv4_A); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = PyObject_RichCompare(__pyx_t_3, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":294
 *     if call == &evdns_resolve_ipv4:
 *         if dnsresult_obj.t != c_DNS_IPv4_A:
 *              raise DnsResultParseError('bad type for ipv4')             # <<<<<<<<<<<<<<
 *     elif call == &evdns_resolve_ipv6:
 *         if dnsresult_obj.t != c_DNS_IPv6_AAAA:
 */
      __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsResultParseError); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_26));
      PyTuple_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_kp_s_26));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_26));
      __pyx_t_3 = PyObject_Call(__pyx_t_6, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L8;
    }
    __pyx_L8:;
    goto __pyx_L7;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":295
 *         if dnsresult_obj.t != c_DNS_IPv4_A:
 *              raise DnsResultParseError('bad type for ipv4')
 *     elif call == &evdns_resolve_ipv6:             # <<<<<<<<<<<<<<
 *         if dnsresult_obj.t != c_DNS_IPv6_AAAA:
 *              raise DnsResultParseError('bad type for ipv6')
 */
  __pyx_t_2 = (__pyx_v_call == (&evdns_resolve_ipv6));
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":296
 *              raise DnsResultParseError('bad type for ipv4')
 *     elif call == &evdns_resolve_ipv6:
 *         if dnsresult_obj.t != c_DNS_IPv6_AAAA:             # <<<<<<<<<<<<<<
 *              raise DnsResultParseError('bad type for ipv6')
 *     elif (call == <_evdns_call_t>evdns_resolve_reverse or
 */
    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_s__t); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = PyInt_FromLong(DNS_IPv6_AAAA); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = PyObject_RichCompare(__pyx_t_3, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":297
 *     elif call == &evdns_resolve_ipv6:
 *         if dnsresult_obj.t != c_DNS_IPv6_AAAA:
 *              raise DnsResultParseError('bad type for ipv6')             # <<<<<<<<<<<<<<
 *     elif (call == <_evdns_call_t>evdns_resolve_reverse or
 *           call == <_evdns_call_t>evdns_resolve_reverse_ipv6):
 */
      __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsResultParseError); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_27));
      PyTuple_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_kp_s_27));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_27));
      __pyx_t_3 = PyObject_Call(__pyx_t_6, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L9;
    }
    __pyx_L9:;
    goto __pyx_L7;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":298
 *         if dnsresult_obj.t != c_DNS_IPv6_AAAA:
 *              raise DnsResultParseError('bad type for ipv6')
 *     elif (call == <_evdns_call_t>evdns_resolve_reverse or             # <<<<<<<<<<<<<<
 *           call == <_evdns_call_t>evdns_resolve_reverse_ipv6):
 *         if dnsresult_obj.t != c_DNS_PTR:
 */
  __pyx_t_2 = (__pyx_v_call == ((int (*)(char const*, int, evdns_callback_type, void *))evdns_resolve_reverse));
  if (!__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":299
 *              raise DnsResultParseError('bad type for ipv6')
 *     elif (call == <_evdns_call_t>evdns_resolve_reverse or
 *           call == <_evdns_call_t>evdns_resolve_reverse_ipv6):             # <<<<<<<<<<<<<<
 *         if dnsresult_obj.t != c_DNS_PTR:
 *              raise DnsResultParseError('bad type for reverse')
 */
    __pyx_t_1 = (__pyx_v_call == ((int (*)(char const*, int, evdns_callback_type, void *))evdns_resolve_reverse_ipv6));
    __pyx_t_8 = __pyx_t_1;
  } else {
    __pyx_t_8 = __pyx_t_2;
  }
  if (__pyx_t_8) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":300
 *     elif (call == <_evdns_call_t>evdns_resolve_reverse or
 *           call == <_evdns_call_t>evdns_resolve_reverse_ipv6):
 *         if dnsresult_obj.t != c_DNS_PTR:             # <<<<<<<<<<<<<<
 *              raise DnsResultParseError('bad type for reverse')
 *     return dnsresult_obj
 */
    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_s__t); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = PyInt_FromLong(DNS_PTR); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = PyObject_RichCompare(__pyx_t_3, __pyx_t_7, Py_NE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_8) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":301
 *           call == <_evdns_call_t>evdns_resolve_reverse_ipv6):
 *         if dnsresult_obj.t != c_DNS_PTR:
 *              raise DnsResultParseError('bad type for reverse')             # <<<<<<<<<<<<<<
 *     return dnsresult_obj
 * 
 */
      __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsResultParseError); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_28));
      PyTuple_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_kp_s_28));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_28));
      __pyx_t_3 = PyObject_Call(__pyx_t_6, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L10;
    }
    __pyx_L10:;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":302
 *         if dnsresult_obj.t != c_DNS_PTR:
 *              raise DnsResultParseError('bad type for reverse')
 *     return dnsresult_obj             # <<<<<<<<<<<<<<
 * 
 * def dns_resolve_ipv4(char *name, int flags=0):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_dnsresult_obj));
  __pyx_r = __pyx_v_dnsresult_obj;
  goto __pyx_L0;

  __pyx_r = ((struct __pyx_obj_4coio_dnsresult *)Py_None); __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("coio.dns_call");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_wakeup_tasklet);
  __Pyx_DECREF(__pyx_v_tempval);
  __Pyx_DECREF((PyObject *)__pyx_v_dnsresult_obj);
  __Pyx_DECREF(__pyx_v_dns_initialized);
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":304
 *     return dnsresult_obj
 * 
 * def dns_resolve_ipv4(char *name, int flags=0):             # <<<<<<<<<<<<<<
 *     """Lookup an A record (IPV4) for a given name.
 * 
 */

static PyObject *__pyx_pf_4coio_dns_resolve_ipv4(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_ipv4[] = "Lookup an A record (IPV4) for a given name.\n\n    Args:\n      name     -- DNS hostname\n      flags    -- either 0 (default) or DNS_QUERY_NO_SEARCH\n    Returns:\n      A dnsresult() object.\n    ";
static PyObject *__pyx_pf_4coio_dns_resolve_ipv4(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  int __pyx_v_flags;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,&__pyx_n_s__flags,0};
  __Pyx_RefNannySetupContext("dns_resolve_ipv4");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "dns_resolve_ipv4") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_name = __Pyx_PyBytes_AsString(values[0]); if (unlikely((!__pyx_v_name) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (values[1]) {
      __pyx_v_flags = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_flags = ((int)0);
    }
  } else {
    __pyx_v_flags = ((int)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_flags = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_name = __Pyx_PyBytes_AsString(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((!__pyx_v_name) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("dns_resolve_ipv4", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.dns_resolve_ipv4");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":313
 *       A dnsresult() object.
 *     """
 *     return dns_call(evdns_resolve_ipv4, <char_constp>name, flags)             # <<<<<<<<<<<<<<
 * 
 * def dns_resolve_ipv6(char *name, int flags=0):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = ((PyObject *)__pyx_f_4coio_dns_call(evdns_resolve_ipv4, ((char const *)__pyx_v_name), __pyx_v_flags)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.dns_resolve_ipv4");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":315
 *     return dns_call(evdns_resolve_ipv4, <char_constp>name, flags)
 * 
 * def dns_resolve_ipv6(char *name, int flags=0):             # <<<<<<<<<<<<<<
 *     """Lookup an AAAA record (IPV6) for a given name.
 * 
 */

static PyObject *__pyx_pf_4coio_dns_resolve_ipv6(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_ipv6[] = "Lookup an AAAA record (IPV6) for a given name.\n\n    Args:\n      name     -- DNS hostname\n      flags    -- either 0 (default) or DNS_QUERY_NO_SEARCH\n    Returns:\n      A dnsresult() object.\n    ";
static PyObject *__pyx_pf_4coio_dns_resolve_ipv6(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  int __pyx_v_flags;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,&__pyx_n_s__flags,0};
  __Pyx_RefNannySetupContext("dns_resolve_ipv6");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "dns_resolve_ipv6") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_name = __Pyx_PyBytes_AsString(values[0]); if (unlikely((!__pyx_v_name) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (values[1]) {
      __pyx_v_flags = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_flags = ((int)0);
    }
  } else {
    __pyx_v_flags = ((int)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_flags = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_name = __Pyx_PyBytes_AsString(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((!__pyx_v_name) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("dns_resolve_ipv6", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.dns_resolve_ipv6");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":324
 *       A dnsresult() object.
 *     """
 *     return dns_call(evdns_resolve_ipv6, <char_constp>name, flags)             # <<<<<<<<<<<<<<
 * 
 * def dns_resolve_reverse(object ip, int flags=0):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = ((PyObject *)__pyx_f_4coio_dns_call(evdns_resolve_ipv6, ((char const *)__pyx_v_name), __pyx_v_flags)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("coio.dns_resolve_ipv6");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":326
 *     return dns_call(evdns_resolve_ipv6, <char_constp>name, flags)
 * 
 * def dns_resolve_reverse(object ip, int flags=0):             # <<<<<<<<<<<<<<
 *     """Lookup a PTR record for a given IPv4 address.
 * 
 */

static PyObject *__pyx_pf_4coio_dns_resolve_reverse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_reverse[] = "Lookup a PTR record for a given IPv4 address.\n\n    Arguments:\n\n    ip       -- IPv4 or IPv6 address in ASCII\n    flags    -- either 0 (default) or DNS_QUERY_NO_SEARCH\n    ";
static PyObject *__pyx_pf_4coio_dns_resolve_reverse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ip = 0;
  int __pyx_v_flags;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_tmp;
  char *__pyx_v_p;
  int __pyx_v_i;
  int __pyx_v_j;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  char *__pyx_t_7;
  char __pyx_t_8;
  int __pyx_t_9;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__ip,&__pyx_n_s__flags,0};
  __Pyx_RefNannySetupContext("dns_resolve_reverse");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ip);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "dns_resolve_reverse") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_ip = values[0];
    if (values[1]) {
      __pyx_v_flags = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_flags = ((int)0);
    }
  } else {
    __pyx_v_flags = ((int)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_flags = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_ip = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("dns_resolve_reverse", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.dns_resolve_reverse");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_ip);
  __pyx_v_items = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_tmp = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":339
 *     cdef int i
 *     cdef int j
 *     if not isinstance(ip, str):             # <<<<<<<<<<<<<<
 *         raise TypeError('ip must be a string')
 *     if '.' in ip:  # TODO(pts): Faster, for strings.
 */
  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_ip, ((PyTypeObject *)((PyObject*)&PyString_Type))); 
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":340
 *     cdef int j
 *     if not isinstance(ip, str):
 *         raise TypeError('ip must be a string')             # <<<<<<<<<<<<<<
 *     if '.' in ip:  # TODO(pts): Faster, for strings.
 *        items = ip.split('.')
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_29));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_s_29));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_29));
    __pyx_t_4 = PyObject_Call(__pyx_builtin_TypeError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":341
 *     if not isinstance(ip, str):
 *         raise TypeError('ip must be a string')
 *     if '.' in ip:  # TODO(pts): Faster, for strings.             # <<<<<<<<<<<<<<
 *        items = ip.split('.')
 *        if len(items) != 4:
 */
  __pyx_t_2 = ((PySequence_Contains(__pyx_v_ip, ((PyObject *)__pyx_kp_s_30)))); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":342
 *         raise TypeError('ip must be a string')
 *     if '.' in ip:  # TODO(pts): Faster, for strings.
 *        items = ip.split('.')             # <<<<<<<<<<<<<<
 *        if len(items) != 4:
 *            raise ValueError('bad ipv4 address')
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_ip, __pyx_n_s__split); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_30));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_s_30));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_30));
    __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (!(likely(PyList_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_5)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_items));
    __pyx_v_items = ((PyObject *)__pyx_t_5);
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":343
 *     if '.' in ip:  # TODO(pts): Faster, for strings.
 *        items = ip.split('.')
 *        if len(items) != 4:             # <<<<<<<<<<<<<<
 *            raise ValueError('bad ipv4 address')
 *        tmp = PyString_FromStringAndSize(NULL, 4)
 */
    __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_items)); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = (__pyx_t_6 != 4);
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":344
 *        items = ip.split('.')
 *        if len(items) != 4:
 *            raise ValueError('bad ipv4 address')             # <<<<<<<<<<<<<<
 *        tmp = PyString_FromStringAndSize(NULL, 4)
 *        p = tmp
 */
      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_31));
      PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_s_31));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_31));
      __pyx_t_3 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":345
 *        if len(items) != 4:
 *            raise ValueError('bad ipv4 address')
 *        tmp = PyString_FromStringAndSize(NULL, 4)             # <<<<<<<<<<<<<<
 *        p = tmp
 *        for i from 0 <= i < 4:
 */
    __pyx_t_3 = PyString_FromStringAndSize(NULL, 4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_v_tmp);
    __pyx_v_tmp = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":346
 *            raise ValueError('bad ipv4 address')
 *        tmp = PyString_FromStringAndSize(NULL, 4)
 *        p = tmp             # <<<<<<<<<<<<<<
 *        for i from 0 <= i < 4:
 *            # This also ValueError. TODO(pts): Proper parsing.
 */
    __pyx_t_7 = __Pyx_PyBytes_AsString(__pyx_v_tmp); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_p = __pyx_t_7;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":347
 *        tmp = PyString_FromStringAndSize(NULL, 4)
 *        p = tmp
 *        for i from 0 <= i < 4:             # <<<<<<<<<<<<<<
 *            # This also ValueError. TODO(pts): Proper parsing.
 *            p[i] = PyInt_FromString(items[i], NULL, 10)
 */
    for (__pyx_v_i = 0; __pyx_v_i < 4; __pyx_v_i++) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":349
 *        for i from 0 <= i < 4:
 *            # This also ValueError. TODO(pts): Proper parsing.
 *            p[i] = PyInt_FromString(items[i], NULL, 10)             # <<<<<<<<<<<<<<
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse,
 *                        <char_constp>p, flags)
 */
      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_items), __pyx_v_i, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyBytes_AsString(__pyx_t_3); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyInt_FromString(__pyx_t_7, NULL, 10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = __Pyx_PyInt_AsChar(__pyx_t_3); if (unlikely((__pyx_t_8 == (char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      (__pyx_v_p[__pyx_v_i]) = __pyx_t_8;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":350
 *            # This also ValueError. TODO(pts): Proper parsing.
 *            p[i] = PyInt_FromString(items[i], NULL, 10)
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse,             # <<<<<<<<<<<<<<
 *                        <char_constp>p, flags)
 *     elif ':' in ip:  # TODO(pts): Faster, for strings.
 */
    __Pyx_XDECREF(__pyx_r);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":351
 *            p[i] = PyInt_FromString(items[i], NULL, 10)
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse,
 *                        <char_constp>p, flags)             # <<<<<<<<<<<<<<
 *     elif ':' in ip:  # TODO(pts): Faster, for strings.
 *        items = ip.split(':')
 */
    __pyx_t_3 = ((PyObject *)__pyx_f_4coio_dns_call(((int (*)(char const*, int, evdns_callback_type, void *))evdns_resolve_reverse), ((char const *)__pyx_v_p), __pyx_v_flags)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 350; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":352
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse,
 *                        <char_constp>p, flags)
 *     elif ':' in ip:  # TODO(pts): Faster, for strings.             # <<<<<<<<<<<<<<
 *        items = ip.split(':')
 *        if len(items) != 8:
 */
  __pyx_t_2 = ((PySequence_Contains(__pyx_v_ip, ((PyObject *)__pyx_kp_s_24)))); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":353
 *                        <char_constp>p, flags)
 *     elif ':' in ip:  # TODO(pts): Faster, for strings.
 *        items = ip.split(':')             # <<<<<<<<<<<<<<
 *        if len(items) != 8:
 *            raise ValueError('bad ipv6 address')
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_ip, __pyx_n_s__split); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_24));
    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_s_24));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_24));
    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(PyList_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_4)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_items));
    __pyx_v_items = ((PyObject *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":354
 *     elif ':' in ip:  # TODO(pts): Faster, for strings.
 *        items = ip.split(':')
 *        if len(items) != 8:             # <<<<<<<<<<<<<<
 *            raise ValueError('bad ipv6 address')
 *        tmp = PyString_FromStringAndSize(NULL, 16)
 */
    __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_items)); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = (__pyx_t_6 != 8);
    if (__pyx_t_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":355
 *        items = ip.split(':')
 *        if len(items) != 8:
 *            raise ValueError('bad ipv6 address')             # <<<<<<<<<<<<<<
 *        tmp = PyString_FromStringAndSize(NULL, 16)
 *        p = tmp
 */
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_32));
      PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_32));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_32));
      __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L11;
    }
    __pyx_L11:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":356
 *        if len(items) != 8:
 *            raise ValueError('bad ipv6 address')
 *        tmp = PyString_FromStringAndSize(NULL, 16)             # <<<<<<<<<<<<<<
 *        p = tmp
 *        for i from 0 <= i < 8:
 */
    __pyx_t_5 = PyString_FromStringAndSize(NULL, 16); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_v_tmp);
    __pyx_v_tmp = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":357
 *            raise ValueError('bad ipv6 address')
 *        tmp = PyString_FromStringAndSize(NULL, 16)
 *        p = tmp             # <<<<<<<<<<<<<<
 *        for i from 0 <= i < 8:
 *            # This also ValueError. TODO(pts): Proper parsing.
 */
    __pyx_t_7 = __Pyx_PyBytes_AsString(__pyx_v_tmp); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_p = __pyx_t_7;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":358
 *        tmp = PyString_FromStringAndSize(NULL, 16)
 *        p = tmp
 *        for i from 0 <= i < 8:             # <<<<<<<<<<<<<<
 *            # This also ValueError. TODO(pts): Proper parsing.
 *            j = PyInt_FromString(items[i], NULL, 16)
 */
    for (__pyx_v_i = 0; __pyx_v_i < 8; __pyx_v_i++) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":360
 *        for i from 0 <= i < 8:
 *            # This also ValueError. TODO(pts): Proper parsing.
 *            j = PyInt_FromString(items[i], NULL, 16)             # <<<<<<<<<<<<<<
 *            p[i * 2] = j >> 8
 *            p[i * 2 + 1] = j & 255
 */
      __pyx_t_5 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_items), __pyx_v_i, sizeof(int), PyInt_FromLong); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = __Pyx_PyBytes_AsString(__pyx_t_5); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyInt_FromString(__pyx_t_7, NULL, 16); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_t_5); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_v_j = __pyx_t_9;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":361
 *            # This also ValueError. TODO(pts): Proper parsing.
 *            j = PyInt_FromString(items[i], NULL, 16)
 *            p[i * 2] = j >> 8             # <<<<<<<<<<<<<<
 *            p[i * 2 + 1] = j & 255
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse_ipv6,
 */
      (__pyx_v_p[(__pyx_v_i * 2)]) = (__pyx_v_j >> 8);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":362
 *            j = PyInt_FromString(items[i], NULL, 16)
 *            p[i * 2] = j >> 8
 *            p[i * 2 + 1] = j & 255             # <<<<<<<<<<<<<<
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse_ipv6,
 *                        <char_constp>p, flags)
 */
      (__pyx_v_p[((__pyx_v_i * 2) + 1)]) = (__pyx_v_j & 255);
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":363
 *            p[i * 2] = j >> 8
 *            p[i * 2 + 1] = j & 255
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse_ipv6,             # <<<<<<<<<<<<<<
 *                        <char_constp>p, flags)
 *     else:
 */
    __Pyx_XDECREF(__pyx_r);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":364
 *            p[i * 2 + 1] = j & 255
 *        return dns_call(<_evdns_call_t>evdns_resolve_reverse_ipv6,
 *                        <char_constp>p, flags)             # <<<<<<<<<<<<<<
 *     else:
 *         raise ValueError('unknown ip address syntax')
 */
    __pyx_t_5 = ((PyObject *)__pyx_f_4coio_dns_call(((int (*)(char const*, int, evdns_callback_type, void *))evdns_resolve_reverse_ipv6), ((char const *)__pyx_v_p), __pyx_v_flags)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":366
 *                        <char_constp>p, flags)
 *     else:
 *         raise ValueError('unknown ip address syntax')             # <<<<<<<<<<<<<<
 * 
 * # --- socket.gethostbyname etc. emulations
 */
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_33));
    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_s_33));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_33));
    __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_L7:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("coio.dns_resolve_reverse");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_items);
  __Pyx_DECREF(__pyx_v_tmp);
  __Pyx_DECREF(__pyx_v_ip);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":377
 * 
 * # TODO(pts): Move this to pure Python to save memory and disk space.
 * def read_etc_hosts(filename='/etc/hosts', f=None):             # <<<<<<<<<<<<<<
 *     """Load IPv4 addresses and hostnames from /etc/hosts.
 * 
 */

static PyObject *__pyx_pf_4coio_read_etc_hosts(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_read_etc_hosts[] = "Load IPv4 addresses and hostnames from /etc/hosts.\n\n    Data already loaded to names_by_ip and names_by_nameip is not overridden.\n\n    Raises:\n      IOError:\n    ";
static PyObject *__pyx_pf_4coio_read_etc_hosts(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_filename = 0;
  PyObject *__pyx_v_f = 0;
  PyObject *__pyx_v_line;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_v_name;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  char *__pyx_t_10;
  char __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__filename,&__pyx_n_s__f,0};
  __Pyx_RefNannySetupContext("read_etc_hosts");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    values[0] = ((PyObject *)__pyx_kp_s_34);
    values[1] = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__filename);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
      case  1:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__f);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "read_etc_hosts") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_filename = values[0];
    __pyx_v_f = values[1];
  } else {
    __pyx_v_filename = ((PyObject *)__pyx_kp_s_34);
    __pyx_v_f = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_f = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: __pyx_v_filename = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("read_etc_hosts", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.read_etc_hosts");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_filename);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_v_line = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_items = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_ip = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_name = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":385
 *       IOError:
 *     """
 *     if f is None:             # <<<<<<<<<<<<<<
 *         f = open(filename)
 *     try:
 */
  __pyx_t_1 = (__pyx_v_f == Py_None);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":386
 *     """
 *     if f is None:
 *         f = open(filename)             # <<<<<<<<<<<<<<
 *     try:
 *         for line in f:
 */
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_filename);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_filename);
    __Pyx_GIVEREF(__pyx_v_filename);
    __pyx_t_3 = PyObject_Call(__pyx_builtin_open, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_f);
    __pyx_v_f = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":387
 *     if f is None:
 *         f = open(filename)
 *     try:             # <<<<<<<<<<<<<<
 *         for line in f:
 *             items = line.strip().split()
 */
  /*try:*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":388
 *         f = open(filename)
 *     try:
 *         for line in f:             # <<<<<<<<<<<<<<
 *             items = line.strip().split()
 *             if len(items) > 1 and not items[0].startswith('#'):
 */
    if (PyList_CheckExact(__pyx_v_f) || PyTuple_CheckExact(__pyx_v_f)) {
      __pyx_t_4 = 0; __pyx_t_3 = __pyx_v_f; __Pyx_INCREF(__pyx_t_3);
    } else {
      __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_f); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 388; __pyx_clineno = __LINE__; goto __pyx_L8;}
      __Pyx_GOTREF(__pyx_t_3);
    }
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++;
      } else {
        __pyx_t_2 = PyIter_Next(__pyx_t_3);
        if (!__pyx_t_2) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 388; __pyx_clineno = __LINE__; goto __pyx_L8;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      __Pyx_DECREF(__pyx_v_line);
      __pyx_v_line = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":389
 *     try:
 *         for line in f:
 *             items = line.strip().split()             # <<<<<<<<<<<<<<
 *             if len(items) > 1 and not items[0].startswith('#'):
 *                 ip = items[0]
 */
      __pyx_t_2 = PyObject_GetAttr(__pyx_v_line, __pyx_n_s__strip); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L8;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L8;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__split); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L8;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L8;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_v_items);
      __pyx_v_items = __pyx_t_5;
      __pyx_t_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":390
 *         for line in f:
 *             items = line.strip().split()
 *             if len(items) > 1 and not items[0].startswith('#'):             # <<<<<<<<<<<<<<
 *                 ip = items[0]
 *                 if is_valid_ipv4(ip):  # TODO(pts): Support IPv6 addresses.
 */
      __pyx_t_6 = PyObject_Length(__pyx_v_items); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L8;}
      __pyx_t_1 = (__pyx_t_6 > 1);
      if (__pyx_t_1) {
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_items, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L8;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_2 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__startswith); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L8;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L8;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(((PyObject *)__pyx_kp_s_35));
        PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_s_35));
        __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_35));
        __pyx_t_7 = PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L8;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L8;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_9 = (!__pyx_t_8);
        __pyx_t_8 = __pyx_t_9;
      } else {
        __pyx_t_8 = __pyx_t_1;
      }
      if (__pyx_t_8) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":391
 *             items = line.strip().split()
 *             if len(items) > 1 and not items[0].startswith('#'):
 *                 ip = items[0]             # <<<<<<<<<<<<<<
 *                 if is_valid_ipv4(ip):  # TODO(pts): Support IPv6 addresses.
 *                     # TODO(pts): Normalize IP address in items[0].
 */
        __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_items, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L8;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_v_ip);
        __pyx_v_ip = __pyx_t_7;
        __pyx_t_7 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":392
 *             if len(items) > 1 and not items[0].startswith('#'):
 *                 ip = items[0]
 *                 if is_valid_ipv4(ip):  # TODO(pts): Support IPv6 addresses.             # <<<<<<<<<<<<<<
 *                     # TODO(pts): Normalize IP address in items[0].
 *                     names_by_ip.setdefault(ip, items)
 */
        __pyx_t_10 = __Pyx_PyBytes_AsString(__pyx_v_ip); if (unlikely((!__pyx_t_10) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L8;}
        __pyx_t_11 = __pyx_f_4coio_is_valid_ipv4(__pyx_t_10);
        if (__pyx_t_11) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":394
 *                 if is_valid_ipv4(ip):  # TODO(pts): Support IPv6 addresses.
 *                     # TODO(pts): Normalize IP address in items[0].
 *                     names_by_ip.setdefault(ip, items)             # <<<<<<<<<<<<<<
 *                     names_by_nameip.setdefault(ip, items)
 *                     for name in items:
 */
          __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_ip); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_5 = PyObject_GetAttr(__pyx_t_7, __pyx_n_s__setdefault); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_INCREF(__pyx_v_ip);
          PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_ip);
          __Pyx_GIVEREF(__pyx_v_ip);
          __Pyx_INCREF(__pyx_v_items);
          PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_items);
          __Pyx_GIVEREF(__pyx_v_items);
          __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":395
 *                     # TODO(pts): Normalize IP address in items[0].
 *                     names_by_ip.setdefault(ip, items)
 *                     names_by_nameip.setdefault(ip, items)             # <<<<<<<<<<<<<<
 *                     for name in items:
 *                         names_by_nameip.setdefault(name, items)
 */
          __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_7 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__setdefault); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_INCREF(__pyx_v_ip);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_ip);
          __Pyx_GIVEREF(__pyx_v_ip);
          __Pyx_INCREF(__pyx_v_items);
          PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_items);
          __Pyx_GIVEREF(__pyx_v_items);
          __pyx_t_5 = PyObject_Call(__pyx_t_7, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L8;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":396
 *                     names_by_ip.setdefault(ip, items)
 *                     names_by_nameip.setdefault(ip, items)
 *                     for name in items:             # <<<<<<<<<<<<<<
 *                         names_by_nameip.setdefault(name, items)
 *     finally:
 */
          if (PyList_CheckExact(__pyx_v_items) || PyTuple_CheckExact(__pyx_v_items)) {
            __pyx_t_6 = 0; __pyx_t_5 = __pyx_v_items; __Pyx_INCREF(__pyx_t_5);
          } else {
            __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_items); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L8;}
            __Pyx_GOTREF(__pyx_t_5);
          }
          for (;;) {
            if (likely(PyList_CheckExact(__pyx_t_5))) {
              if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
              __pyx_t_2 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++;
            } else if (likely(PyTuple_CheckExact(__pyx_t_5))) {
              if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
              __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++;
            } else {
              __pyx_t_2 = PyIter_Next(__pyx_t_5);
              if (!__pyx_t_2) {
                if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L8;}
                break;
              }
              __Pyx_GOTREF(__pyx_t_2);
            }
            __Pyx_DECREF(__pyx_v_name);
            __pyx_v_name = __pyx_t_2;
            __pyx_t_2 = 0;

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":397
 *                     names_by_nameip.setdefault(ip, items)
 *                     for name in items:
 *                         names_by_nameip.setdefault(name, items)             # <<<<<<<<<<<<<<
 *     finally:
 *         f.close()
 */
            __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L8;}
            __Pyx_GOTREF(__pyx_t_2);
            __pyx_t_7 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__setdefault); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L8;}
            __Pyx_GOTREF(__pyx_t_7);
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L8;}
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_INCREF(__pyx_v_name);
            PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
            __Pyx_GIVEREF(__pyx_v_name);
            __Pyx_INCREF(__pyx_v_items);
            PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_items);
            __Pyx_GIVEREF(__pyx_v_items);
            __pyx_t_12 = PyObject_Call(__pyx_t_7, __pyx_t_2, NULL); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L8;}
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          }
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          goto __pyx_L13;
        }
        __pyx_L13:;
        goto __pyx_L12;
      }
      __pyx_L12:;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L9;
    __pyx_L8: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":399
 *                         names_by_nameip.setdefault(name, items)
 *     finally:
 *         f.close()             # <<<<<<<<<<<<<<
 * 
 * cdef object raise_gaierror(object exc_info, char is_name):
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_f, __pyx_n_s__close); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L16_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L16_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L17;
    __pyx_L16_error:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1_error;
    __pyx_L17:;
    switch (__pyx_why) {
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("coio.read_etc_hosts");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_line);
  __Pyx_DECREF(__pyx_v_items);
  __Pyx_DECREF(__pyx_v_ip);
  __Pyx_DECREF(__pyx_v_name);
  __Pyx_DECREF(__pyx_v_filename);
  __Pyx_DECREF(__pyx_v_f);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":401
 *         f.close()
 * 
 * cdef object raise_gaierror(object exc_info, char is_name):             # <<<<<<<<<<<<<<
 *     cdef int result
 *     exc_type, exc_value, exc_tb = exc_info
 */

static  PyObject *__pyx_f_4coio_raise_gaierror(PyObject *__pyx_v_exc_info, char __pyx_v_is_name) {
  int __pyx_v_result;
  PyObject *__pyx_v_exc_type;
  PyObject *__pyx_v_exc_value;
  PyObject *__pyx_v_exc_tb;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  char __pyx_t_7;
  __Pyx_RefNannySetupContext("raise_gaierror");
  __Pyx_INCREF(__pyx_v_exc_info);
  __pyx_v_exc_type = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_exc_value = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_exc_tb = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":403
 * cdef object raise_gaierror(object exc_info, char is_name):
 *     cdef int result
 *     exc_type, exc_value, exc_tb = exc_info             # <<<<<<<<<<<<<<
 *     # -9 == socket.EAI_ADDRFAMILY
 *     # -5 == socket.EAI_NODATA
 */
  if (PyTuple_CheckExact(__pyx_v_exc_info) && likely(PyTuple_GET_SIZE(__pyx_v_exc_info) == 3)) {
    PyObject* tuple = __pyx_v_exc_info;
    __pyx_t_1 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_GET_ITEM(tuple, 2); __Pyx_INCREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_v_exc_type);
    __pyx_v_exc_type = __pyx_t_1;
    __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_t_2;
    __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_exc_tb);
    __pyx_v_exc_tb = __pyx_t_3;
    __pyx_t_3 = 0;
  } else {
    __pyx_t_4 = PyObject_GetIter(__pyx_v_exc_info); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_UnpackItem(__pyx_t_4, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_UnpackItem(__pyx_t_4, 1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_UnpackItem(__pyx_t_4, 2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (__Pyx_EndUnpack(__pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_exc_type);
    __pyx_v_exc_type = __pyx_t_1;
    __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_t_2;
    __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_exc_tb);
    __pyx_v_exc_tb = __pyx_t_3;
    __pyx_t_3 = 0;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":407
 *     # -5 == socket.EAI_NODATA
 *     # -2 == socket.EAI_NONAME  'Name or service not known'
 *     result = exc_value[0]             # <<<<<<<<<<<<<<
 *     result = -result
 *     # TODO(pts): Substitute more.
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_exc_value, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_result = __pyx_t_5;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":408
 *     # -2 == socket.EAI_NONAME  'Name or service not known'
 *     result = exc_value[0]
 *     result = -result             # <<<<<<<<<<<<<<
 *     # TODO(pts): Substitute more.
 *     # Substitute with Linux-specific values.
 */
  __pyx_v_result = (-__pyx_v_result);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":411
 *     # TODO(pts): Substitute more.
 *     # Substitute with Linux-specific values.
 *     if result == c_DNS_ERR_NOTEXIST:             # <<<<<<<<<<<<<<
 *         if is_name:
 *             exc_value = socket.gaierror(
 */
  __pyx_t_6 = (__pyx_v_result == DNS_ERR_NOTEXIST);
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":412
 *     # Substitute with Linux-specific values.
 *     if result == c_DNS_ERR_NOTEXIST:
 *         if is_name:             # <<<<<<<<<<<<<<
 *             exc_value = socket.gaierror(
 *                 socket.EAI_NONAME, 'Name or service not known')
 */
    __pyx_t_7 = __pyx_v_is_name;
    if (__pyx_t_7) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":413
 *     if result == c_DNS_ERR_NOTEXIST:
 *         if is_name:
 *             exc_value = socket.gaierror(             # <<<<<<<<<<<<<<
 *                 socket.EAI_NONAME, 'Name or service not known')
 *         else:
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__gaierror); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":414
 *         if is_name:
 *             exc_value = socket.gaierror(
 *                 socket.EAI_NONAME, 'Name or service not known')             # <<<<<<<<<<<<<<
 *         else:
 *             exc_value = socket.gaierror(
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__EAI_NONAME); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_36));
      PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_kp_s_36));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_36));
      __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_v_exc_value);
      __pyx_v_exc_value = __pyx_t_1;
      __pyx_t_1 = 0;
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":416
 *                 socket.EAI_NONAME, 'Name or service not known')
 *         else:
 *             exc_value = socket.gaierror(             # <<<<<<<<<<<<<<
 *                 socket.EAI_NODATA, 'No address associated with hostname')
 *     else:
 */
      __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__gaierror); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":417
 *         else:
 *             exc_value = socket.gaierror(
 *                 socket.EAI_NODATA, 'No address associated with hostname')             # <<<<<<<<<<<<<<
 *     else:
 *         exc_value = socket.gaierror(-result - 900, exc_value[1])
 */
      __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__EAI_NODATA); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      __Pyx_INCREF(((PyObject *)__pyx_kp_s_37));
      PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_kp_s_37));
      __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_37));
      __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_v_exc_value);
      __pyx_v_exc_value = __pyx_t_2;
      __pyx_t_2 = 0;
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":419
 *                 socket.EAI_NODATA, 'No address associated with hostname')
 *     else:
 *         exc_value = socket.gaierror(-result - 900, exc_value[1])             # <<<<<<<<<<<<<<
 *     raise type(exc_value), exc_value, exc_tb
 * 
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__gaierror); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyInt_FromLong(((-__pyx_v_result) - 900)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_exc_value, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_t_3;
    __pyx_t_3 = 0;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":420
 *     else:
 *         exc_value = socket.gaierror(-result - 900, exc_value[1])
 *     raise type(exc_value), exc_value, exc_tb             # <<<<<<<<<<<<<<
 * 
 * cdef object raise_herror(object exc_info):
 */
  __Pyx_Raise(((PyObject *)Py_TYPE(__pyx_v_exc_value)), __pyx_v_exc_value, __pyx_v_exc_tb);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.raise_gaierror");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_exc_type);
  __Pyx_DECREF(__pyx_v_exc_value);
  __Pyx_DECREF(__pyx_v_exc_tb);
  __Pyx_DECREF(__pyx_v_exc_info);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":422
 *     raise type(exc_value), exc_value, exc_tb
 * 
 * cdef object raise_herror(object exc_info):             # <<<<<<<<<<<<<<
 *     cdef int result
 *     exc_type, exc_value, exc_tb = exc_info
 */

static  PyObject *__pyx_f_4coio_raise_herror(PyObject *__pyx_v_exc_info) {
  int __pyx_v_result;
  PyObject *__pyx_v_exc_type;
  PyObject *__pyx_v_exc_value;
  PyObject *__pyx_v_exc_tb;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("raise_herror");
  __Pyx_INCREF(__pyx_v_exc_info);
  __pyx_v_exc_type = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_exc_value = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_exc_tb = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":424
 * cdef object raise_herror(object exc_info):
 *     cdef int result
 *     exc_type, exc_value, exc_tb = exc_info             # <<<<<<<<<<<<<<
 *     # 1 == c_HERROR_HOST_NOT_FOUND
 *     result = exc_value[0]  # <int>exc_value[0] is different.
 */
  if (PyTuple_CheckExact(__pyx_v_exc_info) && likely(PyTuple_GET_SIZE(__pyx_v_exc_info) == 3)) {
    PyObject* tuple = __pyx_v_exc_info;
    __pyx_t_1 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_GET_ITEM(tuple, 2); __Pyx_INCREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_v_exc_type);
    __pyx_v_exc_type = __pyx_t_1;
    __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_t_2;
    __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_exc_tb);
    __pyx_v_exc_tb = __pyx_t_3;
    __pyx_t_3 = 0;
  } else {
    __pyx_t_4 = PyObject_GetIter(__pyx_v_exc_info); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_UnpackItem(__pyx_t_4, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_UnpackItem(__pyx_t_4, 1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_UnpackItem(__pyx_t_4, 2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (__Pyx_EndUnpack(__pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_exc_type);
    __pyx_v_exc_type = __pyx_t_1;
    __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_t_2;
    __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_exc_tb);
    __pyx_v_exc_tb = __pyx_t_3;
    __pyx_t_3 = 0;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":426
 *     exc_type, exc_value, exc_tb = exc_info
 *     # 1 == c_HERROR_HOST_NOT_FOUND
 *     result = exc_value[0]  # <int>exc_value[0] is different.             # <<<<<<<<<<<<<<
 *     result = -result
 *     # TODO(pts): Substitute more.
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_exc_value, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_result = __pyx_t_5;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":427
 *     # 1 == c_HERROR_HOST_NOT_FOUND
 *     result = exc_value[0]  # <int>exc_value[0] is different.
 *     result = -result             # <<<<<<<<<<<<<<
 *     # TODO(pts): Substitute more.
 *     # Substitute with Linux-specific values.
 */
  __pyx_v_result = (-__pyx_v_result);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":430
 *     # TODO(pts): Substitute more.
 *     # Substitute with Linux-specific values.
 *     if result == c_DNS_ERR_NOTEXIST:             # <<<<<<<<<<<<<<
 *         exc_value = socket.herror(
 *             HERROR_HOST_NOT_FOUND, 'Unknown host')
 */
  __pyx_t_6 = (__pyx_v_result == DNS_ERR_NOTEXIST);
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":431
 *     # Substitute with Linux-specific values.
 *     if result == c_DNS_ERR_NOTEXIST:
 *         exc_value = socket.herror(             # <<<<<<<<<<<<<<
 *             HERROR_HOST_NOT_FOUND, 'Unknown host')
 *     else:
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__herror); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":432
 *     if result == c_DNS_ERR_NOTEXIST:
 *         exc_value = socket.herror(
 *             HERROR_HOST_NOT_FOUND, 'Unknown host')             # <<<<<<<<<<<<<<
 *     else:
 *         exc_value = socket.herror(-result - 900, exc_value[1])
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s_38); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_39));
    PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_kp_s_39));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_39));
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_2, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":434
 *             HERROR_HOST_NOT_FOUND, 'Unknown host')
 *     else:
 *         exc_value = socket.herror(-result - 900, exc_value[1])             # <<<<<<<<<<<<<<
 *     raise type(exc_value), exc_value, exc_tb
 * 
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__herror); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyInt_FromLong(((-__pyx_v_result) - 900)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_exc_value, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_3 = 0;
    __pyx_t_2 = 0;
    __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":435
 *     else:
 *         exc_value = socket.herror(-result - 900, exc_value[1])
 *     raise type(exc_value), exc_value, exc_tb             # <<<<<<<<<<<<<<
 * 
 * def gethostbyname(char *name):
 */
  __Pyx_Raise(((PyObject *)Py_TYPE(__pyx_v_exc_value)), __pyx_v_exc_value, __pyx_v_exc_tb);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("coio.raise_herror");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_exc_type);
  __Pyx_DECREF(__pyx_v_exc_value);
  __Pyx_DECREF(__pyx_v_exc_tb);
  __Pyx_DECREF(__pyx_v_exc_info);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":437
 *     raise type(exc_value), exc_value, exc_tb
 * 
 * def gethostbyname(char *name):             # <<<<<<<<<<<<<<
 *     """Non-blocking drop-in replacement for socket.gethostbyname.
 * 
 */

static PyObject *__pyx_pf_4coio_gethostbyname(PyObject *__pyx_self, PyObject *__pyx_arg_name); /*proto*/
static char __pyx_doc_4coio_gethostbyname[] = "Non-blocking drop-in replacement for socket.gethostbyname.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Returns:\n      An IPv4 address as an ASCII string (e.g. '192.168.1.2').\n    Raises:\n      socket.gaierror: The error names and codes may be different.\n    ";
static PyObject *__pyx_pf_4coio_gethostbyname(PyObject *__pyx_self, PyObject *__pyx_arg_name) {
  char *__pyx_v_name;
  PyObject *__pyx_r = NULL;
  char __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("gethostbyname");
  __pyx_self = __pyx_self;
  assert(__pyx_arg_name); {
    __pyx_v_name = __Pyx_PyBytes_AsString(__pyx_arg_name); if (unlikely((!__pyx_v_name) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.gethostbyname");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":448
 *     """
 *     # TODO(pts): Do proper binary string parsing (everywhere).
 *     if is_valid_ipv4(name):             # <<<<<<<<<<<<<<
 *         return name
 *     if is_valid_ipv6(name):
 */
  __pyx_t_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":449
 *     # TODO(pts): Do proper binary string parsing (everywhere).
 *     if is_valid_ipv4(name):
 *         return name             # <<<<<<<<<<<<<<
 *     if is_valid_ipv6(name):
 *         raise socket.gaierror(
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __pyx_r = ((PyObject *)__pyx_t_2);
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":450
 *     if is_valid_ipv4(name):
 *         return name
 *     if is_valid_ipv6(name):             # <<<<<<<<<<<<<<
 *         raise socket.gaierror(
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 */
  __pyx_t_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":451
 *         return name
 *     if is_valid_ipv6(name):
 *         raise socket.gaierror(             # <<<<<<<<<<<<<<
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 *     if name in names_by_nameip:
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__gaierror); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":452
 *     if is_valid_ipv6(name):
 *         raise socket.gaierror(
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')             # <<<<<<<<<<<<<<
 *     if name in names_by_nameip:
 *         return names_by_nameip[name][0]
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__EAI_ADDRFAMILY); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_40));
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_kp_s_40));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_40));
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":453
 *         raise socket.gaierror(
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 *     if name in names_by_nameip:             # <<<<<<<<<<<<<<
 *         return names_by_nameip[name][0]
 *     try:
 */
  __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = ((PySequence_Contains(__pyx_t_2, ((PyObject *)__pyx_t_4)))); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":454
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 *     if name in names_by_nameip:
 *         return names_by_nameip[name][0]             # <<<<<<<<<<<<<<
 *     try:
 *         return dns_resolve_ipv4(name).values[0]
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_3 = PyObject_GetItem(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":455
 *     if name in names_by_nameip:
 *         return names_by_nameip[name][0]
 *     try:             # <<<<<<<<<<<<<<
 *         return dns_resolve_ipv4(name).values[0]
 *     except DnsLookupError:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":456
 *         return names_by_nameip[name][0]
 *     try:
 *         return dns_resolve_ipv4(name).values[0]             # <<<<<<<<<<<<<<
 *     except DnsLookupError:
 *         raise_gaierror(sys.exc_info(), 0)
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_ipv4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_t_3));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
      __pyx_t_3 = 0;
      __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__values); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L12_try_return;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L15_try_end;
    __pyx_L12_try_return:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L0;
    __pyx_L8_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":457
 *     try:
 *         return dns_resolve_ipv4(name).values[0]
 *     except DnsLookupError:             # <<<<<<<<<<<<<<
 *         raise_gaierror(sys.exc_info(), 0)
 * 
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = PyErr_ExceptionMatches(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_6) {
      __Pyx_AddTraceback("coio.gethostbyname");
      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_4);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":458
 *         return dns_resolve_ipv4(name).values[0]
 *     except DnsLookupError:
 *         raise_gaierror(sys.exc_info(), 0)             # <<<<<<<<<<<<<<
 * 
 * cdef object c_gethostbyname(object address, int family):
 */
      __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = PyObject_GetAttr(__pyx_t_7, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __pyx_f_4coio_raise_gaierror(__pyx_t_7, 0); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L9_exception_handled;
    }
    __pyx_L10_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L9_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L15_try_end:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.gethostbyname");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":460
 *         raise_gaierror(sys.exc_info(), 0)
 * 
 * cdef object c_gethostbyname(object address, int family):             # <<<<<<<<<<<<<<
 *     """Helper function for the connect() methods in nbevent.pyx.
 * 
 */

static  PyObject *__pyx_f_4coio_c_gethostbyname(PyObject *__pyx_v_address, int __pyx_v_family) {
  char *__pyx_v_name;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  char *__pyx_t_3;
  char __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("c_gethostbyname");
  __Pyx_INCREF(__pyx_v_address);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":467
 *     """
 *     cdef char *name
 *     if family == AF_INET:             # <<<<<<<<<<<<<<
 *         name = address[0]
 *         if is_valid_ipv4(name):
 */
  __pyx_t_1 = (__pyx_v_family == AF_INET);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":468
 *     cdef char *name
 *     if family == AF_INET:
 *         name = address[0]             # <<<<<<<<<<<<<<
 *         if is_valid_ipv4(name):
 *             return address
 */
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_address, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyBytes_AsString(__pyx_t_2); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_name = __pyx_t_3;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":469
 *     if family == AF_INET:
 *         name = address[0]
 *         if is_valid_ipv4(name):             # <<<<<<<<<<<<<<
 *             return address
 *         if not is_valid_ipv6(name):
 */
    __pyx_t_4 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
    if (__pyx_t_4) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":470
 *         name = address[0]
 *         if is_valid_ipv4(name):
 *             return address             # <<<<<<<<<<<<<<
 *         if not is_valid_ipv6(name):
 *             try:
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_address);
      __pyx_r = __pyx_v_address;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":471
 *         if is_valid_ipv4(name):
 *             return address
 *         if not is_valid_ipv6(name):             # <<<<<<<<<<<<<<
 *             try:
 *                 return (dns_resolve_ipv4(name).values[0], address[1])
 */
    __pyx_t_1 = (!__pyx_f_4coio_is_valid_ipv6(__pyx_v_name));
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":472
 *             return address
 *         if not is_valid_ipv6(name):
 *             try:             # <<<<<<<<<<<<<<
 *                 return (dns_resolve_ipv4(name).values[0], address[1])
 *             except DnsLookupError:
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":473
 *         if not is_valid_ipv6(name):
 *             try:
 *                 return (dns_resolve_ipv4(name).values[0], address[1])             # <<<<<<<<<<<<<<
 *             except DnsLookupError:
 *                 raise_gaierror(sys.exc_info(), 0)
 */
          __Pyx_XDECREF(__pyx_r);
          __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_ipv4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_5 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_5));
          __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
          __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
          __pyx_t_5 = 0;
          __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__values); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_address, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
          __Pyx_GOTREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_6);
          __pyx_t_5 = 0;
          __pyx_t_6 = 0;
          __pyx_r = __pyx_t_2;
          __pyx_t_2 = 0;
          goto __pyx_L10_try_return;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L13_try_end;
        __pyx_L10_try_return:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L0;
        __pyx_L6_error:;
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":474
 *             try:
 *                 return (dns_resolve_ipv4(name).values[0], address[1])
 *             except DnsLookupError:             # <<<<<<<<<<<<<<
 *                 raise_gaierror(sys.exc_info(), 0)
 *     elif family == AF_INET6:
 */
        __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_7 = PyErr_ExceptionMatches(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (__pyx_t_7) {
          __Pyx_AddTraceback("coio.c_gethostbyname");
          if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_6, &__pyx_t_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_GOTREF(__pyx_t_5);

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":475
 *                 return (dns_resolve_ipv4(name).values[0], address[1])
 *             except DnsLookupError:
 *                 raise_gaierror(sys.exc_info(), 0)             # <<<<<<<<<<<<<<
 *     elif family == AF_INET6:
 *         name = address[0]
 */
          __pyx_t_8 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_9 = PyObject_GetAttr(__pyx_t_8, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_8 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_9 = __pyx_f_4coio_raise_gaierror(__pyx_t_8, 0); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          goto __pyx_L7_exception_handled;
        }
        __pyx_L8_except_error:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L7_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L13_try_end:;
      }
      goto __pyx_L5;
    }
    __pyx_L5:;
    goto __pyx_L3;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":476
 *             except DnsLookupError:
 *                 raise_gaierror(sys.exc_info(), 0)
 *     elif family == AF_INET6:             # <<<<<<<<<<<<<<
 *         name = address[0]
 *         if is_valid_ipv6(name):
 */
  __pyx_t_1 = (__pyx_v_family == AF_INET6);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":477
 *                 raise_gaierror(sys.exc_info(), 0)
 *     elif family == AF_INET6:
 *         name = address[0]             # <<<<<<<<<<<<<<
 *         if is_valid_ipv6(name):
 *             return address
 */
    __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_address, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = __Pyx_PyBytes_AsString(__pyx_t_5); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_name = __pyx_t_3;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":478
 *     elif family == AF_INET6:
 *         name = address[0]
 *         if is_valid_ipv6(name):             # <<<<<<<<<<<<<<
 *             return address
 *         if not is_valid_ipv4(name):
 */
    __pyx_t_4 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
    if (__pyx_t_4) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":479
 *         name = address[0]
 *         if is_valid_ipv6(name):
 *             return address             # <<<<<<<<<<<<<<
 *         if not is_valid_ipv4(name):
 *             try:
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_address);
      __pyx_r = __pyx_v_address;
      goto __pyx_L0;
      goto __pyx_L16;
    }
    __pyx_L16:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":480
 *         if is_valid_ipv6(name):
 *             return address
 *         if not is_valid_ipv4(name):             # <<<<<<<<<<<<<<
 *             try:
 *                 return (dns_resolve_ipv6(name).values[0], address[1])
 */
    __pyx_t_1 = (!__pyx_f_4coio_is_valid_ipv4(__pyx_v_name));
    if (__pyx_t_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":481
 *             return address
 *         if not is_valid_ipv4(name):
 *             try:             # <<<<<<<<<<<<<<
 *                 return (dns_resolve_ipv6(name).values[0], address[1])
 *             except DnsLookupError:
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":482
 *         if not is_valid_ipv4(name):
 *             try:
 *                 return (dns_resolve_ipv6(name).values[0], address[1])             # <<<<<<<<<<<<<<
 *             except DnsLookupError:
 *                 raise_gaierror(sys.exc_info(), 0)
 */
          __Pyx_XDECREF(__pyx_r);
          __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_ipv6); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_6 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_6));
          __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_t_6));
          __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
          __pyx_t_6 = 0;
          __pyx_t_6 = PyObject_Call(__pyx_t_5, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__values); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_2, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_address, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L18_error;}
          __Pyx_GOTREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_2);
          __pyx_t_6 = 0;
          __pyx_t_2 = 0;
          __pyx_r = __pyx_t_5;
          __pyx_t_5 = 0;
          goto __pyx_L22_try_return;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L25_try_end;
        __pyx_L22_try_return:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L0;
        __pyx_L18_error:;
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":483
 *             try:
 *                 return (dns_resolve_ipv6(name).values[0], address[1])
 *             except DnsLookupError:             # <<<<<<<<<<<<<<
 *                 raise_gaierror(sys.exc_info(), 0)
 *     else:
 */
        __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 483; __pyx_clineno = __LINE__; goto __pyx_L20_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = PyErr_ExceptionMatches(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_7) {
          __Pyx_AddTraceback("coio.c_gethostbyname");
          if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_2, &__pyx_t_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 483; __pyx_clineno = __LINE__; goto __pyx_L20_except_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_GOTREF(__pyx_t_6);

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":484
 *                 return (dns_resolve_ipv6(name).values[0], address[1])
 *             except DnsLookupError:
 *                 raise_gaierror(sys.exc_info(), 0)             # <<<<<<<<<<<<<<
 *     else:
 *         return address  # for AF_UNIX etc.
 */
          __pyx_t_9 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L20_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_8 = PyObject_GetAttr(__pyx_t_9, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L20_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_9 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L20_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_8 = __pyx_f_4coio_raise_gaierror(__pyx_t_9, 0); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L20_except_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          goto __pyx_L19_exception_handled;
        }
        __pyx_L20_except_error:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L19_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L25_try_end:;
      }
      goto __pyx_L17;
    }
    __pyx_L17:;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":486
 *                 raise_gaierror(sys.exc_info(), 0)
 *     else:
 *         return address  # for AF_UNIX etc.             # <<<<<<<<<<<<<<
 *     raise socket.gaierror(socket.EAI_ADDRFAMILY,
 *                           'Address family for hostname not supported')
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_address);
    __pyx_r = __pyx_v_address;
    goto __pyx_L0;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":487
 *     else:
 *         return address  # for AF_UNIX etc.
 *     raise socket.gaierror(socket.EAI_ADDRFAMILY,             # <<<<<<<<<<<<<<
 *                           'Address family for hostname not supported')
 * 
 */
  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__gaierror); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_5 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__EAI_ADDRFAMILY); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __Pyx_INCREF(((PyObject *)__pyx_kp_s_40));
  PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_kp_s_40));
  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_40));
  __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_Raise(__pyx_t_5, 0, 0);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("coio.c_gethostbyname");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_address);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":490
 *                           'Address family for hostname not supported')
 * 
 * def gethostbyaddr(char *name):             # <<<<<<<<<<<<<<
 *     """Non-blocking drop-in replacement for socket.gethostbyaddr.
 * 
 */

static PyObject *__pyx_pf_4coio_gethostbyaddr(PyObject *__pyx_self, PyObject *__pyx_arg_name); /*proto*/
static char __pyx_doc_4coio_gethostbyaddr[] = "Non-blocking drop-in replacement for socket.gethostbyaddr.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Raises:\n      socket.herror: The error names and codes may be different.\n      socket.gaierror: The error names and codes may be different.\n    ";
static PyObject *__pyx_pf_4coio_gethostbyaddr(PyObject *__pyx_self, PyObject *__pyx_arg_name) {
  char *__pyx_v_name;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_v_items;
  PyObject *__pyx_r = NULL;
  char __pyx_t_1;
  char __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("gethostbyaddr");
  __pyx_self = __pyx_self;
  assert(__pyx_arg_name); {
    __pyx_v_name = __Pyx_PyBytes_AsString(__pyx_arg_name); if (unlikely((!__pyx_v_name) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.gethostbyaddr");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_v_ip = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_items = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":499
 *       socket.gaierror: The error names and codes may be different.
 *     """
 *     if is_valid_ipv4(name) or is_valid_ipv6(name):             # <<<<<<<<<<<<<<
 *         ip = name
 *     elif name in names_by_nameip:
 */
  __pyx_t_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (!__pyx_t_1) {
    __pyx_t_2 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":500
 *     """
 *     if is_valid_ipv4(name) or is_valid_ipv6(name):
 *         ip = name             # <<<<<<<<<<<<<<
 *     elif name in names_by_nameip:
 *         ip = names_by_nameip[name][0]
 */
    __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(__pyx_v_ip);
    __pyx_v_ip = ((PyObject *)__pyx_t_4);
    __pyx_t_4 = 0;
    goto __pyx_L5;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":501
 *     if is_valid_ipv4(name) or is_valid_ipv6(name):
 *         ip = name
 *     elif name in names_by_nameip:             # <<<<<<<<<<<<<<
 *         ip = names_by_nameip[name][0]
 *     else:
 */
  __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = ((PySequence_Contains(__pyx_t_5, ((PyObject *)__pyx_t_4)))); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":502
 *         ip = name
 *     elif name in names_by_nameip:
 *         ip = names_by_nameip[name][0]             # <<<<<<<<<<<<<<
 *     else:
 *         try:
 */
    __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_6 = PyObject_GetItem(__pyx_t_5, ((PyObject *)__pyx_t_4)); if (!__pyx_t_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_6, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":504
 *         ip = names_by_nameip[name][0]
 *     else:
 *         try:             # <<<<<<<<<<<<<<
 *             ip = dns_resolve_ipv4(name).values[0]
 *         except DnsLookupError:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":505
 *     else:
 *         try:
 *             ip = dns_resolve_ipv4(name).values[0]             # <<<<<<<<<<<<<<
 *         except DnsLookupError:
 *             raise_gaierror(sys.exc_info(), 0)
 */
        __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_ipv4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_6 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_6));
        __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_6));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
        __pyx_t_6 = 0;
        __pyx_t_6 = PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__values); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_5, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_v_ip);
        __pyx_v_ip = __pyx_t_6;
        __pyx_t_6 = 0;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L13_try_end;
      __pyx_L6_error:;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":506
 *         try:
 *             ip = dns_resolve_ipv4(name).values[0]
 *         except DnsLookupError:             # <<<<<<<<<<<<<<
 *             raise_gaierror(sys.exc_info(), 0)
 *     if ip in names_by_ip:
 */
      __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 506; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyErr_ExceptionMatches(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {
        __Pyx_AddTraceback("coio.gethostbyaddr");
        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 506; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_GOTREF(__pyx_t_4);

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":507
 *             ip = dns_resolve_ipv4(name).values[0]
 *         except DnsLookupError:
 *             raise_gaierror(sys.exc_info(), 0)             # <<<<<<<<<<<<<<
 *     if ip in names_by_ip:
 *         items = names_by_ip[ip]
 */
        __pyx_t_8 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_9 = PyObject_GetAttr(__pyx_t_8, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_9 = __pyx_f_4coio_raise_gaierror(__pyx_t_8, 0); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        goto __pyx_L7_exception_handled;
      }
      __pyx_L8_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L7_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L13_try_end:;
    }
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":508
 *         except DnsLookupError:
 *             raise_gaierror(sys.exc_info(), 0)
 *     if ip in names_by_ip:             # <<<<<<<<<<<<<<
 *         items = names_by_ip[ip]
 *         return (items[1], items[2:], [ip])
 */
  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_ip); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = ((PySequence_Contains(__pyx_t_4, __pyx_v_ip))); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":509
 *             raise_gaierror(sys.exc_info(), 0)
 *     if ip in names_by_ip:
 *         items = names_by_ip[ip]             # <<<<<<<<<<<<<<
 *         return (items[1], items[2:], [ip])
 *     try:
 */
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_ip); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_GetItem(__pyx_t_4, __pyx_v_ip); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_items);
    __pyx_v_items = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":510
 *     if ip in names_by_ip:
 *         items = names_by_ip[ip]
 *         return (items[1], items[2:], [ip])             # <<<<<<<<<<<<<<
 *     try:
 *         return (dns_resolve_reverse(ip).values[0], [], [ip])
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_items, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = PySequence_GetSlice(__pyx_v_items, 2, PY_SSIZE_T_MAX); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_6));
    __Pyx_INCREF(__pyx_v_ip);
    PyList_SET_ITEM(__pyx_t_6, 0, __pyx_v_ip);
    __Pyx_GIVEREF(__pyx_v_ip);
    __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_9, 2, ((PyObject *)__pyx_t_6));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_6 = 0;
    __pyx_r = __pyx_t_9;
    __pyx_t_9 = 0;
    goto __pyx_L0;
    goto __pyx_L16;
  }
  __pyx_L16:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":511
 *         items = names_by_ip[ip]
 *         return (items[1], items[2:], [ip])
 *     try:             # <<<<<<<<<<<<<<
 *         return (dns_resolve_reverse(ip).values[0], [], [ip])
 *     except DnsLookupError:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":512
 *         return (items[1], items[2:], [ip])
 *     try:
 *         return (dns_resolve_reverse(ip).values[0], [], [ip])             # <<<<<<<<<<<<<<
 *     except DnsLookupError:
 *         raise_herror(sys.exc_info())
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_9 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_reverse); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_v_ip);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_ip);
      __Pyx_GIVEREF(__pyx_v_ip);
      __pyx_t_4 = PyObject_Call(__pyx_t_9, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__values); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_6, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_6));
      __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_9));
      __Pyx_INCREF(__pyx_v_ip);
      PyList_SET_ITEM(__pyx_t_9, 0, __pyx_v_ip);
      __Pyx_GIVEREF(__pyx_v_ip);
      __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
      __Pyx_GOTREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_6));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
      PyTuple_SET_ITEM(__pyx_t_5, 2, ((PyObject *)__pyx_t_9));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_9));
      __pyx_t_4 = 0;
      __pyx_t_6 = 0;
      __pyx_t_9 = 0;
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L21_try_return;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L24_try_end;
    __pyx_L21_try_return:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L0;
    __pyx_L17_error:;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":513
 *     try:
 *         return (dns_resolve_reverse(ip).values[0], [], [ip])
 *     except DnsLookupError:             # <<<<<<<<<<<<<<
 *         raise_herror(sys.exc_info())
 * 
 */
    __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = PyErr_ExceptionMatches(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_7) {
      __Pyx_AddTraceback("coio.gethostbyaddr");
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_9, &__pyx_t_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_GOTREF(__pyx_t_6);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":514
 *         return (dns_resolve_reverse(ip).values[0], [], [ip])
 *     except DnsLookupError:
 *         raise_herror(sys.exc_info())             # <<<<<<<<<<<<<<
 * 
 * def getfqdn(name=''):
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_8 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __pyx_f_4coio_raise_herror(__pyx_t_4); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L18_exception_handled;
    }
    __pyx_L19_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L18_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L24_try_end:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("coio.gethostbyaddr");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_ip);
  __Pyx_DECREF(__pyx_v_items);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":516
 *         raise_herror(sys.exc_info())
 * 
 * def getfqdn(name=''):             # <<<<<<<<<<<<<<
 *     """Non-blocking drop-in replacement for socket.getfqdn.
 * 
 */

static PyObject *__pyx_pf_4coio_getfqdn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_getfqdn[] = "Non-blocking drop-in replacement for socket.getfqdn.\n\n    This function returns data from /etc/hosts as read at module load time.\n    ";
static PyObject *__pyx_pf_4coio_getfqdn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  char *__pyx_v_cname;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  char *__pyx_t_5;
  char __pyx_t_6;
  char __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
  __Pyx_RefNannySetupContext("getfqdn");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_5);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "getfqdn") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_name = values[0];
  } else {
    __pyx_v_name = ((PyObject *)__pyx_kp_s_5);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_name = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("getfqdn", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.getfqdn");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_name);
  __pyx_v_ip = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":522
 *     """
 *     cdef char* cname
 *     cname = NULL             # <<<<<<<<<<<<<<
 *     if not name:
 *       name = socket.gethostname()
 */
  __pyx_v_cname = NULL;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":523
 *     cdef char* cname
 *     cname = NULL
 *     if not name:             # <<<<<<<<<<<<<<
 *       name = socket.gethostname()
 *     cname = name
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_name); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":524
 *     cname = NULL
 *     if not name:
 *       name = socket.gethostname()             # <<<<<<<<<<<<<<
 *     cname = name
 *     if is_valid_ipv4(cname) or is_valid_ipv6(cname):
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__gethostname); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_name);
    __pyx_v_name = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":525
 *     if not name:
 *       name = socket.gethostname()
 *     cname = name             # <<<<<<<<<<<<<<
 *     if is_valid_ipv4(cname) or is_valid_ipv6(cname):
 *         ip = cname
 */
  __pyx_t_5 = __Pyx_PyBytes_AsString(__pyx_v_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_cname = __pyx_t_5;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":526
 *       name = socket.gethostname()
 *     cname = name
 *     if is_valid_ipv4(cname) or is_valid_ipv6(cname):             # <<<<<<<<<<<<<<
 *         ip = cname
 *     elif cname in names_by_nameip:
 */
  __pyx_t_6 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_cname);
  if (!__pyx_t_6) {
    __pyx_t_7 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_cname);
    __pyx_t_2 = __pyx_t_7;
  } else {
    __pyx_t_2 = __pyx_t_6;
  }
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":527
 *     cname = name
 *     if is_valid_ipv4(cname) or is_valid_ipv6(cname):
 *         ip = cname             # <<<<<<<<<<<<<<
 *     elif cname in names_by_nameip:
 *         ip = names_by_nameip[cname][0]
 */
    __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_cname); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_DECREF(__pyx_v_ip);
    __pyx_v_ip = ((PyObject *)__pyx_t_3);
    __pyx_t_3 = 0;
    goto __pyx_L7;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":528
 *     if is_valid_ipv4(cname) or is_valid_ipv6(cname):
 *         ip = cname
 *     elif cname in names_by_nameip:             # <<<<<<<<<<<<<<
 *         ip = names_by_nameip[cname][0]
 *     else:
 */
  __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_cname); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = ((PySequence_Contains(__pyx_t_4, ((PyObject *)__pyx_t_3)))); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":529
 *         ip = cname
 *     elif cname in names_by_nameip:
 *         ip = names_by_nameip[cname][0]             # <<<<<<<<<<<<<<
 *     else:
 *         try:
 */
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_cname); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_8 = PyObject_GetItem(__pyx_t_4, ((PyObject *)__pyx_t_3)); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_8, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L7;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":531
 *         ip = names_by_nameip[cname][0]
 *     else:
 *         try:             # <<<<<<<<<<<<<<
 *             ip = dns_resolve_ipv4(cname).values[0]
 *         except DnsLookupError:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":532
 *     else:
 *         try:
 *             ip = dns_resolve_ipv4(cname).values[0]             # <<<<<<<<<<<<<<
 *         except DnsLookupError:
 *             return cname
 */
        __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_ipv4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = __Pyx_PyBytes_FromString(__pyx_v_cname); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_8));
        __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_8));
        __Pyx_GIVEREF(((PyObject *)__pyx_t_8));
        __pyx_t_8 = 0;
        __pyx_t_8 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyObject_GetAttr(__pyx_t_8, __pyx_n_s__values); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_4, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_v_ip);
        __pyx_v_ip = __pyx_t_8;
        __pyx_t_8 = 0;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L15_try_end;
      __pyx_L8_error:;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":533
 *         try:
 *             ip = dns_resolve_ipv4(cname).values[0]
 *         except DnsLookupError:             # <<<<<<<<<<<<<<
 *             return cname
 *     if ip in names_by_ip:
 */
      __pyx_t_8 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = PyErr_ExceptionMatches(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (__pyx_t_9) {
        __Pyx_AddTraceback("coio.getfqdn");
        if (__Pyx_GetException(&__pyx_t_8, &__pyx_t_4, &__pyx_t_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_3);

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":534
 *             ip = dns_resolve_ipv4(cname).values[0]
 *         except DnsLookupError:
 *             return cname             # <<<<<<<<<<<<<<
 *     if ip in names_by_ip:
 *         return names_by_ip[ip][1]
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_10 = __Pyx_PyBytes_FromString(__pyx_v_cname); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_10));
        __pyx_r = ((PyObject *)__pyx_t_10);
        __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        goto __pyx_L11_except_return;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L9_exception_handled;
      }
      __pyx_L10_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L11_except_return:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L0;
      __pyx_L9_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L15_try_end:;
    }
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":535
 *         except DnsLookupError:
 *             return cname
 *     if ip in names_by_ip:             # <<<<<<<<<<<<<<
 *         return names_by_ip[ip][1]
 *     try:
 */
  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_ip); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = ((PySequence_Contains(__pyx_t_3, __pyx_v_ip))); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":536
 *             return cname
 *     if ip in names_by_ip:
 *         return names_by_ip[ip][1]             # <<<<<<<<<<<<<<
 *     try:
 *         return dns_resolve_reverse(ip).values[0]
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_ip); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 536; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_GetItem(__pyx_t_3, __pyx_v_ip); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 536; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 536; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L18;
  }
  __pyx_L18:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":537
 *     if ip in names_by_ip:
 *         return names_by_ip[ip][1]
 *     try:             # <<<<<<<<<<<<<<
 *         return dns_resolve_reverse(ip).values[0]
 *     except DnsLookupError:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":538
 *         return names_by_ip[ip][1]
 *     try:
 *         return dns_resolve_reverse(ip).values[0]             # <<<<<<<<<<<<<<
 *     except DnsLookupError:
 *         return cname
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_reverse); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_ip);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_ip);
      __Pyx_GIVEREF(__pyx_v_ip);
      __pyx_t_8 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_GetAttr(__pyx_t_8, __pyx_n_s__values); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_4, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_8;
      __pyx_t_8 = 0;
      goto __pyx_L23_try_return;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L26_try_end;
    __pyx_L23_try_return:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L0;
    __pyx_L19_error:;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":539
 *     try:
 *         return dns_resolve_reverse(ip).values[0]
 *     except DnsLookupError:             # <<<<<<<<<<<<<<
 *         return cname
 * 
 */
    __pyx_t_8 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = PyErr_ExceptionMatches(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (__pyx_t_9) {
      __Pyx_AddTraceback("coio.getfqdn");
      if (__Pyx_GetException(&__pyx_t_8, &__pyx_t_4, &__pyx_t_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_3);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":540
 *         return dns_resolve_reverse(ip).values[0]
 *     except DnsLookupError:
 *         return cname             # <<<<<<<<<<<<<<
 * 
 * def gethostbyname_ex(char *name):
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_10 = __Pyx_PyBytes_FromString(__pyx_v_cname); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      __pyx_r = ((PyObject *)__pyx_t_10);
      __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      goto __pyx_L22_except_return;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L20_exception_handled;
    }
    __pyx_L21_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L22_except_return:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L0;
    __pyx_L20_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L26_try_end:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("coio.getfqdn");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_ip);
  __Pyx_DECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":542
 *         return cname
 * 
 * def gethostbyname_ex(char *name):             # <<<<<<<<<<<<<<
 *     """Non-blocking drop-in replacement for socket.gethostbyname_ex.
 * 
 */

static PyObject *__pyx_pf_4coio_gethostbyname_ex(PyObject *__pyx_self, PyObject *__pyx_arg_name); /*proto*/
static char __pyx_doc_4coio_gethostbyname_ex[] = "Non-blocking drop-in replacement for socket.gethostbyname_ex.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Avoid using this function if possible.\n    Please note that this function is less faithful to its socket.*\n    counterpart than the other functions in this module. This is because the\n    underlying DNS lookup mechanism (evdns) can't return the CNAME records\n    in evdns_resolve_ipv4(). The CNAME emulation here is inaccurate (see the\n    unit tests) and slower (needs 2 DNS requests).\n    ";
static PyObject *__pyx_pf_4coio_gethostbyname_ex(PyObject *__pyx_self, PyObject *__pyx_arg_name) {
  char *__pyx_v_name;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_ips;
  PyObject *__pyx_v_canonical;
  PyObject *__pyx_r = NULL;
  char __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("gethostbyname_ex");
  __pyx_self = __pyx_self;
  assert(__pyx_arg_name); {
    __pyx_v_name = __Pyx_PyBytes_AsString(__pyx_arg_name); if (unlikely((!__pyx_v_name) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("coio.gethostbyname_ex");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_v_items = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_ips = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_canonical = Py_None; __Pyx_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":554
 *     unit tests) and slower (needs 2 DNS requests).
 *     """
 *     if is_valid_ipv4(name):             # <<<<<<<<<<<<<<
 *         return (name, [], [name])
 *     if is_valid_ipv6(name):
 */
  __pyx_t_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":555
 *     """
 *     if is_valid_ipv4(name):
 *         return (name, [], [name])             # <<<<<<<<<<<<<<
 *     if is_valid_ipv6(name):
 *         raise socket.gaierror(
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = PyList_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    PyList_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_2));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    PyTuple_SET_ITEM(__pyx_t_4, 2, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_5 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":556
 *     if is_valid_ipv4(name):
 *         return (name, [], [name])
 *     if is_valid_ipv6(name):             # <<<<<<<<<<<<<<
 *         raise socket.gaierror(
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 */
  __pyx_t_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  if (__pyx_t_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":557
 *         return (name, [], [name])
 *     if is_valid_ipv6(name):
 *         raise socket.gaierror(             # <<<<<<<<<<<<<<
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 *     if name in names_by_nameip:
 */
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__gaierror); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":558
 *     if is_valid_ipv6(name):
 *         raise socket.gaierror(
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')             # <<<<<<<<<<<<<<
 *     if name in names_by_nameip:
 *         items = names_by_nameip[name]
 */
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__EAI_ADDRFAMILY); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_40));
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_kp_s_40));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_40));
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":559
 *         raise socket.gaierror(
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 *     if name in names_by_nameip:             # <<<<<<<<<<<<<<
 *         items = names_by_nameip[name]
 *         return (items[1], items[2:], [items[0]])
 */
  __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = ((PySequence_Contains(__pyx_t_4, ((PyObject *)__pyx_t_3)))); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":560
 *             socket.EAI_ADDRFAMILY, 'Address family for hostname not supported')
 *     if name in names_by_nameip:
 *         items = names_by_nameip[name]             # <<<<<<<<<<<<<<
 *         return (items[1], items[2:], [items[0]])
 *     try:
 */
    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_nameip); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_5 = PyObject_GetItem(__pyx_t_4, ((PyObject *)__pyx_t_3)); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_items);
    __pyx_v_items = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":561
 *     if name in names_by_nameip:
 *         items = names_by_nameip[name]
 *         return (items[1], items[2:], [items[0]])             # <<<<<<<<<<<<<<
 *     try:
 *         ips = dns_resolve_ipv4(name).values
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_items, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = PySequence_GetSlice(__pyx_v_items, 2, PY_SSIZE_T_MAX); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_items, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 2, ((PyObject *)__pyx_t_2));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
    __pyx_t_5 = 0;
    __pyx_t_3 = 0;
    __pyx_t_2 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":562
 *         items = names_by_nameip[name]
 *         return (items[1], items[2:], [items[0]])
 *     try:             # <<<<<<<<<<<<<<
 *         ips = dns_resolve_ipv4(name).values
 *     except DnsLookupError:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":563
 *         return (items[1], items[2:], [items[0]])
 *     try:
 *         ips = dns_resolve_ipv4(name).values             # <<<<<<<<<<<<<<
 *     except DnsLookupError:
 *         raise_gaierror(sys.exc_info(), 0)
 */
      __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_ipv4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_2));
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
      __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__values); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L8_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_v_ips);
      __pyx_v_ips = __pyx_t_3;
      __pyx_t_3 = 0;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L15_try_end;
    __pyx_L8_error:;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":564
 *     try:
 *         ips = dns_resolve_ipv4(name).values
 *     except DnsLookupError:             # <<<<<<<<<<<<<<
 *         raise_gaierror(sys.exc_info(), 0)
 * 
 */
    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = PyErr_ExceptionMatches(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_7) {
      __Pyx_AddTraceback("coio.gethostbyname_ex");
      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_4);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":565
 *         ips = dns_resolve_ipv4(name).values
 *     except DnsLookupError:
 *         raise_gaierror(sys.exc_info(), 0)             # <<<<<<<<<<<<<<
 * 
 *     if ips[0] in names_by_ip:
 */
      __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 565; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 565; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 565; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __pyx_f_4coio_raise_gaierror(__pyx_t_5, 0); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 565; __pyx_clineno = __LINE__; goto __pyx_L10_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L9_exception_handled;
    }
    __pyx_L10_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L9_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L15_try_end:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":567
 *         raise_gaierror(sys.exc_info(), 0)
 * 
 *     if ips[0] in names_by_ip:             # <<<<<<<<<<<<<<
 *         canonical = names_by_ip[ips[0]][1]
 *     else:
 */
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_ips, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_ip); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = ((PySequence_Contains(__pyx_t_2, __pyx_t_4))); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":568
 * 
 *     if ips[0] in names_by_ip:
 *         canonical = names_by_ip[ips[0]][1]             # <<<<<<<<<<<<<<
 *     else:
 *         try:
 */
    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__names_by_ip); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_ips, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_GetItem(__pyx_t_2, __pyx_t_4); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 1, sizeof(long), PyInt_FromLong); if (!__pyx_t_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_canonical);
    __pyx_v_canonical = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L18;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":570
 *         canonical = names_by_ip[ips[0]][1]
 *     else:
 *         try:             # <<<<<<<<<<<<<<
 *             canonical = dns_resolve_reverse(ips[0]).values[0]
 *         except DnsLookupError:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":571
 *     else:
 *         try:
 *             canonical = dns_resolve_reverse(ips[0]).values[0]             # <<<<<<<<<<<<<<
 *         except DnsLookupError:
 *             raise_gaierror(sys.exc_info(), 0)
 */
        __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__dns_resolve_reverse); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_ips, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__values); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L19_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_v_canonical);
        __pyx_v_canonical = __pyx_t_3;
        __pyx_t_3 = 0;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L26_try_end;
      __pyx_L19_error:;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":572
 *         try:
 *             canonical = dns_resolve_reverse(ips[0]).values[0]
 *         except DnsLookupError:             # <<<<<<<<<<<<<<
 *             raise_gaierror(sys.exc_info(), 0)
 *     if canonical == name:
 */
      __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__DnsLookupError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = PyErr_ExceptionMatches(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_7) {
        __Pyx_AddTraceback("coio.gethostbyname_ex");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GOTREF(__pyx_t_4);

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":573
 *             canonical = dns_resolve_reverse(ips[0]).values[0]
 *         except DnsLookupError:
 *             raise_gaierror(sys.exc_info(), 0)             # <<<<<<<<<<<<<<
 *     if canonical == name:
 *         return (name, [], ips)
 */
        __pyx_t_8 = __Pyx_GetName(__pyx_m, __pyx_n_s__sys); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_5 = PyObject_GetAttr(__pyx_t_8, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = __pyx_f_4coio_raise_gaierror(__pyx_t_8, 0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; __pyx_clineno = __LINE__; goto __pyx_L21_except_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        goto __pyx_L20_exception_handled;
      }
      __pyx_L21_except_error:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L20_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L26_try_end:;
    }
  }
  __pyx_L18:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":574
 *         except DnsLookupError:
 *             raise_gaierror(sys.exc_info(), 0)
 *     if canonical == name:             # <<<<<<<<<<<<<<
 *         return (name, [], ips)
 *     else:
 */
  __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_canonical, ((PyObject *)__pyx_t_4), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":575
 *             raise_gaierror(sys.exc_info(), 0)
 *     if canonical == name:
 *         return (name, [], ips)             # <<<<<<<<<<<<<<
 *     else:
 *         return (canonical, [name], ips)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
    PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __Pyx_INCREF(__pyx_v_ips);
    PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_ips);
    __Pyx_GIVEREF(__pyx_v_ips);
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L29;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":577
 *         return (name, [], ips)
 *     else:
 *         return (canonical, [name], ips)             # <<<<<<<<<<<<<<
 * 
 * # TODO(pts): Implement socket.getaddrinfo()
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 577; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 577; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    PyList_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 577; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_canonical);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_canonical);
    __Pyx_GIVEREF(__pyx_v_canonical);
    PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __Pyx_INCREF(__pyx_v_ips);
    PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_ips);
    __Pyx_GIVEREF(__pyx_v_ips);
    __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
  }
  __pyx_L29:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("coio.gethostbyname_ex");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_items);
  __Pyx_DECREF(__pyx_v_ips);
  __Pyx_DECREF(__pyx_v_canonical);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":20
 * # Don't publish it, as a safety for read-only.
 * cdef tasklet main_loop_tasklet
 * def get_main_loop_tasklet():             # <<<<<<<<<<<<<<
 *   return main_loop_tasklet
 * main_loop_tasklet = stackless.tasklet(MainLoop)(link_helper_tasklet)
 */

static PyObject *__pyx_pf_4coio_get_main_loop_tasklet(PyObject *__pyx_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_4coio_get_main_loop_tasklet(PyObject *__pyx_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("get_main_loop_tasklet");
  __pyx_self = __pyx_self;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":21
 * cdef tasklet main_loop_tasklet
 * def get_main_loop_tasklet():
 *   return main_loop_tasklet             # <<<<<<<<<<<<<<
 * main_loop_tasklet = stackless.tasklet(MainLoop)(link_helper_tasklet)
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_4coio_main_loop_tasklet));
  __pyx_r = ((PyObject *)__pyx_v_4coio_main_loop_tasklet);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_tp_new_4coio_event(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_event *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_event *)o);
  p->handle = Py_None; Py_INCREF(Py_None);
  p->evtype = Py_None; Py_INCREF(Py_None);
  p->callback = Py_None; Py_INCREF(Py_None);
  p->args = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_event(PyObject *o) {
  struct __pyx_obj_4coio_event *p = (struct __pyx_obj_4coio_event *)o;
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pf_4coio_5event___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_XDECREF(p->handle);
  Py_XDECREF(p->evtype);
  Py_XDECREF(p->callback);
  Py_XDECREF(p->args);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_event(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_event *p = (struct __pyx_obj_4coio_event *)o;
  if (p->handle) {
    e = (*v)(p->handle, a); if (e) return e;
  }
  if (p->evtype) {
    e = (*v)(p->evtype, a); if (e) return e;
  }
  if (p->callback) {
    e = (*v)(p->callback, a); if (e) return e;
  }
  if (p->args) {
    e = (*v)(p->args, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_event(PyObject *o) {
  struct __pyx_obj_4coio_event *p = (struct __pyx_obj_4coio_event *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->handle);
  p->handle = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->evtype);
  p->evtype = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->callback);
  p->callback = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->args);
  p->args = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static struct PyMethodDef __pyx_methods_4coio_event[] = {
  {__Pyx_NAMESTR("__simple_callback"), (PyCFunction)__pyx_pf_4coio_5event___simple_callback, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("__callback"), (PyCFunction)__pyx_pf_4coio_5event___callback, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("add"), (PyCFunction)__pyx_pf_4coio_5event_add, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_5event_add)},
  {__Pyx_NAMESTR("pending"), (PyCFunction)__pyx_pf_4coio_5event_pending, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_5event_pending)},
  {__Pyx_NAMESTR("delete"), (PyCFunction)__pyx_pf_4coio_5event_delete, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_5event_delete)},
  {__Pyx_NAMESTR("__repr__"), (PyCFunction)__pyx_pf_4coio_5event___repr__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_event = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_event = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_event = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_event = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_event = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.event"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_event), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_event, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_pf_4coio_5event___repr__, /*tp_repr*/
  &__pyx_tp_as_number_event, /*tp_as_number*/
  &__pyx_tp_as_sequence_event, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_event, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_event, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("event(callback, arg=None, evtype=0, handle=None) -> event object\n    \n    Create a new event object with a user callback.\n\n    Arguments:\n\n    callback -- user callback with (ev, handle, evtype, arg) prototype\n    arg      -- optional callback arguments\n    evtype   -- bitmask of EV_READ or EV_WRITE, or EV_SIGNAL\n    handle   -- for EV_READ or EV_WRITE, a file handle, descriptor, or socket\n                for EV_SIGNAL, a signal number\n    "), /*tp_doc*/
  __pyx_tp_traverse_4coio_event, /*tp_traverse*/
  __pyx_tp_clear_4coio_event, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_event, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_4coio_5event___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_event, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_4coio_evbuffer(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  return o;
}

static void __pyx_tp_dealloc_4coio_evbuffer(PyObject *o) {
  (*Py_TYPE(o)->tp_free)(o);
}

static PyObject *__pyx_getprop_4coio_8evbuffer_totallen(PyObject *o, void *x) {
  return __pyx_pf_4coio_8evbuffer_8totallen___get__(o);
}

static PyObject *__pyx_getprop_4coio_8evbuffer_misalign(PyObject *o, void *x) {
  return __pyx_pf_4coio_8evbuffer_8misalign___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_evbuffer[] = {
  {__Pyx_NAMESTR("__repr__"), (PyCFunction)__pyx_pf_4coio_8evbuffer___repr__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("reset"), (PyCFunction)__pyx_pf_4coio_8evbuffer_reset, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_reset)},
  {__Pyx_NAMESTR("expand"), (PyCFunction)__pyx_pf_4coio_8evbuffer_expand, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_expand)},
  {__Pyx_NAMESTR("drain"), (PyCFunction)__pyx_pf_4coio_8evbuffer_drain, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("append"), (PyCFunction)__pyx_pf_4coio_8evbuffer_append, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("consume"), (PyCFunction)__pyx_pf_4coio_8evbuffer_consume, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_consume)},
  {__Pyx_NAMESTR("peek"), (PyCFunction)__pyx_pf_4coio_8evbuffer_peek, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_peek)},
  {__Pyx_NAMESTR("find"), (PyCFunction)__pyx_pf_4coio_8evbuffer_find, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("append_clear"), (PyCFunction)__pyx_pf_4coio_8evbuffer_append_clear, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_append_clear)},
  {__Pyx_NAMESTR("consumeline"), (PyCFunction)__pyx_pf_4coio_8evbuffer_consumeline, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_consumeline)},
  {__Pyx_NAMESTR("nb_accept"), (PyCFunction)__pyx_pf_4coio_8evbuffer_nb_accept, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("nb_flush"), (PyCFunction)__pyx_pf_4coio_8evbuffer_nb_flush, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_nb_flush)},
  {__Pyx_NAMESTR("nb_readline"), (PyCFunction)__pyx_pf_4coio_8evbuffer_nb_readline, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("peekline"), (PyCFunction)__pyx_pf_4coio_8evbuffer_peekline, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_peekline)},
  {__Pyx_NAMESTR("read_from_fd"), (PyCFunction)__pyx_pf_4coio_8evbuffer_read_from_fd, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_read_from_fd)},
  {__Pyx_NAMESTR("read_from_fd_again"), (PyCFunction)__pyx_pf_4coio_8evbuffer_read_from_fd_again, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_read_from_fd_again)},
  {__Pyx_NAMESTR("write_to_fd"), (PyCFunction)__pyx_pf_4coio_8evbuffer_write_to_fd, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_write_to_fd)},
  {__Pyx_NAMESTR("write_to_fd_again"), (PyCFunction)__pyx_pf_4coio_8evbuffer_write_to_fd_again, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8evbuffer_write_to_fd_again)},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_evbuffer[] = {
  {(char *)"totallen", __pyx_getprop_4coio_8evbuffer_totallen, 0, 0, 0},
  {(char *)"misalign", __pyx_getprop_4coio_8evbuffer_misalign, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_evbuffer = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_evbuffer = {
  __pyx_pf_4coio_8evbuffer___len__, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_evbuffer = {
  __pyx_pf_4coio_8evbuffer___len__, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_evbuffer = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_evbuffer = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.evbuffer"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_evbuffer), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_evbuffer, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_pf_4coio_8evbuffer___repr__, /*tp_repr*/
  &__pyx_tp_as_number_evbuffer, /*tp_as_number*/
  &__pyx_tp_as_sequence_evbuffer, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_evbuffer, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_evbuffer, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER, /*tp_flags*/
  __Pyx_DOCSTR("A Python wrapper around libevent's I/O buffer: struct evbuffer\n\n    Please note that this buffer wastes memory: after reading a very long\n    line, the buffer space won't be reclaimed until self.reset() is called.\n    "), /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_evbuffer, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_evbuffer, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_evbuffer, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_4coio_nbfile(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbfile *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbfile *)o);
  p->close_ref = Py_None; Py_INCREF(Py_None);
  p->c_mode = Py_None; Py_INCREF(Py_None);
  p->c_name = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbfile(PyObject *o) {
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  Py_XDECREF(p->close_ref);
  Py_XDECREF(p->c_mode);
  Py_XDECREF(p->c_name);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbfile(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  if (p->close_ref) {
    e = (*v)(p->close_ref, a); if (e) return e;
  }
  if (p->c_mode) {
    e = (*v)(p->c_mode, a); if (e) return e;
  }
  if (p->c_name) {
    e = (*v)(p->c_name, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbfile(PyObject *o) {
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->close_ref);
  p->close_ref = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->c_mode);
  p->c_mode = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->c_name);
  p->c_name = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_4coio_6nbfile_closed(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_6closed___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_do_close(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_8do_close___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_limit(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_10read_limit___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_read_limit(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_4coio_6nbfile_10read_limit___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_mode(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_4mode___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_name(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_4name___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_softspace(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_9softspace___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_softspace(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_4coio_6nbfile_9softspace___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_encoding(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_8encoding___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_newlines(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_8newlines___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_errors(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_6errors___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_buffer_len(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_15read_buffer_len___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_write_buffer_len(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_16write_buffer_len___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_write_buffer_limit(PyObject *o, void *x) {
  return __pyx_pf_4coio_6nbfile_18write_buffer_limit___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbfile[] = {
  {__Pyx_NAMESTR("fileno"), (PyCFunction)__pyx_pf_4coio_6nbfile_fileno, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("write_fileno"), (PyCFunction)__pyx_pf_4coio_6nbfile_write_fileno, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("close"), (PyCFunction)__pyx_pf_4coio_6nbfile_close, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("write"), (PyCFunction)__pyx_pf_4coio_6nbfile_write, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("flush"), (PyCFunction)__pyx_pf_4coio_6nbfile_flush, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("discard_write_buffer"), (PyCFunction)__pyx_pf_4coio_6nbfile_discard_write_buffer, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("discard"), (PyCFunction)__pyx_pf_4coio_6nbfile_discard, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_6nbfile_discard)},
  {__Pyx_NAMESTR("discard_to_read_limit"), (PyCFunction)__pyx_pf_4coio_6nbfile_discard_to_read_limit, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_6nbfile_discard_to_read_limit)},
  {__Pyx_NAMESTR("read"), (PyCFunction)__pyx_pf_4coio_6nbfile_read, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_6nbfile_read)},
  {__Pyx_NAMESTR("read_at_most"), (PyCFunction)__pyx_pf_4coio_6nbfile_read_at_most, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_6nbfile_read_at_most)},
  {__Pyx_NAMESTR("readline"), (PyCFunction)__pyx_pf_4coio_6nbfile_readline, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("__next__"), (PyCFunction)__pyx_pf_4coio_6nbfile___next__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("__iter__"), (PyCFunction)__pyx_pf_4coio_6nbfile___iter__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("xreadlines"), (PyCFunction)__pyx_pf_4coio_6nbfile_xreadlines, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("isatty"), (PyCFunction)__pyx_pf_4coio_6nbfile_isatty, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("truncate"), (PyCFunction)__pyx_pf_4coio_6nbfile_truncate, METH_O, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbfile[] = {
  {(char *)"closed", __pyx_getprop_4coio_6nbfile_closed, 0, 0, 0},
  {(char *)"do_close", __pyx_getprop_4coio_6nbfile_do_close, 0, 0, 0},
  {(char *)"read_limit", __pyx_getprop_4coio_6nbfile_read_limit, __pyx_setprop_4coio_6nbfile_read_limit, __Pyx_DOCSTR(__pyx_k_41), 0},
  {(char *)"mode", __pyx_getprop_4coio_6nbfile_mode, 0, 0, 0},
  {(char *)"name", __pyx_getprop_4coio_6nbfile_name, 0, 0, 0},
  {(char *)"softspace", __pyx_getprop_4coio_6nbfile_softspace, __pyx_setprop_4coio_6nbfile_softspace, 0, 0},
  {(char *)"encoding", __pyx_getprop_4coio_6nbfile_encoding, 0, 0, 0},
  {(char *)"newlines", __pyx_getprop_4coio_6nbfile_newlines, 0, 0, 0},
  {(char *)"errors", __pyx_getprop_4coio_6nbfile_errors, 0, 0, 0},
  {(char *)"read_buffer_len", __pyx_getprop_4coio_6nbfile_read_buffer_len, 0, 0, 0},
  {(char *)"write_buffer_len", __pyx_getprop_4coio_6nbfile_write_buffer_len, 0, 0, 0},
  {(char *)"write_buffer_limit", __pyx_getprop_4coio_6nbfile_write_buffer_limit, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbfile = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbfile = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbfile = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbfile = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_nbfile = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.nbfile"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbfile), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbfile, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbfile, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbfile, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbfile, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbfile, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("A non-blocking file (I/O channel).\n\n    The filehandles are assumed to be nonblocking.\n    "), /*tp_doc*/
  __pyx_tp_traverse_4coio_nbfile, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbfile, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pf_4coio_6nbfile___iter__, /*tp_iter*/
  __pyx_pf_4coio_6nbfile___next__, /*tp_iternext*/
  __pyx_methods_4coio_nbfile, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbfile, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_4coio_6nbfile___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbfile, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_4coio_nbsocket(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbsocket *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbsocket *)o);
  p->realsock = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  Py_XDECREF(p->realsock);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbsocket(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  if (p->realsock) {
    e = (*v)(p->realsock, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->realsock);
  p->realsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_4coio_8nbsocket_do_close(PyObject *o, void *x) {
  return __pyx_pf_4coio_8nbsocket_8do_close___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket__sock(PyObject *o, void *x) {
  return __pyx_pf_4coio_8nbsocket_5_sock___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_type(PyObject *o, void *x) {
  return __pyx_pf_4coio_8nbsocket_4type___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_family(PyObject *o, void *x) {
  return __pyx_pf_4coio_8nbsocket_6family___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_timeout(PyObject *o, void *x) {
  return __pyx_pf_4coio_8nbsocket_7timeout___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_proto(PyObject *o, void *x) {
  return __pyx_pf_4coio_8nbsocket_5proto___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbsocket[] = {
  {__Pyx_NAMESTR("fileno"), (PyCFunction)__pyx_pf_4coio_8nbsocket_fileno, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("dup"), (PyCFunction)__pyx_pf_4coio_8nbsocket_dup, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("close"), (PyCFunction)__pyx_pf_4coio_8nbsocket_close, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("setdoclose"), (PyCFunction)__pyx_pf_4coio_8nbsocket_setdoclose, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_8nbsocket_setdoclose)},
  {__Pyx_NAMESTR("setsockopt"), (PyCFunction)__pyx_pf_4coio_8nbsocket_setsockopt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("getsockopt"), (PyCFunction)__pyx_pf_4coio_8nbsocket_getsockopt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("getsockname"), (PyCFunction)__pyx_pf_4coio_8nbsocket_getsockname, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("getpeername"), (PyCFunction)__pyx_pf_4coio_8nbsocket_getpeername, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("bind"), (PyCFunction)__pyx_pf_4coio_8nbsocket_bind, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("listen"), (PyCFunction)__pyx_pf_4coio_8nbsocket_listen, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("gettimeout"), (PyCFunction)__pyx_pf_4coio_8nbsocket_gettimeout, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("setblocking"), (PyCFunction)__pyx_pf_4coio_8nbsocket_setblocking, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("settimeout"), (PyCFunction)__pyx_pf_4coio_8nbsocket_settimeout, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("accept"), (PyCFunction)__pyx_pf_4coio_8nbsocket_accept, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("connect"), (PyCFunction)__pyx_pf_4coio_8nbsocket_connect, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("connect_ex"), (PyCFunction)__pyx_pf_4coio_8nbsocket_connect_ex, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("shutdown"), (PyCFunction)__pyx_pf_4coio_8nbsocket_shutdown, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("recv"), (PyCFunction)__pyx_pf_4coio_8nbsocket_recv, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("recvfrom"), (PyCFunction)__pyx_pf_4coio_8nbsocket_recvfrom, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("recv_into"), (PyCFunction)__pyx_pf_4coio_8nbsocket_recv_into, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("recvfrom_into"), (PyCFunction)__pyx_pf_4coio_8nbsocket_recvfrom_into, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("send"), (PyCFunction)__pyx_pf_4coio_8nbsocket_send, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("sendto"), (PyCFunction)__pyx_pf_4coio_8nbsocket_sendto, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("sendall"), (PyCFunction)__pyx_pf_4coio_8nbsocket_sendall, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("makefile_samefd"), (PyCFunction)__pyx_pf_4coio_8nbsocket_makefile_samefd, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8nbsocket_makefile_samefd)},
  {__Pyx_NAMESTR("makefile"), (PyCFunction)__pyx_pf_4coio_8nbsocket_makefile, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_8nbsocket_makefile)},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbsocket[] = {
  {(char *)"do_close", __pyx_getprop_4coio_8nbsocket_do_close, 0, 0, 0},
  {(char *)"_sock", __pyx_getprop_4coio_8nbsocket__sock, 0, __Pyx_DOCSTR(__pyx_k_42), 0},
  {(char *)"type", __pyx_getprop_4coio_8nbsocket_type, 0, 0, 0},
  {(char *)"family", __pyx_getprop_4coio_8nbsocket_family, 0, 0, 0},
  {(char *)"timeout", __pyx_getprop_4coio_8nbsocket_timeout, 0, __Pyx_DOCSTR(__pyx_k_43), 0},
  {(char *)"proto", __pyx_getprop_4coio_8nbsocket_proto, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbsocket = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbsocket = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbsocket = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbsocket = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_nbsocket = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.nbsocket"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbsocket), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbsocket, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbsocket, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbsocket, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbsocket, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbsocket, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("Non-blocking drop-in replacement class for socket.socket.\n\n    See the function new_realsocket for using this class as a replacement for\n    socket._realsocket.\n    "), /*tp_doc*/
  __pyx_tp_traverse_4coio_nbsocket, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbsocket, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_nbsocket, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbsocket, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_4coio_8nbsocket___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbsocket, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_4coio_nbsslsocket(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbsslsocket *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbsslsocket *)o);
  p->realsock = Py_None; Py_INCREF(Py_None);
  p->sslsock = Py_None; Py_INCREF(Py_None);
  p->sslobj = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbsslsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  Py_XDECREF(p->realsock);
  Py_XDECREF(p->sslsock);
  Py_XDECREF(p->sslobj);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbsslsocket(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  if (p->realsock) {
    e = (*v)(p->realsock, a); if (e) return e;
  }
  if (p->sslsock) {
    e = (*v)(p->sslsock, a); if (e) return e;
  }
  if (p->sslobj) {
    e = (*v)(p->sslobj, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbsslsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->realsock);
  p->realsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->sslsock);
  p->sslsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->sslobj);
  p->sslobj = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_type(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_4type___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_family(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_6family___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_proto(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_5proto___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sslobj(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_7_sslobj___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sock(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_5_sock___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sslsock(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_8_sslsock___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_keyfile(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_7keyfile___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_certfile(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_8certfile___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_cert_reqs(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_9cert_reqs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_ssl_version(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_11ssl_version___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_ca_certs(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_8ca_certs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_do_handshake_on_connect(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_23do_handshake_on_connect___get__(o);
}

static int __pyx_setprop_4coio_11nbsslsocket_do_handshake_on_connect(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_4coio_11nbsslsocket_23do_handshake_on_connect___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_suppress_ragged_eofs(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__makefile_refs(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_14_makefile_refs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_timeout(PyObject *o, void *x) {
  return __pyx_pf_4coio_11nbsslsocket_7timeout___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbsslsocket[] = {
  {__Pyx_NAMESTR("fileno"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_fileno, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("dup"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_dup, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_11nbsslsocket_dup)},
  {__Pyx_NAMESTR("close"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_close, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("setsockopt"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_setsockopt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("getsockopt"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_getsockopt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("getsockname"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_getsockname, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("getpeername"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_getpeername, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("bind"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_bind, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("listen"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_listen, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("gettimeout"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_gettimeout, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("setblocking"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_setblocking, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("settimeout"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_settimeout, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("read"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_read, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_11nbsslsocket_read)},
  {__Pyx_NAMESTR("write"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_write, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_11nbsslsocket_write)},
  {__Pyx_NAMESTR("accept"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_accept, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("connect"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_connect, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("connect_ex"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_connect_ex, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_11nbsslsocket_connect_ex)},
  {__Pyx_NAMESTR("shutdown"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_shutdown, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("pending"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_pending, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("unwrap"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_unwrap, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("do_handshake"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_do_handshake, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("getpeercert"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_getpeercert, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("cipher"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_cipher, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("recv"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_recv, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_11nbsslsocket_recv)},
  {__Pyx_NAMESTR("recvfrom"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_recvfrom, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("recv_into"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_recv_into, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("recvfrom_into"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_recvfrom_into, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("send"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_send, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("sendto"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_sendto, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("sendall"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_sendall, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("makefile"), (PyCFunction)__pyx_pf_4coio_11nbsslsocket_makefile, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_11nbsslsocket_makefile)},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbsslsocket[] = {
  {(char *)"type", __pyx_getprop_4coio_11nbsslsocket_type, 0, 0, 0},
  {(char *)"family", __pyx_getprop_4coio_11nbsslsocket_family, 0, 0, 0},
  {(char *)"proto", __pyx_getprop_4coio_11nbsslsocket_proto, 0, 0, 0},
  {(char *)"_sslobj", __pyx_getprop_4coio_11nbsslsocket__sslobj, 0, 0, 0},
  {(char *)"_sock", __pyx_getprop_4coio_11nbsslsocket__sock, 0, 0, 0},
  {(char *)"_sslsock", __pyx_getprop_4coio_11nbsslsocket__sslsock, 0, __Pyx_DOCSTR(__pyx_k_44), 0},
  {(char *)"keyfile", __pyx_getprop_4coio_11nbsslsocket_keyfile, 0, 0, 0},
  {(char *)"certfile", __pyx_getprop_4coio_11nbsslsocket_certfile, 0, 0, 0},
  {(char *)"cert_reqs", __pyx_getprop_4coio_11nbsslsocket_cert_reqs, 0, 0, 0},
  {(char *)"ssl_version", __pyx_getprop_4coio_11nbsslsocket_ssl_version, 0, 0, 0},
  {(char *)"ca_certs", __pyx_getprop_4coio_11nbsslsocket_ca_certs, 0, 0, 0},
  {(char *)"do_handshake_on_connect", __pyx_getprop_4coio_11nbsslsocket_do_handshake_on_connect, __pyx_setprop_4coio_11nbsslsocket_do_handshake_on_connect, 0, 0},
  {(char *)"suppress_ragged_eofs", __pyx_getprop_4coio_11nbsslsocket_suppress_ragged_eofs, 0, 0, 0},
  {(char *)"_makefile_refs", __pyx_getprop_4coio_11nbsslsocket__makefile_refs, 0, 0, 0},
  {(char *)"timeout", __pyx_getprop_4coio_11nbsslsocket_timeout, 0, __Pyx_DOCSTR(__pyx_k_45), 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbsslsocket = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbsslsocket = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbsslsocket = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbsslsocket = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_nbsslsocket = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.nbsslsocket"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbsslsocket), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbsslsocket, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbsslsocket, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbsslsocket, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbsslsocket, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbsslsocket, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("Non-blocking drop-in replacement class for ssl.SSLSocket.\n\n    Please note that this class is not as speed-optimized as nbsocket or\n    nbfile, because how the `ssl' module provides abstractions.\n\n    Just like ssl.SSLSocket, nbsslsocket uses a socket._realsocket\n    (derived from the first constructor argument) for the underlying raw\n    communication.\n\n    Just like ssl.SSLSocket, please don't communicate using the unerlying socket._realsocket\n    after the nbsslsocket has been created -- but close it when\n    necessary. Just like ssl.SSLSocket, nbsslsocket will never call the\n    .close() method of the underlying socket._realsocket, it will just\n    drop reference to it.\n\n    Args:\n      args: Same arguments as to the ssl.SSLSocket constructor.\n        ssl.SSLSocket requires a socket.socket as a first argument, and\n        derives its underlying the socket._realsocket from its first\n        argument (using the ._sock property). As an exterions to this,\n        nbsslsocket accepts a socket.socket, socket._realsocket or\n        nbsocket (all treated equvalently) in its first argument, and gets\n        its underlying socket._realsocket accordingly.\n    "), /*tp_doc*/
  __pyx_tp_traverse_4coio_nbsslsocket, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbsslsocket, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_nbsslsocket, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbsslsocket, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_4coio_11nbsslsocket___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbsslsocket, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_4coio_sockwrapper(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_sockwrapper *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_sockwrapper *)o);
  p->c_sock = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_sockwrapper(PyObject *o) {
  struct __pyx_obj_4coio_sockwrapper *p = (struct __pyx_obj_4coio_sockwrapper *)o;
  Py_XDECREF(p->c_sock);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_sockwrapper(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_sockwrapper *p = (struct __pyx_obj_4coio_sockwrapper *)o;
  if (p->c_sock) {
    e = (*v)(p->c_sock, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_sockwrapper(PyObject *o) {
  struct __pyx_obj_4coio_sockwrapper *p = (struct __pyx_obj_4coio_sockwrapper *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->c_sock);
  p->c_sock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_4coio_11sockwrapper__sock(PyObject *o, void *x) {
  return __pyx_pf_4coio_11sockwrapper_5_sock___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_sockwrapper[] = {
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_sockwrapper[] = {
  {(char *)"_sock", __pyx_getprop_4coio_11sockwrapper__sock, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_sockwrapper = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_sockwrapper = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_sockwrapper = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_sockwrapper = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_sockwrapper = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.sockwrapper"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_sockwrapper), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_sockwrapper, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_sockwrapper, /*tp_as_number*/
  &__pyx_tp_as_sequence_sockwrapper, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_sockwrapper, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_sockwrapper, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("A helper class for holding a self._sock."), /*tp_doc*/
  __pyx_tp_traverse_4coio_sockwrapper, /*tp_traverse*/
  __pyx_tp_clear_4coio_sockwrapper, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_sockwrapper, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_sockwrapper, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_4coio_11sockwrapper___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_sockwrapper, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_4coio_sleeper(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  return o;
}

static void __pyx_tp_dealloc_4coio_sleeper(PyObject *o) {
  (*Py_TYPE(o)->tp_free)(o);
}

static struct PyMethodDef __pyx_methods_4coio_sleeper[] = {
  {__Pyx_NAMESTR("sleep"), (PyCFunction)__pyx_pf_4coio_7sleeper_sleep, METH_O, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_sleeper = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_sleeper = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_sleeper = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_sleeper = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_sleeper = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.sleeper"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_sleeper), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_sleeper, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_sleeper, /*tp_as_number*/
  &__pyx_tp_as_sequence_sleeper, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_sleeper, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_sleeper, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_sleeper, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_sleeper, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_4coio_dnsresult(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_dnsresult *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_dnsresult *)o);
  p->_values = ((PyObject *)Py_None); Py_INCREF(Py_None);
  if (__pyx_pf_4coio_9dnsresult___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_4coio_dnsresult(PyObject *o) {
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  Py_XDECREF(((PyObject *)p->_values));
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_dnsresult(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  if (p->_values) {
    e = (*v)(p->_values, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_dnsresult(PyObject *o) {
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->_values);
  p->_values = ((PyObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_4coio_9dnsresult_t(PyObject *o, void *x) {
  return __pyx_pf_4coio_9dnsresult_1t___get__(o);
}

static PyObject *__pyx_getprop_4coio_9dnsresult_ttl(PyObject *o, void *x) {
  return __pyx_pf_4coio_9dnsresult_3ttl___get__(o);
}

static PyObject *__pyx_getprop_4coio_9dnsresult_values(PyObject *o, void *x) {
  return __pyx_pf_4coio_9dnsresult_6values___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_dnsresult[] = {
  {__Pyx_NAMESTR("__repr__"), (PyCFunction)__pyx_pf_4coio_9dnsresult___repr__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_dnsresult[] = {
  {(char *)"t", __pyx_getprop_4coio_9dnsresult_t, 0, 0, 0},
  {(char *)"ttl", __pyx_getprop_4coio_9dnsresult_ttl, 0, 0, 0},
  {(char *)"values", __pyx_getprop_4coio_9dnsresult_values, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_dnsresult = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_dnsresult = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_dnsresult = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_dnsresult = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_4coio_dnsresult = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("coio.dnsresult"), /*tp_name*/
  sizeof(struct __pyx_obj_4coio_dnsresult), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_dnsresult, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_pf_4coio_9dnsresult___repr__, /*tp_repr*/
  &__pyx_tp_as_number_dnsresult, /*tp_as_number*/
  &__pyx_tp_as_sequence_dnsresult, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_dnsresult, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_dnsresult, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("Result of a DNS lookup call.\n\n    Attributes;\n      t: DNS record type constant, e.g. DNS_IPv4_A\n      ttl: time-to-live: number of seconds the result can be cached until\n      values: Nonempty list of ASCII strings containing result values. The\n        first value should be used by default. Repeating the query might\n        return the same values in different order.\n    "), /*tp_doc*/
  __pyx_tp_traverse_4coio_dnsresult, /*tp_traverse*/
  __pyx_tp_clear_4coio_dnsresult, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_dnsresult, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_dnsresult, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_dnsresult, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct PyMethodDef __pyx_methods[] = {
  {__Pyx_NAMESTR("dispatch"), (PyCFunction)__pyx_pf_4coio_dispatch, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_dispatch)},
  {__Pyx_NAMESTR("loop"), (PyCFunction)__pyx_pf_4coio_loop, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_loop)},
  {__Pyx_NAMESTR("abort"), (PyCFunction)__pyx_pf_4coio_abort, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_abort)},
  {__Pyx_NAMESTR("SendExceptionAndRun"), (PyCFunction)__pyx_pf_4coio_SendExceptionAndRun, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_SendExceptionAndRun)},
  {__Pyx_NAMESTR("LinkHelper"), (PyCFunction)__pyx_pf_4coio_LinkHelper, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("MainLoop"), (PyCFunction)__pyx_pf_4coio_MainLoop, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("SigIntHandler"), (PyCFunction)__pyx_pf_4coio_SigIntHandler, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("set_fd_blocking"), (PyCFunction)__pyx_pf_4coio_set_fd_blocking, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_set_fd_blocking)},
  {__Pyx_NAMESTR("new_realsocket"), (PyCFunction)__pyx_pf_4coio_new_realsocket, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_new_realsocket)},
  {__Pyx_NAMESTR("new_realsocket_fromfd"), (PyCFunction)__pyx_pf_4coio_new_realsocket_fromfd, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_new_realsocket_fromfd)},
  {__Pyx_NAMESTR("sleep"), (PyCFunction)__pyx_pf_4coio_sleep, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_sleep)},
  {__Pyx_NAMESTR("fdopen"), (PyCFunction)__pyx_pf_4coio_fdopen, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_fdopen)},
  {__Pyx_NAMESTR("dns_init"), (PyCFunction)__pyx_pf_4coio_dns_init, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_dns_init)},
  {__Pyx_NAMESTR("dns_init_force"), (PyCFunction)__pyx_pf_4coio_dns_init_force, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_4coio_dns_init_force)},
  {__Pyx_NAMESTR("dns_shutdown"), (PyCFunction)__pyx_pf_4coio_dns_shutdown, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_dns_shutdown)},
  {__Pyx_NAMESTR("dns_resolve_ipv4"), (PyCFunction)__pyx_pf_4coio_dns_resolve_ipv4, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_dns_resolve_ipv4)},
  {__Pyx_NAMESTR("dns_resolve_ipv6"), (PyCFunction)__pyx_pf_4coio_dns_resolve_ipv6, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_dns_resolve_ipv6)},
  {__Pyx_NAMESTR("dns_resolve_reverse"), (PyCFunction)__pyx_pf_4coio_dns_resolve_reverse, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_dns_resolve_reverse)},
  {__Pyx_NAMESTR("read_etc_hosts"), (PyCFunction)__pyx_pf_4coio_read_etc_hosts, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_read_etc_hosts)},
  {__Pyx_NAMESTR("gethostbyname"), (PyCFunction)__pyx_pf_4coio_gethostbyname, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_gethostbyname)},
  {__Pyx_NAMESTR("gethostbyaddr"), (PyCFunction)__pyx_pf_4coio_gethostbyaddr, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_gethostbyaddr)},
  {__Pyx_NAMESTR("getfqdn"), (PyCFunction)__pyx_pf_4coio_getfqdn, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_4coio_getfqdn)},
  {__Pyx_NAMESTR("gethostbyname_ex"), (PyCFunction)__pyx_pf_4coio_gethostbyname_ex, METH_O, __Pyx_DOCSTR(__pyx_doc_4coio_gethostbyname_ex)},
  {__Pyx_NAMESTR("get_main_loop_tasklet"), (PyCFunction)__pyx_pf_4coio_get_main_loop_tasklet, METH_NOARGS, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    __Pyx_NAMESTR("coio"),
    0, /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp_s_1, __pyx_k_1, sizeof(__pyx_k_1), 0, 0, 1, 0},
  {&__pyx_kp_s_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 0, 1, 0},
  {&__pyx_kp_u_100, __pyx_k_100, sizeof(__pyx_k_100), 0, 1, 0, 0},
  {&__pyx_kp_u_101, __pyx_k_101, sizeof(__pyx_k_101), 0, 1, 0, 0},
  {&__pyx_kp_u_102, __pyx_k_102, sizeof(__pyx_k_102), 0, 1, 0, 0},
  {&__pyx_kp_u_103, __pyx_k_103, sizeof(__pyx_k_103), 0, 1, 0, 0},
  {&__pyx_kp_s_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 0, 1, 0},
  {&__pyx_n_s_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 0, 1, 1},
  {&__pyx_n_s_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 0, 1, 1},
  {&__pyx_n_s_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 0, 1, 1},
  {&__pyx_kp_s_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 0, 1, 0},
  {&__pyx_kp_s_16, __pyx_k_16, sizeof(__pyx_k_16), 0, 0, 1, 0},
  {&__pyx_kp_s_18, __pyx_k_18, sizeof(__pyx_k_18), 0, 0, 1, 0},
  {&__pyx_kp_s_19, __pyx_k_19, sizeof(__pyx_k_19), 0, 0, 1, 0},
  {&__pyx_kp_s_20, __pyx_k_20, sizeof(__pyx_k_20), 0, 0, 1, 0},
  {&__pyx_kp_s_21, __pyx_k_21, sizeof(__pyx_k_21), 0, 0, 1, 0},
  {&__pyx_kp_s_22, __pyx_k_22, sizeof(__pyx_k_22), 0, 0, 1, 0},
  {&__pyx_kp_s_23, __pyx_k_23, sizeof(__pyx_k_23), 0, 0, 1, 0},
  {&__pyx_kp_s_24, __pyx_k_24, sizeof(__pyx_k_24), 0, 0, 1, 0},
  {&__pyx_kp_s_25, __pyx_k_25, sizeof(__pyx_k_25), 0, 0, 1, 0},
  {&__pyx_kp_s_26, __pyx_k_26, sizeof(__pyx_k_26), 0, 0, 1, 0},
  {&__pyx_kp_s_27, __pyx_k_27, sizeof(__pyx_k_27), 0, 0, 1, 0},
  {&__pyx_kp_s_28, __pyx_k_28, sizeof(__pyx_k_28), 0, 0, 1, 0},
  {&__pyx_kp_s_29, __pyx_k_29, sizeof(__pyx_k_29), 0, 0, 1, 0},
  {&__pyx_kp_s_3, __pyx_k_3, sizeof(__pyx_k_3), 0, 0, 1, 0},
  {&__pyx_kp_s_30, __pyx_k_30, sizeof(__pyx_k_30), 0, 0, 1, 0},
  {&__pyx_kp_s_31, __pyx_k_31, sizeof(__pyx_k_31), 0, 0, 1, 0},
  {&__pyx_kp_s_32, __pyx_k_32, sizeof(__pyx_k_32), 0, 0, 1, 0},
  {&__pyx_kp_s_33, __pyx_k_33, sizeof(__pyx_k_33), 0, 0, 1, 0},
  {&__pyx_kp_s_34, __pyx_k_34, sizeof(__pyx_k_34), 0, 0, 1, 0},
  {&__pyx_kp_s_35, __pyx_k_35, sizeof(__pyx_k_35), 0, 0, 1, 0},
  {&__pyx_kp_s_36, __pyx_k_36, sizeof(__pyx_k_36), 0, 0, 1, 0},
  {&__pyx_kp_s_37, __pyx_k_37, sizeof(__pyx_k_37), 0, 0, 1, 0},
  {&__pyx_n_s_38, __pyx_k_38, sizeof(__pyx_k_38), 0, 0, 1, 1},
  {&__pyx_kp_s_39, __pyx_k_39, sizeof(__pyx_k_39), 0, 0, 1, 0},
  {&__pyx_kp_s_4, __pyx_k_4, sizeof(__pyx_k_4), 0, 0, 1, 0},
  {&__pyx_kp_s_40, __pyx_k_40, sizeof(__pyx_k_40), 0, 0, 1, 0},
  {&__pyx_kp_s_46, __pyx_k_46, sizeof(__pyx_k_46), 0, 0, 1, 0},
  {&__pyx_kp_s_47, __pyx_k_47, sizeof(__pyx_k_47), 0, 0, 1, 0},
  {&__pyx_kp_s_48, __pyx_k_48, sizeof(__pyx_k_48), 0, 0, 1, 0},
  {&__pyx_kp_s_49, __pyx_k_49, sizeof(__pyx_k_49), 0, 0, 1, 0},
  {&__pyx_kp_s_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 1, 0},
  {&__pyx_kp_s_50, __pyx_k_50, sizeof(__pyx_k_50), 0, 0, 1, 0},
  {&__pyx_kp_s_51, __pyx_k_51, sizeof(__pyx_k_51), 0, 0, 1, 0},
  {&__pyx_n_s_52, __pyx_k_52, sizeof(__pyx_k_52), 0, 0, 1, 1},
  {&__pyx_n_s_53, __pyx_k_53, sizeof(__pyx_k_53), 0, 0, 1, 1},
  {&__pyx_kp_u_54, __pyx_k_54, sizeof(__pyx_k_54), 0, 1, 0, 0},
  {&__pyx_kp_u_55, __pyx_k_55, sizeof(__pyx_k_55), 0, 1, 0, 0},
  {&__pyx_kp_u_56, __pyx_k_56, sizeof(__pyx_k_56), 0, 1, 0, 0},
  {&__pyx_kp_u_57, __pyx_k_57, sizeof(__pyx_k_57), 0, 1, 0, 0},
  {&__pyx_kp_u_58, __pyx_k_58, sizeof(__pyx_k_58), 0, 1, 0, 0},
  {&__pyx_kp_u_59, __pyx_k_59, sizeof(__pyx_k_59), 0, 1, 0, 0},
  {&__pyx_kp_s_6, __pyx_k_6, sizeof(__pyx_k_6), 0, 0, 1, 0},
  {&__pyx_kp_u_60, __pyx_k_60, sizeof(__pyx_k_60), 0, 1, 0, 0},
  {&__pyx_kp_u_61, __pyx_k_61, sizeof(__pyx_k_61), 0, 1, 0, 0},
  {&__pyx_kp_u_62, __pyx_k_62, sizeof(__pyx_k_62), 0, 1, 0, 0},
  {&__pyx_kp_u_63, __pyx_k_63, sizeof(__pyx_k_63), 0, 1, 0, 0},
  {&__pyx_kp_u_64, __pyx_k_64, sizeof(__pyx_k_64), 0, 1, 0, 0},
  {&__pyx_kp_u_65, __pyx_k_65, sizeof(__pyx_k_65), 0, 1, 0, 0},
  {&__pyx_kp_u_66, __pyx_k_66, sizeof(__pyx_k_66), 0, 1, 0, 0},
  {&__pyx_kp_u_67, __pyx_k_67, sizeof(__pyx_k_67), 0, 1, 0, 0},
  {&__pyx_kp_u_68, __pyx_k_68, sizeof(__pyx_k_68), 0, 1, 0, 0},
  {&__pyx_kp_u_69, __pyx_k_69, sizeof(__pyx_k_69), 0, 1, 0, 0},
  {&__pyx_kp_s_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 0, 1, 0},
  {&__pyx_kp_u_70, __pyx_k_70, sizeof(__pyx_k_70), 0, 1, 0, 0},
  {&__pyx_kp_u_71, __pyx_k_71, sizeof(__pyx_k_71), 0, 1, 0, 0},
  {&__pyx_kp_u_72, __pyx_k_72, sizeof(__pyx_k_72), 0, 1, 0, 0},
  {&__pyx_kp_u_73, __pyx_k_73, sizeof(__pyx_k_73), 0, 1, 0, 0},
  {&__pyx_kp_u_74, __pyx_k_74, sizeof(__pyx_k_74), 0, 1, 0, 0},
  {&__pyx_kp_u_75, __pyx_k_75, sizeof(__pyx_k_75), 0, 1, 0, 0},
  {&__pyx_n_s_76, __pyx_k_76, sizeof(__pyx_k_76), 0, 0, 1, 1},
  {&__pyx_kp_u_77, __pyx_k_77, sizeof(__pyx_k_77), 0, 1, 0, 0},
  {&__pyx_kp_u_78, __pyx_k_78, sizeof(__pyx_k_78), 0, 1, 0, 0},
  {&__pyx_kp_u_79, __pyx_k_79, sizeof(__pyx_k_79), 0, 1, 0, 0},
  {&__pyx_n_s_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 0, 1, 1},
  {&__pyx_kp_u_80, __pyx_k_80, sizeof(__pyx_k_80), 0, 1, 0, 0},
  {&__pyx_kp_u_81, __pyx_k_81, sizeof(__pyx_k_81), 0, 1, 0, 0},
  {&__pyx_kp_u_82, __pyx_k_82, sizeof(__pyx_k_82), 0, 1, 0, 0},
  {&__pyx_kp_u_83, __pyx_k_83, sizeof(__pyx_k_83), 0, 1, 0, 0},
  {&__pyx_kp_u_84, __pyx_k_84, sizeof(__pyx_k_84), 0, 1, 0, 0},
  {&__pyx_kp_u_85, __pyx_k_85, sizeof(__pyx_k_85), 0, 1, 0, 0},
  {&__pyx_kp_u_86, __pyx_k_86, sizeof(__pyx_k_86), 0, 1, 0, 0},
  {&__pyx_kp_u_87, __pyx_k_87, sizeof(__pyx_k_87), 0, 1, 0, 0},
  {&__pyx_kp_u_88, __pyx_k_88, sizeof(__pyx_k_88), 0, 1, 0, 0},
  {&__pyx_kp_u_89, __pyx_k_89, sizeof(__pyx_k_89), 0, 1, 0, 0},
  {&__pyx_kp_s_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 0, 1, 0},
  {&__pyx_n_s_90, __pyx_k_90, sizeof(__pyx_k_90), 0, 0, 1, 1},
  {&__pyx_kp_u_91, __pyx_k_91, sizeof(__pyx_k_91), 0, 1, 0, 0},
  {&__pyx_kp_u_92, __pyx_k_92, sizeof(__pyx_k_92), 0, 1, 0, 0},
  {&__pyx_kp_u_93, __pyx_k_93, sizeof(__pyx_k_93), 0, 1, 0, 0},
  {&__pyx_kp_u_94, __pyx_k_94, sizeof(__pyx_k_94), 0, 1, 0, 0},
  {&__pyx_kp_u_95, __pyx_k_95, sizeof(__pyx_k_95), 0, 1, 0, 0},
  {&__pyx_kp_u_96, __pyx_k_96, sizeof(__pyx_k_96), 0, 1, 0, 0},
  {&__pyx_kp_u_97, __pyx_k_97, sizeof(__pyx_k_97), 0, 1, 0, 0},
  {&__pyx_kp_u_98, __pyx_k_98, sizeof(__pyx_k_98), 0, 1, 0, 0},
  {&__pyx_kp_u_99, __pyx_k_99, sizeof(__pyx_k_99), 0, 1, 0, 0},
  {&__pyx_n_s__BSD, __pyx_k__BSD, sizeof(__pyx_k__BSD), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_FORMAT, __pyx_k__DNS_ERR_FORMAT, sizeof(__pyx_k__DNS_ERR_FORMAT), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_NONE, __pyx_k__DNS_ERR_NONE, sizeof(__pyx_k__DNS_ERR_NONE), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_NOTEXIST, __pyx_k__DNS_ERR_NOTEXIST, sizeof(__pyx_k__DNS_ERR_NOTEXIST), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_NOTIMPL, __pyx_k__DNS_ERR_NOTIMPL, sizeof(__pyx_k__DNS_ERR_NOTIMPL), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_REFUSED, __pyx_k__DNS_ERR_REFUSED, sizeof(__pyx_k__DNS_ERR_REFUSED), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_SHUTDOWN, __pyx_k__DNS_ERR_SHUTDOWN, sizeof(__pyx_k__DNS_ERR_SHUTDOWN), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_TIMEOUT, __pyx_k__DNS_ERR_TIMEOUT, sizeof(__pyx_k__DNS_ERR_TIMEOUT), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_TRUNCATED, __pyx_k__DNS_ERR_TRUNCATED, sizeof(__pyx_k__DNS_ERR_TRUNCATED), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_ERR_UNKNOWN, __pyx_k__DNS_ERR_UNKNOWN, sizeof(__pyx_k__DNS_ERR_UNKNOWN), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_IPv4_A, __pyx_k__DNS_IPv4_A, sizeof(__pyx_k__DNS_IPv4_A), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_IPv6_AAAA, __pyx_k__DNS_IPv6_AAAA, sizeof(__pyx_k__DNS_IPv6_AAAA), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_PTR, __pyx_k__DNS_PTR, sizeof(__pyx_k__DNS_PTR), 0, 0, 1, 1},
  {&__pyx_n_s__DNS_QUERY_NO_SEARCH, __pyx_k__DNS_QUERY_NO_SEARCH, sizeof(__pyx_k__DNS_QUERY_NO_SEARCH), 0, 0, 1, 1},
  {&__pyx_n_s__DnsLookupError, __pyx_k__DnsLookupError, sizeof(__pyx_k__DnsLookupError), 0, 0, 1, 1},
  {&__pyx_n_s__DnsResultParseError, __pyx_k__DnsResultParseError, sizeof(__pyx_k__DnsResultParseError), 0, 0, 1, 1},
  {&__pyx_n_s__EAI_ADDRFAMILY, __pyx_k__EAI_ADDRFAMILY, sizeof(__pyx_k__EAI_ADDRFAMILY), 0, 0, 1, 1},
  {&__pyx_n_s__EAI_NODATA, __pyx_k__EAI_NODATA, sizeof(__pyx_k__EAI_NODATA), 0, 0, 1, 1},
  {&__pyx_n_s__EAI_NONAME, __pyx_k__EAI_NONAME, sizeof(__pyx_k__EAI_NONAME), 0, 0, 1, 1},
  {&__pyx_n_s__EV_PERSIST, __pyx_k__EV_PERSIST, sizeof(__pyx_k__EV_PERSIST), 0, 0, 1, 1},
  {&__pyx_n_s__EV_READ, __pyx_k__EV_READ, sizeof(__pyx_k__EV_READ), 0, 0, 1, 1},
  {&__pyx_n_s__EV_SIGNAL, __pyx_k__EV_SIGNAL, sizeof(__pyx_k__EV_SIGNAL), 0, 0, 1, 1},
  {&__pyx_n_s__EV_TIMEOUT, __pyx_k__EV_TIMEOUT, sizeof(__pyx_k__EV_TIMEOUT), 0, 0, 1, 1},
  {&__pyx_n_s__EV_WRITE, __pyx_k__EV_WRITE, sizeof(__pyx_k__EV_WRITE), 0, 0, 1, 1},
  {&__pyx_n_s__Exception, __pyx_k__Exception, sizeof(__pyx_k__Exception), 0, 0, 1, 1},
  {&__pyx_n_s__HERROR_NO_ADDRESS, __pyx_k__HERROR_NO_ADDRESS, sizeof(__pyx_k__HERROR_NO_ADDRESS), 0, 0, 1, 1},
  {&__pyx_n_s__HERROR_NO_DATA, __pyx_k__HERROR_NO_DATA, sizeof(__pyx_k__HERROR_NO_DATA), 0, 0, 1, 1},
  {&__pyx_n_s__HERROR_NO_RECOVERY, __pyx_k__HERROR_NO_RECOVERY, sizeof(__pyx_k__HERROR_NO_RECOVERY), 0, 0, 1, 1},
  {&__pyx_n_s__HERROR_TRY_AGAIN, __pyx_k__HERROR_TRY_AGAIN, sizeof(__pyx_k__HERROR_TRY_AGAIN), 0, 0, 1, 1},
  {&__pyx_n_s__IOError, __pyx_k__IOError, sizeof(__pyx_k__IOError), 0, 0, 1, 1},
  {&__pyx_n_s__ImportError, __pyx_k__ImportError, sizeof(__pyx_k__ImportError), 0, 0, 1, 1},
  {&__pyx_n_s__KeyboardInterrupt, __pyx_k__KeyboardInterrupt, sizeof(__pyx_k__KeyboardInterrupt), 0, 0, 1, 1},
  {&__pyx_n_s__LinkHelper, __pyx_k__LinkHelper, sizeof(__pyx_k__LinkHelper), 0, 0, 1, 1},
  {&__pyx_n_s__MainLoop, __pyx_k__MainLoop, sizeof(__pyx_k__MainLoop), 0, 0, 1, 1},
  {&__pyx_n_s__MemoryError, __pyx_k__MemoryError, sizeof(__pyx_k__MemoryError), 0, 0, 1, 1},
  {&__pyx_n_s__NotImplementedError, __pyx_k__NotImplementedError, sizeof(__pyx_k__NotImplementedError), 0, 0, 1, 1},
  {&__pyx_n_s__RuntimeError, __pyx_k__RuntimeError, sizeof(__pyx_k__RuntimeError), 0, 0, 1, 1},
  {&__pyx_n_s__SSLError, __pyx_k__SSLError, sizeof(__pyx_k__SSLError), 0, 0, 1, 1},
  {&__pyx_n_s__SSLSocket, __pyx_k__SSLSocket, sizeof(__pyx_k__SSLSocket), 0, 0, 1, 1},
  {&__pyx_n_s__SSL_ERROR_EOF, __pyx_k__SSL_ERROR_EOF, sizeof(__pyx_k__SSL_ERROR_EOF), 0, 0, 1, 1},
  {&__pyx_n_s__SSL_ERROR_WANT_READ, __pyx_k__SSL_ERROR_WANT_READ, sizeof(__pyx_k__SSL_ERROR_WANT_READ), 0, 0, 1, 1},
  {&__pyx_n_s__SendExceptionAndRun, __pyx_k__SendExceptionAndRun, sizeof(__pyx_k__SendExceptionAndRun), 0, 0, 1, 1},
  {&__pyx_n_s__SigIntHandler, __pyx_k__SigIntHandler, sizeof(__pyx_k__SigIntHandler), 0, 0, 1, 1},
  {&__pyx_n_s__StopIteration, __pyx_k__StopIteration, sizeof(__pyx_k__StopIteration), 0, 0, 1, 1},
  {&__pyx_n_s__TypeError, __pyx_k__TypeError, sizeof(__pyx_k__TypeError), 0, 0, 1, 1},
  {&__pyx_n_s__ValueError, __pyx_k__ValueError, sizeof(__pyx_k__ValueError), 0, 0, 1, 1},
  {&__pyx_n_s____author__, __pyx_k____author__, sizeof(__pyx_k____author__), 0, 0, 1, 1},
  {&__pyx_n_s____callback, __pyx_k____callback, sizeof(__pyx_k____callback), 0, 0, 1, 1},
  {&__pyx_n_s____class__, __pyx_k____class__, sizeof(__pyx_k____class__), 0, 0, 1, 1},
  {&__pyx_n_s____copyright__, __pyx_k____copyright__, sizeof(__pyx_k____copyright__), 0, 0, 1, 1},
  {&__pyx_n_s____event_exc, __pyx_k____event_exc, sizeof(__pyx_k____event_exc), 0, 0, 1, 1},
  {&__pyx_n_s____license__, __pyx_k____license__, sizeof(__pyx_k____license__), 0, 0, 1, 1},
  {&__pyx_n_s____main__, __pyx_k____main__, sizeof(__pyx_k____main__), 0, 0, 1, 1},
  {&__pyx_n_s____simple_callback, __pyx_k____simple_callback, sizeof(__pyx_k____simple_callback), 0, 0, 1, 1},
  {&__pyx_n_s____test__, __pyx_k____test__, sizeof(__pyx_k____test__), 0, 0, 1, 1},
  {&__pyx_n_s____url__, __pyx_k____url__, sizeof(__pyx_k____url__), 0, 0, 1, 1},
  {&__pyx_n_s____version__, __pyx_k____version__, sizeof(__pyx_k____version__), 0, 0, 1, 1},
  {&__pyx_n_s___channel, __pyx_k___channel, sizeof(__pyx_k___channel), 0, 0, 1, 1},
  {&__pyx_n_s___closedsocket, __pyx_k___closedsocket, sizeof(__pyx_k___closedsocket), 0, 0, 1, 1},
  {&__pyx_n_s___fileobject, __pyx_k___fileobject, sizeof(__pyx_k___fileobject), 0, 0, 1, 1},
  {&__pyx_n_s___makefile_refs, __pyx_k___makefile_refs, sizeof(__pyx_k___makefile_refs), 0, 0, 1, 1},
  {&__pyx_n_s___realsocket, __pyx_k___realsocket, sizeof(__pyx_k___realsocket), 0, 0, 1, 1},
  {&__pyx_n_s___sock, __pyx_k___sock, sizeof(__pyx_k___sock), 0, 0, 1, 1},
  {&__pyx_n_s___ssl, __pyx_k___ssl, sizeof(__pyx_k___ssl), 0, 0, 1, 1},
  {&__pyx_n_s___sslobj, __pyx_k___sslobj, sizeof(__pyx_k___sslobj), 0, 0, 1, 1},
  {&__pyx_n_s___t, __pyx_k___t, sizeof(__pyx_k___t), 0, 0, 1, 1},
  {&__pyx_n_s___ttl, __pyx_k___ttl, sizeof(__pyx_k___ttl), 0, 0, 1, 1},
  {&__pyx_n_s___values, __pyx_k___values, sizeof(__pyx_k___values), 0, 0, 1, 1},
  {&__pyx_n_s__abort, __pyx_k__abort, sizeof(__pyx_k__abort), 0, 0, 1, 1},
  {&__pyx_n_s__accept, __pyx_k__accept, sizeof(__pyx_k__accept), 0, 0, 1, 1},
  {&__pyx_n_s__add, __pyx_k__add, sizeof(__pyx_k__add), 0, 0, 1, 1},
  {&__pyx_n_s__append_clear, __pyx_k__append_clear, sizeof(__pyx_k__append_clear), 0, 0, 1, 1},
  {&__pyx_n_s__arg, __pyx_k__arg, sizeof(__pyx_k__arg), 0, 0, 1, 1},
  {&__pyx_n_s__args, __pyx_k__args, sizeof(__pyx_k__args), 0, 0, 1, 1},
  {&__pyx_n_s__balance, __pyx_k__balance, sizeof(__pyx_k__balance), 0, 0, 1, 1},
  {&__pyx_n_s__binary_form, __pyx_k__binary_form, sizeof(__pyx_k__binary_form), 0, 0, 1, 1},
  {&__pyx_n_s__bind, __pyx_k__bind, sizeof(__pyx_k__bind), 0, 0, 1, 1},
  {&__pyx_n_s__blocked, __pyx_k__blocked, sizeof(__pyx_k__blocked), 0, 0, 1, 1},
  {&__pyx_n_s__buf, __pyx_k__buf, sizeof(__pyx_k__buf), 0, 0, 1, 1},
  {&__pyx_n_s__buffer, __pyx_k__buffer, sizeof(__pyx_k__buffer), 0, 0, 1, 1},
  {&__pyx_n_s__buflen, __pyx_k__buflen, sizeof(__pyx_k__buflen), 0, 0, 1, 1},
  {&__pyx_n_s__bufsize, __pyx_k__bufsize, sizeof(__pyx_k__bufsize), 0, 0, 1, 1},
  {&__pyx_n_s__c_closed, __pyx_k__c_closed, sizeof(__pyx_k__c_closed), 0, 0, 1, 1},
  {&__pyx_n_s__c_do_close, __pyx_k__c_do_close, sizeof(__pyx_k__c_do_close), 0, 0, 1, 1},
  {&__pyx_n_s__c_mode, __pyx_k__c_mode, sizeof(__pyx_k__c_mode), 0, 0, 1, 1},
  {&__pyx_n_s__c_name, __pyx_k__c_name, sizeof(__pyx_k__c_name), 0, 0, 1, 1},
  {&__pyx_n_s__c_read_limit, __pyx_k__c_read_limit, sizeof(__pyx_k__c_read_limit), 0, 0, 1, 1},
  {&__pyx_n_s__c_sock, __pyx_k__c_sock, sizeof(__pyx_k__c_sock), 0, 0, 1, 1},
  {&__pyx_n_s__c_softspace, __pyx_k__c_softspace, sizeof(__pyx_k__c_softspace), 0, 0, 1, 1},
  {&__pyx_n_s__ca_certs, __pyx_k__ca_certs, sizeof(__pyx_k__ca_certs), 0, 0, 1, 1},
  {&__pyx_n_s__callback, __pyx_k__callback, sizeof(__pyx_k__callback), 0, 0, 1, 1},
  {&__pyx_n_s__cerfile, __pyx_k__cerfile, sizeof(__pyx_k__cerfile), 0, 0, 1, 1},
  {&__pyx_n_s__cert_reqs, __pyx_k__cert_reqs, sizeof(__pyx_k__cert_reqs), 0, 0, 1, 1},
  {&__pyx_n_s__certfile, __pyx_k__certfile, sizeof(__pyx_k__certfile), 0, 0, 1, 1},
  {&__pyx_n_s__cipher, __pyx_k__cipher, sizeof(__pyx_k__cipher), 0, 0, 1, 1},
  {&__pyx_n_s__close, __pyx_k__close, sizeof(__pyx_k__close), 0, 0, 1, 1},
  {&__pyx_n_s__close_ref, __pyx_k__close_ref, sizeof(__pyx_k__close_ref), 0, 0, 1, 1},
  {&__pyx_n_s__connect, __pyx_k__connect, sizeof(__pyx_k__connect), 0, 0, 1, 1},
  {&__pyx_n_s__connect_ex, __pyx_k__connect_ex, sizeof(__pyx_k__connect_ex), 0, 0, 1, 1},
  {&__pyx_n_s__consume, __pyx_k__consume, sizeof(__pyx_k__consume), 0, 0, 1, 1},
  {&__pyx_n_s__consumeline, __pyx_k__consumeline, sizeof(__pyx_k__consumeline), 0, 0, 1, 1},
  {&__pyx_n_s__data, __pyx_k__data, sizeof(__pyx_k__data), 0, 0, 1, 1},
  {&__pyx_n_s__delete, __pyx_k__delete, sizeof(__pyx_k__delete), 0, 0, 1, 1},
  {&__pyx_n_s__discard, __pyx_k__discard, sizeof(__pyx_k__discard), 0, 0, 1, 1},
  {&__pyx_n_s__dispatch, __pyx_k__dispatch, sizeof(__pyx_k__dispatch), 0, 0, 1, 1},
  {&__pyx_n_s__dns_init, __pyx_k__dns_init, sizeof(__pyx_k__dns_init), 0, 0, 1, 1},
  {&__pyx_n_s__dns_init_force, __pyx_k__dns_init_force, sizeof(__pyx_k__dns_init_force), 0, 0, 1, 1},
  {&__pyx_n_s__dns_resolve_ipv4, __pyx_k__dns_resolve_ipv4, sizeof(__pyx_k__dns_resolve_ipv4), 0, 0, 1, 1},
  {&__pyx_n_s__dns_resolve_ipv6, __pyx_k__dns_resolve_ipv6, sizeof(__pyx_k__dns_resolve_ipv6), 0, 0, 1, 1},
  {&__pyx_n_s__dns_resolve_reverse, __pyx_k__dns_resolve_reverse, sizeof(__pyx_k__dns_resolve_reverse), 0, 0, 1, 1},
  {&__pyx_n_s__dns_shutdown, __pyx_k__dns_shutdown, sizeof(__pyx_k__dns_shutdown), 0, 0, 1, 1},
  {&__pyx_n_s__do_close, __pyx_k__do_close, sizeof(__pyx_k__do_close), 0, 0, 1, 1},
  {&__pyx_n_s__do_handshake, __pyx_k__do_handshake, sizeof(__pyx_k__do_handshake), 0, 0, 1, 1},
  {&__pyx_n_s__dup, __pyx_k__dup, sizeof(__pyx_k__dup), 0, 0, 1, 1},
  {&__pyx_n_s__eb, __pyx_k__eb, sizeof(__pyx_k__eb), 0, 0, 1, 1},
  {&__pyx_n_s__errno, __pyx_k__errno, sizeof(__pyx_k__errno), 0, 0, 1, 1},
  {&__pyx_n_s__error, __pyx_k__error, sizeof(__pyx_k__error), 0, 0, 1, 1},
  {&__pyx_n_s__ev, __pyx_k__ev, sizeof(__pyx_k__ev), 0, 0, 1, 1},
  {&__pyx_n_s__ev_flags, __pyx_k__ev_flags, sizeof(__pyx_k__ev_flags), 0, 0, 1, 1},
  {&__pyx_n_s__evbuffer, __pyx_k__evbuffer, sizeof(__pyx_k__evbuffer), 0, 0, 1, 1},
  {&__pyx_n_s__event, __pyx_k__event, sizeof(__pyx_k__event), 0, 0, 1, 1},
  {&__pyx_n_s__evtype, __pyx_k__evtype, sizeof(__pyx_k__evtype), 0, 0, 1, 1},
  {&__pyx_n_s__exc_info, __pyx_k__exc_info, sizeof(__pyx_k__exc_info), 0, 0, 1, 1},
  {&__pyx_n_s__expand, __pyx_k__expand, sizeof(__pyx_k__expand), 0, 0, 1, 1},
  {&__pyx_n_s__f, __pyx_k__f, sizeof(__pyx_k__f), 0, 0, 1, 1},
  {&__pyx_n_s__fail_requests, __pyx_k__fail_requests, sizeof(__pyx_k__fail_requests), 0, 0, 1, 1},
  {&__pyx_n_s__family, __pyx_k__family, sizeof(__pyx_k__family), 0, 0, 1, 1},
  {&__pyx_n_s__fd, __pyx_k__fd, sizeof(__pyx_k__fd), 0, 0, 1, 1},
  {&__pyx_n_s__fdopen, __pyx_k__fdopen, sizeof(__pyx_k__fdopen), 0, 0, 1, 1},
  {&__pyx_n_s__filename, __pyx_k__filename, sizeof(__pyx_k__filename), 0, 0, 1, 1},
  {&__pyx_n_s__fileno, __pyx_k__fileno, sizeof(__pyx_k__fileno), 0, 0, 1, 1},
  {&__pyx_n_s__flags, __pyx_k__flags, sizeof(__pyx_k__flags), 0, 0, 1, 1},
  {&__pyx_n_s__flush, __pyx_k__flush, sizeof(__pyx_k__flush), 0, 0, 1, 1},
  {&__pyx_n_s__fromfd, __pyx_k__fromfd, sizeof(__pyx_k__fromfd), 0, 0, 1, 1},
  {&__pyx_n_s__gaierror, __pyx_k__gaierror, sizeof(__pyx_k__gaierror), 0, 0, 1, 1},
  {&__pyx_n_s__getfqdn, __pyx_k__getfqdn, sizeof(__pyx_k__getfqdn), 0, 0, 1, 1},
  {&__pyx_n_s__gethostbyaddr, __pyx_k__gethostbyaddr, sizeof(__pyx_k__gethostbyaddr), 0, 0, 1, 1},
  {&__pyx_n_s__gethostbyname, __pyx_k__gethostbyname, sizeof(__pyx_k__gethostbyname), 0, 0, 1, 1},
  {&__pyx_n_s__gethostbyname_ex, __pyx_k__gethostbyname_ex, sizeof(__pyx_k__gethostbyname_ex), 0, 0, 1, 1},
  {&__pyx_n_s__gethostname, __pyx_k__gethostname, sizeof(__pyx_k__gethostname), 0, 0, 1, 1},
  {&__pyx_n_s__getpeername, __pyx_k__getpeername, sizeof(__pyx_k__getpeername), 0, 0, 1, 1},
  {&__pyx_n_s__getsockname, __pyx_k__getsockname, sizeof(__pyx_k__getsockname), 0, 0, 1, 1},
  {&__pyx_n_s__getsockopt, __pyx_k__getsockopt, sizeof(__pyx_k__getsockopt), 0, 0, 1, 1},
  {&__pyx_n_s__handle, __pyx_k__handle, sizeof(__pyx_k__handle), 0, 0, 1, 1},
  {&__pyx_n_s__herror, __pyx_k__herror, sizeof(__pyx_k__herror), 0, 0, 1, 1},
  {&__pyx_n_s__insert, __pyx_k__insert, sizeof(__pyx_k__insert), 0, 0, 1, 1},
  {&__pyx_n_s__ip, __pyx_k__ip, sizeof(__pyx_k__ip), 0, 0, 1, 1},
  {&__pyx_n_s__is_blocking, __pyx_k__is_blocking, sizeof(__pyx_k__is_blocking), 0, 0, 1, 1},
  {&__pyx_n_s__join, __pyx_k__join, sizeof(__pyx_k__join), 0, 0, 1, 1},
  {&__pyx_n_s__keyfile, __pyx_k__keyfile, sizeof(__pyx_k__keyfile), 0, 0, 1, 1},
  {&__pyx_n_s__len, __pyx_k__len, sizeof(__pyx_k__len), 0, 0, 1, 1},
  {&__pyx_n_s__listen, __pyx_k__listen, sizeof(__pyx_k__listen), 0, 0, 1, 1},
  {&__pyx_n_s__loop, __pyx_k__loop, sizeof(__pyx_k__loop), 0, 0, 1, 1},
  {&__pyx_n_s__main, __pyx_k__main, sizeof(__pyx_k__main), 0, 0, 1, 1},
  {&__pyx_n_s__makefile, __pyx_k__makefile, sizeof(__pyx_k__makefile), 0, 0, 1, 1},
  {&__pyx_n_s__makefile_samefd, __pyx_k__makefile_samefd, sizeof(__pyx_k__makefile_samefd), 0, 0, 1, 1},
  {&__pyx_n_s__misalign, __pyx_k__misalign, sizeof(__pyx_k__misalign), 0, 0, 1, 1},
  {&__pyx_n_s__mode, __pyx_k__mode, sizeof(__pyx_k__mode), 0, 0, 1, 1},
  {&__pyx_n_s__n, __pyx_k__n, sizeof(__pyx_k__n), 0, 0, 1, 1},
  {&__pyx_n_s__name, __pyx_k__name, sizeof(__pyx_k__name), 0, 0, 1, 1},
  {&__pyx_n_s__names_by_ip, __pyx_k__names_by_ip, sizeof(__pyx_k__names_by_ip), 0, 0, 1, 1},
  {&__pyx_n_s__names_by_nameip, __pyx_k__names_by_nameip, sizeof(__pyx_k__names_by_nameip), 0, 0, 1, 1},
  {&__pyx_n_s__nb_flush, __pyx_k__nb_flush, sizeof(__pyx_k__nb_flush), 0, 0, 1, 1},
  {&__pyx_n_s__nbfile, __pyx_k__nbfile, sizeof(__pyx_k__nbfile), 0, 0, 1, 1},
  {&__pyx_n_s__nbsocket, __pyx_k__nbsocket, sizeof(__pyx_k__nbsocket), 0, 0, 1, 1},
  {&__pyx_n_s__nbsslsocket, __pyx_k__nbsslsocket, sizeof(__pyx_k__nbsslsocket), 0, 0, 1, 1},
  {&__pyx_n_s__new_realsocket, __pyx_k__new_realsocket, sizeof(__pyx_k__new_realsocket), 0, 0, 1, 1},
  {&__pyx_n_s__next, __pyx_k__next, sizeof(__pyx_k__next), 0, 0, 1, 1},
  {&__pyx_n_s__nonblock, __pyx_k__nonblock, sizeof(__pyx_k__nonblock), 0, 0, 1, 1},
  {&__pyx_n_s__off, __pyx_k__off, sizeof(__pyx_k__off), 0, 0, 1, 1},
  {&__pyx_n_s__open, __pyx_k__open, sizeof(__pyx_k__open), 0, 0, 1, 1},
  {&__pyx_n_s__orig_buffer, __pyx_k__orig_buffer, sizeof(__pyx_k__orig_buffer), 0, 0, 1, 1},
  {&__pyx_n_s__peek, __pyx_k__peek, sizeof(__pyx_k__peek), 0, 0, 1, 1},
  {&__pyx_n_s__peekline, __pyx_k__peekline, sizeof(__pyx_k__peekline), 0, 0, 1, 1},
  {&__pyx_n_s__peer_certificate, __pyx_k__peer_certificate, sizeof(__pyx_k__peer_certificate), 0, 0, 1, 1},
  {&__pyx_n_s__pending, __pyx_k__pending, sizeof(__pyx_k__pending), 0, 0, 1, 1},
  {&__pyx_n_s__pop, __pyx_k__pop, sizeof(__pyx_k__pop), 0, 0, 1, 1},
  {&__pyx_n_s__preference, __pyx_k__preference, sizeof(__pyx_k__preference), 0, 0, 1, 1},
  {&__pyx_n_s__prev, __pyx_k__prev, sizeof(__pyx_k__prev), 0, 0, 1, 1},
  {&__pyx_n_s__proto, __pyx_k__proto, sizeof(__pyx_k__proto), 0, 0, 1, 1},
  {&__pyx_n_s__r, __pyx_k__r, sizeof(__pyx_k__r), 0, 0, 1, 1},
  {&__pyx_n_s__range, __pyx_k__range, sizeof(__pyx_k__range), 0, 0, 1, 1},
  {&__pyx_n_s__read, __pyx_k__read, sizeof(__pyx_k__read), 0, 0, 1, 1},
  {&__pyx_n_s__read_at_most, __pyx_k__read_at_most, sizeof(__pyx_k__read_at_most), 0, 0, 1, 1},
  {&__pyx_n_s__read_eb, __pyx_k__read_eb, sizeof(__pyx_k__read_eb), 0, 0, 1, 1},
  {&__pyx_n_s__read_etc_hosts, __pyx_k__read_etc_hosts, sizeof(__pyx_k__read_etc_hosts), 0, 0, 1, 1},
  {&__pyx_n_s__read_fd, __pyx_k__read_fd, sizeof(__pyx_k__read_fd), 0, 0, 1, 1},
  {&__pyx_n_s__read_from_fd, __pyx_k__read_from_fd, sizeof(__pyx_k__read_from_fd), 0, 0, 1, 1},
  {&__pyx_n_s__read_from_fd_again, __pyx_k__read_from_fd_again, sizeof(__pyx_k__read_from_fd_again), 0, 0, 1, 1},
  {&__pyx_n_s__readline, __pyx_k__readline, sizeof(__pyx_k__readline), 0, 0, 1, 1},
  {&__pyx_n_s__realsock, __pyx_k__realsock, sizeof(__pyx_k__realsock), 0, 0, 1, 1},
  {&__pyx_n_s__recv, __pyx_k__recv, sizeof(__pyx_k__recv), 0, 0, 1, 1},
  {&__pyx_n_s__recv_into, __pyx_k__recv_into, sizeof(__pyx_k__recv_into), 0, 0, 1, 1},
  {&__pyx_n_s__recvfrom, __pyx_k__recvfrom, sizeof(__pyx_k__recvfrom), 0, 0, 1, 1},
  {&__pyx_n_s__recvfrom_into, __pyx_k__recvfrom_into, sizeof(__pyx_k__recvfrom_into), 0, 0, 1, 1},
  {&__pyx_n_s__remove, __pyx_k__remove, sizeof(__pyx_k__remove), 0, 0, 1, 1},
  {&__pyx_n_s__reset, __pyx_k__reset, sizeof(__pyx_k__reset), 0, 0, 1, 1},
  {&__pyx_n_s__run, __pyx_k__run, sizeof(__pyx_k__run), 0, 0, 1, 1},
  {&__pyx_n_s__send, __pyx_k__send, sizeof(__pyx_k__send), 0, 0, 1, 1},
  {&__pyx_n_s__sendto, __pyx_k__sendto, sizeof(__pyx_k__sendto), 0, 0, 1, 1},
  {&__pyx_n_s__server_side, __pyx_k__server_side, sizeof(__pyx_k__server_side), 0, 0, 1, 1},
  {&__pyx_n_s__set_fd_blocking, __pyx_k__set_fd_blocking, sizeof(__pyx_k__set_fd_blocking), 0, 0, 1, 1},
  {&__pyx_n_s__setblocking, __pyx_k__setblocking, sizeof(__pyx_k__setblocking), 0, 0, 1, 1},
  {&__pyx_n_s__setdefault, __pyx_k__setdefault, sizeof(__pyx_k__setdefault), 0, 0, 1, 1},
  {&__pyx_n_s__setdoclose, __pyx_k__setdoclose, sizeof(__pyx_k__setdoclose), 0, 0, 1, 1},
  {&__pyx_n_s__setsockopt, __pyx_k__setsockopt, sizeof(__pyx_k__setsockopt), 0, 0, 1, 1},
  {&__pyx_n_s__shutdown, __pyx_k__shutdown, sizeof(__pyx_k__shutdown), 0, 0, 1, 1},
  {&__pyx_n_s__sig, __pyx_k__sig, sizeof(__pyx_k__sig), 0, 0, 1, 1},
  {&__pyx_n_s__simple, __pyx_k__simple, sizeof(__pyx_k__simple), 0, 0, 1, 1},
  {&__pyx_n_s__sleep, __pyx_k__sleep, sizeof(__pyx_k__sleep), 0, 0, 1, 1},
  {&__pyx_n_s__sock, __pyx_k__sock, sizeof(__pyx_k__sock), 0, 0, 1, 1},
  {&__pyx_n_s__socket, __pyx_k__socket, sizeof(__pyx_k__socket), 0, 0, 1, 1},
  {&__pyx_n_s__socket_fromfd, __pyx_k__socket_fromfd, sizeof(__pyx_k__socket_fromfd), 0, 0, 1, 1},
  {&__pyx_n_s__socket_impl, __pyx_k__socket_impl, sizeof(__pyx_k__socket_impl), 0, 0, 1, 1},
  {&__pyx_n_s__socket_realsocket, __pyx_k__socket_realsocket, sizeof(__pyx_k__socket_realsocket), 0, 0, 1, 1},
  {&__pyx_n_s__split, __pyx_k__split, sizeof(__pyx_k__split), 0, 0, 1, 1},
  {&__pyx_n_s__ssl, __pyx_k__ssl, sizeof(__pyx_k__ssl), 0, 0, 1, 1},
  {&__pyx_n_s__ssl_version, __pyx_k__ssl_version, sizeof(__pyx_k__ssl_version), 0, 0, 1, 1},
  {&__pyx_n_s__sslobj, __pyx_k__sslobj, sizeof(__pyx_k__sslobj), 0, 0, 1, 1},
  {&__pyx_n_s__sslsock, __pyx_k__sslsock, sizeof(__pyx_k__sslsock), 0, 0, 1, 1},
  {&__pyx_n_s__sslsocket_impl, __pyx_k__sslsocket_impl, sizeof(__pyx_k__sslsocket_impl), 0, 0, 1, 1},
  {&__pyx_n_s__sslwrap, __pyx_k__sslwrap, sizeof(__pyx_k__sslwrap), 0, 0, 1, 1},
  {&__pyx_n_s__stackless, __pyx_k__stackless, sizeof(__pyx_k__stackless), 0, 0, 1, 1},
  {&__pyx_n_s__startswith, __pyx_k__startswith, sizeof(__pyx_k__startswith), 0, 0, 1, 1},
  {&__pyx_n_s__strip, __pyx_k__strip, sizeof(__pyx_k__strip), 0, 0, 1, 1},
  {&__pyx_n_s__sys, __pyx_k__sys, sizeof(__pyx_k__sys), 0, 0, 1, 1},
  {&__pyx_n_s__t, __pyx_k__t, sizeof(__pyx_k__t), 0, 0, 1, 1},
  {&__pyx_n_s__tasklet, __pyx_k__tasklet, sizeof(__pyx_k__tasklet), 0, 0, 1, 1},
  {&__pyx_n_s__tasklet_obj, __pyx_k__tasklet_obj, sizeof(__pyx_k__tasklet_obj), 0, 0, 1, 1},
  {&__pyx_n_s__tempval, __pyx_k__tempval, sizeof(__pyx_k__tempval), 0, 0, 1, 1},
  {&__pyx_n_s__timeout, __pyx_k__timeout, sizeof(__pyx_k__timeout), 0, 0, 1, 1},
  {&__pyx_n_s__timeout_value, __pyx_k__timeout_value, sizeof(__pyx_k__timeout_value), 0, 0, 1, 1},
  {&__pyx_n_s__totallen, __pyx_k__totallen, sizeof(__pyx_k__totallen), 0, 0, 1, 1},
  {&__pyx_n_s__traceback, __pyx_k__traceback, sizeof(__pyx_k__traceback), 0, 0, 1, 1},
  {&__pyx_n_s__ttl, __pyx_k__ttl, sizeof(__pyx_k__ttl), 0, 0, 1, 1},
  {&__pyx_n_s__tv, __pyx_k__tv, sizeof(__pyx_k__tv), 0, 0, 1, 1},
  {&__pyx_n_s__tv_sec, __pyx_k__tv_sec, sizeof(__pyx_k__tv_sec), 0, 0, 1, 1},
  {&__pyx_n_s__tv_usec, __pyx_k__tv_usec, sizeof(__pyx_k__tv_usec), 0, 0, 1, 1},
  {&__pyx_n_s__type, __pyx_k__type, sizeof(__pyx_k__type), 0, 0, 1, 1},
  {&__pyx_n_s__types, __pyx_k__types, sizeof(__pyx_k__types), 0, 0, 1, 1},
  {&__pyx_n_s__value, __pyx_k__value, sizeof(__pyx_k__value), 0, 0, 1, 1},
  {&__pyx_n_s__values, __pyx_k__values, sizeof(__pyx_k__values), 0, 0, 1, 1},
  {&__pyx_n_s__w, __pyx_k__w, sizeof(__pyx_k__w), 0, 0, 1, 1},
  {&__pyx_n_s__wakeup_ev, __pyx_k__wakeup_ev, sizeof(__pyx_k__wakeup_ev), 0, 0, 1, 1},
  {&__pyx_n_s__write, __pyx_k__write, sizeof(__pyx_k__write), 0, 0, 1, 1},
  {&__pyx_n_s__write_buffer_limit, __pyx_k__write_buffer_limit, sizeof(__pyx_k__write_buffer_limit), 0, 0, 1, 1},
  {&__pyx_n_s__write_eb, __pyx_k__write_eb, sizeof(__pyx_k__write_eb), 0, 0, 1, 1},
  {&__pyx_n_s__write_fd, __pyx_k__write_fd, sizeof(__pyx_k__write_fd), 0, 0, 1, 1},
  {&__pyx_n_s__write_to_fd, __pyx_k__write_to_fd, sizeof(__pyx_k__write_to_fd), 0, 0, 1, 1},
  {&__pyx_n_s__write_to_fd_again, __pyx_k__write_to_fd_again, sizeof(__pyx_k__write_to_fd_again), 0, 0, 1, 1},
  {&__pyx_n_s__xrange, __pyx_k__xrange, sizeof(__pyx_k__xrange), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_ImportError = __Pyx_GetName(__pyx_b, __pyx_n_s__ImportError); if (!__pyx_builtin_ImportError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_IOError = __Pyx_GetName(__pyx_b, __pyx_n_s__IOError); if (!__pyx_builtin_IOError) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_Exception = __Pyx_GetName(__pyx_b, __pyx_n_s__Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_TypeError = __Pyx_GetName(__pyx_b, __pyx_n_s__TypeError); if (!__pyx_builtin_TypeError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if PY_MAJOR_VERSION >= 3
  __pyx_builtin_xrange = __Pyx_GetName(__pyx_b, __pyx_n_s__range); if (!__pyx_builtin_xrange) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #else
  __pyx_builtin_xrange = __Pyx_GetName(__pyx_b, __pyx_n_s__xrange); if (!__pyx_builtin_xrange) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  __pyx_builtin_RuntimeError = __Pyx_GetName(__pyx_b, __pyx_n_s__RuntimeError); if (!__pyx_builtin_RuntimeError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_KeyboardInterrupt = __Pyx_GetName(__pyx_b, __pyx_n_s__KeyboardInterrupt); if (!__pyx_builtin_KeyboardInterrupt) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_MemoryError = __Pyx_GetName(__pyx_b, __pyx_n_s__MemoryError); if (!__pyx_builtin_MemoryError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 388; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_StopIteration = __Pyx_GetName(__pyx_b, __pyx_n_s__StopIteration); if (!__pyx_builtin_StopIteration) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_ValueError = __Pyx_GetName(__pyx_b, __pyx_n_s__ValueError); if (!__pyx_builtin_ValueError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_buffer = __Pyx_GetName(__pyx_b, __pyx_n_s__buffer); if (!__pyx_builtin_buffer) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_NotImplementedError = __Pyx_GetName(__pyx_b, __pyx_n_s__NotImplementedError); if (!__pyx_builtin_NotImplementedError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_open = __Pyx_GetName(__pyx_b, __pyx_n_s__open); if (!__pyx_builtin_open) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitGlobals(void) {
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_neg_800 = PyInt_FromLong(-800); if (unlikely(!__pyx_int_neg_800)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_1024 = PyInt_FromLong(1024); if (unlikely(!__pyx_int_1024)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initcoio(void); /*proto*/
PyMODINIT_FUNC initcoio(void)
#else
PyMODINIT_FUNC PyInit_coio(void); /*proto*/
PyMODINIT_FUNC PyInit_coio(void)
#endif
{
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  #if CYTHON_REFNANNY
  void* __pyx_refnanny = NULL;
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
  if (!__Pyx_RefNanny) {
      PyErr_Clear();
      __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
      if (!__Pyx_RefNanny)
          Py_FatalError("failed to import 'refnanny' module");
  }
  __pyx_refnanny = __Pyx_RefNanny->SetupContext("PyMODINIT_FUNC PyInit_coio(void)", __LINE__, __FILE__);
  #endif
  __pyx_init_filenames();
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if PY_MAJOR_VERSION < 3
  __pyx_empty_bytes = PyString_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #else
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4(__Pyx_NAMESTR("coio"), __pyx_methods, 0, 0, PYTHON_API_VERSION);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (!__pyx_m) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  #if PY_MAJOR_VERSION < 3
  Py_INCREF(__pyx_m);
  #endif
  __pyx_b = PyImport_AddModule(__Pyx_NAMESTR(__Pyx_BUILTIN_MODULE_NAME));
  if (!__pyx_b) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_module_is_main_coio) {
    if (__Pyx_SetAttrString(__pyx_m, "__name__", __pyx_n_s____main__) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  }
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Global init code ---*/
  __pyx_v_4coio_link_helper_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_4coio_main_loop_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  if (PyType_Ready(&__pyx_type_4coio_event) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "event", (PyObject *)&__pyx_type_4coio_event) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_event = &__pyx_type_4coio_event;
  __pyx_ptype_4coio_tasklet = __Pyx_ImportType("stackless", "tasklet", sizeof(PyTaskletObject), 0); if (unlikely(!__pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_bomb = __Pyx_ImportType("stackless", "bomb", sizeof(PyBombObject), 0); if (unlikely(!__pyx_ptype_4coio_bomb)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyType_Ready(&__pyx_type_4coio_evbuffer) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "evbuffer", (PyObject *)&__pyx_type_4coio_evbuffer) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_evbuffer = &__pyx_type_4coio_evbuffer;
  if (PyType_Ready(&__pyx_type_4coio_nbfile) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "nbfile", (PyObject *)&__pyx_type_4coio_nbfile) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_nbfile = &__pyx_type_4coio_nbfile;
  if (PyType_Ready(&__pyx_type_4coio_nbsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "nbsocket", (PyObject *)&__pyx_type_4coio_nbsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_nbsocket = &__pyx_type_4coio_nbsocket;
  if (PyType_Ready(&__pyx_type_4coio_nbsslsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "nbsslsocket", (PyObject *)&__pyx_type_4coio_nbsslsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_nbsslsocket = &__pyx_type_4coio_nbsslsocket;
  if (PyType_Ready(&__pyx_type_4coio_sockwrapper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "sockwrapper", (PyObject *)&__pyx_type_4coio_sockwrapper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_sockwrapper = &__pyx_type_4coio_sockwrapper;
  if (PyType_Ready(&__pyx_type_4coio_sleeper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "sleeper", (PyObject *)&__pyx_type_4coio_sleeper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_sleeper = &__pyx_type_4coio_sleeper;
  if (PyType_Ready(&__pyx_type_4coio_dnsresult) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "dnsresult", (PyObject *)&__pyx_type_4coio_dnsresult) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4coio_dnsresult = &__pyx_type_4coio_dnsresult;
  /*--- Type import code ---*/
  /*--- Function import code ---*/
  /*--- Execution code ---*/

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":18
 * """
 * 
 * __author__ = ( 'Dug Song <dugsong@monkey.org>',             # <<<<<<<<<<<<<<
 *                'Martin Murray <mmurray@monkey.org>' )
 * __copyright__ = ( 'Copyright (c) 2004 Dug Song',
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_kp_s_46));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_46));
  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_46));
  __Pyx_INCREF(((PyObject *)__pyx_kp_s_47));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_kp_s_47));
  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_47));
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____author__, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":20
 * __author__ = ( 'Dug Song <dugsong@monkey.org>',
 *                'Martin Murray <mmurray@monkey.org>' )
 * __copyright__ = ( 'Copyright (c) 2004 Dug Song',             # <<<<<<<<<<<<<<
 *                   'Copyright (c) 2003 Martin Murray' )
 * __license__ = 'BSD'
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_kp_s_48));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_48));
  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_48));
  __Pyx_INCREF(((PyObject *)__pyx_kp_s_49));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_kp_s_49));
  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_49));
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____copyright__, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":22
 * __copyright__ = ( 'Copyright (c) 2004 Dug Song',
 *                   'Copyright (c) 2003 Martin Murray' )
 * __license__ = 'BSD'             # <<<<<<<<<<<<<<
 * __url__ = 'http://monkey.org/~dugsong/pyevent/'
 * __version__ = '0.4'
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____license__, ((PyObject *)__pyx_n_s__BSD)) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":23
 *                   'Copyright (c) 2003 Martin Murray' )
 * __license__ = 'BSD'
 * __url__ = 'http://monkey.org/~dugsong/pyevent/'             # <<<<<<<<<<<<<<
 * __version__ = '0.4'
 * 
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____url__, ((PyObject *)__pyx_kp_s_50)) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":24
 * __license__ = 'BSD'
 * __url__ = 'http://monkey.org/~dugsong/pyevent/'
 * __version__ = '0.4'             # <<<<<<<<<<<<<<
 * 
 * import sys
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____version__, ((PyObject *)__pyx_kp_s_51)) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":26
 * __version__ = '0.4'
 * 
 * import sys             # <<<<<<<<<<<<<<
 * 
 * cdef extern from "sys/types.h":
 */
  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__sys), 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__sys, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":69
 * # TODO(pts): Do this (exporting to Python + reusing the constant in C)
 * # with less typing.
 * EV_TIMEOUT = c_EV_TIMEOUT             # <<<<<<<<<<<<<<
 * EV_READ = c_EV_READ
 * EV_WRITE = c_EV_WRITE
 */
  __pyx_t_1 = PyInt_FromLong(EV_TIMEOUT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__EV_TIMEOUT, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":70
 * # with less typing.
 * EV_TIMEOUT = c_EV_TIMEOUT
 * EV_READ = c_EV_READ             # <<<<<<<<<<<<<<
 * EV_WRITE = c_EV_WRITE
 * EV_SIGNAL = c_EV_SIGNAL
 */
  __pyx_t_1 = PyInt_FromLong(EV_READ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__EV_READ, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":71
 * EV_TIMEOUT = c_EV_TIMEOUT
 * EV_READ = c_EV_READ
 * EV_WRITE = c_EV_WRITE             # <<<<<<<<<<<<<<
 * EV_SIGNAL = c_EV_SIGNAL
 * EV_PERSIST = c_EV_PERSIST
 */
  __pyx_t_1 = PyInt_FromLong(EV_WRITE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__EV_WRITE, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":72
 * EV_READ = c_EV_READ
 * EV_WRITE = c_EV_WRITE
 * EV_SIGNAL = c_EV_SIGNAL             # <<<<<<<<<<<<<<
 * EV_PERSIST = c_EV_PERSIST
 * 
 */
  __pyx_t_1 = PyInt_FromLong(EV_SIGNAL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__EV_SIGNAL, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":73
 * EV_WRITE = c_EV_WRITE
 * EV_SIGNAL = c_EV_SIGNAL
 * EV_PERSIST = c_EV_PERSIST             # <<<<<<<<<<<<<<
 * 
 * __event_exc = None
 */
  __pyx_t_1 = PyInt_FromLong(EV_PERSIST); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__EV_PERSIST, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":75
 * EV_PERSIST = c_EV_PERSIST
 * 
 * __event_exc = None             # <<<<<<<<<<<<<<
 * 
 * cdef void __event_abort():
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":200
 *     return ret
 * 
 * def loop(nonblock=False):             # <<<<<<<<<<<<<<
 *     """Dispatch all pending events on queue in a single pass.
 *     Returns -1 on error, 0 on success, and 1 if no events are registered."""
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k_2 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":42
 * # TODO(pts): Port to greenlet.
 * # TODO(pts): port to pure Python + select() or epoll().
 * import stackless             # <<<<<<<<<<<<<<
 * import socket
 * #import __builtin__
 */
  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__stackless), 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__stackless, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":43
 * # TODO(pts): port to pure Python + select() or epoll().
 * import stackless
 * import socket             # <<<<<<<<<<<<<<
 * #import __builtin__
 * import types
 */
  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__socket), 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__socket, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":45
 * import socket
 * #import __builtin__
 * import types             # <<<<<<<<<<<<<<
 * 
 * # These are some Pyrex magic declarations which will enforce type safety in
 */
  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__types), 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__types, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1130
 * # Implementation backend class for sockets. Should be socket._socket.socket
 * # (which is the same as socket._realsocket)
 * socket_impl = socket._realsocket             # <<<<<<<<<<<<<<
 * 
 * # The original socket._realsocket class. Reference saved so further patching
 */
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s___realsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__socket_impl, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1134
 * # The original socket._realsocket class. Reference saved so further patching
 * # (in syncless.path) won't have an effect on it.
 * socket_realsocket = socket._realsocket             # <<<<<<<<<<<<<<
 * 
 * socket_fromfd = socket.fromfd
 */
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s___realsocket); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__socket_realsocket, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1136
 * socket_realsocket = socket._realsocket
 * 
 * socket_fromfd = socket.fromfd             # <<<<<<<<<<<<<<
 * 
 * # We're not inheriting from socket._socket.socket, because with the current
 */
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__socket); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__fromfd); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__socket_fromfd, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1441
 * cdef int SSL_ERROR_WANT_READ
 * cdef int SSL_ERROR_WANT_WRITE
 * try:             # <<<<<<<<<<<<<<
 *     import ssl
 *     sslsocket_impl = ssl.SSLSocket
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1442
 * cdef int SSL_ERROR_WANT_WRITE
 * try:
 *     import ssl             # <<<<<<<<<<<<<<
 *     sslsocket_impl = ssl.SSLSocket
 *     SSLError = ssl.SSLError
 */
      __pyx_t_2 = __Pyx_Import(((PyObject *)__pyx_n_s__ssl), 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1442; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_2);
      if (PyObject_SetAttr(__pyx_m, __pyx_n_s__ssl, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1442; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1443
 * try:
 *     import ssl
 *     sslsocket_impl = ssl.SSLSocket             # <<<<<<<<<<<<<<
 *     SSLError = ssl.SSLError
 *     SSL_ERROR_EOF = ssl.SSL_ERROR_EOF
 */
      __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__ssl); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1443; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__SSLSocket); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1443; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (PyObject_SetAttr(__pyx_m, __pyx_n_s__sslsocket_impl, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1443; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1444
 *     import ssl
 *     sslsocket_impl = ssl.SSLSocket
 *     SSLError = ssl.SSLError             # <<<<<<<<<<<<<<
 *     SSL_ERROR_EOF = ssl.SSL_ERROR_EOF
 *     SSL_ERROR_WANT_READ = ssl.SSL_ERROR_WANT_READ
 */
      __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__ssl); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1444; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__SSLError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1444; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (PyObject_SetAttr(__pyx_m, __pyx_n_s__SSLError, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1444; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1445
 *     sslsocket_impl = ssl.SSLSocket
 *     SSLError = ssl.SSLError
 *     SSL_ERROR_EOF = ssl.SSL_ERROR_EOF             # <<<<<<<<<<<<<<
 *     SSL_ERROR_WANT_READ = ssl.SSL_ERROR_WANT_READ
 *     SSL_ERROR_WANT_WRITE = ssl.SSL_ERROR_WANT_WRITE
 */
      __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__ssl); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__SSL_ERROR_EOF); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_3 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_4coio_SSL_ERROR_EOF = __pyx_t_3;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1446
 *     SSLError = ssl.SSLError
 *     SSL_ERROR_EOF = ssl.SSL_ERROR_EOF
 *     SSL_ERROR_WANT_READ = ssl.SSL_ERROR_WANT_READ             # <<<<<<<<<<<<<<
 *     SSL_ERROR_WANT_WRITE = ssl.SSL_ERROR_WANT_WRITE
 * except ImportError:
 */
      __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__ssl); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1446; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__SSL_ERROR_WANT_READ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1446; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_3 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1446; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_4coio_SSL_ERROR_WANT_READ = __pyx_t_3;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1447
 *     SSL_ERROR_EOF = ssl.SSL_ERROR_EOF
 *     SSL_ERROR_WANT_READ = ssl.SSL_ERROR_WANT_READ
 *     SSL_ERROR_WANT_WRITE = ssl.SSL_ERROR_WANT_WRITE             # <<<<<<<<<<<<<<
 * except ImportError:
 *     sslsocket_impl = None
 */
      __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__ssl); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1447; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s_52); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1447; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_3 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1447; __pyx_clineno = __LINE__; goto __pyx_L2_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_4coio_SSL_ERROR_WANT_WRITE = __pyx_t_3;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L9_try_end;
    __pyx_L2_error:;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1448
 *     SSL_ERROR_WANT_READ = ssl.SSL_ERROR_WANT_READ
 *     SSL_ERROR_WANT_WRITE = ssl.SSL_ERROR_WANT_WRITE
 * except ImportError:             # <<<<<<<<<<<<<<
 *     sslsocket_impl = None
 * 
 */
    __pyx_t_3 = PyErr_ExceptionMatches(__pyx_builtin_ImportError);
    if (__pyx_t_3) {
      __Pyx_AddTraceback("coio");
      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L4_except_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_4);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1449
 *     SSL_ERROR_WANT_WRITE = ssl.SSL_ERROR_WANT_WRITE
 * except ImportError:
 *     sslsocket_impl = None             # <<<<<<<<<<<<<<
 * 
 * 
 */
      if (PyObject_SetAttr(__pyx_m, __pyx_n_s__sslsocket_impl, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L4_except_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L3_exception_handled;
    }
    __pyx_L4_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L3_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L9_try_end:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1807
 *                     raise
 * 
 *     def getpeercert(nbsslsocket self, binary_form=False):             # <<<<<<<<<<<<<<
 *         return self.sslobj.peer_certificate(binary_form)
 * 
 */
  __pyx_t_4 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_k_17 = __pyx_t_4;
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":74
 *     int c_HERROR_NO_ADDRESS "NO_ADDRESS"  # == "NO_DATA"
 * 
 * HERROR_HOST_NOT_FOUND = c_HERROR_HOST_NOT_FOUND             # <<<<<<<<<<<<<<
 * HERROR_TRY_AGAIN = c_HERROR_TRY_AGAIN
 * HERROR_NO_RECOVERY = c_HERROR_NO_RECOVERY
 */
  __pyx_t_4 = PyInt_FromLong(HOST_NOT_FOUND); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_38, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":75
 * 
 * HERROR_HOST_NOT_FOUND = c_HERROR_HOST_NOT_FOUND
 * HERROR_TRY_AGAIN = c_HERROR_TRY_AGAIN             # <<<<<<<<<<<<<<
 * HERROR_NO_RECOVERY = c_HERROR_NO_RECOVERY
 * HERROR_NO_DATA = c_HERROR_NO_DATA
 */
  __pyx_t_4 = PyInt_FromLong(TRY_AGAIN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__HERROR_TRY_AGAIN, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":76
 * HERROR_HOST_NOT_FOUND = c_HERROR_HOST_NOT_FOUND
 * HERROR_TRY_AGAIN = c_HERROR_TRY_AGAIN
 * HERROR_NO_RECOVERY = c_HERROR_NO_RECOVERY             # <<<<<<<<<<<<<<
 * HERROR_NO_DATA = c_HERROR_NO_DATA
 * HERROR_NO_ADDRESS = c_HERROR_NO_ADDRESS
 */
  __pyx_t_4 = PyInt_FromLong(NO_RECOVERY); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__HERROR_NO_RECOVERY, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":77
 * HERROR_TRY_AGAIN = c_HERROR_TRY_AGAIN
 * HERROR_NO_RECOVERY = c_HERROR_NO_RECOVERY
 * HERROR_NO_DATA = c_HERROR_NO_DATA             # <<<<<<<<<<<<<<
 * HERROR_NO_ADDRESS = c_HERROR_NO_ADDRESS
 * 
 */
  __pyx_t_4 = PyInt_FromLong(NO_DATA); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__HERROR_NO_DATA, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":78
 * HERROR_NO_RECOVERY = c_HERROR_NO_RECOVERY
 * HERROR_NO_DATA = c_HERROR_NO_DATA
 * HERROR_NO_ADDRESS = c_HERROR_NO_ADDRESS             # <<<<<<<<<<<<<<
 * 
 * # Result codes
 */
  __pyx_t_4 = PyInt_FromLong(NO_ADDRESS); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__HERROR_NO_ADDRESS, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":81
 * 
 * # Result codes
 * DNS_ERR_NONE = c_DNS_ERR_NONE             # <<<<<<<<<<<<<<
 * DNS_ERR_FORMAT = c_DNS_ERR_FORMAT
 * DNS_ERR_SERVERFAILED = c_DNS_ERR_SERVERFAILED
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_NONE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_NONE, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":82
 * # Result codes
 * DNS_ERR_NONE = c_DNS_ERR_NONE
 * DNS_ERR_FORMAT = c_DNS_ERR_FORMAT             # <<<<<<<<<<<<<<
 * DNS_ERR_SERVERFAILED = c_DNS_ERR_SERVERFAILED
 * DNS_ERR_NOTEXIST = c_DNS_ERR_NOTEXIST
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_FORMAT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_FORMAT, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":83
 * DNS_ERR_NONE = c_DNS_ERR_NONE
 * DNS_ERR_FORMAT = c_DNS_ERR_FORMAT
 * DNS_ERR_SERVERFAILED = c_DNS_ERR_SERVERFAILED             # <<<<<<<<<<<<<<
 * DNS_ERR_NOTEXIST = c_DNS_ERR_NOTEXIST
 * DNS_ERR_NOTIMPL = c_DNS_ERR_NOTIMPL
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_SERVERFAILED); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_53, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":84
 * DNS_ERR_FORMAT = c_DNS_ERR_FORMAT
 * DNS_ERR_SERVERFAILED = c_DNS_ERR_SERVERFAILED
 * DNS_ERR_NOTEXIST = c_DNS_ERR_NOTEXIST             # <<<<<<<<<<<<<<
 * DNS_ERR_NOTIMPL = c_DNS_ERR_NOTIMPL
 * DNS_ERR_REFUSED = c_DNS_ERR_REFUSED
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_NOTEXIST); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_NOTEXIST, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":85
 * DNS_ERR_SERVERFAILED = c_DNS_ERR_SERVERFAILED
 * DNS_ERR_NOTEXIST = c_DNS_ERR_NOTEXIST
 * DNS_ERR_NOTIMPL = c_DNS_ERR_NOTIMPL             # <<<<<<<<<<<<<<
 * DNS_ERR_REFUSED = c_DNS_ERR_REFUSED
 * DNS_ERR_TRUNCATED = c_DNS_ERR_TRUNCATED
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_NOTIMPL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_NOTIMPL, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":86
 * DNS_ERR_NOTEXIST = c_DNS_ERR_NOTEXIST
 * DNS_ERR_NOTIMPL = c_DNS_ERR_NOTIMPL
 * DNS_ERR_REFUSED = c_DNS_ERR_REFUSED             # <<<<<<<<<<<<<<
 * DNS_ERR_TRUNCATED = c_DNS_ERR_TRUNCATED
 * DNS_ERR_UNKNOWN = c_DNS_ERR_UNKNOWN
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_REFUSED); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_REFUSED, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":87
 * DNS_ERR_NOTIMPL = c_DNS_ERR_NOTIMPL
 * DNS_ERR_REFUSED = c_DNS_ERR_REFUSED
 * DNS_ERR_TRUNCATED = c_DNS_ERR_TRUNCATED             # <<<<<<<<<<<<<<
 * DNS_ERR_UNKNOWN = c_DNS_ERR_UNKNOWN
 * DNS_ERR_TIMEOUT = c_DNS_ERR_TIMEOUT
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_TRUNCATED); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_TRUNCATED, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":88
 * DNS_ERR_REFUSED = c_DNS_ERR_REFUSED
 * DNS_ERR_TRUNCATED = c_DNS_ERR_TRUNCATED
 * DNS_ERR_UNKNOWN = c_DNS_ERR_UNKNOWN             # <<<<<<<<<<<<<<
 * DNS_ERR_TIMEOUT = c_DNS_ERR_TIMEOUT
 * DNS_ERR_SHUTDOWN = c_DNS_ERR_SHUTDOWN
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_UNKNOWN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_UNKNOWN, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":89
 * DNS_ERR_TRUNCATED = c_DNS_ERR_TRUNCATED
 * DNS_ERR_UNKNOWN = c_DNS_ERR_UNKNOWN
 * DNS_ERR_TIMEOUT = c_DNS_ERR_TIMEOUT             # <<<<<<<<<<<<<<
 * DNS_ERR_SHUTDOWN = c_DNS_ERR_SHUTDOWN
 * 
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_TIMEOUT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_TIMEOUT, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":90
 * DNS_ERR_UNKNOWN = c_DNS_ERR_UNKNOWN
 * DNS_ERR_TIMEOUT = c_DNS_ERR_TIMEOUT
 * DNS_ERR_SHUTDOWN = c_DNS_ERR_SHUTDOWN             # <<<<<<<<<<<<<<
 * 
 * # Types
 */
  __pyx_t_4 = PyInt_FromLong(DNS_ERR_SHUTDOWN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_ERR_SHUTDOWN, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":93
 * 
 * # Types
 * DNS_IPv4_A = c_DNS_IPv4_A             # <<<<<<<<<<<<<<
 * DNS_PTR = c_DNS_PTR
 * DNS_IPv6_AAAA = c_DNS_IPv6_AAAA
 */
  __pyx_t_4 = PyInt_FromLong(DNS_IPv4_A); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_IPv4_A, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":94
 * # Types
 * DNS_IPv4_A = c_DNS_IPv4_A
 * DNS_PTR = c_DNS_PTR             # <<<<<<<<<<<<<<
 * DNS_IPv6_AAAA = c_DNS_IPv6_AAAA
 * 
 */
  __pyx_t_4 = PyInt_FromLong(DNS_PTR); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_PTR, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":95
 * DNS_IPv4_A = c_DNS_IPv4_A
 * DNS_PTR = c_DNS_PTR
 * DNS_IPv6_AAAA = c_DNS_IPv6_AAAA             # <<<<<<<<<<<<<<
 * 
 * # Flags
 */
  __pyx_t_4 = PyInt_FromLong(DNS_IPv6_AAAA); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_IPv6_AAAA, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":98
 * 
 * # Flags
 * DNS_QUERY_NO_SEARCH = c_DNS_QUERY_NO_SEARCH             # <<<<<<<<<<<<<<
 * 
 * cdef char dns_initialized
 */
  __pyx_t_4 = PyInt_FromLong(DNS_QUERY_NO_SEARCH); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DNS_QUERY_NO_SEARCH, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":101
 * 
 * cdef char dns_initialized
 * dns_initialized = 0             # <<<<<<<<<<<<<<
 * 
 * def dns_init():
 */
  __pyx_v_4coio_dns_initialized = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":169
 *         return ''
 * 
 * class DnsLookupError(IOError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_builtin_IOError);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_builtin_IOError);
  __Pyx_GIVEREF(__pyx_builtin_IOError);
  __pyx_t_1 = __Pyx_CreateClass(__pyx_t_2, ((PyObject *)__pyx_t_4), __pyx_n_s__DnsLookupError, "coio"); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DnsLookupError, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":172
 *     pass
 * 
 * class DnsResultParseError(Exception):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_builtin_Exception);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_builtin_Exception);
  __Pyx_GIVEREF(__pyx_builtin_Exception);
  __pyx_t_2 = __Pyx_CreateClass(__pyx_t_1, ((PyObject *)__pyx_t_4), __pyx_n_s__DnsResultParseError, "coio"); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__DnsResultParseError, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":371
 * 
 * # Maps IP addresses to list of host names from /etc/hosts.
 * names_by_ip = {}             # <<<<<<<<<<<<<<
 * 
 * # Maps IP addresses and host names to list of host names from /etc/hosts.
 */
  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__names_by_ip, ((PyObject *)__pyx_t_4)) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":374
 * 
 * # Maps IP addresses and host names to list of host names from /etc/hosts.
 * names_by_nameip = {}             # <<<<<<<<<<<<<<
 * 
 * # TODO(pts): Move this to pure Python to save memory and disk space.
 */
  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__names_by_nameip, ((PyObject *)__pyx_t_4)) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":8
 * # --- Initialization.
 * 
 * event_init()             # <<<<<<<<<<<<<<
 * 
 * # This is needed so Ctrl-<C> raises (eventually, when the main_loop_tasklet
 */
  event_init();

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":12
 * # This is needed so Ctrl-<C> raises (eventually, when the main_loop_tasklet
 * # gets control) a KeyboardInterrupt in the main tasklet.
 * event(SigIntHandler, handle=SIGINT, evtype=EV_SIGNAL | EV_PERSIST).add()             # <<<<<<<<<<<<<<
 * 
 * # Don't publish it. MainLoop depends on it not being changed.
 */
  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__SigIntHandler); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_1 = PyInt_FromLong(SIGINT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__handle), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__EV_SIGNAL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__EV_PERSIST); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyNumber_Or(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__evtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyEval_CallObjectWithKeywords(((PyObject *)((PyObject*)__pyx_ptype_4coio_event)), __pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__add); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":16
 * # Don't publish it. MainLoop depends on it not being changed.
 * cdef tasklet link_helper_tasklet
 * link_helper_tasklet = stackless.tasklet(LinkHelper)().remove()             # <<<<<<<<<<<<<<
 * 
 * # Don't publish it, as a safety for read-only.
 */
  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__stackless); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_4 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__tasklet); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__LinkHelper); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__remove); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_4coio_tasklet))))) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  __Pyx_DECREF(((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_v_4coio_link_helper_tasklet = ((PyTaskletObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":22
 * def get_main_loop_tasklet():
 *   return main_loop_tasklet
 * main_loop_tasklet = stackless.tasklet(MainLoop)(link_helper_tasklet)             # <<<<<<<<<<<<<<
 * 
 * try:
 */
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__stackless); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__tasklet); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__MainLoop); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_6, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  __pyx_t_6 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_4coio_tasklet))))) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_v_4coio_main_loop_tasklet));
  __Pyx_DECREF(((PyObject *)__pyx_v_4coio_main_loop_tasklet));
  __Pyx_GIVEREF(__pyx_t_6);
  __pyx_v_4coio_main_loop_tasklet = ((PyTaskletObject *)__pyx_t_6);
  __pyx_t_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":24
 * main_loop_tasklet = stackless.tasklet(MainLoop)(link_helper_tasklet)
 * 
 * try:             # <<<<<<<<<<<<<<
 *   read_etc_hosts()
 * except IOError:
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":25
 * 
 * try:
 *   read_etc_hosts()             # <<<<<<<<<<<<<<
 * except IOError:
 *   pass
 */
      __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__read_etc_hosts); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L12_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L12_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L19_try_end;
    __pyx_L12_error:;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":26
 * try:
 *   read_etc_hosts()
 * except IOError:             # <<<<<<<<<<<<<<
 *   pass
 */
    __pyx_t_3 = PyErr_ExceptionMatches(__pyx_builtin_IOError);
    if (__pyx_t_3) {
      PyErr_Restore(0,0,0);
      goto __pyx_L13_exception_handled;
    }
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L13_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L19_try_end:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":1
 * include "event.pxi"             # <<<<<<<<<<<<<<
 * include "nbevent.pxi"
 * include "evdns.pxi"
 */
  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__event); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__add); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_54), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__event); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__pending); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_55), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__event); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__delete); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_56), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__dispatch); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_57), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__loop); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_58), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__abort); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_59), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__SendExceptionAndRun); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_60), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__set_fd_blocking); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_61), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__reset); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_62), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__expand); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_63), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__consume); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_64), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__peek); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_65), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__append_clear); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_66), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__consumeline); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_67), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__nb_flush); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_68), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__peekline); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_69), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__read_from_fd); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_70), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__read_from_fd_again); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_71), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__write_to_fd); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_72), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__evbuffer); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__write_to_fd_again); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_73), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbfile); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__discard); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_74), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbfile); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s_76); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_75), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbfile); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__read); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_77), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbfile); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__read_at_most); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_78), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__setdoclose); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_79), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__makefile_samefd); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_80), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__makefile); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_81), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsslsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__dup); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_82), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsslsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__read); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_83), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsslsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__write); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_84), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsslsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__connect_ex); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_85), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsslsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__recv); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_86), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__nbsslsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__makefile); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_87), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__new_realsocket); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_88), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s_90); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_89), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__sleep); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_91), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__fdopen); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_92), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__dns_init); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_93), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__dns_init_force); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_94), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__dns_shutdown); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_95), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__dns_resolve_ipv4); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_96), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__dns_resolve_ipv6); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_97), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__dns_resolve_reverse); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_98), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__read_etc_hosts); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_99), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__gethostbyname); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_100), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__gethostbyaddr); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_101), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_GetAttr(__pyx_m, __pyx_n_s__getfqdn); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_GetAttrString(__pyx_t_6, "__doc__");
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_102), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_m, __pyx_n_s__gethostbyname_ex); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetAttrString(__pyx_t_2, "__doc__");
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_103), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____test__, ((PyObject *)__pyx_t_4)) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  if (__pyx_m) {
    __Pyx_AddTraceback("init coio");
    Py_DECREF(__pyx_m); __pyx_m = 0;
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init coio");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

static const char *__pyx_filenames[] = {
  "nbevent.pxi",
  "evdns.pxi",
  "event.pxi",
  "coio.pyx",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}


static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AS_STRING(kw_name));
        #endif
}

static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *number, *more_or_less;

    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    number = (num_expected == 1) ? "" : "s";
    PyErr_Format(PyExc_TypeError,
        #if PY_VERSION_HEX < 0x02050000
            "%s() takes %s %d positional argument%s (%d given)",
        #else
            "%s() takes %s %zd positional argument%s (%zd given)",
        #endif
        func_name, more_or_less, num_expected, number, num_found);
}

static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;

    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
        } else {
            #if PY_MAJOR_VERSION < 3
            if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key))) {
            #else
            if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key))) {
            #endif
                goto invalid_keyword_type;
            } else {
                for (name = first_kw_arg; *name; name++) {
                    #if PY_MAJOR_VERSION >= 3
                    if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                        PyUnicode_Compare(**name, key) == 0) break;
                    #else
                    if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                        _PyString_Eq(**name, key)) break;
                    #endif
                }
                if (*name) {
                    values[name-argnames] = value;
                } else {
                    /* unexpected keyword found */
                    for (name=argnames; name != first_kw_arg; name++) {
                        if (**name == key) goto arg_passed_twice;
                        #if PY_MAJOR_VERSION >= 3
                        if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                            PyUnicode_Compare(**name, key) == 0) goto arg_passed_twice;
                        #else
                        if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                            _PyString_Eq(**name, key)) goto arg_passed_twice;
                        #endif
                    }
                    if (kwds2) {
                        if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
                    } else {
                        goto invalid_keyword;
                    }
                }
            }
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, **name);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%s() got an unexpected keyword argument '%s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *local_type, *local_value, *local_tb;
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
    if (unlikely(tstate->curexc_type))
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
        goto bad;
    #endif
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
    Py_INCREF(local_type);
    Py_INCREF(local_value);
    Py_INCREF(local_tb);
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    /* Make sure tstate is in a consistent state when we XDECREF
       these objects (XDECREF may run arbitrary code). */
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}


static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();

    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}

static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;

    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
}


static CYTHON_INLINE int __Pyx_CheckKeywordStrings(
    PyObject *kwdict,
    const char* function_name,
    int kw_allowed)
{
    PyObject* key = 0;
    Py_ssize_t pos = 0;
    while (PyDict_Next(kwdict, &pos, &key, 0)) {
        #if PY_MAJOR_VERSION < 3
        if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key)))
        #else
        if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key)))
        #endif
            goto invalid_keyword_type;
    }
    if ((!kw_allowed) && unlikely(key))
        goto invalid_keyword;
    return 1;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%s() keywords must be strings", function_name);
    return 0;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%s() got an unexpected keyword argument '%s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
    return 0;
}

static PyObject* __Pyx_PyEval_CallObjectWithKeywords(PyObject *callable, PyObject *args, PyObject *kwargs) {
    PyObject* result;
    if (likely(PyDict_Check(kwargs))) {
        return PyEval_CallObjectWithKeywords(callable, args, kwargs);
    } else {
        PyObject* real_dict;
        real_dict = PyObject_CallFunctionObjArgs((PyObject*)&PyDict_Type, kwargs, NULL);
        if (unlikely(!real_dict))
            return NULL;
        result = PyEval_CallObjectWithKeywords(callable, args, real_dict);
        Py_DECREF(real_dict);
        return result; /* may be NULL */
    }
}

static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
        #if PY_VERSION_HEX < 0x02050000
                 "need more than %d value%s to unpack", (int)index,
        #else
                 "need more than %zd value%s to unpack", index,
        #endif
                 (index == 1) ? "" : "s");
}

static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(void) {
    PyErr_SetString(PyExc_ValueError, "too many values to unpack");
}

static PyObject *__Pyx_UnpackItem(PyObject *iter, Py_ssize_t index) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred()) {
            __Pyx_RaiseNeedMoreValuesError(index);
        }
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        __Pyx_RaiseTooManyValuesError();
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}


static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (unlikely(!type)) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (likely(PyObject_TypeCheck(obj, type)))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                 Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact)
{
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (Py_TYPE(obj) == type) return 1;
    }
    else {
        if (PyObject_TypeCheck(obj, type)) return 1;
    }
    PyErr_Format(PyExc_TypeError,
        "Argument '%s' has incorrect type (expected %s, got %s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
    return 0;
}

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
}

static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = __Pyx_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunctionObjArgs(__import__,
        name, global_dict, empty_dict, list, NULL);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static PyObject *__Pyx_CreateClass(
    PyObject *bases, PyObject *dict, PyObject *name, const char *modname)
{
    PyObject *py_modname;
    PyObject *result = 0;

    #if PY_MAJOR_VERSION < 3
    py_modname = PyString_FromString(modname);
    #else
    py_modname = PyUnicode_FromString(modname);
    #endif
    if (!py_modname)
        goto bad;
    if (PyDict_SetItemString(dict, "__module__", py_modname) < 0)
        goto bad;
    #if PY_MAJOR_VERSION < 3
    result = PyClass_New(bases, dict, name);
    #else
    result = PyObject_CallFunctionObjArgs((PyObject *)&PyType_Type, name, bases, dict, NULL);
    #endif
bad:
    Py_XDECREF(py_modname);
    return result;
}

#if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    /* First, check the traceback argument, replacing None with NULL. */
    if (tb == Py_None) {
        Py_DECREF(tb);
        tb = 0;
    }
    else if (tb != NULL && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    /* Next, replace a missing value with None */
    if (value == NULL) {
        value = Py_None;
        Py_INCREF(value);
    }
    #if PY_VERSION_HEX < 0x02050000
    if (!PyClass_Check(type))
    #else
    if (!PyType_Check(type))
    #endif
    {
        /* Raising an instance.  The value should be a dummy. */
        if (value != Py_None) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        Py_DECREF(value);
        value = type;
        #if PY_VERSION_HEX < 0x02050000
            if (PyInstance_Check(type)) {
                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
                Py_INCREF(type);
            }
            else {
                type = 0;
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception must be an old-style class or instance");
                goto raise_error;
            }
        #else
            type = (PyObject*) Py_TYPE(type);
            Py_INCREF(type);
            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception class must be a subclass of BaseException");
                goto raise_error;
            }
        #endif
    }

    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

#else /* Python 3+ */

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;

    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (!PyExceptionClass_Check(type)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }

    PyErr_SetObject(type, value);

    if (tb) {
        PyThreadState *tstate = PyThreadState_GET();
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
    }

bad:
    return;
}
#endif

static CYTHON_INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject* x) {
    const unsigned char neg_one = (unsigned char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned char" :
                    "value too large to convert to unsigned char");
            }
            return (unsigned char)-1;
        }
        return (unsigned char)val;
    }
    return (unsigned char)__Pyx_PyInt_AsUnsignedLong(x);
}

static CYTHON_INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject* x) {
    const unsigned short neg_one = (unsigned short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned short" :
                    "value too large to convert to unsigned short");
            }
            return (unsigned short)-1;
        }
        return (unsigned short)val;
    }
    return (unsigned short)__Pyx_PyInt_AsUnsignedLong(x);
}

static CYTHON_INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject* x) {
    const unsigned int neg_one = (unsigned int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned int" :
                    "value too large to convert to unsigned int");
            }
            return (unsigned int)-1;
        }
        return (unsigned int)val;
    }
    return (unsigned int)__Pyx_PyInt_AsUnsignedLong(x);
}

static CYTHON_INLINE char __Pyx_PyInt_AsChar(PyObject* x) {
    const char neg_one = (char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to char" :
                    "value too large to convert to char");
            }
            return (char)-1;
        }
        return (char)val;
    }
    return (char)__Pyx_PyInt_AsLong(x);
}

static CYTHON_INLINE short __Pyx_PyInt_AsShort(PyObject* x) {
    const short neg_one = (short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to short" :
                    "value too large to convert to short");
            }
            return (short)-1;
        }
        return (short)val;
    }
    return (short)__Pyx_PyInt_AsLong(x);
}

static CYTHON_INLINE int __Pyx_PyInt_AsInt(PyObject* x) {
    const int neg_one = (int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to int" :
                    "value too large to convert to int");
            }
            return (int)-1;
        }
        return (int)val;
    }
    return (int)__Pyx_PyInt_AsLong(x);
}

static CYTHON_INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject* x) {
    const signed char neg_one = (signed char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed char" :
                    "value too large to convert to signed char");
            }
            return (signed char)-1;
        }
        return (signed char)val;
    }
    return (signed char)__Pyx_PyInt_AsSignedLong(x);
}

static CYTHON_INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject* x) {
    const signed short neg_one = (signed short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed short" :
                    "value too large to convert to signed short");
            }
            return (signed short)-1;
        }
        return (signed short)val;
    }
    return (signed short)__Pyx_PyInt_AsSignedLong(x);
}

static CYTHON_INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject* x) {
    const signed int neg_one = (signed int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed int" :
                    "value too large to convert to signed int");
            }
            return (signed int)-1;
        }
        return (signed int)val;
    }
    return (signed int)__Pyx_PyInt_AsSignedLong(x);
}

static CYTHON_INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject* x) {
    const unsigned long neg_one = (unsigned long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned long");
            return (unsigned long)-1;
        }
        return (unsigned long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned long");
                return (unsigned long)-1;
            }
            return PyLong_AsUnsignedLong(x);
        } else {
            return PyLong_AsLong(x);
        }
    } else {
        unsigned long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned long)-1;
        val = __Pyx_PyInt_AsUnsignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static CYTHON_INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject* x) {
    const unsigned PY_LONG_LONG neg_one = (unsigned PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned PY_LONG_LONG");
            return (unsigned PY_LONG_LONG)-1;
        }
        return (unsigned PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned PY_LONG_LONG");
                return (unsigned PY_LONG_LONG)-1;
            }
            return PyLong_AsUnsignedLongLong(x);
        } else {
            return PyLong_AsLongLong(x);
        }
    } else {
        unsigned PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsUnsignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static CYTHON_INLINE long __Pyx_PyInt_AsLong(PyObject* x) {
    const long neg_one = (long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to long");
            return (long)-1;
        }
        return (long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to long");
                return (long)-1;
            }
            return PyLong_AsUnsignedLong(x);
        } else {
            return PyLong_AsLong(x);
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (long)-1;
        val = __Pyx_PyInt_AsLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static CYTHON_INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject* x) {
    const PY_LONG_LONG neg_one = (PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to PY_LONG_LONG");
            return (PY_LONG_LONG)-1;
        }
        return (PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to PY_LONG_LONG");
                return (PY_LONG_LONG)-1;
            }
            return PyLong_AsUnsignedLongLong(x);
        } else {
            return PyLong_AsLongLong(x);
        }
    } else {
        PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static CYTHON_INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject* x) {
    const signed long neg_one = (signed long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to signed long");
            return (signed long)-1;
        }
        return (signed long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to signed long");
                return (signed long)-1;
            }
            return PyLong_AsUnsignedLong(x);
        } else {
            return PyLong_AsLong(x);
        }
    } else {
        signed long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed long)-1;
        val = __Pyx_PyInt_AsSignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static CYTHON_INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject* x) {
    const signed PY_LONG_LONG neg_one = (signed PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to signed PY_LONG_LONG");
            return (signed PY_LONG_LONG)-1;
        }
        return (signed PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to signed PY_LONG_LONG");
                return (signed PY_LONG_LONG)-1;
            }
            return PyLong_AsUnsignedLongLong(x);
        } else {
            return PyLong_AsLongLong(x);
        }
    } else {
        signed PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsSignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static void __Pyx_WriteUnraisable(const char *name) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
    #if PY_MAJOR_VERSION < 3
    ctx = PyString_FromString(name);
    #else
    ctx = PyUnicode_FromString(name);
    #endif
    __Pyx_ErrRestore(old_exc, old_val, old_tb);
    if (!ctx) {
        PyErr_WriteUnraisable(Py_None);
    } else {
        PyErr_WriteUnraisable(ctx);
        Py_DECREF(ctx);
    }
}

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name,
    long size, int strict)
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    PyObject *py_name = 0;
    char warning[200];

    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    #if PY_MAJOR_VERSION < 3
    py_name = PyString_FromString(class_name);
    #else
    py_name = PyUnicode_FromString(class_name);
    #endif
    if (!py_name)
        goto bad;
    result = PyObject_GetAttr(py_module, py_name);
    Py_DECREF(py_name);
    py_name = 0;
    Py_DECREF(py_module);
    py_module = 0;
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError, 
            "%s.%s is not a type object",
            module_name, class_name);
        goto bad;
    }
    if (!strict && ((PyTypeObject *)result)->tp_basicsize > size) {
        PyOS_snprintf(warning, sizeof(warning), 
            "%s.%s size changed, may indicate binary incompatibility",
            module_name, class_name);
        PyErr_WarnEx(NULL, warning, 0);
    }
    else if (((PyTypeObject *)result)->tp_basicsize != size) {
        PyErr_Format(PyExc_ValueError, 
            "%s.%s has the wrong size, try recompiling",
            module_name, class_name);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(py_module);
    Py_XDECREF(result);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(const char *name) {
    PyObject *py_name = 0;
    PyObject *py_module = 0;

    #if PY_MAJOR_VERSION < 3
    py_name = PyString_FromString(name);
    #else
    py_name = PyUnicode_FromString(name);
    #endif
    if (!py_name)
        goto bad;
    py_module = PyImport_Import(py_name);
    Py_DECREF(py_name);
    return py_module;
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(const char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;

    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(__pyx_filename);
    #else
    py_srcfile = PyUnicode_FromString(__pyx_filename);
    #endif
    if (!py_srcfile) goto bad;
    if (__pyx_clineno) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        #if PY_MAJOR_VERSION >= 3
        0,            /*int kwonlyargcount,*/
        #endif
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple,  /*PyObject *consts,*/
        __pyx_empty_tuple,  /*PyObject *names,*/
        __pyx_empty_tuple,  /*PyObject *varnames,*/
        __pyx_empty_tuple,  /*PyObject *freevars,*/
        __pyx_empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

/* Type Conversion Functions */

static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   if (x == Py_True) return 1;
   else if ((x == Py_False) | (x == Py_None)) return 0;
   else return PyObject_IsTrue(x);
}

static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x) {
  PyNumberMethods *m;
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_VERSION_HEX < 0x03000000
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return Py_INCREF(x), x;
  m = Py_TYPE(x)->tp_as_number;
#if PY_VERSION_HEX < 0x03000000
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
#else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
#endif
  if (res) {
#if PY_VERSION_HEX < 0x03000000
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%s__ returned non-%s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}

static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject* x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}

static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
#if PY_VERSION_HEX < 0x02050000
   if (ival <= LONG_MAX)
       return PyInt_FromLong((long)ival);
   else {
       unsigned char *bytes = (unsigned char *) &ival;
       int one = 1; int little = (int)*(unsigned char*)&one;
       return _PyLong_FromByteArray(bytes, sizeof(size_t), little, 0);
   }
#else
   return PyInt_FromSize_t(ival);
#endif
}

static CYTHON_INLINE size_t __Pyx_PyInt_AsSize_t(PyObject* x) {
   unsigned PY_LONG_LONG val = __Pyx_PyInt_AsUnsignedLongLong(x);
   if (unlikely(val == (unsigned PY_LONG_LONG)-1 && PyErr_Occurred())) {
       return (size_t)-1;
   } else if (unlikely(val != (unsigned PY_LONG_LONG)(size_t)val)) {
       PyErr_SetString(PyExc_OverflowError,
                       "value too large to convert to size_t");
       return (size_t)-1;
   }
   return (size_t)val;
}


#endif /* Py_PYTHON_H */
