/* Generated by Pyrex 0.9.8.5 on Sun Feb 14 14:55:41 2010 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)	PyInt_AsLong(o)
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#include "sys/types.h"
#include "event.h"
#include "stdlib.h"
#include "unistd.h"
#include "string.h"
#include "errno.h"
#include "fcntl.h"
#include "signal.h"
#include "sys/socket.h"
#include "frameobject.h"
#include "core/stackless_structs.h"
#include "stackless_api.h"
#include "evdns.h"
#include "netdb.h"


typedef struct {PyObject **p; int i; char *s; long n;} __Pyx_StringTabEntry; /*proto*/

static PyObject *__pyx_m;
static PyObject *__pyx_b;
static int __pyx_lineno;
static char *__pyx_filename;
static char **__pyx_f;

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static PyObject *__Pyx_GetItemInt(PyObject *o, Py_ssize_t i); /*proto*/

static void __Pyx_WriteUnraisable(char *name); /*proto*/

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed, char *name); /*proto*/

static int __Pyx_GetStarArgs(PyObject **args, PyObject **kwds, char *kwd_list[],     Py_ssize_t nargs, PyObject **args2, PyObject **kwds2, char rqd_kwds[]); /*proto*/

static PyObject *__Pyx_UnpackItem(PyObject *); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/

static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name, long size);  /*proto*/

static PyObject *__Pyx_ImportModule(char *name); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name, char *modname); /*proto*/

static void __Pyx_AddTraceback(char *funcname); /*proto*/

/* Declarations from coio */


/* Declarations from implementation of coio */

typedef void (*__pyx_t_4coio_event_handler)(int,short,void *);

struct __pyx_obj_4coio_event {
  PyObject_HEAD
  struct event ev;
  PyObject *handle;
  PyObject *evtype;
  PyObject *callback;
  PyObject *args;
  float timeout;
  struct timeval tv;
};

struct __pyx_obj_4coio_evbuffer {
  PyObject_HEAD
  struct evbuffer eb;
  struct event wakeup_ev;
};

enum __pyx_t_4coio_dummy {
  __pyx_e_4coio_DEFAULT_WRITE_BUFFER_LIMIT = 8192
};

struct __pyx_obj_4coio_nbfile {
  PyObject_HEAD
  PyObject *close_ref;
  struct event wakeup_ev;
  int read_fd;
  int write_fd;
  int c_write_buffer_limit;
  int c_read_limit;
  struct evbuffer read_eb;
  struct evbuffer write_eb;
  char c_do_close;
  char c_closed;
  char c_softspace;
  PyObject *c_mode;
  PyObject *c_name;
};

struct __pyx_obj_4coio_nbsocket {
  PyObject_HEAD
  struct event wakeup_ev;
  int fd;
  float timeout_value;
  struct timeval tv;
  PyObject *realsock;
  char c_do_close;
};

struct __pyx_obj_4coio_nbsslsocket {
  PyObject_HEAD
  struct event wakeup_ev;
  int fd;
  float timeout_value;
  struct timeval tv;
  PyObject *realsock;
  PyObject *sslsock;
  PyObject *sslobj;
};

struct __pyx_obj_4coio_sleeper {
  PyObject_HEAD
  struct event wakeup_ev;
};

typedef int (*__pyx_t_4coio__evdns_call_t)(char const*,int,evdns_callback_type,void *);

struct __pyx_obj_4coio_dnsresult {
  PyObject_HEAD
  char _t;
  int _ttl;
  PyListObject *_values;
};








static PyTypeObject *__pyx_ptype_4coio_event = 0;
static PyTypeObject *__pyx_ptype_4coio_tasklet = 0;
static PyTypeObject *__pyx_ptype_4coio_bomb = 0;
static PyTypeObject *__pyx_ptype_4coio_evbuffer = 0;
static PyTypeObject *__pyx_ptype_4coio_nbfile = 0;
static PyTypeObject *__pyx_ptype_4coio_nbsocket = 0;
static PyTypeObject *__pyx_ptype_4coio_nbsslsocket = 0;
static PyTypeObject *__pyx_ptype_4coio_sleeper = 0;
static PyTypeObject *__pyx_ptype_4coio_dnsresult = 0;
static int __pyx_v_4coio_SSL_ERROR_EOF;
static int __pyx_v_4coio_SSL_ERROR_WANT_READ;
static int __pyx_v_4coio_SSL_ERROR_WANT_WRITE;
static char __pyx_v_4coio_dns_initialized;
static PyTaskletObject *__pyx_v_4coio_link_helper_tasklet;
static PyTaskletObject *__pyx_v_4coio_main_loop_tasklet;
static void __pyx_f_4coio___event_abort(void); /*proto*/
static void __pyx_f_4coio___event_handler(int,short,void *); /*proto*/
static void __pyx_f_4coio___simple_event_handler(int,short,void *); /*proto*/
static void __pyx_f_4coio_set_fd_nonblocking(int); /*proto*/
static void __pyx_f_4coio_HandleCTimeoutWakeup(int,short,void *); /*proto*/
static void __pyx_f_4coio_HandleCWakeup(int,short,void *); /*proto*/
static PyObject *__pyx_f_4coio_write_to_fd(int,struct event *,char const*,Py_ssize_t); /*proto*/
static PyObject *__pyx_f_4coio_handle_eagain(struct __pyx_obj_4coio_nbsocket *,int); /*proto*/
static PyObject *__pyx_f_4coio_handle_ssl_eagain(struct __pyx_obj_4coio_nbsslsocket *,int); /*proto*/
static PyObject *__pyx_f_4coio_format_ipv6_word(unsigned int,unsigned int); /*proto*/
static void __pyx_f_4coio__dns_callback(int,char,int,int,void *,void *); /*proto*/
static char __pyx_f_4coio_is_valid_hex_digit(char); /*proto*/
static char __pyx_f_4coio_is_valid_ipv6(char *); /*proto*/
static char __pyx_f_4coio_is_valid_ipv4(char *); /*proto*/
static struct __pyx_obj_4coio_dnsresult *__pyx_f_4coio_dns_call(__pyx_t_4coio__evdns_call_t,char const*,int); /*proto*/
static PyObject *__pyx_f_4coio_raise_gaierror(PyObject *,char); /*proto*/
static PyObject *__pyx_f_4coio_raise_herror(PyObject *); /*proto*/
static PyObject *__pyx_f_4coio_c_gethostbyname(PyObject *,int); /*proto*/

static char __pyx_k1[] = "sys";
static char __pyx_k2[] = "exc_info";
static char __pyx_k3[] = "__event_exc";
static char __pyx_k4[] = "__callback";
static char __pyx_k5[] = "__simple_callback";
static char __pyx_k6[] = "fileno";
static char __pyx_k7[] = "pending";
static char __pyx_k8[] = "delete";
static char __pyx_k9[] = "<event flags=0x%x, handle=%s, callback=%s, arg=%s>";
static char __pyx_k10[] = "blocked";
static char __pyx_k11[] = "_channel";
static char __pyx_k12[] = "preference";
static char __pyx_k13[] = "balance";
static char __pyx_k14[] = "send";
static char __pyx_k15[] = "insert";
static char __pyx_k16[] = "run";
static char __pyx_k17[] = "LinkHelper tasklet called";
static char __pyx_k18[] = "loop";
static char __pyx_k19[] = "SendExceptionAndRun";
static char __pyx_k20[] = "stackless";
static char __pyx_k21[] = "main";
static char __pyx_k22[] = "<evbuffer misalign=%s, totallen=%s, off=%s at 0x%x>";
static char __pyx_k23[] = "";
static char __pyx_k24[] = "\n";
static char __pyx_k25[] = "accept";
static char __pyx_k26[] = "socket";
static char __pyx_k27[] = "error";
static char __pyx_k28[] = "errno";
static char __pyx_k29[] = "w";
static char __pyx_k30[] = "r";
static char __pyx_k31[] = "flush";
static char __pyx_k32[] = "close";
static char __pyx_k33[] = "write_buffer_limit";
static char __pyx_k34[] = "fd";
static char __pyx_k35[] = "discard";
static char __pyx_k36[] = "readline";
static char __pyx_k37[] = "e";
static char __pyx_k38[] = "timed out";
static char __pyx_k39[] = "socket_impl";
static char __pyx_k40[] = "pop";
static char __pyx_k41[] = "dup";
static char __pyx_k42[] = "_closedsocket";
static char __pyx_k43[] = "type";
static char __pyx_k44[] = "family";
static char __pyx_k45[] = "proto";
static char __pyx_k46[] = "setsockopt";
static char __pyx_k47[] = "getsockopt";
static char __pyx_k48[] = "getsockname";
static char __pyx_k49[] = "getpeername";
static char __pyx_k50[] = "bind";
static char __pyx_k51[] = "listen";
static char __pyx_k52[] = "Timeout value out of range";
static char __pyx_k53[] = "connect_ex";
static char __pyx_k54[] = "shutdown";
static char __pyx_k55[] = "recv";
static char __pyx_k56[] = "recvfrom";
static char __pyx_k57[] = "recv_into";
static char __pyx_k58[] = "recvfrom_into";
static char __pyx_k59[] = "sendto";
static char __pyx_k60[] = "r+";
static char __pyx_k61[] = "do_close";
static char __pyx_k62[] = "close_ref";
static char __pyx_k63[] = "sslsocket_impl";
static char __pyx_k64[] = "_sock";
static char __pyx_k65[] = "_sslobj";
static char __pyx_k66[] = "setblocking";
static char __pyx_k67[] = "keyfile";
static char __pyx_k68[] = "cerfile";
static char __pyx_k69[] = "cert_reqs";
static char __pyx_k70[] = "ssl_version";
static char __pyx_k71[] = "ca_certs";
static char __pyx_k72[] = "do_handshake_on_connect";
static char __pyx_k73[] = "_suppress_ragged_eofs";
static char __pyx_k74[] = "_makefile_refs";
static char __pyx_k75[] = "read";
static char __pyx_k76[] = "SSLError";
static char __pyx_k77[] = "suppress_ragged_eofs";
static char __pyx_k78[] = "write";
static char __pyx_k79[] = "attempt to connect already-connected SSLSocket!";
static char __pyx_k80[] = "ssl";
static char __pyx_k81[] = "_ssl";
static char __pyx_k82[] = "sslwrap";
static char __pyx_k83[] = "certfile";
static char __pyx_k84[] = "do_handshake";
static char __pyx_k85[] = "connect";
static char __pyx_k86[] = "No SSL wrapper around ";
static char __pyx_k87[] = "peer_certificate";
static char __pyx_k88[] = "cipher";
static char __pyx_k89[] = "flags=0 expected for recv on ";
static char __pyx_k90[] = "__class__";
static char __pyx_k91[] = "flags=0 expected for send on ";
static char __pyx_k92[] = "args";
static char __pyx_k93[] = "flags=0 expected for sendall on ";
static char __pyx_k94[] = "_fileobject";
static char __pyx_k95[] = "setdoclose";
static char __pyx_k96[] = "socket_fromfd";
static char __pyx_k97[] = "sleep";
static char __pyx_k98[] = "mode";
static char __pyx_k99[] = "<dnsresult t=%d, ttl=%d values=%r at 0x%x>";
static char __pyx_k100[] = "%x";
static char __pyx_k101[] = "DnsLookupError";
static char __pyx_k102[] = "%d.%d.%d.%d";
static char __pyx_k103[] = ":";
static char __pyx_k104[] = "join";
static char __pyx_k105[] = "DnsResultParseError";
static char __pyx_k106[] = "unknown type";
static char __pyx_k107[] = "err";
static char __pyx_k108[] = "value";
static char __pyx_k109[] = "traceback";
static char __pyx_k110[] = "t";
static char __pyx_k111[] = "bad type for ipv4";
static char __pyx_k112[] = "bad type for ipv6";
static char __pyx_k113[] = "bad type for reverse";
static char __pyx_k114[] = "ip must be a string";
static char __pyx_k115[] = ".";
static char __pyx_k116[] = "split";
static char __pyx_k117[] = "bad ipv4 address";
static char __pyx_k118[] = "bad ipv6 address";
static char __pyx_k119[] = "unknown ip address syntax";
static char __pyx_k120[] = "strip";
static char __pyx_k121[] = "startswith";
static char __pyx_k122[] = "#";
static char __pyx_k123[] = "names_by_ip";
static char __pyx_k124[] = "setdefault";
static char __pyx_k125[] = "names_by_nameip";
static char __pyx_k126[] = "gaierror";
static char __pyx_k127[] = "EAI_NONAME";
static char __pyx_k128[] = "Name or service not known";
static char __pyx_k129[] = "EAI_NODATA";
static char __pyx_k130[] = "No address associated with hostname";
static char __pyx_k131[] = "herror";
static char __pyx_k132[] = "HERROR_HOST_NOT_FOUND";
static char __pyx_k133[] = "Unknown host";
static char __pyx_k134[] = "EAI_ADDRFAMILY";
static char __pyx_k135[] = "Address family for hostname not supported";
static char __pyx_k136[] = "dns_resolve_ipv4";
static char __pyx_k137[] = "values";
static char __pyx_k138[] = "dns_resolve_ipv6";
static char __pyx_k139[] = "dns_resolve_reverse";
static char __pyx_k140[] = "gethostname";
static char __pyx_k141[] = "Dug Song <dugsong@monkey.org>";
static char __pyx_k142[] = "Martin Murray <mmurray@monkey.org>";
static char __pyx_k143[] = "__author__";
static char __pyx_k144[] = "Copyright (c) 2004 Dug Song";
static char __pyx_k145[] = "Copyright (c) 2003 Martin Murray";
static char __pyx_k146[] = "__copyright__";
static char __pyx_k147[] = "BSD";
static char __pyx_k148[] = "__license__";
static char __pyx_k149[] = "http://monkey.org/~dugsong/pyevent/";
static char __pyx_k150[] = "__url__";
static char __pyx_k151[] = "0.4";
static char __pyx_k152[] = "__version__";
static char __pyx_k153[] = "EV_TIMEOUT";
static char __pyx_k154[] = "EV_READ";
static char __pyx_k155[] = "EV_WRITE";
static char __pyx_k156[] = "EV_SIGNAL";
static char __pyx_k157[] = "EV_PERSIST";
static char __pyx_k158[] = "types";
static char __pyx_k159[] = "_realsocket";
static char __pyx_k160[] = "fromfd";
static char __pyx_k161[] = "SSLSocket";
static char __pyx_k162[] = "SSL_ERROR_EOF";
static char __pyx_k163[] = "SSL_ERROR_WANT_READ";
static char __pyx_k164[] = "SSL_ERROR_WANT_WRITE";
static char __pyx_k165[] = "HERROR_TRY_AGAIN";
static char __pyx_k166[] = "HERROR_NO_RECOVERY";
static char __pyx_k167[] = "HERROR_NO_DATA";
static char __pyx_k168[] = "HERROR_NO_ADDRESS";
static char __pyx_k169[] = "DNS_ERR_NONE";
static char __pyx_k170[] = "DNS_ERR_FORMAT";
static char __pyx_k171[] = "DNS_ERR_SERVERFAILED";
static char __pyx_k172[] = "DNS_ERR_NOTEXIST";
static char __pyx_k173[] = "DNS_ERR_NOTIMPL";
static char __pyx_k174[] = "DNS_ERR_REFUSED";
static char __pyx_k175[] = "DNS_ERR_TRUNCATED";
static char __pyx_k176[] = "DNS_ERR_UNKNOWN";
static char __pyx_k177[] = "DNS_ERR_TIMEOUT";
static char __pyx_k178[] = "DNS_ERR_SHUTDOWN";
static char __pyx_k179[] = "DNS_IPv4_A";
static char __pyx_k180[] = "DNS_PTR";
static char __pyx_k181[] = "DNS_IPv6_AAAA";
static char __pyx_k182[] = "DNS_QUERY_NO_SEARCH";
static char __pyx_k183[] = "/etc/hosts";
static char __pyx_k184[] = "SigIntHandler";
static char __pyx_k185[] = "handle";
static char __pyx_k186[] = "evtype";
static char __pyx_k187[] = "add";
static char __pyx_k188[] = "tasklet";
static char __pyx_k189[] = "LinkHelper";
static char __pyx_k190[] = "remove";
static char __pyx_k191[] = "MainLoop";
static char __pyx_k192[] = "read_etc_hosts";

static PyObject *__pyx_n_BSD;
static PyObject *__pyx_n_DNS_ERR_FORMAT;
static PyObject *__pyx_n_DNS_ERR_NONE;
static PyObject *__pyx_n_DNS_ERR_NOTEXIST;
static PyObject *__pyx_n_DNS_ERR_NOTIMPL;
static PyObject *__pyx_n_DNS_ERR_REFUSED;
static PyObject *__pyx_n_DNS_ERR_SERVERFAILED;
static PyObject *__pyx_n_DNS_ERR_SHUTDOWN;
static PyObject *__pyx_n_DNS_ERR_TIMEOUT;
static PyObject *__pyx_n_DNS_ERR_TRUNCATED;
static PyObject *__pyx_n_DNS_ERR_UNKNOWN;
static PyObject *__pyx_n_DNS_IPv4_A;
static PyObject *__pyx_n_DNS_IPv6_AAAA;
static PyObject *__pyx_n_DNS_PTR;
static PyObject *__pyx_n_DNS_QUERY_NO_SEARCH;
static PyObject *__pyx_n_DnsLookupError;
static PyObject *__pyx_n_DnsResultParseError;
static PyObject *__pyx_n_EAI_ADDRFAMILY;
static PyObject *__pyx_n_EAI_NODATA;
static PyObject *__pyx_n_EAI_NONAME;
static PyObject *__pyx_n_EV_PERSIST;
static PyObject *__pyx_n_EV_READ;
static PyObject *__pyx_n_EV_SIGNAL;
static PyObject *__pyx_n_EV_TIMEOUT;
static PyObject *__pyx_n_EV_WRITE;
static PyObject *__pyx_n_HERROR_HOST_NOT_FOUND;
static PyObject *__pyx_n_HERROR_NO_ADDRESS;
static PyObject *__pyx_n_HERROR_NO_DATA;
static PyObject *__pyx_n_HERROR_NO_RECOVERY;
static PyObject *__pyx_n_HERROR_TRY_AGAIN;
static PyObject *__pyx_n_LinkHelper;
static PyObject *__pyx_n_MainLoop;
static PyObject *__pyx_n_SSLError;
static PyObject *__pyx_n_SSLSocket;
static PyObject *__pyx_n_SSL_ERROR_EOF;
static PyObject *__pyx_n_SSL_ERROR_WANT_READ;
static PyObject *__pyx_n_SSL_ERROR_WANT_WRITE;
static PyObject *__pyx_n_SendExceptionAndRun;
static PyObject *__pyx_n_SigIntHandler;
static PyObject *__pyx_n___author__;
static PyObject *__pyx_n___callback;
static PyObject *__pyx_n___class__;
static PyObject *__pyx_n___copyright__;
static PyObject *__pyx_n___event_exc;
static PyObject *__pyx_n___license__;
static PyObject *__pyx_n___simple_callback;
static PyObject *__pyx_n___url__;
static PyObject *__pyx_n___version__;
static PyObject *__pyx_n__channel;
static PyObject *__pyx_n__closedsocket;
static PyObject *__pyx_n__fileobject;
static PyObject *__pyx_n__makefile_refs;
static PyObject *__pyx_n__realsocket;
static PyObject *__pyx_n__sock;
static PyObject *__pyx_n__ssl;
static PyObject *__pyx_n__sslobj;
static PyObject *__pyx_n__suppress_ragged_eofs;
static PyObject *__pyx_n_accept;
static PyObject *__pyx_n_add;
static PyObject *__pyx_n_args;
static PyObject *__pyx_n_balance;
static PyObject *__pyx_n_bind;
static PyObject *__pyx_n_blocked;
static PyObject *__pyx_n_ca_certs;
static PyObject *__pyx_n_cerfile;
static PyObject *__pyx_n_cert_reqs;
static PyObject *__pyx_n_certfile;
static PyObject *__pyx_n_cipher;
static PyObject *__pyx_n_close;
static PyObject *__pyx_n_close_ref;
static PyObject *__pyx_n_connect;
static PyObject *__pyx_n_connect_ex;
static PyObject *__pyx_n_delete;
static PyObject *__pyx_n_discard;
static PyObject *__pyx_n_dns_resolve_ipv4;
static PyObject *__pyx_n_dns_resolve_ipv6;
static PyObject *__pyx_n_dns_resolve_reverse;
static PyObject *__pyx_n_do_close;
static PyObject *__pyx_n_do_handshake;
static PyObject *__pyx_n_do_handshake_on_connect;
static PyObject *__pyx_n_dup;
static PyObject *__pyx_n_e;
static PyObject *__pyx_n_err;
static PyObject *__pyx_n_errno;
static PyObject *__pyx_n_error;
static PyObject *__pyx_n_evtype;
static PyObject *__pyx_n_exc_info;
static PyObject *__pyx_n_family;
static PyObject *__pyx_n_fd;
static PyObject *__pyx_n_fileno;
static PyObject *__pyx_n_flush;
static PyObject *__pyx_n_fromfd;
static PyObject *__pyx_n_gaierror;
static PyObject *__pyx_n_gethostname;
static PyObject *__pyx_n_getpeername;
static PyObject *__pyx_n_getsockname;
static PyObject *__pyx_n_getsockopt;
static PyObject *__pyx_n_handle;
static PyObject *__pyx_n_herror;
static PyObject *__pyx_n_insert;
static PyObject *__pyx_n_join;
static PyObject *__pyx_n_keyfile;
static PyObject *__pyx_n_listen;
static PyObject *__pyx_n_loop;
static PyObject *__pyx_n_main;
static PyObject *__pyx_n_mode;
static PyObject *__pyx_n_names_by_ip;
static PyObject *__pyx_n_names_by_nameip;
static PyObject *__pyx_n_peer_certificate;
static PyObject *__pyx_n_pending;
static PyObject *__pyx_n_pop;
static PyObject *__pyx_n_preference;
static PyObject *__pyx_n_proto;
static PyObject *__pyx_n_r;
static PyObject *__pyx_n_read;
static PyObject *__pyx_n_read_etc_hosts;
static PyObject *__pyx_n_readline;
static PyObject *__pyx_n_recv;
static PyObject *__pyx_n_recv_into;
static PyObject *__pyx_n_recvfrom;
static PyObject *__pyx_n_recvfrom_into;
static PyObject *__pyx_n_remove;
static PyObject *__pyx_n_run;
static PyObject *__pyx_n_send;
static PyObject *__pyx_n_sendto;
static PyObject *__pyx_n_setblocking;
static PyObject *__pyx_n_setdefault;
static PyObject *__pyx_n_setdoclose;
static PyObject *__pyx_n_setsockopt;
static PyObject *__pyx_n_shutdown;
static PyObject *__pyx_n_sleep;
static PyObject *__pyx_n_socket;
static PyObject *__pyx_n_socket_fromfd;
static PyObject *__pyx_n_socket_impl;
static PyObject *__pyx_n_split;
static PyObject *__pyx_n_ssl;
static PyObject *__pyx_n_ssl_version;
static PyObject *__pyx_n_sslsocket_impl;
static PyObject *__pyx_n_sslwrap;
static PyObject *__pyx_n_stackless;
static PyObject *__pyx_n_startswith;
static PyObject *__pyx_n_strip;
static PyObject *__pyx_n_suppress_ragged_eofs;
static PyObject *__pyx_n_sys;
static PyObject *__pyx_n_t;
static PyObject *__pyx_n_tasklet;
static PyObject *__pyx_n_traceback;
static PyObject *__pyx_n_type;
static PyObject *__pyx_n_types;
static PyObject *__pyx_n_value;
static PyObject *__pyx_n_values;
static PyObject *__pyx_n_w;
static PyObject *__pyx_n_write;
static PyObject *__pyx_n_write_buffer_limit;

static PyObject *__pyx_k9p;
static PyObject *__pyx_k17p;
static PyObject *__pyx_k22p;
static PyObject *__pyx_k23p;
static PyObject *__pyx_k38p;
static PyObject *__pyx_k52p;
static PyObject *__pyx_k60p;
static PyObject *__pyx_k79p;
static PyObject *__pyx_k86p;
static PyObject *__pyx_k89p;
static PyObject *__pyx_k91p;
static PyObject *__pyx_k93p;
static PyObject *__pyx_k99p;
static PyObject *__pyx_k103p;
static PyObject *__pyx_k106p;
static PyObject *__pyx_k111p;
static PyObject *__pyx_k112p;
static PyObject *__pyx_k113p;
static PyObject *__pyx_k114p;
static PyObject *__pyx_k115p;
static PyObject *__pyx_k117p;
static PyObject *__pyx_k118p;
static PyObject *__pyx_k119p;
static PyObject *__pyx_k122p;
static PyObject *__pyx_k128p;
static PyObject *__pyx_k130p;
static PyObject *__pyx_k133p;
static PyObject *__pyx_k135p;
static PyObject *__pyx_k141p;
static PyObject *__pyx_k142p;
static PyObject *__pyx_k144p;
static PyObject *__pyx_k145p;
static PyObject *__pyx_k149p;
static PyObject *__pyx_k151p;
static PyObject *__pyx_k183p;

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_n_BSD, 1, __pyx_k147, sizeof(__pyx_k147)},
  {&__pyx_n_DNS_ERR_FORMAT, 1, __pyx_k170, sizeof(__pyx_k170)},
  {&__pyx_n_DNS_ERR_NONE, 1, __pyx_k169, sizeof(__pyx_k169)},
  {&__pyx_n_DNS_ERR_NOTEXIST, 1, __pyx_k172, sizeof(__pyx_k172)},
  {&__pyx_n_DNS_ERR_NOTIMPL, 1, __pyx_k173, sizeof(__pyx_k173)},
  {&__pyx_n_DNS_ERR_REFUSED, 1, __pyx_k174, sizeof(__pyx_k174)},
  {&__pyx_n_DNS_ERR_SERVERFAILED, 1, __pyx_k171, sizeof(__pyx_k171)},
  {&__pyx_n_DNS_ERR_SHUTDOWN, 1, __pyx_k178, sizeof(__pyx_k178)},
  {&__pyx_n_DNS_ERR_TIMEOUT, 1, __pyx_k177, sizeof(__pyx_k177)},
  {&__pyx_n_DNS_ERR_TRUNCATED, 1, __pyx_k175, sizeof(__pyx_k175)},
  {&__pyx_n_DNS_ERR_UNKNOWN, 1, __pyx_k176, sizeof(__pyx_k176)},
  {&__pyx_n_DNS_IPv4_A, 1, __pyx_k179, sizeof(__pyx_k179)},
  {&__pyx_n_DNS_IPv6_AAAA, 1, __pyx_k181, sizeof(__pyx_k181)},
  {&__pyx_n_DNS_PTR, 1, __pyx_k180, sizeof(__pyx_k180)},
  {&__pyx_n_DNS_QUERY_NO_SEARCH, 1, __pyx_k182, sizeof(__pyx_k182)},
  {&__pyx_n_DnsLookupError, 1, __pyx_k101, sizeof(__pyx_k101)},
  {&__pyx_n_DnsResultParseError, 1, __pyx_k105, sizeof(__pyx_k105)},
  {&__pyx_n_EAI_ADDRFAMILY, 1, __pyx_k134, sizeof(__pyx_k134)},
  {&__pyx_n_EAI_NODATA, 1, __pyx_k129, sizeof(__pyx_k129)},
  {&__pyx_n_EAI_NONAME, 1, __pyx_k127, sizeof(__pyx_k127)},
  {&__pyx_n_EV_PERSIST, 1, __pyx_k157, sizeof(__pyx_k157)},
  {&__pyx_n_EV_READ, 1, __pyx_k154, sizeof(__pyx_k154)},
  {&__pyx_n_EV_SIGNAL, 1, __pyx_k156, sizeof(__pyx_k156)},
  {&__pyx_n_EV_TIMEOUT, 1, __pyx_k153, sizeof(__pyx_k153)},
  {&__pyx_n_EV_WRITE, 1, __pyx_k155, sizeof(__pyx_k155)},
  {&__pyx_n_HERROR_HOST_NOT_FOUND, 1, __pyx_k132, sizeof(__pyx_k132)},
  {&__pyx_n_HERROR_NO_ADDRESS, 1, __pyx_k168, sizeof(__pyx_k168)},
  {&__pyx_n_HERROR_NO_DATA, 1, __pyx_k167, sizeof(__pyx_k167)},
  {&__pyx_n_HERROR_NO_RECOVERY, 1, __pyx_k166, sizeof(__pyx_k166)},
  {&__pyx_n_HERROR_TRY_AGAIN, 1, __pyx_k165, sizeof(__pyx_k165)},
  {&__pyx_n_LinkHelper, 1, __pyx_k189, sizeof(__pyx_k189)},
  {&__pyx_n_MainLoop, 1, __pyx_k191, sizeof(__pyx_k191)},
  {&__pyx_n_SSLError, 1, __pyx_k76, sizeof(__pyx_k76)},
  {&__pyx_n_SSLSocket, 1, __pyx_k161, sizeof(__pyx_k161)},
  {&__pyx_n_SSL_ERROR_EOF, 1, __pyx_k162, sizeof(__pyx_k162)},
  {&__pyx_n_SSL_ERROR_WANT_READ, 1, __pyx_k163, sizeof(__pyx_k163)},
  {&__pyx_n_SSL_ERROR_WANT_WRITE, 1, __pyx_k164, sizeof(__pyx_k164)},
  {&__pyx_n_SendExceptionAndRun, 1, __pyx_k19, sizeof(__pyx_k19)},
  {&__pyx_n_SigIntHandler, 1, __pyx_k184, sizeof(__pyx_k184)},
  {&__pyx_n___author__, 1, __pyx_k143, sizeof(__pyx_k143)},
  {&__pyx_n___callback, 1, __pyx_k4, sizeof(__pyx_k4)},
  {&__pyx_n___class__, 1, __pyx_k90, sizeof(__pyx_k90)},
  {&__pyx_n___copyright__, 1, __pyx_k146, sizeof(__pyx_k146)},
  {&__pyx_n___event_exc, 1, __pyx_k3, sizeof(__pyx_k3)},
  {&__pyx_n___license__, 1, __pyx_k148, sizeof(__pyx_k148)},
  {&__pyx_n___simple_callback, 1, __pyx_k5, sizeof(__pyx_k5)},
  {&__pyx_n___url__, 1, __pyx_k150, sizeof(__pyx_k150)},
  {&__pyx_n___version__, 1, __pyx_k152, sizeof(__pyx_k152)},
  {&__pyx_n__channel, 1, __pyx_k11, sizeof(__pyx_k11)},
  {&__pyx_n__closedsocket, 1, __pyx_k42, sizeof(__pyx_k42)},
  {&__pyx_n__fileobject, 1, __pyx_k94, sizeof(__pyx_k94)},
  {&__pyx_n__makefile_refs, 1, __pyx_k74, sizeof(__pyx_k74)},
  {&__pyx_n__realsocket, 1, __pyx_k159, sizeof(__pyx_k159)},
  {&__pyx_n__sock, 1, __pyx_k64, sizeof(__pyx_k64)},
  {&__pyx_n__ssl, 1, __pyx_k81, sizeof(__pyx_k81)},
  {&__pyx_n__sslobj, 1, __pyx_k65, sizeof(__pyx_k65)},
  {&__pyx_n__suppress_ragged_eofs, 1, __pyx_k73, sizeof(__pyx_k73)},
  {&__pyx_n_accept, 1, __pyx_k25, sizeof(__pyx_k25)},
  {&__pyx_n_add, 1, __pyx_k187, sizeof(__pyx_k187)},
  {&__pyx_n_args, 1, __pyx_k92, sizeof(__pyx_k92)},
  {&__pyx_n_balance, 1, __pyx_k13, sizeof(__pyx_k13)},
  {&__pyx_n_bind, 1, __pyx_k50, sizeof(__pyx_k50)},
  {&__pyx_n_blocked, 1, __pyx_k10, sizeof(__pyx_k10)},
  {&__pyx_n_ca_certs, 1, __pyx_k71, sizeof(__pyx_k71)},
  {&__pyx_n_cerfile, 1, __pyx_k68, sizeof(__pyx_k68)},
  {&__pyx_n_cert_reqs, 1, __pyx_k69, sizeof(__pyx_k69)},
  {&__pyx_n_certfile, 1, __pyx_k83, sizeof(__pyx_k83)},
  {&__pyx_n_cipher, 1, __pyx_k88, sizeof(__pyx_k88)},
  {&__pyx_n_close, 1, __pyx_k32, sizeof(__pyx_k32)},
  {&__pyx_n_close_ref, 1, __pyx_k62, sizeof(__pyx_k62)},
  {&__pyx_n_connect, 1, __pyx_k85, sizeof(__pyx_k85)},
  {&__pyx_n_connect_ex, 1, __pyx_k53, sizeof(__pyx_k53)},
  {&__pyx_n_delete, 1, __pyx_k8, sizeof(__pyx_k8)},
  {&__pyx_n_discard, 1, __pyx_k35, sizeof(__pyx_k35)},
  {&__pyx_n_dns_resolve_ipv4, 1, __pyx_k136, sizeof(__pyx_k136)},
  {&__pyx_n_dns_resolve_ipv6, 1, __pyx_k138, sizeof(__pyx_k138)},
  {&__pyx_n_dns_resolve_reverse, 1, __pyx_k139, sizeof(__pyx_k139)},
  {&__pyx_n_do_close, 1, __pyx_k61, sizeof(__pyx_k61)},
  {&__pyx_n_do_handshake, 1, __pyx_k84, sizeof(__pyx_k84)},
  {&__pyx_n_do_handshake_on_connect, 1, __pyx_k72, sizeof(__pyx_k72)},
  {&__pyx_n_dup, 1, __pyx_k41, sizeof(__pyx_k41)},
  {&__pyx_n_e, 1, __pyx_k37, sizeof(__pyx_k37)},
  {&__pyx_n_err, 1, __pyx_k107, sizeof(__pyx_k107)},
  {&__pyx_n_errno, 1, __pyx_k28, sizeof(__pyx_k28)},
  {&__pyx_n_error, 1, __pyx_k27, sizeof(__pyx_k27)},
  {&__pyx_n_evtype, 1, __pyx_k186, sizeof(__pyx_k186)},
  {&__pyx_n_exc_info, 1, __pyx_k2, sizeof(__pyx_k2)},
  {&__pyx_n_family, 1, __pyx_k44, sizeof(__pyx_k44)},
  {&__pyx_n_fd, 1, __pyx_k34, sizeof(__pyx_k34)},
  {&__pyx_n_fileno, 1, __pyx_k6, sizeof(__pyx_k6)},
  {&__pyx_n_flush, 1, __pyx_k31, sizeof(__pyx_k31)},
  {&__pyx_n_fromfd, 1, __pyx_k160, sizeof(__pyx_k160)},
  {&__pyx_n_gaierror, 1, __pyx_k126, sizeof(__pyx_k126)},
  {&__pyx_n_gethostname, 1, __pyx_k140, sizeof(__pyx_k140)},
  {&__pyx_n_getpeername, 1, __pyx_k49, sizeof(__pyx_k49)},
  {&__pyx_n_getsockname, 1, __pyx_k48, sizeof(__pyx_k48)},
  {&__pyx_n_getsockopt, 1, __pyx_k47, sizeof(__pyx_k47)},
  {&__pyx_n_handle, 1, __pyx_k185, sizeof(__pyx_k185)},
  {&__pyx_n_herror, 1, __pyx_k131, sizeof(__pyx_k131)},
  {&__pyx_n_insert, 1, __pyx_k15, sizeof(__pyx_k15)},
  {&__pyx_n_join, 1, __pyx_k104, sizeof(__pyx_k104)},
  {&__pyx_n_keyfile, 1, __pyx_k67, sizeof(__pyx_k67)},
  {&__pyx_n_listen, 1, __pyx_k51, sizeof(__pyx_k51)},
  {&__pyx_n_loop, 1, __pyx_k18, sizeof(__pyx_k18)},
  {&__pyx_n_main, 1, __pyx_k21, sizeof(__pyx_k21)},
  {&__pyx_n_mode, 1, __pyx_k98, sizeof(__pyx_k98)},
  {&__pyx_n_names_by_ip, 1, __pyx_k123, sizeof(__pyx_k123)},
  {&__pyx_n_names_by_nameip, 1, __pyx_k125, sizeof(__pyx_k125)},
  {&__pyx_n_peer_certificate, 1, __pyx_k87, sizeof(__pyx_k87)},
  {&__pyx_n_pending, 1, __pyx_k7, sizeof(__pyx_k7)},
  {&__pyx_n_pop, 1, __pyx_k40, sizeof(__pyx_k40)},
  {&__pyx_n_preference, 1, __pyx_k12, sizeof(__pyx_k12)},
  {&__pyx_n_proto, 1, __pyx_k45, sizeof(__pyx_k45)},
  {&__pyx_n_r, 1, __pyx_k30, sizeof(__pyx_k30)},
  {&__pyx_n_read, 1, __pyx_k75, sizeof(__pyx_k75)},
  {&__pyx_n_read_etc_hosts, 1, __pyx_k192, sizeof(__pyx_k192)},
  {&__pyx_n_readline, 1, __pyx_k36, sizeof(__pyx_k36)},
  {&__pyx_n_recv, 1, __pyx_k55, sizeof(__pyx_k55)},
  {&__pyx_n_recv_into, 1, __pyx_k57, sizeof(__pyx_k57)},
  {&__pyx_n_recvfrom, 1, __pyx_k56, sizeof(__pyx_k56)},
  {&__pyx_n_recvfrom_into, 1, __pyx_k58, sizeof(__pyx_k58)},
  {&__pyx_n_remove, 1, __pyx_k190, sizeof(__pyx_k190)},
  {&__pyx_n_run, 1, __pyx_k16, sizeof(__pyx_k16)},
  {&__pyx_n_send, 1, __pyx_k14, sizeof(__pyx_k14)},
  {&__pyx_n_sendto, 1, __pyx_k59, sizeof(__pyx_k59)},
  {&__pyx_n_setblocking, 1, __pyx_k66, sizeof(__pyx_k66)},
  {&__pyx_n_setdefault, 1, __pyx_k124, sizeof(__pyx_k124)},
  {&__pyx_n_setdoclose, 1, __pyx_k95, sizeof(__pyx_k95)},
  {&__pyx_n_setsockopt, 1, __pyx_k46, sizeof(__pyx_k46)},
  {&__pyx_n_shutdown, 1, __pyx_k54, sizeof(__pyx_k54)},
  {&__pyx_n_sleep, 1, __pyx_k97, sizeof(__pyx_k97)},
  {&__pyx_n_socket, 1, __pyx_k26, sizeof(__pyx_k26)},
  {&__pyx_n_socket_fromfd, 1, __pyx_k96, sizeof(__pyx_k96)},
  {&__pyx_n_socket_impl, 1, __pyx_k39, sizeof(__pyx_k39)},
  {&__pyx_n_split, 1, __pyx_k116, sizeof(__pyx_k116)},
  {&__pyx_n_ssl, 1, __pyx_k80, sizeof(__pyx_k80)},
  {&__pyx_n_ssl_version, 1, __pyx_k70, sizeof(__pyx_k70)},
  {&__pyx_n_sslsocket_impl, 1, __pyx_k63, sizeof(__pyx_k63)},
  {&__pyx_n_sslwrap, 1, __pyx_k82, sizeof(__pyx_k82)},
  {&__pyx_n_stackless, 1, __pyx_k20, sizeof(__pyx_k20)},
  {&__pyx_n_startswith, 1, __pyx_k121, sizeof(__pyx_k121)},
  {&__pyx_n_strip, 1, __pyx_k120, sizeof(__pyx_k120)},
  {&__pyx_n_suppress_ragged_eofs, 1, __pyx_k77, sizeof(__pyx_k77)},
  {&__pyx_n_sys, 1, __pyx_k1, sizeof(__pyx_k1)},
  {&__pyx_n_t, 1, __pyx_k110, sizeof(__pyx_k110)},
  {&__pyx_n_tasklet, 1, __pyx_k188, sizeof(__pyx_k188)},
  {&__pyx_n_traceback, 1, __pyx_k109, sizeof(__pyx_k109)},
  {&__pyx_n_type, 1, __pyx_k43, sizeof(__pyx_k43)},
  {&__pyx_n_types, 1, __pyx_k158, sizeof(__pyx_k158)},
  {&__pyx_n_value, 1, __pyx_k108, sizeof(__pyx_k108)},
  {&__pyx_n_values, 1, __pyx_k137, sizeof(__pyx_k137)},
  {&__pyx_n_w, 1, __pyx_k29, sizeof(__pyx_k29)},
  {&__pyx_n_write, 1, __pyx_k78, sizeof(__pyx_k78)},
  {&__pyx_n_write_buffer_limit, 1, __pyx_k33, sizeof(__pyx_k33)},
  {&__pyx_k9p, 0, __pyx_k9, sizeof(__pyx_k9)},
  {&__pyx_k17p, 0, __pyx_k17, sizeof(__pyx_k17)},
  {&__pyx_k22p, 0, __pyx_k22, sizeof(__pyx_k22)},
  {&__pyx_k23p, 0, __pyx_k23, sizeof(__pyx_k23)},
  {&__pyx_k38p, 0, __pyx_k38, sizeof(__pyx_k38)},
  {&__pyx_k52p, 0, __pyx_k52, sizeof(__pyx_k52)},
  {&__pyx_k60p, 0, __pyx_k60, sizeof(__pyx_k60)},
  {&__pyx_k79p, 0, __pyx_k79, sizeof(__pyx_k79)},
  {&__pyx_k86p, 0, __pyx_k86, sizeof(__pyx_k86)},
  {&__pyx_k89p, 0, __pyx_k89, sizeof(__pyx_k89)},
  {&__pyx_k91p, 0, __pyx_k91, sizeof(__pyx_k91)},
  {&__pyx_k93p, 0, __pyx_k93, sizeof(__pyx_k93)},
  {&__pyx_k99p, 0, __pyx_k99, sizeof(__pyx_k99)},
  {&__pyx_k103p, 0, __pyx_k103, sizeof(__pyx_k103)},
  {&__pyx_k106p, 0, __pyx_k106, sizeof(__pyx_k106)},
  {&__pyx_k111p, 0, __pyx_k111, sizeof(__pyx_k111)},
  {&__pyx_k112p, 0, __pyx_k112, sizeof(__pyx_k112)},
  {&__pyx_k113p, 0, __pyx_k113, sizeof(__pyx_k113)},
  {&__pyx_k114p, 0, __pyx_k114, sizeof(__pyx_k114)},
  {&__pyx_k115p, 0, __pyx_k115, sizeof(__pyx_k115)},
  {&__pyx_k117p, 0, __pyx_k117, sizeof(__pyx_k117)},
  {&__pyx_k118p, 0, __pyx_k118, sizeof(__pyx_k118)},
  {&__pyx_k119p, 0, __pyx_k119, sizeof(__pyx_k119)},
  {&__pyx_k122p, 0, __pyx_k122, sizeof(__pyx_k122)},
  {&__pyx_k128p, 0, __pyx_k128, sizeof(__pyx_k128)},
  {&__pyx_k130p, 0, __pyx_k130, sizeof(__pyx_k130)},
  {&__pyx_k133p, 0, __pyx_k133, sizeof(__pyx_k133)},
  {&__pyx_k135p, 0, __pyx_k135, sizeof(__pyx_k135)},
  {&__pyx_k141p, 0, __pyx_k141, sizeof(__pyx_k141)},
  {&__pyx_k142p, 0, __pyx_k142, sizeof(__pyx_k142)},
  {&__pyx_k144p, 0, __pyx_k144, sizeof(__pyx_k144)},
  {&__pyx_k145p, 0, __pyx_k145, sizeof(__pyx_k145)},
  {&__pyx_k149p, 0, __pyx_k149, sizeof(__pyx_k149)},
  {&__pyx_k151p, 0, __pyx_k151, sizeof(__pyx_k151)},
  {&__pyx_k183p, 0, __pyx_k183, sizeof(__pyx_k183)},
  {0, 0, 0, 0}
};

static PyObject *__pyx_d1;
static short __pyx_d2;
static PyObject *__pyx_d3;
static PyObject *__pyx_d4;
static float __pyx_d5;
static PyObject *__pyx_d6;
static int __pyx_d7;
static int __pyx_d8;
static int __pyx_d9;
static int __pyx_d10;
static int __pyx_d11;
static char __pyx_d12;
static PyObject *__pyx_d13;
static PyObject *__pyx_d14;
static PyObject *__pyx_d15;
static int __pyx_d16;
static PyObject *__pyx_d17;
static int __pyx_d18;
static PyObject *__pyx_d19;
static int __pyx_d20;
static PyObject *__pyx_d21;
static PyObject *__pyx_d22;
static int __pyx_d23;
static int __pyx_d24;
static int __pyx_d25;
static int __pyx_d26;
static PyObject *__pyx_d27;
static int __pyx_d28;
static PyObject *__pyx_d29;
static int __pyx_d30;
static char __pyx_d31;
static PyObject *__pyx_d32;
static int __pyx_d33;
static int __pyx_d34;
static int __pyx_d35;
static int __pyx_d36;
static PyObject *__pyx_d37;
static PyObject *__pyx_d38;
static PyObject *__pyx_d39;


/* Implementation of coio */

static void __pyx_f_4coio___event_abort(void) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":80 */
  event_loopbreak();

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":81 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_exc_info); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n___event_exc, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":82 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n___event_exc); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; goto __pyx_L1;}
  __pyx_1 = __Pyx_GetItemInt(__pyx_2, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = __pyx_1 == Py_None;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_3) {
    if (PyObject_SetAttr(__pyx_m, __pyx_n___event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_WriteUnraisable("coio.__event_abort");
  __pyx_L0:;
}

static void __pyx_f_4coio___event_handler(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_arg), __pyx_n___callback); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_WriteUnraisable("coio.__event_handler");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static void __pyx_f_4coio___simple_event_handler(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_arg), __pyx_n___simple_callback); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_WriteUnraisable("coio.__simple_event_handler");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static int __pyx_f_4coio_5event___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_5event___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_callback = 0;
  PyObject *__pyx_v_arg = 0;
  short __pyx_v_evtype;
  PyObject *__pyx_v_handle = 0;
  PyObject *__pyx_v_simple = 0;
  __pyx_t_4coio_event_handler __pyx_v_handler;
  int __pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"callback","arg","evtype","handle","simple",0};
  __pyx_v_arg = __pyx_d1;
  __pyx_v_evtype = __pyx_d2;
  __pyx_v_handle = __pyx_d3;
  __pyx_v_simple = __pyx_d4;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|OhOO", __pyx_argnames, &__pyx_v_callback, &__pyx_v_arg, &__pyx_v_evtype, &__pyx_v_handle, &__pyx_v_simple)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_callback);
  Py_INCREF(__pyx_v_arg);
  Py_INCREF(__pyx_v_handle);
  Py_INCREF(__pyx_v_simple);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":113 */
  Py_INCREF(__pyx_v_callback);
  Py_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback = __pyx_v_callback;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":114 */
  Py_INCREF(__pyx_v_arg);
  Py_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->args = __pyx_v_arg;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":115 */
  __pyx_1 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->evtype);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->evtype = __pyx_1;
  __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":116 */
  Py_INCREF(__pyx_v_handle);
  Py_DECREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle = __pyx_v_handle;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":117 */
  __pyx_2 = PyObject_IsTrue(__pyx_v_simple); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; goto __pyx_L1;}
  if (__pyx_2) {
    __pyx_v_handler = __pyx_f_4coio___simple_event_handler;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_v_handler = __pyx_f_4coio___event_handler;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":121 */
  __pyx_2 = (__pyx_v_evtype == 0);
  if (__pyx_2) {
    __pyx_3 = PyObject_IsTrue(__pyx_v_handle); if (__pyx_3 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; goto __pyx_L1;}
    __pyx_2 = (!__pyx_3);
  }
  if (__pyx_2) {
    evtimer_set((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),__pyx_v_handler,((void *)__pyx_v_self));
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":124 */
    __pyx_3 = PyObject_IsInstance(__pyx_v_handle,((PyObject *)(&PyInt_Type))); if (__pyx_3 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; goto __pyx_L1;}
    __pyx_2 = (!__pyx_3);
    if (__pyx_2) {
      __pyx_1 = PyObject_GetAttr(__pyx_v_handle, __pyx_n_fileno); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; goto __pyx_L1;}
      __pyx_4 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_v_handle);
      __pyx_v_handle = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":126 */
    __pyx_3 = PyInt_AsLong(__pyx_v_handle); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; goto __pyx_L1;}
    event_set((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),__pyx_3,__pyx_v_evtype,__pyx_v_handler,((void *)__pyx_v_self));
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.event.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_callback);
  Py_DECREF(__pyx_v_arg);
  Py_DECREF(__pyx_v_handle);
  Py_DECREF(__pyx_v_simple);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_5event___simple_callback(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_5event___simple_callback(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  short __pyx_v_evtype;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"evtype",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "h", __pyx_argnames, &__pyx_v_evtype)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":129 */
  /*try:*/ {
    __pyx_1 = PySequence_Tuple(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; goto __pyx_L2;}
    __pyx_2 = PyObject_CallObject(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; goto __pyx_L2;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    if (PyObject_Cmp(__pyx_2, Py_None, &__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; goto __pyx_L2;}
    __pyx_3 = __pyx_3 != 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_3) {
      __pyx_3 = ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec;
      if (!__pyx_3) {
        __pyx_3 = ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_usec;
      }
      if (__pyx_3) {
        event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),(&((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv));
        goto __pyx_L5;
      }
      /*else*/ {
        event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),NULL);
      }
      __pyx_L5:;
      goto __pyx_L4;
    }
    __pyx_L4:;
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_1); __pyx_1 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":135 */
  /*except:*/ {
    __Pyx_AddTraceback("coio.__simple_callback");
    if (__Pyx_GetException(&__pyx_1, &__pyx_2, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; goto __pyx_L1;}
    __pyx_f_4coio___event_abort();
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":138 */
  __pyx_3 = (!(__pyx_v_evtype & EV_SIGNAL));
  if (__pyx_3) {
    __pyx_3 = (!event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),(((EV_READ | EV_WRITE) | EV_SIGNAL) | EV_TIMEOUT),NULL));
  }
  if (__pyx_3) {
    Py_DECREF(__pyx_v_self);
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.event.__simple_callback");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_5event___callback(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_5event___callback(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  short __pyx_v_evtype;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  static char *__pyx_argnames[] = {"evtype",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "h", __pyx_argnames, &__pyx_v_evtype)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":143 */
  /*try:*/ {
    __pyx_1 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; goto __pyx_L2;}
    __pyx_2 = PyTuple_New(4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; goto __pyx_L2;}
    Py_INCREF(__pyx_v_self);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_self);
    Py_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
    PyTuple_SET_ITEM(__pyx_2, 1, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
    PyTuple_SET_ITEM(__pyx_2, 2, __pyx_1);
    Py_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
    PyTuple_SET_ITEM(__pyx_2, 3, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
    __pyx_1 = 0;
    __pyx_1 = PyObject_CallObject(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; goto __pyx_L2;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":145 */
  /*except:*/ {
    __Pyx_AddTraceback("coio.__callback");
    if (__Pyx_GetException(&__pyx_2, &__pyx_1, &__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; goto __pyx_L1;}
    __pyx_f_4coio___event_abort();
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":147 */
  __pyx_4 = (!event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),(((EV_READ | EV_WRITE) | EV_SIGNAL) | EV_TIMEOUT),NULL));
  if (__pyx_4) {
    Py_DECREF(__pyx_v_self);
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.event.__callback");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_5event_add(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_5event_add[] = "Add event to be executed after an optional timeout.\n\n        Arguments:\n        \n        timeout -- seconds after which the event will be executed\n        ";
static PyObject *__pyx_f_4coio_5event_add(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  float __pyx_v_timeout;
  PyObject *__pyx_r;
  int __pyx_1;
  static char *__pyx_argnames[] = {"timeout",0};
  __pyx_v_timeout = __pyx_d5;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|f", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":157 */
  __pyx_1 = (!event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),(((EV_READ | EV_WRITE) | EV_SIGNAL) | EV_TIMEOUT),NULL));
  if (__pyx_1) {
    Py_INCREF(__pyx_v_self);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":160 */
  ((struct __pyx_obj_4coio_event *)__pyx_v_self)->timeout = __pyx_v_timeout;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":161 */
  __pyx_1 = (__pyx_v_timeout >= 0.0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":162 */
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec = ((unsigned int)__pyx_v_timeout);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":163 */
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_usec = ((unsigned int)((__pyx_v_timeout - ((float)((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec)) * 1000000.0));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":164 */
    event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),(&((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv));
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":166 */
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_sec = 0;
    ((struct __pyx_obj_4coio_event *)__pyx_v_self)->tv.tv_usec = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":167 */
    event_add((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),NULL);
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_5event_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_5event_pending[] = "Return 1 if the event is scheduled to run, or else 0.";
static PyObject *__pyx_f_4coio_5event_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(event_pending((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev),(((EV_TIMEOUT | EV_SIGNAL) | EV_READ) | EV_WRITE),NULL)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.event.pending");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_5event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_5event_delete[] = "Remove event from the event queue.";
static PyObject *__pyx_f_4coio_5event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_pending); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_IsTrue(__pyx_2); if (__pyx_3 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_3) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":176 */
    event_del((&((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":177 */
    Py_DECREF(__pyx_v_self);
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.event.delete");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static void __pyx_f_4coio_5event___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_f_4coio_5event___dealloc__(PyObject *__pyx_v_self) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_delete); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.event.__dealloc__");
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
}

static PyObject *__pyx_f_4coio_5event___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_5event___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_event *)__pyx_v_self)->ev.ev_flags); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
  Py_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  PyTuple_SET_ITEM(__pyx_2, 1, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->handle);
  Py_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  PyTuple_SET_ITEM(__pyx_2, 2, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->callback);
  Py_INCREF(((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  PyTuple_SET_ITEM(__pyx_2, 3, ((struct __pyx_obj_4coio_event *)__pyx_v_self)->args);
  __pyx_1 = 0;
  __pyx_1 = PyNumber_Remainder(__pyx_k9p, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.event.__repr__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dispatch(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dispatch[] = "Dispatch all events on the event queue.\n    Returns -1 on error, 0 on success, and 1 if no events are registered.\n    ";
static PyObject *__pyx_f_4coio_dispatch(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_ret;
  PyObject *__pyx_v_t;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_v_t = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":192 */
  /*with nogil:*/ {
    PyThreadState *_save;
    Py_UNBLOCK_THREADS
    /*try:*/ {
      __pyx_v_ret = event_dispatch();
    }
    /*finally:*/ {
      Py_BLOCK_THREADS
    }
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":194 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n___event_exc); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; goto __pyx_L1;}
  __pyx_2 = PyObject_IsTrue(__pyx_1); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":195 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n___event_exc); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; goto __pyx_L1;}
    Py_DECREF(__pyx_v_t);
    __pyx_v_t = __pyx_1;
    __pyx_1 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":196 */
    if (PyObject_SetAttr(__pyx_m, __pyx_n___event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; goto __pyx_L1;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":197 */
    __pyx_1 = __Pyx_GetItemInt(__pyx_v_t, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; goto __pyx_L1;}
    __pyx_3 = __Pyx_GetItemInt(__pyx_v_t, 1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; goto __pyx_L1;}
    __pyx_4 = __Pyx_GetItemInt(__pyx_v_t, 2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; goto __pyx_L1;}
    __Pyx_Raise(__pyx_1, __pyx_3, __pyx_4);
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; goto __pyx_L1;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":198 */
  __pyx_1 = PyInt_FromLong(__pyx_v_ret); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.dispatch");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_t);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_loop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_loop[] = "Dispatch all pending events on queue in a single pass.\n    Returns -1 on error, 0 on success, and 1 if no events are registered.";
static PyObject *__pyx_f_4coio_loop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_nonblock = 0;
  int __pyx_v_flags;
  int __pyx_v_ret;
  PyObject *__pyx_v_t;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"nonblock",0};
  __pyx_v_nonblock = __pyx_d6;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_nonblock)) return 0;
  Py_INCREF(__pyx_v_nonblock);
  __pyx_v_t = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":205 */
  __pyx_v_flags = EVLOOP_ONCE;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":206 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_nonblock); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_v_flags = (EVLOOP_ONCE | EVLOOP_NONBLOCK);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":208 */
  /*with nogil:*/ {
    PyThreadState *_save;
    Py_UNBLOCK_THREADS
    /*try:*/ {
      __pyx_v_ret = event_loop(__pyx_v_flags);
    }
    /*finally:*/ {
      Py_BLOCK_THREADS
    }
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":210 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n___event_exc); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 210; goto __pyx_L1;}
  __pyx_1 = PyObject_IsTrue(__pyx_2); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 210; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":211 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n___event_exc); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; goto __pyx_L1;}
    Py_DECREF(__pyx_v_t);
    __pyx_v_t = __pyx_2;
    __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":212 */
    if (PyObject_SetAttr(__pyx_m, __pyx_n___event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; goto __pyx_L1;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":213 */
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_t, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; goto __pyx_L1;}
    __pyx_3 = __Pyx_GetItemInt(__pyx_v_t, 1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; goto __pyx_L1;}
    __pyx_4 = __Pyx_GetItemInt(__pyx_v_t, 2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; goto __pyx_L1;}
    __Pyx_Raise(__pyx_2, __pyx_3, __pyx_4);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; goto __pyx_L1;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":214 */
  __pyx_2 = PyInt_FromLong(__pyx_v_ret); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.loop");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_t);
  Py_DECREF(__pyx_v_nonblock);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_abort(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_abort[] = "Abort event dispatch loop.";
static PyObject *__pyx_f_4coio_abort(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_f_4coio___event_abort();

  __pyx_r = Py_None; Py_INCREF(Py_None);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_SendExceptionAndRun(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_SendExceptionAndRun[] = "Send exception to tasklet, even if it\'s blocked on a channel.\n\n    To get the tasklet is activated (to handle the exception) after\n    SendException, call tasklet.run() after calling SendException.\n\n    tasklet.insert() is called automatically to ensure that it eventually gets\n    scheduled.\n    ";
static PyObject *__pyx_f_4coio_SendExceptionAndRun(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyTaskletObject *__pyx_v_tasklet_obj = 0;
  PyObject *__pyx_v_exc_info = 0;
  PyObject *__pyx_v_bomb_obj;
  PyObject *__pyx_v_c;
  PyObject *__pyx_v_old_preference;
  PyObject *__pyx_v_i;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  Py_ssize_t __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"tasklet_obj","exc_info",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OO", __pyx_argnames, &__pyx_v_tasklet_obj, &__pyx_v_exc_info)) return 0;
  Py_INCREF(__pyx_v_tasklet_obj);
  Py_INCREF(__pyx_v_exc_info);
  __pyx_v_bomb_obj = Py_None; Py_INCREF(Py_None);
  __pyx_v_c = Py_None; Py_INCREF(Py_None);
  __pyx_v_old_preference = Py_None; Py_INCREF(Py_None);
  __pyx_v_i = Py_None; Py_INCREF(Py_None);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tasklet_obj), __pyx_ptype_4coio_tasklet, 1, "tasklet_obj")) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 154; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":163 */
  __pyx_2 = PyObject_IsInstance(__pyx_v_exc_info,((PyObject *)(&PyList_Type))); if (__pyx_2 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 163; goto __pyx_L1;}
  __pyx_1 = (!__pyx_2);
  if (__pyx_1) {
    __pyx_2 = PyObject_IsInstance(__pyx_v_exc_info,((PyObject *)(&PyTuple_Type))); if (__pyx_2 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 163; goto __pyx_L1;}
    __pyx_1 = (!__pyx_2);
  }
  if (__pyx_1) {
    __Pyx_Raise(PyExc_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 164; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":165 */
  __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 165; goto __pyx_L1;}
  __pyx_2 = ((PyObject *)__pyx_v_tasklet_obj) == __pyx_3;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":166 */
    __pyx_4 = PyObject_Length(__pyx_v_exc_info); if (__pyx_4 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 166; goto __pyx_L1;}
    __pyx_1 = (__pyx_4 < 3);
    if (__pyx_1) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
      Py_INCREF(__pyx_v_exc_info);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_exc_info);
      __pyx_5 = PyObject_CallObject(((PyObject *)(&PyList_Type)), __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyList_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
      Py_INCREF(Py_None);
      PyList_SET_ITEM(__pyx_3, 0, Py_None);
      Py_INCREF(Py_None);
      PyList_SET_ITEM(__pyx_3, 1, Py_None);
      __pyx_6 = PyNumber_Add(__pyx_5, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_exc_info);
      __pyx_v_exc_info = __pyx_6;
      __pyx_6 = 0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":168 */
    __pyx_5 = __Pyx_GetItemInt(__pyx_v_exc_info, 0); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 168; goto __pyx_L1;}
    __pyx_3 = __Pyx_GetItemInt(__pyx_v_exc_info, 1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 168; goto __pyx_L1;}
    __pyx_6 = __Pyx_GetItemInt(__pyx_v_exc_info, 2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 168; goto __pyx_L1;}
    __Pyx_Raise(__pyx_5, __pyx_3, __pyx_6);
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 168; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":169 */
  __pyx_5 = PySequence_Tuple(__pyx_v_exc_info); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 169; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_bomb), __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 169; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  Py_DECREF(__pyx_v_bomb_obj);
  __pyx_v_bomb_obj = __pyx_3;
  __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":170 */
  __pyx_6 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_blocked); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 170; goto __pyx_L1;}
  __pyx_2 = PyObject_IsTrue(__pyx_6); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 170; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  if (__pyx_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":171 */
    __pyx_5 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n__channel); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 171; goto __pyx_L1;}
    Py_DECREF(__pyx_v_c);
    __pyx_v_c = __pyx_5;
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":172 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_c, __pyx_n_preference); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 172; goto __pyx_L1;}
    Py_DECREF(__pyx_v_old_preference);
    __pyx_v_old_preference = __pyx_3;
    __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":173 */
    __pyx_6 = PyInt_FromLong(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 173; goto __pyx_L1;}
    if (PyObject_SetAttr(__pyx_v_c, __pyx_n_preference, __pyx_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 173; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":174 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_c, __pyx_n_balance); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 174; goto __pyx_L1;}
    __pyx_3 = PyNumber_Negative(__pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 174; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 174; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_5 = PyObject_CallObject(((PyObject *)(&PyRange_Type)), __pyx_6); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 174; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_3 = PyObject_GetIter(__pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 174; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    for (;;) {
      __pyx_6 = PyIter_Next(__pyx_3);
      if (!__pyx_6) {
        if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 174; goto __pyx_L1;}
        break;
      }
      Py_DECREF(__pyx_v_i);
      __pyx_v_i = __pyx_6;
      __pyx_6 = 0;
      __pyx_5 = PyObject_GetAttr(__pyx_v_c, __pyx_n_send); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 175; goto __pyx_L1;}
      __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 175; goto __pyx_L1;}
      Py_INCREF(__pyx_v_bomb_obj);
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_bomb_obj);
      __pyx_7 = PyObject_CallObject(__pyx_5, __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 175; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
    }
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":176 */
    if (PyObject_SetAttr(__pyx_v_c, __pyx_n_preference, __pyx_v_old_preference) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 176; goto __pyx_L1;}
    goto __pyx_L5;
  }
  /*else*/ {
    Py_INCREF(__pyx_v_bomb_obj);
    Py_DECREF(__pyx_v_tasklet_obj->tempval);
    __pyx_v_tasklet_obj->tempval = __pyx_v_bomb_obj;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":179 */
  __pyx_5 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_insert); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 179; goto __pyx_L1;}
  __pyx_6 = PyObject_CallObject(__pyx_5, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 179; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":180 */
  __pyx_7 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_run); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 180; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 180; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.SendExceptionAndRun");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_bomb_obj);
  Py_DECREF(__pyx_v_c);
  Py_DECREF(__pyx_v_old_preference);
  Py_DECREF(__pyx_v_i);
  Py_DECREF(__pyx_v_tasklet_obj);
  Py_DECREF(__pyx_v_exc_info);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_LinkHelper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_LinkHelper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 189; goto __pyx_L1;}
  Py_INCREF(__pyx_k17p);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_k17p);
  __pyx_2 = PyObject_CallObject(PyExc_RuntimeError, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 189; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_Raise(__pyx_2, 0, 0);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 189; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.LinkHelper");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_MainLoop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_MainLoop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyTaskletObject *__pyx_v_link_helper_tasklet = 0;
  PyTaskletObject *__pyx_v_ptemp;
  PyTaskletObject *__pyx_v_p;
  PyTaskletObject *__pyx_v_c;
  PyObject *__pyx_v_o;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  long __pyx_2;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"link_helper_tasklet",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_link_helper_tasklet)) return 0;
  Py_INCREF(__pyx_v_link_helper_tasklet);
  __pyx_v_o = Py_None; Py_INCREF(Py_None);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_link_helper_tasklet), __pyx_ptype_4coio_tasklet, 1, "link_helper_tasklet")) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 192; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":198 */
  __pyx_1 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 198; goto __pyx_L1;}
  Py_DECREF(__pyx_v_o);
  __pyx_v_o = __pyx_1;
  __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":200 */
  __pyx_v_c = ((PyTaskletObject *)__pyx_v_o);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":201 */
  __pyx_v_p = ((PyTaskletObject *)__pyx_v_link_helper_tasklet);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":202 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (!(__pyx_v_c != __pyx_v_p)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 202; goto __pyx_L1;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":204 */
  while (1) {
    __pyx_2 = 1;
    if (!__pyx_2) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":213 */
    __pyx_3 = (__pyx_v_p->next != NULL);
    if (__pyx_3) {
      __pyx_3 = PyTasklet_Remove(__pyx_v_link_helper_tasklet); if (__pyx_3 == (-1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 214; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":215 */
    __pyx_3 = PyTasklet_Insert(__pyx_v_link_helper_tasklet); if (__pyx_3 == (-1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 215; goto __pyx_L1;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":230 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_loop); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 230; goto __pyx_L1;}
    __pyx_4 = PyInt_FromLong((PyStackless_GetRunCount() > 2)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 230; goto __pyx_L1;}
    __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 230; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_4);
    __pyx_4 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_1, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 230; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":239 */
    __pyx_v_ptemp = __pyx_v_p->next;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":240 */
    __pyx_v_p->next = __pyx_v_c->next;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":241 */
    __pyx_v_c->next = __pyx_v_ptemp;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":242 */
    __pyx_v_p->next->prev = __pyx_v_p;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":243 */
    __pyx_v_c->next->prev = __pyx_v_c;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":244 */
    __pyx_v_ptemp = __pyx_v_p->prev;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":245 */
    __pyx_v_p->prev = __pyx_v_c->prev;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":246 */
    __pyx_v_c->prev = __pyx_v_ptemp;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":247 */
    __pyx_v_p->prev->next = __pyx_v_p;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":248 */
    __pyx_v_c->prev->next = __pyx_v_c;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":250 */
    __pyx_3 = PyTasklet_Remove(__pyx_v_link_helper_tasklet); if (__pyx_3 == (-1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 250; goto __pyx_L1;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":252 */
    __pyx_1 = PyStackless_Schedule(Py_None,0); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 252; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.MainLoop");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_o);
  Py_DECREF(__pyx_v_link_helper_tasklet);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_SigIntHandler(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_SigIntHandler(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ev = 0;
  PyObject *__pyx_v_sig = 0;
  PyObject *__pyx_v_evtype = 0;
  PyObject *__pyx_v_arg = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"ev","sig","evtype","arg",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOOO", __pyx_argnames, &__pyx_v_ev, &__pyx_v_sig, &__pyx_v_evtype, &__pyx_v_arg)) return 0;
  Py_INCREF(__pyx_v_ev);
  Py_INCREF(__pyx_v_sig);
  Py_INCREF(__pyx_v_evtype);
  Py_INCREF(__pyx_v_arg);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_SendExceptionAndRun); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 257; goto __pyx_L1;}
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 257; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_main); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 257; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 257; goto __pyx_L1;}
  Py_INCREF(PyExc_KeyboardInterrupt);
  PyTuple_SET_ITEM(__pyx_2, 0, PyExc_KeyboardInterrupt);
  __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 257; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_2);
  __pyx_3 = 0;
  __pyx_2 = 0;
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 257; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.SigIntHandler");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_ev);
  Py_DECREF(__pyx_v_sig);
  Py_DECREF(__pyx_v_evtype);
  Py_DECREF(__pyx_v_arg);
  return __pyx_r;
}

static void __pyx_f_4coio_set_fd_nonblocking(int __pyx_v_fd) {
  int __pyx_v_old;
  int __pyx_1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":264 */
  __pyx_v_old = fcntl(__pyx_v_fd,F_GETFL);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":265 */
  __pyx_1 = (__pyx_v_old >= 0);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_old & (~O_NONBLOCK));
  }
  if (__pyx_1) {
    fcntl(__pyx_v_fd,F_SETFL,(__pyx_v_old | O_NONBLOCK));
    goto __pyx_L2;
  }
  __pyx_L2:;

}

static PyObject *__pyx_f_4coio_set_fd_blocking(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_set_fd_blocking[] = "Set a file descriptor blocking or nonblocking.\n\n    Please note that this may affect more than expected, for example it may\n    affect sys.stderr when called for sys.stdout.\n\n    Returns:\n      The old blocking value (True or False).\n    ";
static PyObject *__pyx_f_4coio_set_fd_blocking(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyObject *__pyx_v_is_blocking = 0;
  int __pyx_v_old;
  int __pyx_v_value;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"fd","is_blocking",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "iO", __pyx_argnames, &__pyx_v_fd, &__pyx_v_is_blocking)) return 0;
  Py_INCREF(__pyx_v_is_blocking);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":280 */
  __pyx_v_old = fcntl(__pyx_v_fd,F_GETFL);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":281 */
  __pyx_1 = (__pyx_v_old < 0);
  if (__pyx_1) {
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":283 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_is_blocking); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 283; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_v_value = (__pyx_v_old & (~O_NONBLOCK));
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_v_value = (__pyx_v_old | O_NONBLOCK);
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":287 */
  __pyx_1 = (__pyx_v_old != __pyx_v_value);
  if (__pyx_1) {
    fcntl(__pyx_v_fd,F_SETFL,__pyx_v_value);
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":289 */
  __pyx_2 = PyInt_FromLong((__pyx_v_old & O_NONBLOCK)); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 289; goto __pyx_L1;}
  __pyx_1 = PyObject_IsTrue(__pyx_2); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 289; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyInt_FromLong(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 289; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.set_fd_blocking");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_is_blocking);
  return __pyx_r;
}

static void __pyx_f_4coio_HandleCTimeoutWakeup(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  int __pyx_1;
  PyGILState_STATE _save = PyGILState_Ensure();

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":295 */
  __pyx_1 = (__pyx_v_evtype == EV_TIMEOUT);
  if (__pyx_1) {
    Py_INCREF(Py_True);
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = Py_True;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(Py_False);
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = Py_False;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":299 */
  __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 299; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_WriteUnraisable("coio.HandleCTimeoutWakeup");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static void __pyx_f_4coio_HandleCWakeup(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  int __pyx_1;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 302; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_WriteUnraisable("coio.HandleCWakeup");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static PyObject *__pyx_f_4coio_8evbuffer___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.misalign); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.totallen); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; goto __pyx_L1;}
  __pyx_4 = PyLong_FromUnsignedLong(((unsigned int)__pyx_v_self)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; goto __pyx_L1;}
  __pyx_5 = PyTuple_New(4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
  PyTuple_SET_ITEM(__pyx_5, 2, __pyx_3);
  PyTuple_SET_ITEM(__pyx_5, 3, __pyx_4);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_1 = PyNumber_Remainder(__pyx_k22p, __pyx_5); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 343; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.evbuffer.__repr__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static Py_ssize_t __pyx_f_4coio_8evbuffer___len__(PyObject *__pyx_v_self); /*proto*/
static Py_ssize_t __pyx_f_4coio_8evbuffer___len__(PyObject *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  Py_INCREF(__pyx_v_self);
  __pyx_r = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_reset(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_reset[] = "Clear the buffer and free associated memory.";
static PyObject *__pyx_f_4coio_8evbuffer_reset(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct evbuffer *__pyx_v_eb;
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":352 */
  __pyx_v_eb = (&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":353 */
  free(__pyx_v_eb->orig_buffer);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":355 */
  __pyx_v_eb->buffer = NULL;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":356 */
  __pyx_v_eb->orig_buffer = NULL;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":357 */
  __pyx_v_eb->off = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":358 */
  __pyx_v_eb->totallen = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":359 */
  __pyx_v_eb->misalign = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_8totallen___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer_8totallen___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.totallen); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 363; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.evbuffer.totallen.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_8misalign___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer_8misalign___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.misalign); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 367; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.evbuffer.misalign.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_expand(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_expand[] = "Expand the available buffer space (self.totallen) to >= n bytes.\n\n        As a side effect, may discard consumed data (self.misalign = 0).\n\n        Please note that 256 bytes will always be reserved. Call self.reset()\n        to get rid of everything.\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_expand(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = evbuffer_expand((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);
  if (__pyx_1) {
    __Pyx_Raise(PyExc_MemoryError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 378; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.evbuffer.expand");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_drain(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer_drain(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_append(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer_append(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_buf = 0;
  char const* __pyx_v_p;
  Py_ssize_t __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"buf",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_buf)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_buf);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":386 */
  __pyx_1 = (PyObject_AsCharBuffer(__pyx_v_buf,(&__pyx_v_p),(&__pyx_v_n)) < 0);
  if (__pyx_1) {
    __Pyx_Raise(PyExc_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 387; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":388 */
  __pyx_2 = PyInt_FromLong(evbuffer_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),((char *)__pyx_v_p),__pyx_v_n)); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 388; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.evbuffer.append");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_buf);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_consume(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_consume[] = "Read, drain and return at most n (or all) from the beginning.\n\n        The corresponding C function is evbuffer_remove().";
static PyObject *__pyx_f_4coio_8evbuffer_consume(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"n",0};
  __pyx_v_n = __pyx_d7;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":396 */
  __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_1) {
    __pyx_1 = (__pyx_v_n < 0);
  }
  if (__pyx_1) {
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":398 */
  __pyx_1 = (__pyx_v_n == 0);
  if (__pyx_1) {
    Py_INCREF(__pyx_k23p);
    __pyx_r = __pyx_k23p;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":400 */
  __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_2;
  __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":401 */
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":402 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.evbuffer.consume");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_peek(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_peek[] = "Read and return at most n (or all) from the beginning, no drain.";
static PyObject *__pyx_f_4coio_8evbuffer_peek(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"n",0};
  __pyx_v_n = __pyx_d8;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":409 */
  __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_1) {
    __pyx_1 = (__pyx_v_n < 0);
  }
  if (__pyx_1) {
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":411 */
  __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 411; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.evbuffer.peek");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_find(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer_find(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_buf = 0;
  Py_ssize_t __pyx_v_n;
  char const* __pyx_v_p;
  char *__pyx_v_q;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"buf",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_buf)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_buf);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":418 */
  __pyx_1 = (PyObject_AsCharBuffer(__pyx_v_buf,(&__pyx_v_p),(&__pyx_v_n)) < 0);
  if (__pyx_1) {
    __Pyx_Raise(PyExc_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 419; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":420 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),((unsigned char const*)__pyx_v_p),__pyx_v_n));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":421 */
  __pyx_1 = (__pyx_v_q == NULL);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong((-1)); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 422; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":423 */
  __pyx_2 = PyInt_FromLong((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer))); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 423; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.evbuffer.find");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_buf);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_append_clear(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_append_clear[] = "Append source and clear source.\n\n        The corresponding C function is evbuffer_add_buffer().\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_append_clear(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4coio_evbuffer *__pyx_v_source = 0;
  PyObject *__pyx_r;
  int __pyx_1;
  static char *__pyx_argnames[] = {"source",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_source)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_source);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_source), __pyx_ptype_4coio_evbuffer, 1, "source")) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 425; goto __pyx_L1;}
  __pyx_1 = (0 != evbuffer_add_buffer((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),(&__pyx_v_source->eb)));
  if (__pyx_1) {
    __Pyx_Raise(PyExc_RuntimeError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 431; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.evbuffer.append_clear");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_source);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_consumeline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_consumeline[] = "Read, drain and return string ending with \'\\n\', or \'\'.\n\n        An empty string is returned instead of a partial line at the end of\n        the buffer.\n\n        This method doesn\'t use evbuffer_readline(), which is not binary\n        (char 0) safe.\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_consumeline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  char *__pyx_v_q;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":444 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),((unsigned char const*)__pyx_k24),1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":445 */
  __pyx_1 = (__pyx_v_q == NULL);
  if (__pyx_1) {
    Py_INCREF(__pyx_k23p);
    __pyx_r = __pyx_k23p;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":447 */
  __pyx_v_n = ((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer)) + 1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":448 */
  __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 448; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_2;
  __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":449 */
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":450 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.evbuffer.consumeline");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_nb_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer_nb_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_sock = 0;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"sock",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_sock)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_sock);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":454 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(__pyx_v_sock, __pyx_n_accept); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; goto __pyx_L4;}
      __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_r = __pyx_3;
      __pyx_3 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":457 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 457; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 457; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_4 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_4) {
      __Pyx_AddTraceback("coio.nb_accept");
      if (__Pyx_GetException(&__pyx_2, &__pyx_3, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 457; goto __pyx_L1;}
      Py_INCREF(__pyx_3);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_3;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":458 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; goto __pyx_L1;}
      __pyx_4 = __pyx_4 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_4) {
        __Pyx_Raise(__pyx_2, __pyx_3, __pyx_5);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 459; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":460 */
      __pyx_6 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 460; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_6);
      __pyx_6 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":461 */
      __pyx_7 = PyObject_GetAttr(__pyx_v_sock, __pyx_n_fileno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 461; goto __pyx_L1;}
      __pyx_6 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 461; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      __pyx_4 = PyInt_AsLong(__pyx_6); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 461; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      event_set((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev),__pyx_4,EV_READ,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":463 */
      event_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":464 */
      __pyx_7 = PyStackless_Schedule(Py_None,1); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.evbuffer.nb_accept");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_sock);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_nb_flush(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_nb_flush[] = "Use self.append*, then self.nb_flush. Don\'t reuse self for reads.";
static PyObject *__pyx_f_4coio_8evbuffer_nb_flush(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_fd)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":472 */
  while (1) {
    __pyx_1 = (((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off > 0);
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":473 */
    __pyx_v_n = evbuffer_write((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_fd);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":474 */
    __pyx_1 = (__pyx_v_n < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":475 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        goto __pyx_L5;
      }
      __pyx_L5:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":478 */
      __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 478; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
      __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":479 */
      event_set((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev),__pyx_v_fd,EV_WRITE,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":481 */
      event_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":482 */
      __pyx_4 = PyStackless_Schedule(Py_None,1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L4;
    }
    __pyx_L4:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.evbuffer.nb_flush");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_nb_readline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8evbuffer_nb_readline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  int __pyx_v_got;
  char *__pyx_v_q;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_fd)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":489 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),((unsigned char const*)__pyx_k24),1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":490 */
  while (1) {
    __pyx_1 = (__pyx_v_q == NULL);
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":494 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_fd,8192);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":495 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":496 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 498; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 498; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 498; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 498; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 498; goto __pyx_L1;}
        goto __pyx_L5;
      }
      __pyx_L5:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":513 */
      __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 513; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
      __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":514 */
      event_set((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev),__pyx_v_fd,EV_READ,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":516 */
      event_add((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":517 */
      __pyx_4 = PyStackless_Schedule(Py_None,1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 517; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L4;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":519 */
      __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":520 */
      __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 520; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_2;
      __pyx_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":521 */
      evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":522 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    /*else*/ {
      __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),((unsigned char const*)__pyx_k24),1));
    }
    __pyx_L4:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":526 */
  __pyx_v_n = ((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer)) + 1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":527 */
  __pyx_3 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 527; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_3;
  __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":528 */
  evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":529 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.evbuffer.nb_readline");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_peekline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_peekline[] = "Read and return string ending with \'\\n\', or \'\', no draining.\n\n        An empty string is returned instead of a partial line at the end of\n        the buffer.\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_peekline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_q;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":539 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),((unsigned char const*)__pyx_k24),1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":540 */
  __pyx_1 = (__pyx_v_q == NULL);
  if (__pyx_1) {
    Py_INCREF(__pyx_k23p);
    __pyx_r = __pyx_k23p;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":542 */
  __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer)) + 1)); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 542; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.evbuffer.peekline");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_read_from_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_read_from_fd[] = "Read from file descriptor, append to self,\n\n        Does a ioctl(fd, FIONREAD, &c) before reading to limit the wasted\n        buffer space.\n\n        The corresponding C function is evbuffer_read().\n\n        Returns:\n          The number of bytes read.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_read_from_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd","n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "ii", __pyx_argnames, &__pyx_v_fd, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":559 */
  __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_fd,__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":560 */
  __pyx_1 = (__pyx_v_got < 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 562; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 562; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 562; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 562; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 562; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":563 */
  __pyx_3 = PyInt_FromLong(__pyx_v_got); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 563; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.evbuffer.read_from_fd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_read_from_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_read_from_fd_again[] = "Read from file descriptor, append to self,\n\n        Does a ioctl(fd, FIONREAD, &c) before reading to limit the wasted\n        buffer space.\n\n        The corresponding C function is evbuffer_read().\n\n        Returns:\n          The number of bytes read, or None on EAGAIN.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_read_from_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd","n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "ii", __pyx_argnames, &__pyx_v_fd, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":579 */
  __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_fd,__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":580 */
  __pyx_1 = (__pyx_v_got < 0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":581 */
    __pyx_1 = (errno == EAGAIN);
    if (__pyx_1) {
      Py_INCREF(Py_None);
      __pyx_r = Py_None;
      goto __pyx_L0;
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":584 */
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 584; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 584; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 584; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 584; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 584; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":585 */
  __pyx_3 = PyInt_FromLong(__pyx_v_got); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 585; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.evbuffer.read_from_fd_again");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_write_to_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_write_to_fd[] = "Write and drain n bytes to file descriptor fd.\n\n        A similar but weaker C function is evbuffer_write().\n\n        Returns:\n          The number of bytes written, which is not zero unless self is empty.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_write_to_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd","n",0};
  __pyx_v_n = __pyx_d9;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i|i", __pyx_argnames, &__pyx_v_fd, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":597 */
  __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_1) {
    __pyx_1 = (__pyx_v_n < 0);
  }
  if (__pyx_1) {
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":599 */
  __pyx_1 = (__pyx_v_n > 0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":601 */
    __pyx_v_n = write(__pyx_v_fd,((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),__pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":602 */
    __pyx_1 = (__pyx_v_n < 0);
    if (__pyx_1) {
      __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 604; goto __pyx_L1;}
      __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 604; goto __pyx_L1;}
      __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 604; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
      PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
      __pyx_2 = 0;
      __pyx_3 = 0;
      __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 604; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __Pyx_Raise(__pyx_2, 0, 0);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 604; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":605 */
    evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":606 */
  __pyx_3 = PyInt_FromLong(__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 606; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.evbuffer.write_to_fd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8evbuffer_write_to_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8evbuffer_write_to_fd_again[] = "Write and drain n bytes to file descriptor fd.\n\n        A similar but weaker C function is evbuffer_write().\n\n        Returns:\n          The number of bytes written, which is not zero unless self is empty;\n          or None on EAGAIN.\n        Raises:\n          IOError: With the corresponding errno.\n        ";
static PyObject *__pyx_f_4coio_8evbuffer_write_to_fd_again(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  int __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd","n",0};
  __pyx_v_n = __pyx_d10;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i|i", __pyx_argnames, &__pyx_v_fd, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":619 */
  __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off);
  if (!__pyx_1) {
    __pyx_1 = (__pyx_v_n < 0);
  }
  if (__pyx_1) {
    __pyx_v_n = ((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.off;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":621 */
  __pyx_1 = (__pyx_v_n > 0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":623 */
    __pyx_v_n = write(__pyx_v_fd,((char const*)((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb.buffer),__pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":624 */
    __pyx_1 = (__pyx_v_n < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":625 */
      __pyx_1 = (errno == EAGAIN);
      if (__pyx_1) {
        Py_INCREF(Py_None);
        __pyx_r = Py_None;
        goto __pyx_L0;
        goto __pyx_L5;
      }
      __pyx_L5:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":628 */
      __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 628; goto __pyx_L1;}
      __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 628; goto __pyx_L1;}
      __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 628; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
      PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
      __pyx_2 = 0;
      __pyx_3 = 0;
      __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 628; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __Pyx_Raise(__pyx_2, 0, 0);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 628; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":629 */
    evbuffer_drain((&((struct __pyx_obj_4coio_evbuffer *)__pyx_v_self)->eb),__pyx_v_n);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":630 */
  __pyx_3 = PyInt_FromLong(__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 630; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.evbuffer.write_to_fd_again");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_write_to_fd(int __pyx_v_fd,struct event *__pyx_v_wakeup_ev,char const* __pyx_v_p,Py_ssize_t __pyx_v_n) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":637 */
  while (1) {
    __pyx_1 = (__pyx_v_n > 0);
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":638 */
    __pyx_v_got = write(__pyx_v_fd,__pyx_v_p,__pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":639 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":640 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 642; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 642; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 642; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 642; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 642; goto __pyx_L1;}
        goto __pyx_L5;
      }
      __pyx_L5:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":643 */
      __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 643; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
      __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":644 */
      event_set(__pyx_v_wakeup_ev,__pyx_v_fd,EV_WRITE,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":646 */
      event_add(__pyx_v_wakeup_ev,NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":647 */
      __pyx_4 = PyStackless_Schedule(Py_None,1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 647; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":648 */
    __pyx_v_p += __pyx_v_got;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":649 */
    __pyx_v_n -= __pyx_v_got;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.write_to_fd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_6nbfile___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_read_fd;
  int __pyx_v_write_fd;
  int __pyx_v_write_buffer_limit;
  char __pyx_v_do_close;
  PyObject *__pyx_v_close_ref = 0;
  PyObject *__pyx_v_mode = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  int __pyx_1;
  static char *__pyx_argnames[] = {"read_fd","write_fd","write_buffer_limit","do_close","close_ref","mode","name",0};
  __pyx_v_write_buffer_limit = __pyx_d11;
  __pyx_v_do_close = __pyx_d12;
  __pyx_v_close_ref = __pyx_d13;
  __pyx_v_mode = __pyx_d14;
  __pyx_v_name = __pyx_d15;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "ii|ibOOO", __pyx_argnames, &__pyx_v_read_fd, &__pyx_v_write_fd, &__pyx_v_write_buffer_limit, &__pyx_v_do_close, &__pyx_v_close_ref, &__pyx_v_mode, &__pyx_v_name)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_close_ref);
  Py_INCREF(__pyx_v_mode);
  Py_INCREF(__pyx_v_name);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":684 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = (__pyx_v_read_fd >= 0);
  if (!__pyx_1) {
    if (PyObject_Cmp(__pyx_v_mode, __pyx_n_w, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 684; goto __pyx_L1;}
    __pyx_1 = __pyx_1 == 0;
  }
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 684; goto __pyx_L1;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":685 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = (__pyx_v_write_fd >= 0);
  if (!__pyx_1) {
    if (PyObject_Cmp(__pyx_v_mode, __pyx_n_r, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 685; goto __pyx_L1;}
    __pyx_1 = __pyx_1 == 0;
  }
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 685; goto __pyx_L1;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":686 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":687 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close = __pyx_v_do_close;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":688 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd = __pyx_v_read_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":689 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd = __pyx_v_write_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":690 */
  __pyx_1 = (__pyx_v_write_buffer_limit == (-1));
  if (__pyx_1) {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_e_4coio_DEFAULT_WRITE_BUFFER_LIMIT;
    goto __pyx_L2;
  }
  /*else*/ {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_v_write_buffer_limit;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":694 */
  Py_INCREF(__pyx_v_close_ref);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref = __pyx_v_close_ref;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":695 */
  Py_INCREF(__pyx_v_mode);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode = __pyx_v_mode;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":696 */
  Py_INCREF(__pyx_v_name);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name = __pyx_v_name;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_close_ref);
  Py_DECREF(__pyx_v_mode);
  Py_DECREF(__pyx_v_name);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd >= 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 703; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 705; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_write_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_write_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 709; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.write_fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_got;
  PyObject *__pyx_v_exc;
  PyObject *__pyx_v_close_ref;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  char __pyx_4;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_exc = Py_None; Py_INCREF(Py_None);
  __pyx_v_close_ref = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":713 */
  /*try:*/ {
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off > 0);
    if (__pyx_1) {
      __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_flush); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 715; goto __pyx_L3;}
      __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 715; goto __pyx_L3;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_why = 0; goto __pyx_L4;
    __pyx_L3: {
      __pyx_why = 4;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L4;
    }
    __pyx_L4:;
    __pyx_1 = (!((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":718 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed = 1;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":719 */
      __pyx_4 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close;
      if (__pyx_4) {
        __pyx_1 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref == Py_None;
        if (__pyx_1) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":721 */
          __pyx_v_got = close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd);

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":722 */
          __pyx_1 = (__pyx_v_got < 0);
          if (__pyx_1) {

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":723 */
            __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 723; goto __pyx_L6;}
            __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 723; goto __pyx_L6;}
            __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 723; goto __pyx_L6;}
            PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
            PyTuple_SET_ITEM(__pyx_5, 1, __pyx_3);
            __pyx_2 = 0;
            __pyx_3 = 0;
            __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 723; goto __pyx_L6;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            Py_DECREF(__pyx_v_exc);
            __pyx_v_exc = __pyx_2;
            __pyx_2 = 0;

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":724 */
            close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd);

            /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":725 */
            __Pyx_Raise(__pyx_v_exc, 0, 0);
            {__pyx_filename = __pyx_f[1]; __pyx_lineno = 725; goto __pyx_L6;}
            goto __pyx_L10;
          }
          __pyx_L10:;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":726 */
          __pyx_v_got = close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd);

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":727 */
          __pyx_1 = (__pyx_v_got < 0);
          if (__pyx_1) {
            __pyx_3 = PyInt_FromLong(errno); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 728; goto __pyx_L6;}
            __pyx_5 = PyString_FromString(strerror(errno)); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 728; goto __pyx_L6;}
            __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 728; goto __pyx_L6;}
            PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
            PyTuple_SET_ITEM(__pyx_2, 1, __pyx_5);
            __pyx_3 = 0;
            __pyx_5 = 0;
            __pyx_3 = PyObject_CallObject(PyExc_IOError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 728; goto __pyx_L6;}
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            __Pyx_Raise(__pyx_3, 0, 0);
            Py_DECREF(__pyx_3); __pyx_3 = 0;
            {__pyx_filename = __pyx_f[1]; __pyx_lineno = 728; goto __pyx_L6;}
            goto __pyx_L11;
          }
          __pyx_L11:;
          goto __pyx_L9;
        }
        /*else*/ {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":730 */
          Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
          Py_DECREF(__pyx_v_close_ref);
          __pyx_v_close_ref = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":731 */
          Py_INCREF(Py_False);
          Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
          ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref = Py_False;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":732 */
          __pyx_1 = __pyx_v_close_ref != Py_False;
          if (__pyx_1) {
            __pyx_5 = PyObject_GetAttr(__pyx_v_close_ref, __pyx_n_close); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 733; goto __pyx_L6;}
            __pyx_2 = PyObject_CallObject(__pyx_5, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 733; goto __pyx_L6;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            goto __pyx_L12;
          }
          __pyx_L12:;
        }
        __pyx_L9:;
        goto __pyx_L8;
      }
      __pyx_L8:;
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L13;
    __pyx_L6:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1;
    __pyx_L13:;
    switch (__pyx_why) {
      case 4: {
        PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1;
      }
    }
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.close");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc);
  Py_DECREF(__pyx_v_close_ref);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_6closed___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_6closed___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  char __pyx_1;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed;
  if (__pyx_1) {
    Py_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_8do_close___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_8do_close___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 745; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.do_close.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_10read_limit___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_10read_limit___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 756; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.read_limit.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile_10read_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_value); /*proto*/
static int __pyx_f_4coio_6nbfile_10read_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_value) {
  int __pyx_v_new_value;
  int __pyx_r;
  Py_INCREF(__pyx_v_self);
  __pyx_v_new_value = PyInt_AsLong(__pyx_arg_new_value); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 757; goto __pyx_L1;}
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit = __pyx_v_new_value;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.read_limit.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_4mode___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_4mode___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_4name___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_4name___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_9softspace___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_9softspace___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_softspace); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 771; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.softspace.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile_9softspace___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_softspace); /*proto*/
static int __pyx_f_4coio_6nbfile_9softspace___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_softspace) {
  char __pyx_v_softspace;
  int __pyx_r;
  Py_INCREF(__pyx_v_self);
  __pyx_v_softspace = PyInt_AsLong(__pyx_arg_softspace); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 772; goto __pyx_L1;}
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_softspace = __pyx_v_softspace;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.softspace.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_8encoding___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_8encoding___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_8newlines___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_8newlines___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_6errors___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_6errors___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_buf = 0;
  char const* __pyx_v_p;
  Py_ssize_t __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"buf",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_buf)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_buf);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":795 */
  __pyx_1 = (PyObject_AsCharBuffer(__pyx_v_buf,(&__pyx_v_p),(&__pyx_v_n)) < 0);
  if (__pyx_1) {
    __Pyx_Raise(PyExc_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 796; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":797 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit == 0);
  if (__pyx_1) {
    __pyx_2 = __pyx_f_4coio_write_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),__pyx_v_p,__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 799; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":802 */
  evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((char *)__pyx_v_p),__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":803 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_write_buffer_limit); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 803; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 803; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_2, __pyx_3, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 803; goto __pyx_L1;}
  __pyx_1 = __pyx_1 > 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off >= ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit);
  }
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_flush); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 805; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 805; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbfile.write");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_buf);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_flush(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_flush(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  int __pyx_v_fd;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":813 */
  __pyx_v_fd = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":814 */
  while (1) {
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off > 0);
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":815 */
    __pyx_v_n = evbuffer_write((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),__pyx_v_fd);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":816 */
    __pyx_1 = (__pyx_v_n < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":817 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 819; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 819; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 819; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 819; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 819; goto __pyx_L1;}
        goto __pyx_L5;
      }
      __pyx_L5:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":820 */
      __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 820; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
      __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":821 */
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),__pyx_v_fd,EV_WRITE,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":823 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":824 */
      __pyx_4 = PyStackless_Schedule(Py_None,1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 824; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L4;
    }
    __pyx_L4:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.flush");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_15read_buffer_len___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_15read_buffer_len___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 828; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.read_buffer_len.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_16write_buffer_len___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_16write_buffer_len___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 832; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.write_buffer_len.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_18write_buffer_limit___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_18write_buffer_limit___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 836; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.write_buffer_limit.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_discard_write_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_discard_write_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off);

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_discard[] = "Read and discard exactly n bytes.\n\n        Args:\n          n: Number of bytes to discard. Negative values are treated as 0.\n        Returns:\n          The number of bytes not discarded because of EOF.\n        Raises:\n          IOError: (but not EOFError)\n        ";
static PyObject *__pyx_f_4coio_6nbfile_discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":853 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":854 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off >= __pyx_v_n);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":855 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off -= __pyx_v_n;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":856 */
      __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 856; goto __pyx_L1;}
      __pyx_r = __pyx_2;
      __pyx_2 = 0;
      goto __pyx_L0;
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":857 */
    __pyx_v_n -= ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":858 */
    evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":859 */
  __pyx_1 = (__pyx_v_n <= 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 860; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":861 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":862 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
    }
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":863 */
      __pyx_v_got = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":864 */
      __pyx_1 = (__pyx_v_got == 0);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 865; goto __pyx_L1;}
        __pyx_r = __pyx_2;
        __pyx_2 = 0;
        goto __pyx_L0;
        goto __pyx_L8;
      }
      __pyx_L8:;
      goto __pyx_L7;
    }
    /*else*/ {
      __pyx_v_got = __pyx_v_n;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":868 */
    __pyx_1 = (__pyx_v_got > 8192);
    if (__pyx_1) {
      __pyx_v_got = 8192;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":872 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_got);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":873 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":874 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 875; goto __pyx_L1;}
        __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 875; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 875; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
        __pyx_2 = 0;
        __pyx_4 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 875; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 875; goto __pyx_L1;}
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":876 */
      __pyx_4 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 876; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_4);
      __pyx_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":877 */
      __pyx_5 = __Pyx_GetName(__pyx_b, __pyx_n_fd); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 877; goto __pyx_L1;}
      __pyx_1 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 877; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),__pyx_1,EV_READ,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":879 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":880 */
      __pyx_2 = PyStackless_Schedule(Py_None,1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 880; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L10;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {
      __pyx_4 = PyInt_FromLong(__pyx_v_n); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 882; goto __pyx_L1;}
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
      goto __pyx_L10;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":884 */
      __pyx_v_n -= __pyx_v_got;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":885 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_1) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L12;
      }
      __pyx_L12:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":887 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_got);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":888 */
      __pyx_1 = (__pyx_v_n == 0);
      if (__pyx_1) {
        __pyx_5 = PyInt_FromLong(0); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 889; goto __pyx_L1;}
        __pyx_r = __pyx_5;
        __pyx_5 = 0;
        goto __pyx_L0;
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __pyx_L10:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.discard");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_discard_to_read_limit(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_discard_to_read_limit[] = "Discard the read buffer, and discard bytes from read_fd.";
static PyObject *__pyx_f_4coio_6nbfile_discard_to_read_limit(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":893 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_1) {
    evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":896 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit > 0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":898 */
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_discard); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 898; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 898; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 898; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 898; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":899 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (!(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit == 0)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 899; goto __pyx_L1;}
    }
    #endif
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.discard_to_read_limit");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_read[] = "Read exactly n bytes (or less on EOF), and return string\n\n        Args:\n          n: Number of bytes to read. Negative values are treated as 0.\n        Returns:\n          String containing the bytes read; an empty string on EOF.\n        Raises:\n          IOError: (but not EOFError)\n        ";
static PyObject *__pyx_f_4coio_6nbfile_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":914 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
  }
  if (__pyx_1) {
    __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":916 */
  __pyx_1 = (__pyx_v_n <= 0);
  if (__pyx_1) {
    Py_INCREF(__pyx_k23p);
    __pyx_r = __pyx_k23p;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":918 */
  while (1) {
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off < __pyx_v_n);
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":919 */
    __pyx_v_got = (__pyx_v_n - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":920 */
    __pyx_1 = (__pyx_v_got > 65536);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_got > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen);
    }
    if (__pyx_1) {
      __pyx_v_got = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":927 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_got);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":928 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":929 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 930; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 930; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 930; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 930; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 930; goto __pyx_L1;}
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":931 */
      __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 931; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
      __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":932 */
      __pyx_4 = __Pyx_GetName(__pyx_b, __pyx_n_fd); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 932; goto __pyx_L1;}
      __pyx_1 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 932; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),__pyx_1,EV_READ,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":934 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":935 */
      __pyx_2 = PyStackless_Schedule(Py_None,1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 935; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L7;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":937 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":938 */
      goto __pyx_L5;
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":940 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_1) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L9;
      }
      __pyx_L9:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":942 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_got);
    }
    __pyx_L7:;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":943 */
  __pyx_3 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 943; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_3;
  __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":944 */
  evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":945 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.read");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_read_at_most(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_read_at_most[] = "Read at most n bytes and return the string.\n\n        If the read buffer is not empty (self.read_buffer_len), data inside it\n        will be returned, and no attempt is done to read self.read_fd.\n        ";
static PyObject *__pyx_f_4coio_6nbfile_read_at_most(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_got;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":955 */
  __pyx_1 = (__pyx_v_n <= 0);
  if (__pyx_1) {
    Py_INCREF(__pyx_k23p);
    __pyx_r = __pyx_k23p;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":957 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":958 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off < __pyx_v_n);
    if (__pyx_1) {
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":960 */
    __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 960; goto __pyx_L1;}
    Py_DECREF(__pyx_v_buf);
    __pyx_v_buf = __pyx_2;
    __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":961 */
    evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":962 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_1) {
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_n;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":965 */
    Py_INCREF(__pyx_v_buf);
    __pyx_r = __pyx_v_buf;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":966 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
  }
  if (__pyx_1) {
    __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":968 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":971 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":972 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":973 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 974; goto __pyx_L1;}
        __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 974; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 974; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
        __pyx_2 = 0;
        __pyx_4 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 974; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 974; goto __pyx_L1;}
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":975 */
      __pyx_4 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 975; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_4);
      __pyx_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":976 */
      __pyx_5 = __Pyx_GetName(__pyx_b, __pyx_n_fd); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 976; goto __pyx_L1;}
      __pyx_1 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 976; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),__pyx_1,EV_READ,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":978 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":979 */
      __pyx_2 = PyStackless_Schedule(Py_None,1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 979; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L9;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {
      Py_INCREF(__pyx_k23p);
      __pyx_r = __pyx_k23p;
      goto __pyx_L0;
      goto __pyx_L9;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":983 */
      __pyx_4 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_got); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 983; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_4;
      __pyx_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":985 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_got);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":986 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_1) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":988 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
    }
    __pyx_L9:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.read_at_most");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_readline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_readline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  int __pyx_v_n;
  int __pyx_v_got;
  char *__pyx_v_q;
  int __pyx_v_fd;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":996 */
  __pyx_v_fd = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":997 */
  __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((unsigned char const*)__pyx_k24),1));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":998 */
  while (1) {
    __pyx_1 = (__pyx_v_q == NULL);
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1003 */
    __pyx_v_n = 8192;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1004 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
    }
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1005 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1006 */
      __pyx_1 = (__pyx_v_n == 0);
      if (__pyx_1) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1007 */
        __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1008 */
        __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1008; goto __pyx_L1;}
        Py_DECREF(__pyx_v_buf);
        __pyx_v_buf = __pyx_2;
        __pyx_2 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1009 */
        evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1010 */
        Py_INCREF(__pyx_v_buf);
        __pyx_r = __pyx_v_buf;
        goto __pyx_L0;
        goto __pyx_L5;
      }
      __pyx_L5:;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1011 */
    __pyx_v_got = evbuffer_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_fd,__pyx_v_n);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1012 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1013 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1015; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1015; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1015; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1015; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1015; goto __pyx_L1;}
        goto __pyx_L7;
      }
      __pyx_L7:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1016 */
      __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1016; goto __pyx_L1;}
      Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
      __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
      __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1017 */
      event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),__pyx_v_fd,EV_READ,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1019 */
      event_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->wakeup_ev),NULL);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1020 */
      __pyx_4 = PyStackless_Schedule(Py_None,1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1020; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L6;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1022 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1023 */
      __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1023; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_2;
      __pyx_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1024 */
      evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1025 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L6;
    }
    /*else*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1027 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_1) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1030 */
      __pyx_v_q = ((char *)evbuffer_find((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((unsigned char const*)__pyx_k24),1));
    }
    __pyx_L6:;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1031 */
  __pyx_v_n = ((__pyx_v_q - ((char *)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer)) + 1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1032 */
  __pyx_3 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1032; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_3;
  __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1033 */
  evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1034 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.readline");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile___next__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile___next__(PyObject *__pyx_v_self) {
  PyObject *__pyx_v_line;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  Py_INCREF(__pyx_v_self);
  __pyx_v_line = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1037 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_readline); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1037; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1037; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_line);
  __pyx_v_line = __pyx_2;
  __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1038 */
  __pyx_3 = PyObject_IsTrue(__pyx_v_line); if (__pyx_3 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1038; goto __pyx_L1;}
  if (__pyx_3) {
    Py_INCREF(__pyx_v_line);
    __pyx_r = __pyx_v_line;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1040 */
  __Pyx_Raise(PyExc_StopIteration, 0, 0);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1040; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.__next__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_line);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile___iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile___iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_xreadlines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_xreadlines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_isatty(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_isatty(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1053 */
  __pyx_v_got = isatty(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1054 */
  __pyx_1 = (__pyx_v_got < 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1055; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1055; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1055; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1055; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1055; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_1 = __pyx_v_got;
  if (__pyx_1) {
    Py_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.isatty");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_truncate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_truncate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_size;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"size",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_size)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (ftruncate(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_size) < 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1064; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1064; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1064; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(PyExc_IOError, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1064; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1064; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.truncate");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_handle_eagain(struct __pyx_obj_4coio_nbsocket *__pyx_v_self,int __pyx_v_evtype) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1083 */
  __pyx_1 = (__pyx_v_self->timeout_value == 0.0);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_b, __pyx_n_e); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_errno); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_b, __pyx_n_e); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    __pyx_5 = PyObject_GetAttr(__pyx_2, __pyx_n_errno); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_2 = PyString_FromString(strerror(__pyx_1)); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_4);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
    __pyx_4 = 0;
    __pyx_2 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1084; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1085 */
  __pyx_2 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1085; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1086 */
  __pyx_1 = (__pyx_v_self->timeout_value < 0.0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1087 */
    event_set((&__pyx_v_self->wakeup_ev),__pyx_v_self->fd,__pyx_v_evtype,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1089 */
    event_add((&__pyx_v_self->wakeup_ev),NULL);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1090 */
    __pyx_3 = PyStackless_Schedule(Py_None,1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1090; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1092 */
    event_set((&__pyx_v_self->wakeup_ev),__pyx_v_self->fd,__pyx_v_evtype,__pyx_f_4coio_HandleCTimeoutWakeup,((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1094 */
    event_add((&__pyx_v_self->wakeup_ev),(&__pyx_v_self->tv));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1095 */
    __pyx_5 = PyStackless_Schedule(Py_None,1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1095; goto __pyx_L1;}
    __pyx_1 = PyObject_IsTrue(__pyx_5); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1095; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    if (__pyx_1) {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1097; goto __pyx_L1;}
      __pyx_2 = PyObject_GetAttr(__pyx_4, __pyx_n_error); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1097; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1097; goto __pyx_L1;}
      Py_INCREF(__pyx_k38p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k38p);
      __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1097; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_5, 0, 0);
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1097; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.handle_eagain");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_handle_ssl_eagain(struct __pyx_obj_4coio_nbsslsocket *__pyx_v_self,int __pyx_v_evtype) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1102 */
  __pyx_1 = (__pyx_v_self->timeout_value == 0.0);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_b, __pyx_n_e); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_errno); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_b, __pyx_n_e); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    __pyx_5 = PyObject_GetAttr(__pyx_2, __pyx_n_errno); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_2 = PyString_FromString(strerror(__pyx_1)); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_4);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
    __pyx_4 = 0;
    __pyx_2 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1103; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1104 */
  __pyx_2 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1104; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1105 */
  __pyx_1 = (__pyx_v_self->timeout_value < 0.0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1106 */
    event_set((&__pyx_v_self->wakeup_ev),__pyx_v_self->fd,__pyx_v_evtype,__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1108 */
    event_add((&__pyx_v_self->wakeup_ev),NULL);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1109 */
    __pyx_3 = PyStackless_Schedule(Py_None,1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1109; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1111 */
    event_set((&__pyx_v_self->wakeup_ev),__pyx_v_self->fd,__pyx_v_evtype,__pyx_f_4coio_HandleCTimeoutWakeup,((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1113 */
    event_add((&__pyx_v_self->wakeup_ev),(&__pyx_v_self->tv));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1114 */
    __pyx_5 = PyStackless_Schedule(Py_None,1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1114; goto __pyx_L1;}
    __pyx_1 = PyObject_IsTrue(__pyx_5); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1114; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    if (__pyx_1) {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1116; goto __pyx_L1;}
      __pyx_2 = PyObject_GetAttr(__pyx_4, __pyx_n_error); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1116; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1116; goto __pyx_L1;}
      Py_INCREF(__pyx_k38p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k38p);
      __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1116; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_5, 0, 0);
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1116; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.handle_ssl_eagain");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_8nbsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_8nbsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_v_my_socket_impl;
  int __pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_ssize_t __pyx_5;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, &__pyx_v_kwargs, 0) < 0) return -1;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    Py_XDECREF(__pyx_v_kwargs);
    return -1;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_my_socket_impl = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1148 */
  __pyx_1 = PySequence_Contains(__pyx_v_kwargs, __pyx_n_socket_impl); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1148; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_pop); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1149; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1149; goto __pyx_L1;}
    Py_INCREF(__pyx_n_socket_impl);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_n_socket_impl);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1149; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_my_socket_impl);
    __pyx_v_my_socket_impl = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket_impl); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1151; goto __pyx_L1;}
    Py_DECREF(__pyx_v_my_socket_impl);
    __pyx_v_my_socket_impl = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1152 */
  __pyx_3 = __pyx_v_args;
  Py_INCREF(__pyx_3);
  __pyx_1 = PyObject_IsTrue(__pyx_3); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1152; goto __pyx_L1;}
  if (__pyx_1) {
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_4 = __Pyx_GetItemInt(__pyx_v_args, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1152; goto __pyx_L1;}
    __pyx_1 = PyObject_IsInstance(__pyx_4,__pyx_v_my_socket_impl); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1152; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = PyInt_FromLong(__pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1152; goto __pyx_L1;}
  }
  __pyx_1 = PyObject_IsTrue(__pyx_3); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1152; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1153 */
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_args, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1153; goto __pyx_L1;}
    Py_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_2;
    __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1154 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    __pyx_5 = PyObject_Length(__pyx_v_args); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1154; goto __pyx_L1;}
    if (!(__pyx_5 == 1)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1154; goto __pyx_L1;}
    }
    #endif
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_4 = PySequence_Tuple(__pyx_v_args); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1156; goto __pyx_L1;}
    __pyx_3 = PyEval_CallObjectWithKeywords(__pyx_v_my_socket_impl, __pyx_4, __pyx_v_kwargs); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1156; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_3;
    __pyx_3 = 0;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1157 */
  __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_fileno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1157; goto __pyx_L1;}
  __pyx_4 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1157; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1157; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd = __pyx_1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1159 */
  __pyx_f_4coio_set_fd_nonblocking(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1160 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = (-1.0);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsocket.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_v_kwargs);
  Py_DECREF(__pyx_v_my_socket_impl);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1163; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1169; goto __pyx_L1;}
  Py_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_self);
  __pyx_2 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1169; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_dup); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1169; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1169; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1169; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1169; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.dup");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  char __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1172 */
  __pyx_1 = ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close;
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_close); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1175; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1175; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1178; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n__closedsocket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1178; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1178; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1179 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd = (-1);

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.close");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_setdoclose(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_setdoclose[] = "With True, makes self.close() close the filehandle.\n\n        Returns:\n          self\n        ";
static PyObject *__pyx_f_4coio_8nbsocket_setdoclose(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char __pyx_v_do_close;
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {"do_close",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "b", __pyx_argnames, &__pyx_v_do_close)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1191 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close = __pyx_v_do_close;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1192 */
  Py_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_8do_close___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_8do_close___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1197; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.do_close.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_4type___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_4type___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_type); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1210; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.type.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_6family___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_6family___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1214; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.family.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_7timeout___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_7timeout___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1226; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.timeout.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_5proto___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_5proto___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_proto); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1230; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.proto.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_setsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1233; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1233; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1233; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.setsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_getsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1236; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1236; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1236; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.getsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_getsockname); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1239; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1239; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1239; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.getsockname");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_getpeername); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1242; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1242; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1242; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.getpeername");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_bind); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1245; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1245; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1245; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.bind");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_listen); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1248; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1248; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1248; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.listen");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1254; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.gettimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_is_blocking = 0;
  PyObject *__pyx_r;
  int __pyx_1;
  float __pyx_2;
  static char *__pyx_argnames[] = {"is_blocking",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_is_blocking)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_is_blocking);
  __pyx_1 = PyObject_IsTrue(__pyx_v_is_blocking); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1257; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyFloat_AsDouble(Py_None); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1258; goto __pyx_L1;}
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = __pyx_2;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1260 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = 0.0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1261 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_sec = 0;
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_usec = 0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbsocket.setblocking");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_is_blocking);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  float __pyx_v_timeout_float;
  PyObject *__pyx_r;
  int __pyx_1;
  float __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_timeout);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1265 */
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    __pyx_2 = PyFloat_AsDouble(Py_None); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1266; goto __pyx_L1;}
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = __pyx_2;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1268 */
    __pyx_2 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1268; goto __pyx_L1;}
    __pyx_v_timeout_float = __pyx_2;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1269 */
    __pyx_1 = (__pyx_v_timeout_float < 0.0);
    if (__pyx_1) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1270; goto __pyx_L1;}
      Py_INCREF(__pyx_k52p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k52p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1270; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1270; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1271 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->timeout_value = __pyx_v_timeout_float;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1272 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_sec = ((unsigned int)__pyx_v_timeout_float);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1273 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_usec = ((unsigned int)((__pyx_v_timeout_float - ((float)((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->tv.tv_sec)) * 1000000.0));
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsocket.settimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_asock;
  PyObject *__pyx_v_addr;
  PyObject *__pyx_v_esock;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_asock = Py_None; Py_INCREF(Py_None);
  __pyx_v_addr = Py_None; Py_INCREF(Py_None);
  __pyx_v_esock = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1279 */
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_accept); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1279; goto __pyx_L4;}
      __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1279; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyObject_GetIter(__pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1279; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = __Pyx_UnpackItem(__pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1279; goto __pyx_L4;}
      Py_DECREF(__pyx_v_asock);
      __pyx_v_asock = __pyx_3;
      __pyx_3 = 0;
      __pyx_3 = __Pyx_UnpackItem(__pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1279; goto __pyx_L4;}
      Py_DECREF(__pyx_v_addr);
      __pyx_v_addr = __pyx_3;
      __pyx_3 = 0;
      if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1279; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1280 */
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1280; goto __pyx_L4;}
      Py_INCREF(__pyx_v_self);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_self);
      __pyx_2 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1280; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1280; goto __pyx_L4;}
      Py_INCREF(__pyx_v_asock);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_asock);
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1280; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_esock);
      __pyx_v_esock = __pyx_4;
      __pyx_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1281 */
      __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1281; goto __pyx_L4;}
      Py_INCREF(__pyx_v_esock);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_esock);
      Py_INCREF(__pyx_v_addr);
      PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_addr);
      __pyx_r = __pyx_2;
      __pyx_2 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1282 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1282; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_error); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1282; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_4);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.accept");
      if (__Pyx_GetException(&__pyx_2, &__pyx_3, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1282; goto __pyx_L1;}
      Py_INCREF(__pyx_3);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_3;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1283 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1283; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1283; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1283; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_2, __pyx_3, __pyx_4);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1284; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1285 */
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1285; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.accept");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_asock);
  Py_DECREF(__pyx_v_addr);
  Py_DECREF(__pyx_v_esock);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1290 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1290; goto __pyx_L1;}
  __pyx_2 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1290; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address,__pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1290; goto __pyx_L1;}
  Py_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_1;
  __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1292 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1293 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_connect_ex); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1293; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1293; goto __pyx_L1;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_address);
    __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1293; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_5;
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1294 */
    __pyx_2 = PyObject_IsTrue(__pyx_v_err); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1294; goto __pyx_L1;}
    if (__pyx_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1295 */
      __pyx_1 = PyInt_FromLong(EAGAIN); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1295; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_v_err, __pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1295; goto __pyx_L1;}
      __pyx_2 = __pyx_2 != 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      if (__pyx_2) {
        __pyx_4 = PyInt_FromLong(EINPROGRESS); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1295; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_v_err, __pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1295; goto __pyx_L1;}
        __pyx_2 = __pyx_2 != 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
      }
      if (__pyx_2) {
        __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1296; goto __pyx_L1;}
        __pyx_1 = PyObject_GetAttr(__pyx_5, __pyx_n_error); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1296; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __pyx_2 = PyInt_AsLong(__pyx_v_err); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1296; goto __pyx_L1;}
        __pyx_4 = PyString_FromString(strerror(__pyx_2)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1296; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1296; goto __pyx_L1;}
        Py_INCREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_v_err);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
        __pyx_4 = 0;
        __pyx_4 = PyObject_CallObject(__pyx_1, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1296; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_4, 0, 0);
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1296; goto __pyx_L1;}
        goto __pyx_L5;
      }
      __pyx_L5:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1297 */
      __pyx_1 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1297; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      goto __pyx_L4;
    }
    /*else*/ {
      __pyx_r = Py_None; Py_INCREF(Py_None);
      goto __pyx_L0;
    }
    __pyx_L4:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbsocket.connect");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1303 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1303; goto __pyx_L1;}
  __pyx_2 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1303; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address,__pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1303; goto __pyx_L1;}
  Py_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_1;
  __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1305 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1306 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_connect_ex); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1306; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1306; goto __pyx_L1;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_address);
    __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1306; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_5;
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1307 */
    __pyx_1 = PyInt_FromLong(EAGAIN); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1307; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_v_err, __pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1307; goto __pyx_L1;}
    __pyx_2 = __pyx_2 != 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    if (__pyx_2) {
      __pyx_4 = PyInt_FromLong(EINPROGRESS); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1307; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_v_err, __pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1307; goto __pyx_L1;}
      __pyx_2 = __pyx_2 != 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
    }
    if (__pyx_2) {
      Py_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1309 */
    __pyx_5 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1309; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbsocket.connect_ex");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_how = 0;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  static char *__pyx_argnames[] = {"how",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_how)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_how);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1313 */
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_shutdown); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1313; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1313; goto __pyx_L1;}
    Py_INCREF(__pyx_v_how);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_how);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1313; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_4;
    __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1314 */
    __pyx_2 = PyInt_FromLong(EAGAIN); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1314; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_v_err, __pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1314; goto __pyx_L1;}
    __pyx_5 = __pyx_5 != 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      Py_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1317 */
    __pyx_3 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1317; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsocket.shutdown");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_how);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recv); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1322; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1322; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1322; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1323 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1323; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1323; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.recv");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1323; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1324 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1324; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1324; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1324; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1325; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1326 */
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1326; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.recv");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1331; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1331; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1331; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1332 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1332; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1332; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.recvfrom");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1332; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1333 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1333; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1333; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1333; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1334; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1335 */
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1335; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.recvfrom");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recv_into); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1340; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1340; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1340; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1341 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1341; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1341; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.recv_into");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1341; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1342 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1342; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1342; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1342; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1343; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1344 */
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1344; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.recv_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom_into); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1349; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1349; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1349; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1350 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1350; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1350; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.recvfrom_into");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1350; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1351 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1351; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1351; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1351; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1352; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1353 */
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1353; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.recvfrom_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1358; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1358; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1358; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1359 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1359; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1359; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.send");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1359; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1360 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1360; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1360; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1360; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1361; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1362 */
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1362; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.send");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_sendto); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1367; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1367; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1367; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1368 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1368; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1368; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.sendto");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1368; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1369 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1369; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1369; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1369; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1370; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1371 */
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1371; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.sendto");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  int __pyx_v_got;
  int __pyx_v_got2;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  Py_ssize_t __pyx_7;
  static char *__pyx_argnames[] = {"data","flags",0};
  __pyx_v_flags = __pyx_d16;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_data, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1376 */
  /*try:*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1378 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1378; goto __pyx_L2;}
    __pyx_2 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1378; goto __pyx_L2;}
    __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1378; goto __pyx_L2;}
    Py_INCREF(__pyx_v_data);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
    PyTuple_SET_ITEM(__pyx_3, 1, __pyx_2);
    __pyx_2 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1378; goto __pyx_L2;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1378; goto __pyx_L2;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_got = __pyx_4;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1379 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (!(__pyx_v_got > 0)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1379; goto __pyx_L2;}
    }
    #endif
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_1); __pyx_1 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1380 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1380; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1380; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_4 = PyErr_ExceptionMatches(__pyx_3);
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_4) {
    __Pyx_AddTraceback("coio.sendall");
    if (__Pyx_GetException(&__pyx_2, &__pyx_1, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1380; goto __pyx_L1;}
    Py_INCREF(__pyx_1);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_1;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1381 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1381; goto __pyx_L1;}
    __pyx_6 = PyInt_FromLong(EAGAIN); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1381; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_5, __pyx_6, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1381; goto __pyx_L1;}
    __pyx_4 = __pyx_4 != 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    if (__pyx_4) {
      __Pyx_Raise(__pyx_2, __pyx_1, __pyx_3);
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1382; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1383 */
    __pyx_5 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1383; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1384 */
    __pyx_v_got = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }
  goto __pyx_L1;
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1385 */
  while (1) {
    __pyx_7 = PyObject_Length(__pyx_v_data); if (__pyx_7 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1385; goto __pyx_L1;}
    __pyx_4 = (__pyx_v_got < __pyx_7);
    if (!__pyx_4) break;
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1387 */
      __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      __pyx_5 = PyInt_FromLong(__pyx_v_got); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      Py_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_data);
      PyTuple_SET_ITEM(__pyx_2, 1, __pyx_5);
      __pyx_5 = 0;
      __pyx_1 = PyObject_CallObject(((PyObject *)(&PyBuffer_Type)), __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_3 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
      PyTuple_SET_ITEM(__pyx_5, 1, __pyx_3);
      __pyx_1 = 0;
      __pyx_3 = 0;
      __pyx_2 = PyObject_CallObject(__pyx_6, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1387; goto __pyx_L7;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_got2 = __pyx_4;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1388 */
      #ifndef PYREX_WITHOUT_ASSERTIONS
      if (!(__pyx_v_got2 > 0)) {
        PyErr_SetNone(PyExc_AssertionError);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1388; goto __pyx_L7;}
      }
      #endif

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1389 */
      __pyx_v_got += __pyx_v_got2;
    }
    goto __pyx_L8;
    __pyx_L7:;
    Py_XDECREF(__pyx_1); __pyx_1 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1390 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1390; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1390; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_4 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_4) {
      __Pyx_AddTraceback("coio.sendall");
      if (__Pyx_GetException(&__pyx_6, &__pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1390; goto __pyx_L1;}
      Py_INCREF(__pyx_5);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_5;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1391 */
      __pyx_1 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1391; goto __pyx_L1;}
      __pyx_3 = PyInt_FromLong(EAGAIN); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1391; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_1, __pyx_3, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1391; goto __pyx_L1;}
      __pyx_4 = __pyx_4 != 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      if (__pyx_4) {
        __Pyx_Raise(__pyx_6, __pyx_5, __pyx_2);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1392; goto __pyx_L1;}
        goto __pyx_L9;
      }
      __pyx_L9:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1393 */
      __pyx_1 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1393; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L8;
    }
    goto __pyx_L1;
    __pyx_L8:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.nbsocket.sendall");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_makefile_samefd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_makefile_samefd[] = "Create and return an nbfile with self.fd.\n\n        The nbfile will be buffered, and its close method won\'t be cause an\n        os.close(self.fd).\n\n        This method is not part of normal sockets.\n        ";
static PyObject *__pyx_f_4coio_8nbsocket_makefile_samefd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"mode","bufsize",0};
  __pyx_v_mode = __pyx_d17;
  __pyx_v_bufsize = __pyx_d18;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|Oi", __pyx_argnames, &__pyx_v_mode, &__pyx_v_bufsize)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_mode);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1403 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (PyObject_Cmp(__pyx_v_mode, __pyx_k60p, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1403; goto __pyx_L1;}
  __pyx_1 = __pyx_1 == 0;
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1403; goto __pyx_L1;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1404 */
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1404; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1404; goto __pyx_L1;}
  __pyx_4 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1404; goto __pyx_L1;}
  __pyx_5 = PyTuple_New(3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1404; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_3);
  PyTuple_SET_ITEM(__pyx_5, 2, __pyx_4);
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbfile), __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1404; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbsocket.makefile_samefd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_makefile[] = "Create an nbfile (non-blocking file-like) object from self.\n\n        os.dup(self.fd) will be passed to the new nbfile object, and its\n        .close() method will close that file descriptor.\n\n        Args:\n          mode: \'r\', \'w\', \'r+\' etc. The default is mode\'r\', just as for\n            socket.socket.makefile.\n        ";
static PyObject *__pyx_f_4coio_8nbsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  int __pyx_v_fd;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"mode","bufsize",0};
  __pyx_v_mode = __pyx_d19;
  __pyx_v_bufsize = __pyx_d20;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|Oi", __pyx_argnames, &__pyx_v_mode, &__pyx_v_bufsize)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_mode);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1417 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (PyObject_Cmp(__pyx_v_mode, __pyx_k60p, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1417; goto __pyx_L1;}
  __pyx_1 = __pyx_1 == 0;
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1417; goto __pyx_L1;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1418 */
  __pyx_v_fd = dup(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1419 */
  __pyx_1 = (__pyx_v_fd < 0);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1420; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1420; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1420; goto __pyx_L1;}
    __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1420; goto __pyx_L1;}
    __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1420; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
    __pyx_2 = 0;
    __pyx_4 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1420; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1420; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1422 */
  __pyx_4 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  __pyx_5 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_3);
  PyTuple_SET_ITEM(__pyx_2, 2, __pyx_5);
  __pyx_4 = 0;
  __pyx_3 = 0;
  __pyx_5 = 0;
  __pyx_4 = PyDict_New(); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_4, __pyx_n_do_close, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyDict_SetItem(__pyx_4, __pyx_n_close_ref, __pyx_v_self) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  __pyx_5 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_nbfile), __pyx_2, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1422; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_r = __pyx_5;
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbsocket.makefile");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static int __pyx_f_4coio_11nbsslsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_11nbsslsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_v_my_sslsocket_impl;
  int __pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, &__pyx_v_kwargs, 0) < 0) return -1;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    Py_XDECREF(__pyx_v_kwargs);
    return -1;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_my_sslsocket_impl = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1460 */
  __pyx_1 = PySequence_Contains(__pyx_v_kwargs, __pyx_n_sslsocket_impl); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1460; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_pop); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1461; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1461; goto __pyx_L1;}
    Py_INCREF(__pyx_n_sslsocket_impl);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_n_sslsocket_impl);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1461; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_my_sslsocket_impl);
    __pyx_v_my_sslsocket_impl = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_sslsocket_impl); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1463; goto __pyx_L1;}
    Py_DECREF(__pyx_v_my_sslsocket_impl);
    __pyx_v_my_sslsocket_impl = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1464 */
  __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1464; goto __pyx_L1;}
  __pyx_4 = PyEval_CallObjectWithKeywords(__pyx_v_my_sslsocket_impl, __pyx_3, __pyx_v_kwargs); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1464; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock = __pyx_4;
  __pyx_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1465 */
  __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sock); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1465; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock = __pyx_2;
  __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1469 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1469; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_3;
  __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1470 */
  __pyx_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_fileno); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1470; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_4, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1470; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_1 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1470; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->fd = __pyx_1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1471 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_setblocking); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1471; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1471; goto __pyx_L1;}
  Py_INCREF(Py_False);
  PyTuple_SET_ITEM(__pyx_4, 0, Py_False);
  __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1471; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1472 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_setblocking); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1472; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1472; goto __pyx_L1;}
  Py_INCREF(Py_False);
  PyTuple_SET_ITEM(__pyx_4, 0, Py_False);
  __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1472; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1473 */
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = (-1.0);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_v_kwargs);
  Py_DECREF(__pyx_v_my_sslsocket_impl);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->fd); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1476; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_dup[] = "Duplicates to a non-SSL socket (as in SSLSocket.dup).";
static PyObject *__pyx_f_4coio_11nbsslsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_dup); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1483; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1483; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1483; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1483; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.dup");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1486 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_close); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1486; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1486; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1487 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1487; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_1;
  __pyx_1 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.close");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_4type___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_4type___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_type); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1491; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.type.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_6family___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_6family___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1495; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.family.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_5proto___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_5proto___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_proto); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1499; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.proto.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_7_sslobj___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_7_sslobj___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_8_sslsock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_8_sslsock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_7keyfile___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_7keyfile___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_keyfile); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1519; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.keyfile.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_8certfile___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_8certfile___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_cerfile); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1523; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.certfile.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_9cert_reqs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_9cert_reqs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_cert_reqs); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1527; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.cert_reqs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_11ssl_version___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_11ssl_version___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ssl_version); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1531; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.ssl_version.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_8ca_certs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_8ca_certs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ca_certs); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1535; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.ca_certs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_do_handshake_on_connect); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1539; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake_on_connect.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__suppress_ragged_eofs); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1543; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.suppress_ragged_eofs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_14_makefile_refs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_14_makefile_refs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__makefile_refs); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1547; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket._makefile_refs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_7timeout___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_7timeout___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1555; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.timeout.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_setsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1558; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1558; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1558; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.setsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_getsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1561; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1561; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1561; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_getsockname); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1564; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1564; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1564; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getsockname");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_getpeername); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1567; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1567; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1567; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getpeername");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_bind); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1570; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1570; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1570; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.bind");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_listen); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1573; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1573; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1573; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.listen");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1579; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.gettimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_is_blocking = 0;
  PyObject *__pyx_r;
  int __pyx_1;
  float __pyx_2;
  static char *__pyx_argnames[] = {"is_blocking",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_is_blocking)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_is_blocking);
  __pyx_1 = PyObject_IsTrue(__pyx_v_is_blocking); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1582; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyFloat_AsDouble(Py_None); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1583; goto __pyx_L1;}
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = __pyx_2;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1585 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = 0.0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1586 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_sec = 0;
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_usec = 0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbsslsocket.setblocking");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_is_blocking);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  float __pyx_v_timeout_float;
  PyObject *__pyx_r;
  int __pyx_1;
  float __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_timeout);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1590 */
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    __pyx_2 = PyFloat_AsDouble(Py_None); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1591; goto __pyx_L1;}
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = __pyx_2;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1593 */
    __pyx_2 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1593; goto __pyx_L1;}
    __pyx_v_timeout_float = __pyx_2;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1594 */
    __pyx_1 = (__pyx_v_timeout_float < 0.0);
    if (__pyx_1) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1595; goto __pyx_L1;}
      Py_INCREF(__pyx_k52p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k52p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1595; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1595; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1596 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->timeout_value = __pyx_v_timeout_float;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1597 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_sec = ((unsigned int)__pyx_v_timeout_float);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1598 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_usec = ((unsigned int)((__pyx_v_timeout_float - ((float)((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->tv.tv_sec)) * 1000000.0));
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.settimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_read[] = "Emulate ssl.SSLSocket.read, doesn\'t make much sense.";
static PyObject *__pyx_f_4coio_11nbsslsocket_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_len = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  static char *__pyx_argnames[] = {"len",0};
  __pyx_v_len = __pyx_d21;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_len)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_len);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_read); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1605; goto __pyx_L4;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1605; goto __pyx_L4;}
      Py_INCREF(__pyx_v_len);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_len);
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1605; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1606 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1606; goto __pyx_L1;}
    __pyx_5 = PyErr_ExceptionMatches(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.read");
      if (__Pyx_GetException(&__pyx_3, &__pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1606; goto __pyx_L1;}
      Py_INCREF(__pyx_4);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_4;
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1607; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1607; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1607; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __pyx_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1608; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1609; goto __pyx_L1;}
      __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1609; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1609; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_5) {
        __pyx_7 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1610; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1611; goto __pyx_L1;}
      __pyx_8 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_EOF); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1611; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_8, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1611; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_8); __pyx_8 = 0;
      __pyx_6 = PyInt_FromLong(__pyx_5); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1611; goto __pyx_L1;}
      __pyx_5 = PyObject_IsTrue(__pyx_6); if (__pyx_5 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1611; goto __pyx_L1;}
      if (__pyx_5) {
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_suppress_ragged_eofs); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1612; goto __pyx_L1;}
      }
      __pyx_5 = PyObject_IsTrue(__pyx_6); if (__pyx_5 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1611; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_5) {
        Py_INCREF(__pyx_k23p);
        __pyx_r = __pyx_k23p;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        goto __pyx_L0;
        goto __pyx_L6;
      }
      /*else*/ {
        __Pyx_Raise(__pyx_3, __pyx_4, __pyx_2);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1615; goto __pyx_L1;}
      }
      __pyx_L6:;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("coio.nbsslsocket.read");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_len);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_write[] = "Emulate ssl.SSLSocket.write, doesn\'t make much sense.";
static PyObject *__pyx_f_4coio_11nbsslsocket_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"data",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_data)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_write); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1621; goto __pyx_L4;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1621; goto __pyx_L4;}
      Py_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1621; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1622 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1622; goto __pyx_L1;}
    __pyx_5 = PyErr_ExceptionMatches(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.write");
      if (__Pyx_GetException(&__pyx_3, &__pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1622; goto __pyx_L1;}
      Py_INCREF(__pyx_4);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_4;
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1623; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1623; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1623; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __pyx_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1624; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1625; goto __pyx_L1;}
      __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1625; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1625; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_5) {
        __pyx_7 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1626; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L6;
      }
      /*else*/ {
        __Pyx_Raise(__pyx_3, __pyx_4, __pyx_2);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1628; goto __pyx_L1;}
      }
      __pyx_L6:;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.write");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_asock;
  PyObject *__pyx_v_addr;
  PyObject *__pyx_v_esock;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_asock = Py_None; Py_INCREF(Py_None);
  __pyx_v_addr = Py_None; Py_INCREF(Py_None);
  __pyx_v_esock = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1631 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1631; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1632 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1634 */
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_accept); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1634; goto __pyx_L4;}
      __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1634; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyObject_GetIter(__pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1634; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = __Pyx_UnpackItem(__pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1634; goto __pyx_L4;}
      Py_DECREF(__pyx_v_asock);
      __pyx_v_asock = __pyx_3;
      __pyx_3 = 0;
      __pyx_3 = __Pyx_UnpackItem(__pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1634; goto __pyx_L4;}
      Py_DECREF(__pyx_v_addr);
      __pyx_v_addr = __pyx_3;
      __pyx_3 = 0;
      if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1634; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1635 */
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1635; goto __pyx_L4;}
      Py_INCREF(__pyx_v_self);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_self);
      __pyx_2 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1635; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1635; goto __pyx_L4;}
      Py_INCREF(__pyx_v_asock);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_asock);
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1635; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_esock);
      __pyx_v_esock = __pyx_4;
      __pyx_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1636 */
      __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1636; goto __pyx_L4;}
      Py_INCREF(__pyx_v_esock);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_esock);
      Py_INCREF(__pyx_v_addr);
      PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_addr);
      __pyx_r = __pyx_2;
      __pyx_2 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1637 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1637; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_error); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1637; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_4);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.accept");
      if (__Pyx_GetException(&__pyx_2, &__pyx_3, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1637; goto __pyx_L1;}
      Py_INCREF(__pyx_3);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_3;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1638 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1638; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1638; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1638; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_2, __pyx_3, __pyx_4);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1639; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1640 */
      if (!__Pyx_TypeTest(__pyx_v_self, __pyx_ptype_4coio_nbsocket)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1640; goto __pyx_L1;}
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1640; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.accept");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_asock);
  Py_DECREF(__pyx_v_addr);
  Py_DECREF(__pyx_v_esock);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1643 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n__sslobj); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1643; goto __pyx_L1;}
  __pyx_2 = PyObject_IsTrue(__pyx_1); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1643; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_2) {
    __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1644; goto __pyx_L1;}
    Py_INCREF(__pyx_k79p);
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_k79p);
    __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1644; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_Raise(__pyx_3, 0, 0);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1644; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1648 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1648; goto __pyx_L1;}
  __pyx_2 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1648; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address,__pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1648; goto __pyx_L1;}
  Py_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_3;
  __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1650 */
  while (1) {
    __pyx_4 = 1;
    if (!__pyx_4) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1651 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_connect_ex); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1651; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1651; goto __pyx_L1;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_address);
    __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1651; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_5;
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1652 */
    __pyx_2 = PyObject_IsTrue(__pyx_v_err); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1652; goto __pyx_L1;}
    if (__pyx_2) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1653 */
      __pyx_1 = PyInt_FromLong(EAGAIN); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1653; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_v_err, __pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1653; goto __pyx_L1;}
      __pyx_2 = __pyx_2 != 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      if (__pyx_2) {
        __pyx_3 = PyInt_FromLong(EINPROGRESS); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1653; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_v_err, __pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1653; goto __pyx_L1;}
        __pyx_2 = __pyx_2 != 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
      }
      if (__pyx_2) {
        __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1654; goto __pyx_L1;}
        __pyx_1 = PyObject_GetAttr(__pyx_5, __pyx_n_error); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1654; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __pyx_2 = PyInt_AsLong(__pyx_v_err); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1654; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(__pyx_2)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1654; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1654; goto __pyx_L1;}
        Py_INCREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_v_err);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_3);
        __pyx_3 = 0;
        __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1654; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_3, 0, 0);
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1654; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1655 */
      __pyx_1 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1655; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      goto __pyx_L5;
    }
    /*else*/ {
      goto __pyx_L4;
    }
    __pyx_L5:;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1659 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1659; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_5, __pyx_n__ssl); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1659; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_sslwrap); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1659; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_5 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_keyfile); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1660; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_certfile); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1661; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_cert_reqs); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1661; goto __pyx_L1;}
  __pyx_7 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ssl_version); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1662; goto __pyx_L1;}
  __pyx_8 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ca_certs); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1662; goto __pyx_L1;}
  __pyx_9 = PyTuple_New(7); if (!__pyx_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1659; goto __pyx_L1;}
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  PyTuple_SET_ITEM(__pyx_9, 0, ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  Py_INCREF(Py_False);
  PyTuple_SET_ITEM(__pyx_9, 1, Py_False);
  PyTuple_SET_ITEM(__pyx_9, 2, __pyx_5);
  PyTuple_SET_ITEM(__pyx_9, 3, __pyx_3);
  PyTuple_SET_ITEM(__pyx_9, 4, __pyx_6);
  PyTuple_SET_ITEM(__pyx_9, 5, __pyx_7);
  PyTuple_SET_ITEM(__pyx_9, 6, __pyx_8);
  __pyx_5 = 0;
  __pyx_3 = 0;
  __pyx_6 = 0;
  __pyx_7 = 0;
  __pyx_8 = 0;
  __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_9); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1659; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_9); __pyx_9 = 0;
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj, __pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1659; goto __pyx_L1;}
  Py_INCREF(__pyx_5);
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_5;
  Py_DECREF(__pyx_5); __pyx_5 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1664 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_do_handshake_on_connect); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1664; goto __pyx_L1;}
  __pyx_2 = PyObject_IsTrue(__pyx_3); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1664; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_2) {
    __pyx_6 = PyObject_GetAttr(__pyx_v_self, __pyx_n_do_handshake); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1665; goto __pyx_L1;}
    __pyx_7 = PyObject_CallObject(__pyx_6, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1665; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  __Pyx_AddTraceback("coio.nbsslsocket.connect");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_connect_ex[] = "Do a connect(2), and return 0 or the error code.\n\n        The implementation of connect_ex is not optimized for speed.\n\n        This is incompatible with SSLSocket.connect_ex, which doesn\'t do the\n        SSL handshake, and connects only the socket._realsocket.\n        \n        Returns:\n          0 on success; errno for socket.error and -800 - errno for\n          ssl.SSLError.\n        ";
static PyObject *__pyx_f_4coio_11nbsslsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1679 */
  /*try:*/ {
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connect); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1680; goto __pyx_L2;}
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1680; goto __pyx_L2;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_address);
    __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1680; goto __pyx_L2;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_1); __pyx_1 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1681 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1681; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_error); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1681; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_4 = PyErr_ExceptionMatches(__pyx_2);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_4) {
    __Pyx_AddTraceback("coio.connect_ex");
    if (__Pyx_GetException(&__pyx_3, &__pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1681; goto __pyx_L1;}
    Py_INCREF(__pyx_1);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_1;
    __pyx_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1682; goto __pyx_L1;}
    __pyx_r = __pyx_5;
    __pyx_5 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1683 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1683; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_5, __pyx_n_SSLError); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1683; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_4 = PyErr_ExceptionMatches(__pyx_3);
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_4) {
    __Pyx_AddTraceback("coio.connect_ex");
    if (__Pyx_GetException(&__pyx_1, &__pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1683; goto __pyx_L1;}
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_2;
    __pyx_3 = PyInt_FromLong((-800)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1684; goto __pyx_L1;}
    __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1684; goto __pyx_L1;}
    __pyx_7 = PyNumber_Subtract(__pyx_3, __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1684; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_r = __pyx_7;
    __pyx_7 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    goto __pyx_L0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    goto __pyx_L3;
  }
  goto __pyx_L1;
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1685 */
  __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1685; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.connect_ex");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_how = 0;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  static char *__pyx_argnames[] = {"how",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_how)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_how);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1689 */
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj, Py_None) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1689; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1690 */
  Py_INCREF(Py_None);
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = Py_None;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1691 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1692 */
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_shutdown); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1692; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1692; goto __pyx_L1;}
    Py_INCREF(__pyx_v_how);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_how);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1692; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_4;
    __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1693 */
    __pyx_2 = PyInt_FromLong(EAGAIN); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1693; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_v_err, __pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1693; goto __pyx_L1;}
    __pyx_5 = __pyx_5 != 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      Py_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1696 */
    if (!__Pyx_TypeTest(__pyx_v_self, __pyx_ptype_4coio_nbsocket)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1696; goto __pyx_L1;}
    __pyx_3 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1696; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.shutdown");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_how);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_pending); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1700; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1700; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.pending");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_unwrap(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_unwrap(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_s;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_s = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1703 */
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1703; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1704 */
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_shutdown); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1704; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1704; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_s);
    __pyx_v_s = __pyx_3;
    __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1705 */
    if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj, Py_None) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1705; goto __pyx_L1;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1706 */
    Py_INCREF(Py_None);
    Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = Py_None;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1707 */
    Py_INCREF(__pyx_v_s);
    __pyx_r = __pyx_v_s;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1708 */
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1708; goto __pyx_L1;}
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  PyTuple_SET_ITEM(__pyx_2, 0, ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __pyx_3 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1708; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyNumber_Add(__pyx_k86p, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1708; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1708; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1708; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_Raise(__pyx_2, 0, 0);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1708; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.unwrap");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_s);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_do_handshake(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_do_handshake(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1713 */
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_do_handshake); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1713; goto __pyx_L4;}
      __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1713; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1714 */
      __pyx_r = Py_None; Py_INCREF(Py_None);
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1715 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1715; goto __pyx_L1;}
    __pyx_4 = PyErr_ExceptionMatches(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_4) {
      __Pyx_AddTraceback("coio.do_handshake");
      if (__Pyx_GetException(&__pyx_3, &__pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1715; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1716; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1716; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1716; goto __pyx_L1;}
      __pyx_4 = __pyx_4 == 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_4) {
        __pyx_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1717; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1718; goto __pyx_L1;}
      __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1718; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1718; goto __pyx_L1;}
      __pyx_4 = __pyx_4 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_4) {
        __pyx_7 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1719; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L6;
      }
      /*else*/ {
        __Pyx_Raise(__pyx_3, __pyx_2, __pyx_5);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1721; goto __pyx_L1;}
      }
      __pyx_L6:;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getpeercert(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getpeercert(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_binary_form = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"binary_form",0};
  __pyx_v_binary_form = __pyx_d22;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_binary_form)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_binary_form);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_peer_certificate); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1724; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1724; goto __pyx_L1;}
  Py_INCREF(__pyx_v_binary_form);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_binary_form);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1724; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getpeercert");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_binary_form);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_cipher(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_cipher(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1727; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_cipher); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1730; goto __pyx_L1;}
    __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1730; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.cipher");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_recv[] = "Receive data from the SSL or non-SSL connection.\n\n        The defaults for buflen and flags are the same as in ssl.SSLSocket.\n        ";
static PyObject *__pyx_f_4coio_11nbsslsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_buflen;
  int __pyx_v_flags;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  static char *__pyx_argnames[] = {"buflen","flags",0};
  __pyx_v_buflen = __pyx_d23;
  __pyx_v_flags = __pyx_d24;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|ii", __pyx_argnames, &__pyx_v_buflen, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1737 */
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1737; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1738 */
    __pyx_1 = __pyx_v_flags;
    if (__pyx_1) {
      __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n___class__); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1740; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1740; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
      __pyx_2 = 0;
      __pyx_2 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1740; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyNumber_Add(__pyx_k89p, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1740; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1739; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
      __pyx_3 = 0;
      __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1739; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_3, 0, 0);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1739; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1741 */
    while (1) {
      __pyx_4 = 1;
      if (!__pyx_4) break;
      /*try:*/ {
        __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_read); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1743; goto __pyx_L6;}
        __pyx_3 = PyInt_FromLong(__pyx_v_buflen); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1743; goto __pyx_L6;}
        __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1743; goto __pyx_L6;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
        __pyx_3 = 0;
        __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1743; goto __pyx_L6;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __pyx_r = __pyx_3;
        __pyx_3 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L7;
      __pyx_L6:;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1744 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1744; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      if (__pyx_1) {
        __Pyx_AddTraceback("coio.recv");
        if (__Pyx_GetException(&__pyx_5, &__pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1744; goto __pyx_L1;}
        Py_INCREF(__pyx_3);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_3;
        __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1745; goto __pyx_L1;}
        __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1745; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1745; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        if (__pyx_1) {
          __pyx_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1746; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          goto __pyx_L8;
        }
        __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1747; goto __pyx_L1;}
        __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1747; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1747; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        if (__pyx_1) {
          __pyx_7 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1748; goto __pyx_L1;}
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          goto __pyx_L8;
        }
        __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1749; goto __pyx_L1;}
        __pyx_8 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_EOF); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1749; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_7, __pyx_8, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1749; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        __pyx_6 = PyInt_FromLong(__pyx_1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1749; goto __pyx_L1;}
        __pyx_1 = PyObject_IsTrue(__pyx_6); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1749; goto __pyx_L1;}
        if (__pyx_1) {
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_suppress_ragged_eofs); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1750; goto __pyx_L1;}
        }
        __pyx_1 = PyObject_IsTrue(__pyx_6); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1749; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        if (__pyx_1) {
          Py_INCREF(__pyx_k23p);
          __pyx_r = __pyx_k23p;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          goto __pyx_L0;
          goto __pyx_L8;
        }
        /*else*/ {
          __Pyx_Raise(__pyx_5, __pyx_3, __pyx_2);
          {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1753; goto __pyx_L1;}
        }
        __pyx_L8:;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        goto __pyx_L7;
      }
      goto __pyx_L1;
      __pyx_L7:;
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1754 */
  while (1) {
    __pyx_4 = 1;
    if (!__pyx_4) break;
    /*try:*/ {
      __pyx_7 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recv); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1756; goto __pyx_L11;}
      __pyx_8 = PyInt_FromLong(__pyx_v_buflen); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1756; goto __pyx_L11;}
      __pyx_6 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1756; goto __pyx_L11;}
      __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1756; goto __pyx_L11;}
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_8);
      PyTuple_SET_ITEM(__pyx_5, 1, __pyx_6);
      __pyx_8 = 0;
      __pyx_6 = 0;
      __pyx_3 = PyObject_CallObject(__pyx_7, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1756; goto __pyx_L11;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_r = __pyx_3;
      __pyx_3 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L12;
    __pyx_L11:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_8); __pyx_8 = 0;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1757 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1757; goto __pyx_L1;}
    __pyx_8 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1757; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = PyErr_ExceptionMatches(__pyx_8);
    Py_DECREF(__pyx_8); __pyx_8 = 0;
    if (__pyx_1) {
      __Pyx_AddTraceback("coio.recv");
      if (__Pyx_GetException(&__pyx_6, &__pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1757; goto __pyx_L1;}
      Py_INCREF(__pyx_7);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_7;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1758 */
      __pyx_3 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1758; goto __pyx_L1;}
      __pyx_2 = PyInt_FromLong(EAGAIN); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1758; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_3, __pyx_2, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1758; goto __pyx_L1;}
      __pyx_1 = __pyx_1 != 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      if (__pyx_1) {
        __Pyx_Raise(__pyx_6, __pyx_7, __pyx_5);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1759; goto __pyx_L1;}
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1760 */
      __pyx_8 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_READ); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1760; goto __pyx_L1;}
      Py_DECREF(__pyx_8); __pyx_8 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      goto __pyx_L12;
    }
    goto __pyx_L1;
    __pyx_L12:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("coio.nbsslsocket.recv");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1763 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1763; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1764 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1766; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1766; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1766; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1767 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1767; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1767; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.recvfrom");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1767; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1768 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1768; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1768; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1768; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1769; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1770 */
      if (!__Pyx_TypeTest(__pyx_v_self, __pyx_ptype_4coio_nbsocket)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1770; goto __pyx_L1;}
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1770; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.recvfrom");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1773 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1773; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1774 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recv_into); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1776; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1776; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1776; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1777 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1777; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1777; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.recv_into");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1777; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1778 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1778; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1778; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1778; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1779; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1780 */
      if (!__Pyx_TypeTest(__pyx_v_self, __pyx_ptype_4coio_nbsocket)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1780; goto __pyx_L1;}
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1780; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.recv_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1783 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1783; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1784 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom_into); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1786; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1786; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1786; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1787 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1787; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1787; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.recvfrom_into");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1787; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1788 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1788; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1788; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1788; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1789; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1790 */
      if (!__Pyx_TypeTest(__pyx_v_self, __pyx_ptype_4coio_nbsocket)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1790; goto __pyx_L1;}
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1790; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.recvfrom_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"data","flags",0};
  __pyx_v_flags = __pyx_d25;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_data, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1793 */
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1793; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1794 */
    __pyx_1 = __pyx_v_flags;
    if (__pyx_1) {
      __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n___class__); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1796; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1796; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
      __pyx_2 = 0;
      __pyx_2 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1796; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyNumber_Add(__pyx_k91p, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1796; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1795; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
      __pyx_3 = 0;
      __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1795; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_3, 0, 0);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1795; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1797 */
    while (1) {
      __pyx_4 = 1;
      if (!__pyx_4) break;
      /*try:*/ {
        __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_write); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1799; goto __pyx_L6;}
        __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1799; goto __pyx_L6;}
        Py_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
        __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1799; goto __pyx_L6;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_r = __pyx_5;
        __pyx_5 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L7;
      __pyx_L6:;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1800 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1800; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      if (__pyx_1) {
        __Pyx_AddTraceback("coio.send");
        if (__Pyx_GetException(&__pyx_3, &__pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1800; goto __pyx_L1;}
        Py_INCREF(__pyx_5);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_5;
        __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1801; goto __pyx_L1;}
        __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1801; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1801; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        if (__pyx_1) {
          __pyx_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1802; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          goto __pyx_L8;
        }
        __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1803; goto __pyx_L1;}
        __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1803; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1803; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        if (__pyx_1) {
          __pyx_7 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1804; goto __pyx_L1;}
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          goto __pyx_L8;
        }
        /*else*/ {
          __Pyx_Raise(__pyx_3, __pyx_5, __pyx_2);
          {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1806; goto __pyx_L1;}
        }
        __pyx_L8:;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        goto __pyx_L7;
      }
      goto __pyx_L1;
      __pyx_L7:;
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1807 */
  while (1) {
    __pyx_4 = 1;
    if (!__pyx_4) break;
    /*try:*/ {
      __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1809; goto __pyx_L11;}
      __pyx_7 = __Pyx_GetName(__pyx_b, __pyx_n_args); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1809; goto __pyx_L11;}
      __pyx_3 = PySequence_Tuple(__pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1809; goto __pyx_L11;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      __pyx_5 = PyObject_CallObject(__pyx_6, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1809; goto __pyx_L11;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_5;
      __pyx_5 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L12;
    __pyx_L11:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1810 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1810; goto __pyx_L1;}
    __pyx_7 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1810; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = PyErr_ExceptionMatches(__pyx_7);
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    if (__pyx_1) {
      __Pyx_AddTraceback("coio.send");
      if (__Pyx_GetException(&__pyx_6, &__pyx_3, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1810; goto __pyx_L1;}
      Py_INCREF(__pyx_3);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_3;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1811 */
      __pyx_2 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1811; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1811; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_2, __pyx_7, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1811; goto __pyx_L1;}
      __pyx_1 = __pyx_1 != 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_1) {
        __Pyx_Raise(__pyx_6, __pyx_3, __pyx_5);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1812; goto __pyx_L1;}
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1813 */
      __pyx_2 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1813; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      goto __pyx_L12;
    }
    goto __pyx_L1;
    __pyx_L12:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.send");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1816 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1816; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1817 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_sendto); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1819; goto __pyx_L4;}
      __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1819; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1819; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1820 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1820; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_error); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1820; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("coio.sendto");
      if (__Pyx_GetException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1820; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1821 */
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1821; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1821; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1821; goto __pyx_L1;}
      __pyx_5 = __pyx_5 != 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __Pyx_Raise(__pyx_4, __pyx_2, __pyx_3);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1822; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1823 */
      if (!__Pyx_TypeTest(__pyx_v_self, __pyx_ptype_4coio_nbsocket)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1823; goto __pyx_L1;}
      __pyx_6 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1823; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.sendto");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  int __pyx_v_got;
  int __pyx_v_got2;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  Py_ssize_t __pyx_8;
  static char *__pyx_argnames[] = {"data","flags",0};
  __pyx_v_flags = __pyx_d26;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_data, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1828 */
  __pyx_v_got = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1829 */
  Py_INCREF(__pyx_v_data);
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_v_data;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1830 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_data); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1830; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1831 */
    __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1831; goto __pyx_L1;}
    if (__pyx_1) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1832 */
      __pyx_1 = __pyx_v_flags;
      if (__pyx_1) {
        __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n___class__); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1835; goto __pyx_L1;}
        __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1835; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
        __pyx_2 = 0;
        __pyx_2 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1835; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_3 = PyNumber_Add(__pyx_k93p, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1834; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1833; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
        __pyx_3 = 0;
        __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1833; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_Raise(__pyx_3, 0, 0);
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1833; goto __pyx_L1;}
        goto __pyx_L4;
      }
      __pyx_L4:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1836 */
      while (1) {
        __pyx_4 = 1;
        if (!__pyx_4) break;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1837 */
        /*try:*/ {
          __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_write); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1838; goto __pyx_L7;}
          __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1838; goto __pyx_L7;}
          Py_INCREF(__pyx_v_buf);
          PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_buf);
          __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1838; goto __pyx_L7;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_1 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1838; goto __pyx_L7;}
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          __pyx_v_got2 = __pyx_1;
        }
        goto __pyx_L8;
        __pyx_L7:;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        Py_XDECREF(__pyx_5); __pyx_5 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1839 */
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1839; goto __pyx_L1;}
        __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        if (__pyx_1) {
          __Pyx_AddTraceback("coio.sendall");
          if (__Pyx_GetException(&__pyx_3, &__pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1839; goto __pyx_L1;}
          Py_INCREF(__pyx_5);
          Py_DECREF(__pyx_v_e);
          __pyx_v_e = __pyx_5;
          __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1840; goto __pyx_L1;}
          __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1840; goto __pyx_L1;}
          if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1840; goto __pyx_L1;}
          __pyx_1 = __pyx_1 == 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          if (__pyx_1) {
            __pyx_6 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1841; goto __pyx_L1;}
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            goto __pyx_L9;
          }
          __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1842; goto __pyx_L1;}
          __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1842; goto __pyx_L1;}
          if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1842; goto __pyx_L1;}
          __pyx_1 = __pyx_1 == 0;
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          if (__pyx_1) {
            __pyx_7 = __pyx_f_4coio_handle_ssl_eagain(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1843; goto __pyx_L1;}
            Py_DECREF(__pyx_7); __pyx_7 = 0;
            goto __pyx_L9;
          }
          /*else*/ {
            __Pyx_Raise(__pyx_3, __pyx_5, __pyx_2);
            {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1845; goto __pyx_L1;}
          }
          __pyx_L9:;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          goto __pyx_L8;
        }
        goto __pyx_L1;
        __pyx_L8:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1846 */
        #ifndef PYREX_WITHOUT_ASSERTIONS
        if (!(__pyx_v_got2 > 0)) {
          PyErr_SetNone(PyExc_AssertionError);
          {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1846; goto __pyx_L1;}
        }
        #endif

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1847 */
        __pyx_v_got += __pyx_v_got2;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1848 */
        __pyx_8 = PyObject_Length(__pyx_v_data); if (__pyx_8 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1848; goto __pyx_L1;}
        __pyx_1 = (__pyx_v_got >= __pyx_8);
        if (__pyx_1) {
          __pyx_r = Py_None; Py_INCREF(Py_None);
          goto __pyx_L0;
          goto __pyx_L10;
        }
        __pyx_L10:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1850 */
        __pyx_6 = PyInt_FromLong(__pyx_v_got); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1850; goto __pyx_L1;}
        __pyx_7 = PyTuple_New(2); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1850; goto __pyx_L1;}
        Py_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_v_data);
        PyTuple_SET_ITEM(__pyx_7, 1, __pyx_6);
        __pyx_6 = 0;
        __pyx_3 = PyObject_CallObject(((PyObject *)(&PyBuffer_Type)), __pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1850; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_v_buf);
        __pyx_v_buf = __pyx_3;
        __pyx_3 = 0;
      }
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1852 */
    while (1) {
      __pyx_4 = 1;
      if (!__pyx_4) break;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1853 */
      /*try:*/ {
        __pyx_5 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1854; goto __pyx_L13;}
        __pyx_2 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1854; goto __pyx_L13;}
        __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1854; goto __pyx_L13;}
        Py_INCREF(__pyx_v_buf);
        PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_buf);
        PyTuple_SET_ITEM(__pyx_6, 1, __pyx_2);
        __pyx_2 = 0;
        __pyx_7 = PyObject_CallObject(__pyx_5, __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1854; goto __pyx_L13;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_1 = PyInt_AsLong(__pyx_7); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1854; goto __pyx_L13;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_v_got2 = __pyx_1;
      }
      goto __pyx_L14;
      __pyx_L13:;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_7); __pyx_7 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1855 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1855; goto __pyx_L1;}
      __pyx_2 = PyObject_GetAttr(__pyx_3, __pyx_n_error); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1855; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      if (__pyx_1) {
        __Pyx_AddTraceback("coio.sendall");
        if (__Pyx_GetException(&__pyx_5, &__pyx_6, &__pyx_7) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1855; goto __pyx_L1;}
        Py_INCREF(__pyx_6);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_6;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1856 */
        __pyx_3 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1856; goto __pyx_L1;}
        __pyx_2 = PyInt_FromLong(EAGAIN); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1856; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_3, __pyx_2, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1856; goto __pyx_L1;}
        __pyx_1 = __pyx_1 != 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        if (__pyx_1) {
          __Pyx_Raise(__pyx_5, __pyx_6, __pyx_7);
          {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1857; goto __pyx_L1;}
          goto __pyx_L15;
        }
        __pyx_L15:;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1858 */
        if (!__Pyx_TypeTest(__pyx_v_self, __pyx_ptype_4coio_nbsocket)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1858; goto __pyx_L1;}
        __pyx_3 = __pyx_f_4coio_handle_eagain(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self),EV_WRITE); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1858; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L14;
      }
      goto __pyx_L1;
      __pyx_L14:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1859 */
      #ifndef PYREX_WITHOUT_ASSERTIONS
      if (!(__pyx_v_got2 > 0)) {
        PyErr_SetNone(PyExc_AssertionError);
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1859; goto __pyx_L1;}
      }
      #endif

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1860 */
      __pyx_v_got += __pyx_v_got2;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1861 */
      __pyx_8 = PyObject_Length(__pyx_v_data); if (__pyx_8 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1861; goto __pyx_L1;}
      __pyx_1 = (__pyx_v_got >= __pyx_8);
      if (__pyx_1) {
        __pyx_r = Py_None; Py_INCREF(Py_None);
        goto __pyx_L0;
        goto __pyx_L16;
      }
      __pyx_L16:;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1865 */
      __pyx_2 = PyInt_FromLong(__pyx_v_got); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1865; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1865; goto __pyx_L1;}
      Py_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
      PyTuple_SET_ITEM(__pyx_3, 1, __pyx_2);
      __pyx_2 = 0;
      __pyx_5 = PyObject_CallObject(((PyObject *)(&PyBuffer_Type)), __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1865; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_5;
      __pyx_5 = 0;
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.sendall");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_makefile[] = "Create an nbfile (non-blocking file-like) object from self.\n\n        os.dup(self.fd) will be passed to the new nbfile object, and its\n        .close() method will close that file descriptor.\n\n        As of now, the returned file object is slow (uses a pure Python\n        implementation of socket._fileobject).\n\n        Args:\n          mode: \'r\', \'w\', \'r+\' etc. The default is mode\'r\', just as for\n            socket.socket.makefile.\n        ";
static PyObject *__pyx_f_4coio_11nbsslsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"mode","bufsize",0};
  __pyx_v_mode = __pyx_d27;
  __pyx_v_bufsize = __pyx_d28;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|Oi", __pyx_argnames, &__pyx_v_mode, &__pyx_v_bufsize)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_mode);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1882 */
  __pyx_1 = PyInt_FromLong(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1882; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__makefile_refs); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1882; goto __pyx_L1;}
  __pyx_3 = PyNumber_InPlaceAdd(__pyx_2, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1882; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__makefile_refs, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1882; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1883 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1883; goto __pyx_L1;}
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n__fileobject); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1883; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1883; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1883; goto __pyx_L1;}
  Py_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_self);
  Py_INCREF(__pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_2, 2, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyDict_New(); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1883; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_3, __pyx_n_close, Py_True) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1883; goto __pyx_L1;}
  __pyx_4 = PyEval_CallObjectWithKeywords(__pyx_1, __pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1883; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_r = __pyx_4;
  __pyx_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.makefile");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_new_realsocket(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_new_realsocket[] = "Non-blocking drop-in replacement for socket._realsocket.\n\n    The most important difference between socket.socket and socket._realsocket\n    is that socket._realsocket.close() closes the filehandle immediately,\n    while socket.socket.close() just breaks the reference.\n    ";
static PyObject *__pyx_f_4coio_new_realsocket(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  __pyx_1 = PySequence_Tuple(__pyx_v_args); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1893; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1893; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_setdoclose); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1893; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1893; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1893; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1893; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.new_realsocket");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_new_realsocket_fromfd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_new_realsocket_fromfd[] = "Non-blocking drop-in replacement for socket.fromfd.";
static PyObject *__pyx_f_4coio_new_realsocket_fromfd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket_fromfd); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_setdoclose); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyInt_FromLong(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
  __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1898; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.new_realsocket_fromfd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_7sleeper_sleep(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_7sleeper_sleep(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  float __pyx_v_duration;
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  struct timeval __pyx_v_tv;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"duration",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "f", __pyx_argnames, &__pyx_v_duration)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1909 */
  __pyx_1 = (__pyx_v_duration > 0);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1910 */
    __pyx_2 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1910; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
    __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_2);
    __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1911 */
    evtimer_set((&((struct __pyx_obj_4coio_sleeper *)__pyx_v_self)->wakeup_ev),__pyx_f_4coio_HandleCWakeup,((void *)__pyx_v_wakeup_tasklet));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1912 */
    event_add((&((struct __pyx_obj_4coio_sleeper *)__pyx_v_self)->wakeup_ev),NULL);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1914 */
    __pyx_v_tv.tv_sec = ((unsigned int)__pyx_v_duration);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1915 */
    __pyx_v_tv.tv_usec = ((unsigned int)((__pyx_v_duration - ((float)__pyx_v_tv.tv_sec)) * 1000000.0));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1917 */
    event_add((&((struct __pyx_obj_4coio_sleeper *)__pyx_v_self)->wakeup_ev),(&__pyx_v_tv));

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1918 */
    __pyx_2 = PyStackless_Schedule(Py_None,1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1918; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.sleeper.sleep");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_sleep(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_sleep[] = "Non-blocking drop-in replacement for time.sleep.";
static PyObject *__pyx_f_4coio_sleep(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  float __pyx_v_duration;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"duration",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "f", __pyx_argnames, &__pyx_v_duration)) return 0;
  __pyx_1 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_sleeper), 0); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1923; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_sleep); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1923; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyFloat_FromDouble(__pyx_v_duration); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1923; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1923; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_1);
  __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1923; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.sleep");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_fdopen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_fdopen[] = "Non-blocking, almost drop-in replacement for os.fdopen.";
static PyObject *__pyx_f_4coio_fdopen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  char __pyx_v_do_close;
  PyObject *__pyx_v_name = 0;
  int __pyx_v_read_fd;
  int __pyx_v_write_fd;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd","mode","bufsize","do_close","name",0};
  __pyx_v_mode = __pyx_d29;
  __pyx_v_bufsize = __pyx_d30;
  __pyx_v_do_close = __pyx_d31;
  __pyx_v_name = __pyx_d32;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i|OibO", __pyx_argnames, &__pyx_v_fd, &__pyx_v_mode, &__pyx_v_bufsize, &__pyx_v_do_close, &__pyx_v_name)) return 0;
  Py_INCREF(__pyx_v_mode);
  Py_INCREF(__pyx_v_name);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1931 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (!(__pyx_v_fd >= 0)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1931; goto __pyx_L1;}
  }
  #endif

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1932 */
  __pyx_f_4coio_set_fd_nonblocking(__pyx_v_fd);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1933 */
  __pyx_v_read_fd = __pyx_v_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1934 */
  __pyx_v_write_fd = __pyx_v_fd;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1936 */
  if (PyObject_Cmp(__pyx_v_mode, __pyx_n_r, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1936; goto __pyx_L1;}
  __pyx_1 = __pyx_1 == 0;
  if (__pyx_1) {
    __pyx_v_write_fd = (-1);
    goto __pyx_L2;
  }
  if (PyObject_Cmp(__pyx_v_mode, __pyx_n_w, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1938; goto __pyx_L1;}
  __pyx_1 = __pyx_1 == 0;
  if (__pyx_1) {
    __pyx_v_read_fd = (-1);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1940 */
  __pyx_2 = PyInt_FromLong(__pyx_v_read_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(__pyx_v_write_fd); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_2 = PyDict_New(); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_write_buffer_limit, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyInt_FromLong(__pyx_v_do_close); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1941; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_do_close, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyDict_SetItem(__pyx_2, __pyx_n_mode, __pyx_v_mode) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  __pyx_3 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_nbfile), __pyx_4, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1940; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.fdopen");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_mode);
  Py_DECREF(__pyx_v_name);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_init(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_init[] = "Initialize async DNS resolver unless already intitialized.\n\n    The resolver functions call this automatically if needed.    \n    ";
static PyObject *__pyx_f_4coio_dns_init(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 108; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":109 */
    evdns_init();

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":110 */
    __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 110; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.dns_init");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_init_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_init_force[] = "Initialize async DNS resolver, force reinit";
static PyObject *__pyx_f_4coio_dns_init_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":114 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 114; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":115 */
    evdns_shutdown(1);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":116 */
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 116; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":117 */
  evdns_init();

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":118 */
  __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 118; goto __pyx_L1;}
  Py_DECREF(__pyx_v_dns_initialized);
  __pyx_v_dns_initialized = __pyx_2;
  __pyx_2 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.dns_init_force");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_shutdown(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_shutdown[] = "Shutdown the async DNS resolver and terminate all active requests.";
static PyObject *__pyx_f_4coio_dns_shutdown(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fail_requests;
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"fail_requests",0};
  __pyx_v_fail_requests = __pyx_d33;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|i", __pyx_argnames, &__pyx_v_fail_requests)) return 0;
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 122; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":123 */
    evdns_shutdown(__pyx_v_fail_requests);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":124 */
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.dns_shutdown");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult_1t___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult_1t___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 142; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dnsresult.t.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult_3ttl___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult_3ttl___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 146; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dnsresult.ttl.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult_6values___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult_6values___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  __pyx_r = ((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_9dnsresult___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_9dnsresult___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char __pyx_v_t;
  int __pyx_v_ttl;
  PyListObject *__pyx_v_values = 0;
  int __pyx_r;
  static char *__pyx_argnames[] = {"t","ttl","values",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "biO", __pyx_argnames, &__pyx_v_t, &__pyx_v_ttl, &__pyx_v_values)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_values);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_values), (&PyList_Type), 1, "values")) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 152; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":153 */
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t = __pyx_v_t;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":154 */
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl = __pyx_v_ttl;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":155 */
  Py_INCREF(((PyObject *)__pyx_v_values));
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values = __pyx_v_values;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.dnsresult.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_values);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 159; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 159; goto __pyx_L1;}
  __pyx_3 = PyLong_FromUnsignedLong(((unsigned int)__pyx_v_self)); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 159; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(4); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 159; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_2);
  Py_INCREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  PyTuple_SET_ITEM(__pyx_4, 2, ((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  PyTuple_SET_ITEM(__pyx_4, 3, __pyx_3);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_1 = PyNumber_Remainder(__pyx_k99p, __pyx_4); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 158; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.dnsresult.__repr__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_format_ipv6_word(unsigned int __pyx_v_hi,unsigned int __pyx_v_lo) {
  PyObject *__pyx_r;
  unsigned int __pyx_1;
  PyObject *__pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":162 */
  __pyx_v_lo += (__pyx_v_hi << 8);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":163 */
  __pyx_1 = __pyx_v_lo;
  if (__pyx_1) {
    __pyx_2 = PyString_FromFormat(((char const*)__pyx_k100),__pyx_v_lo); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 165; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(__pyx_k23p);
    __pyx_r = __pyx_k23p;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.format_ipv6_word");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static void __pyx_f_4coio__dns_callback(int __pyx_v_resultcode,char __pyx_v_t,int __pyx_v_count,int __pyx_v_ttl,void *__pyx_v_addrs,void *__pyx_v_arg) {
  PyObject *__pyx_v_exc;
  int __pyx_v_i;
  unsigned char *__pyx_v_p;
  PyListObject *__pyx_v_xlist;
  PyObject *__pyx_v_x;
  PyObject *__pyx_v_words;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  int __pyx_6;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  PyObject *__pyx_11 = 0;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_v_exc = Py_None; Py_INCREF(Py_None);
  __pyx_v_xlist = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_x = Py_None; Py_INCREF(Py_None);
  __pyx_v_words = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":182 */
  __pyx_1 = __pyx_v_resultcode;
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":185 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong((-__pyx_v_resultcode)); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
    __pyx_4 = PyString_FromString(evdns_err_to_string(__pyx_v_resultcode)); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
    __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
    __pyx_3 = 0;
    __pyx_4 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_v_exc);
    __pyx_v_exc = __pyx_3;
    __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":186 */
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 187; goto __pyx_L1;}
    Py_INCREF(__pyx_v_exc);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_exc);
    __pyx_2 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 187; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyTuple_New(3); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 186; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
    Py_INCREF(__pyx_v_exc);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_v_exc);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_5, 2, Py_None);
    __pyx_2 = 0;
    __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_bomb), __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 186; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_3;
    __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":188 */
    __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; goto __pyx_L1;}

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":189 */
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":190 */
  __pyx_1 = (__pyx_v_t == DNS_IPv4_A);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_count > 0);
  }
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":191 */
    __pyx_4 = PyList_New(0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 191; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_4, (&PyList_Type))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 191; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_xlist));
    __pyx_v_xlist = ((PyListObject *)__pyx_4);
    __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":192 */
    __pyx_v_p = ((unsigned char *)__pyx_v_addrs);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":193 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_count; ++__pyx_v_i) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":195 */
      __pyx_2 = PyString_FromFormat(((char const*)__pyx_k102),(__pyx_v_p[0]),(__pyx_v_p[1]),(__pyx_v_p[2]),(__pyx_v_p[3])); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 195; goto __pyx_L1;}
      __pyx_6 = PyList_Append(((PyObject *)__pyx_v_xlist),__pyx_2); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 195; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":197 */
      __pyx_v_p += 4;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":198 */
    Py_INCREF(((PyObject *)__pyx_v_xlist));
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = ((PyObject *)__pyx_v_xlist);
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_t == DNS_IPv6_AAAA);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_count > 0);
  }
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":200 */
    __pyx_5 = PyList_New(0); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 200; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, (&PyList_Type))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 200; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_xlist));
    __pyx_v_xlist = ((PyListObject *)__pyx_5);
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":201 */
    __pyx_v_p = ((unsigned char *)__pyx_v_addrs);

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":202 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_count; ++__pyx_v_i) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":203 */
      __pyx_3 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[0]),(__pyx_v_p[1])); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 203; goto __pyx_L1;}
      __pyx_4 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[2]),(__pyx_v_p[3])); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 204; goto __pyx_L1;}
      __pyx_2 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[4]),(__pyx_v_p[5])); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 205; goto __pyx_L1;}
      __pyx_5 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[6]),(__pyx_v_p[7])); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 206; goto __pyx_L1;}
      __pyx_7 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[8]),(__pyx_v_p[9])); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 207; goto __pyx_L1;}
      __pyx_8 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[10]),(__pyx_v_p[11])); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 208; goto __pyx_L1;}
      __pyx_9 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[12]),(__pyx_v_p[13])); if (!__pyx_9) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 209; goto __pyx_L1;}
      __pyx_10 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[14]),(__pyx_v_p[15])); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 210; goto __pyx_L1;}
      __pyx_11 = PyList_New(8); if (!__pyx_11) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 203; goto __pyx_L1;}
      PyList_SET_ITEM(__pyx_11, 0, __pyx_3);
      PyList_SET_ITEM(__pyx_11, 1, __pyx_4);
      PyList_SET_ITEM(__pyx_11, 2, __pyx_2);
      PyList_SET_ITEM(__pyx_11, 3, __pyx_5);
      PyList_SET_ITEM(__pyx_11, 4, __pyx_7);
      PyList_SET_ITEM(__pyx_11, 5, __pyx_8);
      PyList_SET_ITEM(__pyx_11, 6, __pyx_9);
      PyList_SET_ITEM(__pyx_11, 7, __pyx_10);
      __pyx_3 = 0;
      __pyx_4 = 0;
      __pyx_2 = 0;
      __pyx_5 = 0;
      __pyx_7 = 0;
      __pyx_8 = 0;
      __pyx_9 = 0;
      __pyx_10 = 0;
      Py_DECREF(__pyx_v_words);
      __pyx_v_words = __pyx_11;
      __pyx_11 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":211 */
      __pyx_v_p += 16;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":212 */
      __pyx_3 = PyObject_GetAttr(__pyx_k103p, __pyx_n_join); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
      __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
      Py_INCREF(__pyx_v_words);
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_words);
      __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_6 = PyList_Append(((PyObject *)__pyx_v_xlist),__pyx_2); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":213 */
    Py_INCREF(((PyObject *)__pyx_v_xlist));
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = ((PyObject *)__pyx_v_xlist);
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_t == DNS_PTR);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_count == 1);
  }
  if (__pyx_1) {
    __pyx_5 = PyString_FromString((((char const* *)__pyx_v_addrs)[0])); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 215; goto __pyx_L1;}
    __pyx_7 = PyList_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 215; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_7, 0, __pyx_5);
    __pyx_5 = 0;
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = __pyx_7;
    __pyx_7 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
    Py_INCREF(Py_None);
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = Py_None;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":218 */
  __pyx_1 = __pyx_v_x == Py_None;
  if (__pyx_1) {
    __pyx_8 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 220; goto __pyx_L1;}
    __pyx_9 = PyTuple_New(3); if (!__pyx_9) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 219; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_9, 0, __pyx_8);
    Py_INCREF(__pyx_k106p);
    PyTuple_SET_ITEM(__pyx_9, 1, __pyx_k106p);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_9, 2, Py_None);
    __pyx_8 = 0;
    __pyx_10 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_bomb), __pyx_9); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 219; goto __pyx_L1;}
    Py_DECREF(__pyx_9); __pyx_9 = 0;
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_10;
    __pyx_10 = 0;
    goto __pyx_L8;
  }
  /*else*/ {
    __pyx_11 = PyInt_FromLong(__pyx_v_t); if (!__pyx_11) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 222; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(__pyx_v_ttl); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 222; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 222; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_11);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    Py_INCREF(__pyx_v_x);
    PyTuple_SET_ITEM(__pyx_4, 2, __pyx_v_x);
    __pyx_11 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_dnsresult), __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 222; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L8:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":223 */
  __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 223; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  Py_XDECREF(__pyx_11);
  __Pyx_WriteUnraisable("coio._dns_callback");
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc);
  Py_DECREF(__pyx_v_xlist);
  Py_DECREF(__pyx_v_x);
  Py_DECREF(__pyx_v_words);
  PyGILState_Release(_save);
}

static char __pyx_f_4coio_is_valid_hex_digit(char __pyx_v_p) {
  char __pyx_r;
  int __pyx_1;
  __pyx_1 = (__pyx_v_p >= '0');
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_p <= '9');
  }
  if (__pyx_1) {
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_1 = (__pyx_v_p >= 'a');
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_p <= 'f');
  }
  if (__pyx_1) {
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_1 = (__pyx_v_p >= 'A');
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_p <= 'F');
  }
  if (__pyx_1) {
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_r = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static char __pyx_f_4coio_is_valid_ipv6(char *__pyx_v_p) {
  int __pyx_v_i;
  char __pyx_r;
  int __pyx_1;
  char __pyx_2;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":240 */
  __pyx_1 = (!__pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0])));
  if (__pyx_1) {
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":242 */
  for (__pyx_v_i = 1; __pyx_v_i < 8; ++__pyx_v_i) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":243 */
    while (1) {
      __pyx_2 = __pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0]));
      if (!__pyx_2) break;
      __pyx_v_p += 1;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":245 */
    __pyx_1 = ((__pyx_v_p[0]) != ':');
    if (__pyx_1) {
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":247 */
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":248 */
  while (1) {
    __pyx_2 = __pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0]));
    if (!__pyx_2) break;
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":250 */
  __pyx_r = ((__pyx_v_p[0]) == '\0');
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static char __pyx_f_4coio_is_valid_ipv4(char *__pyx_v_p) {
  int __pyx_v_i;
  char __pyx_r;
  int __pyx_1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":254 */
  for (__pyx_v_i = 1; __pyx_v_i < 4; ++__pyx_v_i) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":255 */
    __pyx_1 = ((__pyx_v_p[0]) < '0');
    if (!__pyx_1) {
      __pyx_1 = ((__pyx_v_p[0]) > '9');
    }
    if (__pyx_1) {
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":257 */
    __pyx_v_p += 1;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":258 */
    while (1) {
      __pyx_1 = ((__pyx_v_p[0]) >= '0');
      if (__pyx_1) {
        __pyx_1 = ((__pyx_v_p[0]) <= '9');
      }
      if (!__pyx_1) break;
      __pyx_v_p += 1;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":260 */
    __pyx_1 = ((__pyx_v_p[0]) != '.');
    if (__pyx_1) {
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":262 */
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":263 */
  __pyx_1 = ((__pyx_v_p[0]) < '0');
  if (!__pyx_1) {
    __pyx_1 = ((__pyx_v_p[0]) > '9');
  }
  if (__pyx_1) {
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":265 */
  __pyx_v_p += 1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":266 */
  while (1) {
    __pyx_1 = ((__pyx_v_p[0]) >= '0');
    if (__pyx_1) {
      __pyx_1 = ((__pyx_v_p[0]) <= '9');
    }
    if (!__pyx_1) break;
    __pyx_v_p += 1;
  }

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":268 */
  __pyx_r = ((__pyx_v_p[0]) == '\0');
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static struct __pyx_obj_4coio_dnsresult *__pyx_f_4coio_dns_call(__pyx_t_4coio__evdns_call_t __pyx_v_call,char const* __pyx_v_name,int __pyx_v_flags) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_v_tempval;
  int __pyx_v_result;
  struct __pyx_obj_4coio_dnsresult *__pyx_v_dnsresult_obj;
  PyObject *__pyx_v_dns_initialized;
  struct __pyx_obj_4coio_dnsresult *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_tempval = Py_None; Py_INCREF(Py_None);
  __pyx_v_dnsresult_obj = ((struct __pyx_obj_4coio_dnsresult *)Py_None); Py_INCREF(Py_None);
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":275 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 275; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":276 */
    evdns_init();

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":277 */
    __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 277; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":278 */
  __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 278; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":279 */
  Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_wakeup_tasklet->tempval);
  __pyx_v_wakeup_tasklet->tempval = Py_None;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":280 */
  __pyx_v_result = __pyx_v_call(__pyx_v_name,__pyx_v_flags,__pyx_f_4coio__dns_callback,((void *)__pyx_v_wakeup_tasklet));

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":281 */
  __pyx_1 = __pyx_v_result;
  if (__pyx_1) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    __pyx_4 = __Pyx_GetName(__pyx_b, __pyx_n_err); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    __pyx_5 = PyNumber_Negative(__pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_4 = __Pyx_GetName(__pyx_b, __pyx_n_err); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    __pyx_2 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_4 = PyString_FromString(evdns_err_to_string(__pyx_2)); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_5);
    PyTuple_SET_ITEM(__pyx_6, 1, __pyx_4);
    __pyx_5 = 0;
    __pyx_4 = 0;
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_6); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __Pyx_Raise(__pyx_5, 0, 0);
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 282; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":283 */
  __pyx_1 = __pyx_v_wakeup_tasklet->tempval == Py_None;
  if (__pyx_1) {
    __pyx_4 = PyStackless_Schedule(Py_None,1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 284; goto __pyx_L1;}
    Py_DECREF(__pyx_v_tempval);
    __pyx_v_tempval = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":287 */
    Py_INCREF(__pyx_v_wakeup_tasklet->tempval);
    Py_DECREF(__pyx_v_tempval);
    __pyx_v_tempval = __pyx_v_wakeup_tasklet->tempval;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":288 */
    Py_INCREF(Py_None);
    Py_DECREF(__pyx_v_wakeup_tasklet->tempval);
    __pyx_v_wakeup_tasklet->tempval = Py_None;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":289 */
    __pyx_2 = PyObject_IsInstance(__pyx_v_tempval,((PyObject *)__pyx_ptype_4coio_bomb)); if (__pyx_2 == -1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 289; goto __pyx_L1;}
    if (__pyx_2) {
      __pyx_3 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_type); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 290; goto __pyx_L1;}
      __pyx_6 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_value); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 290; goto __pyx_L1;}
      __pyx_5 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_traceback); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 290; goto __pyx_L1;}
      __Pyx_Raise(__pyx_3, __pyx_6, __pyx_5);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 290; goto __pyx_L1;}
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":291 */
  if (!__Pyx_TypeTest(__pyx_v_tempval, __pyx_ptype_4coio_dnsresult)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 291; goto __pyx_L1;}
  Py_INCREF(__pyx_v_tempval);
  Py_DECREF(((PyObject *)__pyx_v_dnsresult_obj));
  __pyx_v_dnsresult_obj = ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_tempval);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":292 */
  __pyx_1 = (__pyx_v_call == (&evdns_resolve_ipv4));
  if (__pyx_1) {
    __pyx_4 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_t); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 293; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(DNS_IPv4_A); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 293; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_4, __pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 293; goto __pyx_L1;}
    __pyx_2 = __pyx_2 != 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_2) {
      __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 294; goto __pyx_L1;}
      __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 294; goto __pyx_L1;}
      Py_INCREF(__pyx_k111p);
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_k111p);
      __pyx_4 = PyObject_CallObject(__pyx_6, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 294; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 294; goto __pyx_L1;}
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L6;
  }
  __pyx_1 = (__pyx_v_call == (&evdns_resolve_ipv6));
  if (__pyx_1) {
    __pyx_3 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_t); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 296; goto __pyx_L1;}
    __pyx_6 = PyInt_FromLong(DNS_IPv6_AAAA); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 296; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_3, __pyx_6, &__pyx_2) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 296; goto __pyx_L1;}
    __pyx_2 = __pyx_2 != 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    if (__pyx_2) {
      __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 297; goto __pyx_L1;}
      __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 297; goto __pyx_L1;}
      Py_INCREF(__pyx_k112p);
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_k112p);
      __pyx_3 = PyObject_CallObject(__pyx_5, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 297; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __Pyx_Raise(__pyx_3, 0, 0);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 297; goto __pyx_L1;}
      goto __pyx_L8;
    }
    __pyx_L8:;
    goto __pyx_L6;
  }
  __pyx_1 = (__pyx_v_call == ((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse));
  if (!__pyx_1) {
    __pyx_1 = (__pyx_v_call == ((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse_ipv6));
  }
  if (__pyx_1) {
    __pyx_6 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_t); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 300; goto __pyx_L1;}
    __pyx_5 = PyInt_FromLong(DNS_PTR); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 300; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_6, __pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 300; goto __pyx_L1;}
    __pyx_2 = __pyx_2 != 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    if (__pyx_2) {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 301; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 301; goto __pyx_L1;}
      Py_INCREF(__pyx_k113p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k113p);
      __pyx_6 = PyObject_CallObject(__pyx_4, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 301; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_6, 0, 0);
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 301; goto __pyx_L1;}
      goto __pyx_L9;
    }
    __pyx_L9:;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":302 */
  Py_INCREF(((PyObject *)__pyx_v_dnsresult_obj));
  __pyx_r = __pyx_v_dnsresult_obj;
  goto __pyx_L0;

  __pyx_r = ((struct __pyx_obj_4coio_dnsresult *)Py_None); Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.dns_call");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_tempval);
  Py_DECREF(__pyx_v_dnsresult_obj);
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_resolve_ipv4(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_ipv4[] = "Lookup an A record (IPV4) for a given name.\n\n    Args:\n      name     -- DNS hostname\n      flags    -- either 0 (default) or DNS_QUERY_NO_SEARCH\n    Returns:\n      A dnsresult() object.\n    ";
static PyObject *__pyx_f_4coio_dns_resolve_ipv4(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  int __pyx_v_flags;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {"name","flags",0};
  __pyx_v_flags = __pyx_d34;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s|i", __pyx_argnames, &__pyx_v_name, &__pyx_v_flags)) return 0;
  __pyx_1 = ((PyObject *)__pyx_f_4coio_dns_call(evdns_resolve_ipv4,((char const*)__pyx_v_name),__pyx_v_flags)); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 313; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dns_resolve_ipv4");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_resolve_ipv6(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_ipv6[] = "Lookup an AAAA record (IPV6) for a given name.\n\n    Args:\n      name     -- DNS hostname\n      flags    -- either 0 (default) or DNS_QUERY_NO_SEARCH\n    Returns:\n      A dnsresult() object.\n    ";
static PyObject *__pyx_f_4coio_dns_resolve_ipv6(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  int __pyx_v_flags;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {"name","flags",0};
  __pyx_v_flags = __pyx_d35;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s|i", __pyx_argnames, &__pyx_v_name, &__pyx_v_flags)) return 0;
  __pyx_1 = ((PyObject *)__pyx_f_4coio_dns_call(evdns_resolve_ipv6,((char const*)__pyx_v_name),__pyx_v_flags)); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 324; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dns_resolve_ipv6");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_resolve_reverse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_reverse[] = "Lookup a PTR record for a given IPv4 address.\n\n    Arguments:\n\n    ip       -- IPv4 or IPv6 address in ASCII\n    flags    -- either 0 (default) or DNS_QUERY_NO_SEARCH\n    ";
static PyObject *__pyx_f_4coio_dns_resolve_reverse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ip = 0;
  int __pyx_v_flags;
  PyListObject *__pyx_v_items;
  PyObject *__pyx_v_tmp;
  char *__pyx_v_p;
  int __pyx_v_i;
  int __pyx_v_j;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  Py_ssize_t __pyx_6;
  char *__pyx_7;
  char __pyx_8;
  static char *__pyx_argnames[] = {"ip","flags",0};
  __pyx_v_flags = __pyx_d36;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_ip, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_ip);
  __pyx_v_items = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_tmp = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":339 */
  __pyx_1 = PyObject_IsInstance(__pyx_v_ip,((PyObject *)(&PyString_Type))); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 339; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 340; goto __pyx_L1;}
    Py_INCREF(__pyx_k114p);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k114p);
    __pyx_4 = PyObject_CallObject(PyExc_TypeError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 340; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 340; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":341 */
  __pyx_1 = PySequence_Contains(__pyx_v_ip, __pyx_k115p); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 341; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":342 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_ip, __pyx_n_split); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 342; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 342; goto __pyx_L1;}
    Py_INCREF(__pyx_k115p);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_k115p);
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 342; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (!__Pyx_TypeTest(__pyx_5, (&PyList_Type))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 342; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_items));
    __pyx_v_items = ((PyListObject *)__pyx_5);
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":343 */
    __pyx_6 = PyObject_Length(((PyObject *)__pyx_v_items)); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 343; goto __pyx_L1;}
    __pyx_2 = (__pyx_6 != 4);
    if (__pyx_2) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 344; goto __pyx_L1;}
      Py_INCREF(__pyx_k117p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k117p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 344; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 344; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":345 */
    __pyx_5 = PyString_FromStringAndSize(NULL,4); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 345; goto __pyx_L1;}
    Py_DECREF(__pyx_v_tmp);
    __pyx_v_tmp = __pyx_5;
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":346 */
    __pyx_7 = PyString_AsString(__pyx_v_tmp); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 346; goto __pyx_L1;}
    __pyx_v_p = __pyx_7;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":347 */
    for (__pyx_v_i = 0; __pyx_v_i < 4; ++__pyx_v_i) {
      __pyx_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_items), __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 349; goto __pyx_L1;}
      __pyx_7 = PyString_AsString(__pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 349; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_4 = PyInt_FromString(__pyx_7,NULL,10); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 349; goto __pyx_L1;}
      __pyx_8 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 349; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      (__pyx_v_p[__pyx_v_i]) = __pyx_8;
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":350 */
    __pyx_5 = ((PyObject *)__pyx_f_4coio_dns_call(((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse),((char const*)__pyx_v_p),__pyx_v_flags)); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 350; goto __pyx_L1;}
    __pyx_r = __pyx_5;
    __pyx_5 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_1 = PySequence_Contains(__pyx_v_ip, __pyx_k103p); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 352; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":353 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_ip, __pyx_n_split); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 353; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 353; goto __pyx_L1;}
    Py_INCREF(__pyx_k103p);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_k103p);
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 353; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (!__Pyx_TypeTest(__pyx_5, (&PyList_Type))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 353; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_items));
    __pyx_v_items = ((PyListObject *)__pyx_5);
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":354 */
    __pyx_6 = PyObject_Length(((PyObject *)__pyx_v_items)); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 354; goto __pyx_L1;}
    __pyx_2 = (__pyx_6 != 8);
    if (__pyx_2) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 355; goto __pyx_L1;}
      Py_INCREF(__pyx_k118p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k118p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 355; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 355; goto __pyx_L1;}
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":356 */
    __pyx_5 = PyString_FromStringAndSize(NULL,16); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 356; goto __pyx_L1;}
    Py_DECREF(__pyx_v_tmp);
    __pyx_v_tmp = __pyx_5;
    __pyx_5 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":357 */
    __pyx_7 = PyString_AsString(__pyx_v_tmp); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 357; goto __pyx_L1;}
    __pyx_v_p = __pyx_7;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":358 */
    for (__pyx_v_i = 0; __pyx_v_i < 8; ++__pyx_v_i) {

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":360 */
      __pyx_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_items), __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; goto __pyx_L1;}
      __pyx_7 = PyString_AsString(__pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_4 = PyInt_FromString(__pyx_7,NULL,16); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; goto __pyx_L1;}
      __pyx_1 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_j = __pyx_1;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":361 */
      (__pyx_v_p[(__pyx_v_i * 2)]) = (__pyx_v_j >> 8);

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":362 */
      (__pyx_v_p[((__pyx_v_i * 2) + 1)]) = (__pyx_v_j & 255);
    }

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":363 */
    __pyx_5 = ((PyObject *)__pyx_f_4coio_dns_call(((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse_ipv6),((char const*)__pyx_v_p),__pyx_v_flags)); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 363; goto __pyx_L1;}
    __pyx_r = __pyx_5;
    __pyx_5 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; goto __pyx_L1;}
    Py_INCREF(__pyx_k119p);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k119p);
    __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; goto __pyx_L1;}
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.dns_resolve_reverse");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_items);
  Py_DECREF(__pyx_v_tmp);
  Py_DECREF(__pyx_v_ip);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_read_etc_hosts(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_read_etc_hosts[] = "Load IPv4 addresses and hostnames from /etc/hosts.\n\n    Data already loaded to names_by_ip and names_by_nameip is not overridden.\n\n    Raises:\n      IOError:\n    ";
static PyObject *__pyx_f_4coio_read_etc_hosts(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_filename = 0;
  PyObject *__pyx_v_f = 0;
  PyObject *__pyx_v_line;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_v_name;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_ssize_t __pyx_5;
  PyObject *__pyx_6 = 0;
  int __pyx_7;
  char *__pyx_8;
  char __pyx_9;
  PyObject *__pyx_10 = 0;
  static char *__pyx_argnames[] = {"filename","f",0};
  __pyx_v_filename = __pyx_d37;
  __pyx_v_f = __pyx_d38;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|OO", __pyx_argnames, &__pyx_v_filename, &__pyx_v_f)) return 0;
  Py_INCREF(__pyx_v_filename);
  Py_INCREF(__pyx_v_f);
  __pyx_v_line = Py_None; Py_INCREF(Py_None);
  __pyx_v_items = Py_None; Py_INCREF(Py_None);
  __pyx_v_ip = Py_None; Py_INCREF(Py_None);
  __pyx_v_name = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":385 */
  __pyx_1 = __pyx_v_f == Py_None;
  if (__pyx_1) {
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 386; goto __pyx_L1;}
    Py_INCREF(__pyx_v_filename);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_filename);
    __pyx_3 = PyObject_CallObject(((PyObject *)(&PyFile_Type)), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 386; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_f);
    __pyx_v_f = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":387 */
  /*try:*/ {
    __pyx_2 = PyObject_GetIter(__pyx_v_f); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 388; goto __pyx_L4;}
    for (;;) {
      __pyx_3 = PyIter_Next(__pyx_2);
      if (!__pyx_3) {
        if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 388; goto __pyx_L4;}
        break;
      }
      Py_DECREF(__pyx_v_line);
      __pyx_v_line = __pyx_3;
      __pyx_3 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":389 */
      __pyx_3 = PyObject_GetAttr(__pyx_v_line, __pyx_n_strip); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 389; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 389; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_split); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 389; goto __pyx_L4;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 389; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_items);
      __pyx_v_items = __pyx_4;
      __pyx_4 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":390 */
      __pyx_5 = PyObject_Length(__pyx_v_items); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; goto __pyx_L4;}
      __pyx_1 = (__pyx_5 > 1);
      if (__pyx_1) {
        __pyx_3 = __Pyx_GetItemInt(__pyx_v_items, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; goto __pyx_L4;}
        __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_startswith); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; goto __pyx_L4;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; goto __pyx_L4;}
        Py_INCREF(__pyx_k122p);
        PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k122p);
        __pyx_6 = PyObject_CallObject(__pyx_4, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; goto __pyx_L4;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_7 = PyObject_IsTrue(__pyx_6); if (__pyx_7 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; goto __pyx_L4;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_1 = (!__pyx_7);
      }
      if (__pyx_1) {

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":391 */
        __pyx_4 = __Pyx_GetItemInt(__pyx_v_items, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 391; goto __pyx_L4;}
        Py_DECREF(__pyx_v_ip);
        __pyx_v_ip = __pyx_4;
        __pyx_4 = 0;

        /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":392 */
        __pyx_8 = PyString_AsString(__pyx_v_ip); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 392; goto __pyx_L4;}
        __pyx_9 = __pyx_f_4coio_is_valid_ipv4(__pyx_8);
        if (__pyx_9) {

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":394 */
          __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 394; goto __pyx_L4;}
          __pyx_6 = PyObject_GetAttr(__pyx_3, __pyx_n_setdefault); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 394; goto __pyx_L4;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 394; goto __pyx_L4;}
          Py_INCREF(__pyx_v_ip);
          PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_ip);
          Py_INCREF(__pyx_v_items);
          PyTuple_SET_ITEM(__pyx_4, 1, __pyx_v_items);
          __pyx_3 = PyObject_CallObject(__pyx_6, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 394; goto __pyx_L4;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":395 */
          __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 395; goto __pyx_L4;}
          __pyx_4 = PyObject_GetAttr(__pyx_6, __pyx_n_setdefault); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 395; goto __pyx_L4;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 395; goto __pyx_L4;}
          Py_INCREF(__pyx_v_ip);
          PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_ip);
          Py_INCREF(__pyx_v_items);
          PyTuple_SET_ITEM(__pyx_3, 1, __pyx_v_items);
          __pyx_6 = PyObject_CallObject(__pyx_4, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 395; goto __pyx_L4;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;

          /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":396 */
          __pyx_4 = PyObject_GetIter(__pyx_v_items); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; goto __pyx_L4;}
          for (;;) {
            __pyx_3 = PyIter_Next(__pyx_4);
            if (!__pyx_3) {
              if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; goto __pyx_L4;}
              break;
            }
            Py_DECREF(__pyx_v_name);
            __pyx_v_name = __pyx_3;
            __pyx_3 = 0;
            __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 397; goto __pyx_L4;}
            __pyx_3 = PyObject_GetAttr(__pyx_6, __pyx_n_setdefault); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 397; goto __pyx_L4;}
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 397; goto __pyx_L4;}
            Py_INCREF(__pyx_v_name);
            PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_name);
            Py_INCREF(__pyx_v_items);
            PyTuple_SET_ITEM(__pyx_6, 1, __pyx_v_items);
            __pyx_10 = PyObject_CallObject(__pyx_3, __pyx_6); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 397; goto __pyx_L4;}
            Py_DECREF(__pyx_3); __pyx_3 = 0;
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            Py_DECREF(__pyx_10); __pyx_10 = 0;
          }
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          goto __pyx_L9;
        }
        __pyx_L9:;
        goto __pyx_L8;
      }
      __pyx_L8:;
    }
    Py_DECREF(__pyx_2); __pyx_2 = 0;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_10); __pyx_10 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    __pyx_3 = PyObject_GetAttr(__pyx_v_f, __pyx_n_close); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 399; goto __pyx_L12;}
    __pyx_6 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 399; goto __pyx_L12;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    goto __pyx_L13;
    __pyx_L12:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1;
    __pyx_L13:;
    switch (__pyx_why) {
      case 4: {
        PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1;
      }
    }
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_10);
  __Pyx_AddTraceback("coio.read_etc_hosts");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_line);
  Py_DECREF(__pyx_v_items);
  Py_DECREF(__pyx_v_ip);
  Py_DECREF(__pyx_v_name);
  Py_DECREF(__pyx_v_filename);
  Py_DECREF(__pyx_v_f);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_raise_gaierror(PyObject *__pyx_v_exc_info,char __pyx_v_is_name) {
  int __pyx_v_result;
  PyObject *__pyx_v_exc_type;
  PyObject *__pyx_v_exc_value;
  PyObject *__pyx_v_exc_tb;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  char __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  Py_INCREF(__pyx_v_exc_info);
  __pyx_v_exc_type = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_value = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_tb = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":403 */
  __pyx_1 = PyObject_GetIter(__pyx_v_exc_info); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 403; goto __pyx_L1;}
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 403; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_type);
  __pyx_v_exc_type = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 403; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_value);
  __pyx_v_exc_value = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 403; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_tb);
  __pyx_v_exc_tb = __pyx_2;
  __pyx_2 = 0;
  if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 403; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":407 */
  __pyx_2 = __Pyx_GetItemInt(__pyx_v_exc_value, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 407; goto __pyx_L1;}
  __pyx_3 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 407; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_result = __pyx_3;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":408 */
  __pyx_v_result = (-__pyx_v_result);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":411 */
  __pyx_3 = (__pyx_v_result == DNS_ERR_NOTEXIST);
  if (__pyx_3) {
    __pyx_4 = __pyx_v_is_name;
    if (__pyx_4) {
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 413; goto __pyx_L1;}
      __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_gaierror); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 413; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 414; goto __pyx_L1;}
      __pyx_5 = PyObject_GetAttr(__pyx_1, __pyx_n_EAI_NONAME); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 414; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = PyTuple_New(2); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 413; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_1, 0, __pyx_5);
      Py_INCREF(__pyx_k128p);
      PyTuple_SET_ITEM(__pyx_1, 1, __pyx_k128p);
      __pyx_5 = 0;
      __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_1); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 413; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_v_exc_value);
      __pyx_v_exc_value = __pyx_5;
      __pyx_5 = 0;
      goto __pyx_L3;
    }
    /*else*/ {
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 416; goto __pyx_L1;}
      __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 416; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 417; goto __pyx_L1;}
      __pyx_2 = PyObject_GetAttr(__pyx_5, __pyx_n_EAI_NODATA); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 417; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 416; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
      Py_INCREF(__pyx_k130p);
      PyTuple_SET_ITEM(__pyx_5, 1, __pyx_k130p);
      __pyx_2 = 0;
      __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 416; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_v_exc_value);
      __pyx_v_exc_value = __pyx_2;
      __pyx_2 = 0;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 419; goto __pyx_L1;}
    __pyx_5 = PyObject_GetAttr(__pyx_1, __pyx_n_gaierror); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 419; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_2 = PyInt_FromLong(((-__pyx_v_result) - 900)); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 419; goto __pyx_L1;}
    __pyx_1 = __Pyx_GetItemInt(__pyx_v_exc_value, 1); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 419; goto __pyx_L1;}
    __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 419; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_6, 1, __pyx_1);
    __pyx_2 = 0;
    __pyx_1 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_5, __pyx_6); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 419; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":420 */
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 420; goto __pyx_L1;}
  Py_INCREF(__pyx_v_exc_value);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_exc_value);
  __pyx_5 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_1); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 420; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_Raise(__pyx_5, __pyx_v_exc_value, __pyx_v_exc_tb);
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  {__pyx_filename = __pyx_f[2]; __pyx_lineno = 420; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.raise_gaierror");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc_type);
  Py_DECREF(__pyx_v_exc_value);
  Py_DECREF(__pyx_v_exc_tb);
  Py_DECREF(__pyx_v_exc_info);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_raise_herror(PyObject *__pyx_v_exc_info) {
  int __pyx_v_result;
  PyObject *__pyx_v_exc_type;
  PyObject *__pyx_v_exc_value;
  PyObject *__pyx_v_exc_tb;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  Py_INCREF(__pyx_v_exc_info);
  __pyx_v_exc_type = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_value = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_tb = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":424 */
  __pyx_1 = PyObject_GetIter(__pyx_v_exc_info); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 424; goto __pyx_L1;}
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 424; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_type);
  __pyx_v_exc_type = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 424; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_value);
  __pyx_v_exc_value = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 424; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_tb);
  __pyx_v_exc_tb = __pyx_2;
  __pyx_2 = 0;
  if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 424; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":426 */
  __pyx_2 = __Pyx_GetItemInt(__pyx_v_exc_value, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 426; goto __pyx_L1;}
  __pyx_3 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 426; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_result = __pyx_3;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":427 */
  __pyx_v_result = (-__pyx_v_result);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":430 */
  __pyx_3 = (__pyx_v_result == DNS_ERR_NOTEXIST);
  if (__pyx_3) {
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 431; goto __pyx_L1;}
    __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_herror); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 431; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_HERROR_HOST_NOT_FOUND); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 432; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 431; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_1);
    Py_INCREF(__pyx_k133p);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_k133p);
    __pyx_1 = 0;
    __pyx_1 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 431; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_1;
    __pyx_1 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_herror); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = PyInt_FromLong(((-__pyx_v_result) - 900)); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; goto __pyx_L1;}
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_exc_value, 1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; goto __pyx_L1;}
    __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
    __pyx_1 = 0;
    __pyx_2 = 0;
    __pyx_1 = PyObject_CallObject(__pyx_4, __pyx_5); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_1;
    __pyx_1 = 0;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":435 */
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 435; goto __pyx_L1;}
  Py_INCREF(__pyx_v_exc_value);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_exc_value);
  __pyx_4 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 435; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_Raise(__pyx_4, __pyx_v_exc_value, __pyx_v_exc_tb);
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  {__pyx_filename = __pyx_f[2]; __pyx_lineno = 435; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.raise_herror");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc_type);
  Py_DECREF(__pyx_v_exc_value);
  Py_DECREF(__pyx_v_exc_tb);
  Py_DECREF(__pyx_v_exc_info);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_gethostbyname(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_gethostbyname[] = "Non-blocking drop-in replacement for socket.gethostbyname.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Returns:\n      An IPv4 address as an ASCII string (e.g. \'192.168.1.2\').\n    Raises:\n      socket.gaierror: The error names and codes may be different.\n    ";
static PyObject *__pyx_f_4coio_gethostbyname(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  PyObject *__pyx_r;
  char __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"name",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s", __pyx_argnames, &__pyx_v_name)) return 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":448 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 449; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":450 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 451; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 451; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 452; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_EAI_ADDRFAMILY); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 452; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 451; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
    Py_INCREF(__pyx_k135p);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_k135p);
    __pyx_4 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 451; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 451; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":453 */
  __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 453; goto __pyx_L1;}
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 453; goto __pyx_L1;}
  __pyx_5 = PySequence_Contains(__pyx_2, __pyx_3); if (__pyx_5 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 453; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_5) {
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_4, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_4 = __Pyx_GetItemInt(__pyx_2, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":455 */
  /*try:*/ {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 456; goto __pyx_L5;}
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 456; goto __pyx_L5;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 456; goto __pyx_L5;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 456; goto __pyx_L5;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_values); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 456; goto __pyx_L5;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_4 = __Pyx_GetItemInt(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 456; goto __pyx_L5;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
  }
  goto __pyx_L6;
  __pyx_L5:;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":457 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 457; goto __pyx_L1;}
  __pyx_5 = PyErr_ExceptionMatches(__pyx_2);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_5) {
    __Pyx_AddTraceback("coio.gethostbyname");
    if (__Pyx_GetException(&__pyx_3, &__pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 457; goto __pyx_L1;}
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 458; goto __pyx_L1;}
    __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n_exc_info); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 458; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_6 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 458; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_7 = __pyx_f_4coio_raise_gaierror(__pyx_6,0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 458; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L6;
  }
  goto __pyx_L1;
  __pyx_L6:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.gethostbyname");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_c_gethostbyname(PyObject *__pyx_v_address,int __pyx_v_family) {
  char *__pyx_v_name;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  char *__pyx_3;
  char __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  Py_INCREF(__pyx_v_address);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":467 */
  __pyx_1 = (__pyx_v_family == AF_INET);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":468 */
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_address, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 468; goto __pyx_L1;}
    __pyx_3 = PyString_AsString(__pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 468; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_name = __pyx_3;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":469 */
    __pyx_4 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
    if (__pyx_4) {
      Py_INCREF(__pyx_v_address);
      __pyx_r = __pyx_v_address;
      goto __pyx_L0;
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":471 */
    __pyx_1 = (!__pyx_f_4coio_is_valid_ipv6(__pyx_v_name));
    if (__pyx_1) {
      /*try:*/ {
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        __pyx_5 = PyString_FromString(__pyx_v_name); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        PyTuple_SET_ITEM(__pyx_6, 0, __pyx_5);
        __pyx_5 = 0;
        __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_6); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_2 = PyObject_GetAttr(__pyx_5, __pyx_n_values); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __pyx_6 = __Pyx_GetItemInt(__pyx_2, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_5 = __Pyx_GetItemInt(__pyx_v_address, 1); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; goto __pyx_L5;}
        PyTuple_SET_ITEM(__pyx_2, 0, __pyx_6);
        PyTuple_SET_ITEM(__pyx_2, 1, __pyx_5);
        __pyx_6 = 0;
        __pyx_5 = 0;
        __pyx_r = __pyx_2;
        __pyx_2 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L6;
      __pyx_L5:;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":474 */
      __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 474; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_6);
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_1) {
        __Pyx_AddTraceback("coio.c_gethostbyname");
        if (__Pyx_GetException(&__pyx_5, &__pyx_2, &__pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 474; goto __pyx_L1;}
        __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; goto __pyx_L1;}
        __pyx_8 = PyObject_GetAttr(__pyx_7, __pyx_n_exc_info); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_7 = PyObject_CallObject(__pyx_8, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; goto __pyx_L1;}
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        __pyx_8 = __pyx_f_4coio_raise_gaierror(__pyx_7,0); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L6;
      }
      goto __pyx_L1;
      __pyx_L6:;
      goto __pyx_L4;
    }
    __pyx_L4:;
    goto __pyx_L2;
  }
  __pyx_1 = (__pyx_v_family == AF_INET6);
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":477 */
    __pyx_7 = __Pyx_GetItemInt(__pyx_v_address, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 477; goto __pyx_L1;}
    __pyx_3 = PyString_AsString(__pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 477; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_v_name = __pyx_3;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":478 */
    __pyx_4 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
    if (__pyx_4) {
      Py_INCREF(__pyx_v_address);
      __pyx_r = __pyx_v_address;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":480 */
    __pyx_1 = (!__pyx_f_4coio_is_valid_ipv4(__pyx_v_name));
    if (__pyx_1) {
      /*try:*/ {
        __pyx_8 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv6); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        __pyx_5 = PyString_FromString(__pyx_v_name); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        PyTuple_SET_ITEM(__pyx_2, 0, __pyx_5);
        __pyx_5 = 0;
        __pyx_6 = PyObject_CallObject(__pyx_8, __pyx_2); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n_values); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_5 = __Pyx_GetItemInt(__pyx_7, 0); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_8 = __Pyx_GetItemInt(__pyx_v_address, 1); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 482; goto __pyx_L9;}
        PyTuple_SET_ITEM(__pyx_2, 0, __pyx_5);
        PyTuple_SET_ITEM(__pyx_2, 1, __pyx_8);
        __pyx_5 = 0;
        __pyx_8 = 0;
        __pyx_r = __pyx_2;
        __pyx_2 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L10;
      __pyx_L9:;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_7); __pyx_7 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      Py_XDECREF(__pyx_8); __pyx_8 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":483 */
      __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 483; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_6);
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_1) {
        __Pyx_AddTraceback("coio.c_gethostbyname");
        if (__Pyx_GetException(&__pyx_7, &__pyx_5, &__pyx_8) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 483; goto __pyx_L1;}
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 484; goto __pyx_L1;}
        __pyx_6 = PyObject_GetAttr(__pyx_2, __pyx_n_exc_info); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 484; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_2 = PyObject_CallObject(__pyx_6, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 484; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_6 = __pyx_f_4coio_raise_gaierror(__pyx_2,0); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 484; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        goto __pyx_L10;
      }
      goto __pyx_L1;
      __pyx_L10:;
      goto __pyx_L8;
    }
    __pyx_L8:;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(__pyx_v_address);
    __pyx_r = __pyx_v_address;
    goto __pyx_L0;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":487 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; goto __pyx_L1;}
  __pyx_5 = PyObject_GetAttr(__pyx_7, __pyx_n_EAI_ADDRFAMILY); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  __pyx_8 = PyTuple_New(2); if (!__pyx_8) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_8, 0, __pyx_5);
  Py_INCREF(__pyx_k135p);
  PyTuple_SET_ITEM(__pyx_8, 1, __pyx_k135p);
  __pyx_5 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_6, __pyx_8); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  __Pyx_Raise(__pyx_2, 0, 0);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("coio.c_gethostbyname");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_gethostbyaddr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_gethostbyaddr[] = "Non-blocking drop-in replacement for socket.gethostbyaddr.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Raises:\n      socket.herror: The error names and codes may be different.\n      socket.gaierror: The error names and codes may be different.\n    ";
static PyObject *__pyx_f_4coio_gethostbyaddr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_v_items;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  static char *__pyx_argnames[] = {"name",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s", __pyx_argnames, &__pyx_v_name)) return 0;
  __pyx_v_ip = Py_None; Py_INCREF(Py_None);
  __pyx_v_items = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":499 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (!__pyx_1) {
    __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  }
  if (__pyx_1) {
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 500; goto __pyx_L1;}
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 501; goto __pyx_L1;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 501; goto __pyx_L1;}
  __pyx_1 = PySequence_Contains(__pyx_3, __pyx_2); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 501; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 502; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 502; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 502; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_2 = __Pyx_GetItemInt(__pyx_4, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 502; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    /*try:*/ {
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 505; goto __pyx_L3;}
      __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 505; goto __pyx_L3;}
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 505; goto __pyx_L3;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
      __pyx_4 = 0;
      __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 505; goto __pyx_L3;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_values); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 505; goto __pyx_L3;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_2 = __Pyx_GetItemInt(__pyx_3, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 505; goto __pyx_L3;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_ip);
      __pyx_v_ip = __pyx_2;
      __pyx_2 = 0;
    }
    goto __pyx_L4;
    __pyx_L3:;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":506 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 506; goto __pyx_L1;}
    __pyx_1 = PyErr_ExceptionMatches(__pyx_4);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_1) {
      __Pyx_AddTraceback("coio.gethostbyaddr");
      if (__Pyx_GetException(&__pyx_3, &__pyx_2, &__pyx_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 506; goto __pyx_L1;}
      __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 507; goto __pyx_L1;}
      __pyx_6 = PyObject_GetAttr(__pyx_5, __pyx_n_exc_info); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 507; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_5 = PyObject_CallObject(__pyx_6, 0); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 507; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_6 = __pyx_f_4coio_raise_gaierror(__pyx_5,0); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 507; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L4;
    }
    goto __pyx_L1;
    __pyx_L4:;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":508 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 508; goto __pyx_L1;}
  __pyx_1 = PySequence_Contains(__pyx_5, __pyx_v_ip); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 508; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  if (__pyx_1) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":509 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 509; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_6, __pyx_v_ip); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 509; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_v_items);
    __pyx_v_items = __pyx_3;
    __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":510 */
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_items, 1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 510; goto __pyx_L1;}
    __pyx_4 = PySequence_GetSlice(__pyx_v_items, 2, PY_SSIZE_T_MAX); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 510; goto __pyx_L1;}
    __pyx_5 = PyList_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 510; goto __pyx_L1;}
    Py_INCREF(__pyx_v_ip);
    PyList_SET_ITEM(__pyx_5, 0, __pyx_v_ip);
    __pyx_6 = PyTuple_New(3); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 510; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_6, 1, __pyx_4);
    PyTuple_SET_ITEM(__pyx_6, 2, __pyx_5);
    __pyx_2 = 0;
    __pyx_4 = 0;
    __pyx_5 = 0;
    __pyx_r = __pyx_6;
    __pyx_6 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":511 */
  /*try:*/ {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_reverse); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    Py_INCREF(__pyx_v_ip);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_ip);
    __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PyObject_GetAttr(__pyx_4, __pyx_n_values); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_6 = __Pyx_GetItemInt(__pyx_5, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_3 = PyList_New(0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    __pyx_2 = PyList_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    Py_INCREF(__pyx_v_ip);
    PyList_SET_ITEM(__pyx_2, 0, __pyx_v_ip);
    __pyx_4 = PyTuple_New(3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; goto __pyx_L6;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_6);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    PyTuple_SET_ITEM(__pyx_4, 2, __pyx_2);
    __pyx_6 = 0;
    __pyx_3 = 0;
    __pyx_2 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
  }
  goto __pyx_L7;
  __pyx_L6:;
  Py_XDECREF(__pyx_5); __pyx_5 = 0;
  Py_XDECREF(__pyx_6); __pyx_6 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":513 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 513; goto __pyx_L1;}
  __pyx_1 = PyErr_ExceptionMatches(__pyx_5);
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  if (__pyx_1) {
    __Pyx_AddTraceback("coio.gethostbyaddr");
    if (__Pyx_GetException(&__pyx_6, &__pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 513; goto __pyx_L1;}
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 514; goto __pyx_L1;}
    __pyx_5 = PyObject_GetAttr(__pyx_4, __pyx_n_exc_info); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 514; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_5, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 514; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_5 = __pyx_f_4coio_raise_herror(__pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 514; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L7;
  }
  goto __pyx_L1;
  __pyx_L7:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.gethostbyaddr");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_ip);
  Py_DECREF(__pyx_v_items);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_getfqdn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_getfqdn[] = "Non-blocking drop-in replacement for socket.getfqdn.\n\n    This function returns data from /etc/hosts as read at module load time.\n    ";
static PyObject *__pyx_f_4coio_getfqdn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  char *__pyx_v_cname;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  char *__pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"name",0};
  __pyx_v_name = __pyx_d39;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_name)) return 0;
  Py_INCREF(__pyx_v_name);
  __pyx_v_ip = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":522 */
  __pyx_v_cname = NULL;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":523 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_name); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 523; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 524; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_gethostname); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 524; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_4, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 524; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_name);
    __pyx_v_name = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":525 */
  __pyx_5 = PyString_AsString(__pyx_v_name); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 525; goto __pyx_L1;}
  __pyx_v_cname = __pyx_5;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":526 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_cname);
  if (!__pyx_1) {
    __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_cname);
  }
  if (__pyx_1) {
    __pyx_4 = PyString_FromString(__pyx_v_cname); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 527; goto __pyx_L1;}
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L3;
  }
  __pyx_3 = PyString_FromString(__pyx_v_cname); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 528; goto __pyx_L1;}
  __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 528; goto __pyx_L1;}
  __pyx_2 = PySequence_Contains(__pyx_4, __pyx_3); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 528; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_2) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 529; goto __pyx_L1;}
    __pyx_4 = PyString_FromString(__pyx_v_cname); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 529; goto __pyx_L1;}
    __pyx_6 = PyObject_GetItem(__pyx_3, __pyx_4); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 529; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = __Pyx_GetItemInt(__pyx_6, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 529; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
    /*try:*/ {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 532; goto __pyx_L4;}
      __pyx_6 = PyString_FromString(__pyx_v_cname); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 532; goto __pyx_L4;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 532; goto __pyx_L4;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_6);
      __pyx_6 = 0;
      __pyx_6 = PyObject_CallObject(__pyx_4, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 532; goto __pyx_L4;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_4 = PyObject_GetAttr(__pyx_6, __pyx_n_values); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 532; goto __pyx_L4;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_3 = __Pyx_GetItemInt(__pyx_4, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 532; goto __pyx_L4;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_v_ip);
      __pyx_v_ip = __pyx_3;
      __pyx_3 = 0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":533 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 533; goto __pyx_L1;}
    __pyx_1 = PyErr_ExceptionMatches(__pyx_6);
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    if (__pyx_1) {
      __Pyx_AddTraceback("coio.getfqdn");
      if (__Pyx_GetException(&__pyx_4, &__pyx_3, &__pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 533; goto __pyx_L1;}
      __pyx_7 = PyString_FromString(__pyx_v_cname); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 534; goto __pyx_L1;}
      __pyx_r = __pyx_7;
      __pyx_7 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      goto __pyx_L0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":535 */
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 535; goto __pyx_L1;}
  __pyx_2 = PySequence_Contains(__pyx_7, __pyx_v_ip); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 535; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  if (__pyx_2) {
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 536; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_4, __pyx_v_ip); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 536; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_6 = __Pyx_GetItemInt(__pyx_3, 1); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 536; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_r = __pyx_6;
    __pyx_6 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":537 */
  /*try:*/ {
    __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_reverse); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 538; goto __pyx_L7;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 538; goto __pyx_L7;}
    Py_INCREF(__pyx_v_ip);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_ip);
    __pyx_3 = PyObject_CallObject(__pyx_7, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 538; goto __pyx_L7;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_6 = PyObject_GetAttr(__pyx_3, __pyx_n_values); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 538; goto __pyx_L7;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_7 = __Pyx_GetItemInt(__pyx_6, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 538; goto __pyx_L7;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_r = __pyx_7;
    __pyx_7 = 0;
    goto __pyx_L0;
  }
  goto __pyx_L8;
  __pyx_L7:;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_6); __pyx_6 = 0;
  Py_XDECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":539 */
  __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 539; goto __pyx_L1;}
  __pyx_1 = PyErr_ExceptionMatches(__pyx_4);
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_1) {
    __Pyx_AddTraceback("coio.getfqdn");
    if (__Pyx_GetException(&__pyx_3, &__pyx_6, &__pyx_7) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 539; goto __pyx_L1;}
    __pyx_4 = PyString_FromString(__pyx_v_cname); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 540; goto __pyx_L1;}
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    goto __pyx_L0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    goto __pyx_L8;
  }
  goto __pyx_L1;
  __pyx_L8:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.getfqdn");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_ip);
  Py_DECREF(__pyx_v_name);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_gethostbyname_ex(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_gethostbyname_ex[] = "Non-blocking drop-in replacement for socket.gethostbyname_ex.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Avoid using this function if possible.\n    Please note that this function is less faithful to its socket.*\n    counterpart than the other functions in this module. This is because the\n    underlying DNS lookup mechanism (evdns) can\'t return the CNAME records\n    in evdns_resolve_ipv4(). The CNAME emulation here is inaccurate (see the\n    unit tests) and slower (needs 2 DNS requests).\n    ";
static PyObject *__pyx_f_4coio_gethostbyname_ex(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_ips;
  PyObject *__pyx_v_canonical;
  PyObject *__pyx_r;
  char __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  int __pyx_6;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"name",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s", __pyx_argnames, &__pyx_v_name)) return 0;
  __pyx_v_items = Py_None; Py_INCREF(Py_None);
  __pyx_v_ips = Py_None; Py_INCREF(Py_None);
  __pyx_v_canonical = Py_None; Py_INCREF(Py_None);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":554 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 555; goto __pyx_L1;}
    __pyx_3 = PyList_New(0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 555; goto __pyx_L1;}
    __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 555; goto __pyx_L1;}
    __pyx_5 = PyList_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 555; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_5, 0, __pyx_4);
    __pyx_4 = 0;
    __pyx_4 = PyTuple_New(3); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 555; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    PyTuple_SET_ITEM(__pyx_4, 2, __pyx_5);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_5 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":556 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 557; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 557; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 558; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_5, __pyx_n_EAI_ADDRFAMILY); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 558; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 557; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
    Py_INCREF(__pyx_k135p);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_k135p);
    __pyx_4 = 0;
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 557; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_Raise(__pyx_5, 0, 0);
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 557; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":559 */
  __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 559; goto __pyx_L1;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 559; goto __pyx_L1;}
  __pyx_6 = PySequence_Contains(__pyx_3, __pyx_4); if (__pyx_6 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 559; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_6) {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":560 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 560; goto __pyx_L1;}
    __pyx_5 = PyString_FromString(__pyx_v_name); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 560; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_2, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 560; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_v_items);
    __pyx_v_items = __pyx_4;
    __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":561 */
    __pyx_3 = __Pyx_GetItemInt(__pyx_v_items, 1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; goto __pyx_L1;}
    __pyx_2 = PySequence_GetSlice(__pyx_v_items, 2, PY_SSIZE_T_MAX); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; goto __pyx_L1;}
    __pyx_5 = __Pyx_GetItemInt(__pyx_v_items, 0); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; goto __pyx_L1;}
    __pyx_4 = PyList_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_4, 0, __pyx_5);
    __pyx_5 = 0;
    __pyx_5 = PyTuple_New(3); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
    PyTuple_SET_ITEM(__pyx_5, 2, __pyx_4);
    __pyx_3 = 0;
    __pyx_2 = 0;
    __pyx_4 = 0;
    __pyx_r = __pyx_5;
    __pyx_5 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":562 */
  /*try:*/ {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 563; goto __pyx_L5;}
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 563; goto __pyx_L5;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 563; goto __pyx_L5;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 563; goto __pyx_L5;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_2 = PyObject_GetAttr(__pyx_5, __pyx_n_values); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 563; goto __pyx_L5;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_v_ips);
    __pyx_v_ips = __pyx_2;
    __pyx_2 = 0;
  }
  goto __pyx_L6;
  __pyx_L5:;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;
  Py_XDECREF(__pyx_5); __pyx_5 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":564 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 564; goto __pyx_L1;}
  __pyx_6 = PyErr_ExceptionMatches(__pyx_3);
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_6) {
    __Pyx_AddTraceback("coio.gethostbyname_ex");
    if (__Pyx_GetException(&__pyx_4, &__pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 564; goto __pyx_L1;}
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 565; goto __pyx_L1;}
    __pyx_7 = PyObject_GetAttr(__pyx_3, __pyx_n_exc_info); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 565; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 565; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_7 = __pyx_f_4coio_raise_gaierror(__pyx_3,0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 565; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L6;
  }
  goto __pyx_L1;
  __pyx_L6:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":567 */
  __pyx_3 = __Pyx_GetItemInt(__pyx_v_ips, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 567; goto __pyx_L1;}
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 567; goto __pyx_L1;}
  __pyx_6 = PySequence_Contains(__pyx_7, __pyx_3); if (__pyx_6 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 567; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  if (__pyx_6) {
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 568; goto __pyx_L1;}
    __pyx_5 = __Pyx_GetItemInt(__pyx_v_ips, 0); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 568; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_4, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 568; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_3 = __Pyx_GetItemInt(__pyx_2, 1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 568; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_canonical);
    __pyx_v_canonical = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L7;
  }
  /*else*/ {
    /*try:*/ {
      __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_reverse); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 571; goto __pyx_L8;}
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_ips, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 571; goto __pyx_L8;}
      __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 571; goto __pyx_L8;}
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_4);
      __pyx_4 = 0;
      __pyx_2 = PyObject_CallObject(__pyx_7, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 571; goto __pyx_L8;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_values); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 571; goto __pyx_L8;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_4 = __Pyx_GetItemInt(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 571; goto __pyx_L8;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_canonical);
      __pyx_v_canonical = __pyx_4;
      __pyx_4 = 0;
    }
    goto __pyx_L9;
    __pyx_L8:;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":572 */
    __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 572; goto __pyx_L1;}
    __pyx_6 = PyErr_ExceptionMatches(__pyx_7);
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    if (__pyx_6) {
      __Pyx_AddTraceback("coio.gethostbyname_ex");
      if (__Pyx_GetException(&__pyx_5, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 572; goto __pyx_L1;}
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 573; goto __pyx_L1;}
      __pyx_7 = PyObject_GetAttr(__pyx_4, __pyx_n_exc_info); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 573; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_4 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 573; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      __pyx_7 = __pyx_f_4coio_raise_gaierror(__pyx_4,0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 573; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L9;
    }
    goto __pyx_L1;
    __pyx_L9:;
  }
  __pyx_L7:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":574 */
  __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 574; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_v_canonical, __pyx_4, &__pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 574; goto __pyx_L1;}
  __pyx_6 = __pyx_6 == 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_6) {
    __pyx_7 = PyString_FromString(__pyx_v_name); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 575; goto __pyx_L1;}
    __pyx_5 = PyList_New(0); if (!__pyx_5) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 575; goto __pyx_L1;}
    __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 575; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_7);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_5);
    Py_INCREF(__pyx_v_ips);
    PyTuple_SET_ITEM(__pyx_2, 2, __pyx_v_ips);
    __pyx_7 = 0;
    __pyx_5 = 0;
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L10;
  }
  /*else*/ {
    __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 577; goto __pyx_L1;}
    __pyx_4 = PyList_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 577; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_7 = PyTuple_New(3); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 577; goto __pyx_L1;}
    Py_INCREF(__pyx_v_canonical);
    PyTuple_SET_ITEM(__pyx_7, 0, __pyx_v_canonical);
    PyTuple_SET_ITEM(__pyx_7, 1, __pyx_4);
    Py_INCREF(__pyx_v_ips);
    PyTuple_SET_ITEM(__pyx_7, 2, __pyx_v_ips);
    __pyx_4 = 0;
    __pyx_r = __pyx_7;
    __pyx_7 = 0;
    goto __pyx_L0;
  }
  __pyx_L10:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.gethostbyname_ex");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_items);
  Py_DECREF(__pyx_v_ips);
  Py_DECREF(__pyx_v_canonical);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_get_main_loop_tasklet(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_get_main_loop_tasklet(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(((PyObject *)__pyx_v_4coio_main_loop_tasklet));
  __pyx_r = ((PyObject *)__pyx_v_4coio_main_loop_tasklet);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_tp_new_4coio_event(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_event *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_event *)o);
  p->handle = Py_None; Py_INCREF(Py_None);
  p->evtype = Py_None; Py_INCREF(Py_None);
  p->callback = Py_None; Py_INCREF(Py_None);
  p->args = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_event(PyObject *o) {
  struct __pyx_obj_4coio_event *p = (struct __pyx_obj_4coio_event *)o;
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++o->ob_refcnt;
    __pyx_f_4coio_5event___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --o->ob_refcnt;
    PyErr_Restore(etype, eval, etb);
  }
  Py_XDECREF(p->handle);
  Py_XDECREF(p->evtype);
  Py_XDECREF(p->callback);
  Py_XDECREF(p->args);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_event(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_event *p = (struct __pyx_obj_4coio_event *)o;
  if (p->handle) {
    e = (*v)(p->handle, a); if (e) return e;
  }
  if (p->evtype) {
    e = (*v)(p->evtype, a); if (e) return e;
  }
  if (p->callback) {
    e = (*v)(p->callback, a); if (e) return e;
  }
  if (p->args) {
    e = (*v)(p->args, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_event(PyObject *o) {
  struct __pyx_obj_4coio_event *p = (struct __pyx_obj_4coio_event *)o;
  PyObject *t;
  t = p->handle; 
  p->handle = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->evtype; 
  p->evtype = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->callback; 
  p->callback = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->args; 
  p->args = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static struct PyMethodDef __pyx_methods_4coio_event[] = {
  {"__simple_callback", (PyCFunction)__pyx_f_4coio_5event___simple_callback, METH_VARARGS|METH_KEYWORDS, 0},
  {"__callback", (PyCFunction)__pyx_f_4coio_5event___callback, METH_VARARGS|METH_KEYWORDS, 0},
  {"add", (PyCFunction)__pyx_f_4coio_5event_add, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_5event_add},
  {"pending", (PyCFunction)__pyx_f_4coio_5event_pending, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_5event_pending},
  {"delete", (PyCFunction)__pyx_f_4coio_5event_delete, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_5event_delete},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_event = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_event = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_event = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_event = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_event = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.event", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_event), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_event, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_f_4coio_5event___repr__, /*tp_repr*/
  &__pyx_tp_as_number_event, /*tp_as_number*/
  &__pyx_tp_as_sequence_event, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_event, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_event, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "event(callback, arg=None, evtype=0, handle=None) -> event object\n    \n    Create a new event object with a user callback.\n\n    Arguments:\n\n    callback -- user callback with (ev, handle, evtype, arg) prototype\n    arg      -- optional callback arguments\n    evtype   -- bitmask of EV_READ or EV_WRITE, or EV_SIGNAL\n    handle   -- for EV_READ or EV_WRITE, a file handle, descriptor, or socket\n                for EV_SIGNAL, a signal number\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_event, /*tp_traverse*/
  __pyx_tp_clear_4coio_event, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_event, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_5event___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_event, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_evbuffer(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  return o;
}

static void __pyx_tp_dealloc_4coio_evbuffer(PyObject *o) {
  (*o->ob_type->tp_free)(o);
}

static PyObject *__pyx_getprop_4coio_8evbuffer_totallen(PyObject *o, void *x) {
  return __pyx_f_4coio_8evbuffer_8totallen___get__(o);
}

static PyObject *__pyx_getprop_4coio_8evbuffer_misalign(PyObject *o, void *x) {
  return __pyx_f_4coio_8evbuffer_8misalign___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_evbuffer[] = {
  {"reset", (PyCFunction)__pyx_f_4coio_8evbuffer_reset, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_reset},
  {"expand", (PyCFunction)__pyx_f_4coio_8evbuffer_expand, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_expand},
  {"drain", (PyCFunction)__pyx_f_4coio_8evbuffer_drain, METH_VARARGS|METH_KEYWORDS, 0},
  {"append", (PyCFunction)__pyx_f_4coio_8evbuffer_append, METH_VARARGS|METH_KEYWORDS, 0},
  {"consume", (PyCFunction)__pyx_f_4coio_8evbuffer_consume, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_consume},
  {"peek", (PyCFunction)__pyx_f_4coio_8evbuffer_peek, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_peek},
  {"find", (PyCFunction)__pyx_f_4coio_8evbuffer_find, METH_VARARGS|METH_KEYWORDS, 0},
  {"append_clear", (PyCFunction)__pyx_f_4coio_8evbuffer_append_clear, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_append_clear},
  {"consumeline", (PyCFunction)__pyx_f_4coio_8evbuffer_consumeline, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_consumeline},
  {"nb_accept", (PyCFunction)__pyx_f_4coio_8evbuffer_nb_accept, METH_VARARGS|METH_KEYWORDS, 0},
  {"nb_flush", (PyCFunction)__pyx_f_4coio_8evbuffer_nb_flush, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_nb_flush},
  {"nb_readline", (PyCFunction)__pyx_f_4coio_8evbuffer_nb_readline, METH_VARARGS|METH_KEYWORDS, 0},
  {"peekline", (PyCFunction)__pyx_f_4coio_8evbuffer_peekline, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_peekline},
  {"read_from_fd", (PyCFunction)__pyx_f_4coio_8evbuffer_read_from_fd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_read_from_fd},
  {"read_from_fd_again", (PyCFunction)__pyx_f_4coio_8evbuffer_read_from_fd_again, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_read_from_fd_again},
  {"write_to_fd", (PyCFunction)__pyx_f_4coio_8evbuffer_write_to_fd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_write_to_fd},
  {"write_to_fd_again", (PyCFunction)__pyx_f_4coio_8evbuffer_write_to_fd_again, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8evbuffer_write_to_fd_again},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_evbuffer[] = {
  {"totallen", __pyx_getprop_4coio_8evbuffer_totallen, 0, 0, 0},
  {"misalign", __pyx_getprop_4coio_8evbuffer_misalign, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_evbuffer = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_evbuffer = {
  __pyx_f_4coio_8evbuffer___len__, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_evbuffer = {
  __pyx_f_4coio_8evbuffer___len__, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_evbuffer = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_evbuffer = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.evbuffer", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_evbuffer), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_evbuffer, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_f_4coio_8evbuffer___repr__, /*tp_repr*/
  &__pyx_tp_as_number_evbuffer, /*tp_as_number*/
  &__pyx_tp_as_sequence_evbuffer, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_evbuffer, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_evbuffer, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  "A Python wrapper around libevent\'s I/O buffer: struct evbuffer\n\n    Please note that this buffer wastes memory: after reading a very long\n    line, the buffer space won\'t be reclaimed until self.reset() is called.\n    ", /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_evbuffer, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_evbuffer, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_evbuffer, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_nbfile(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbfile *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbfile *)o);
  p->close_ref = Py_None; Py_INCREF(Py_None);
  p->c_mode = Py_None; Py_INCREF(Py_None);
  p->c_name = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbfile(PyObject *o) {
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  Py_XDECREF(p->close_ref);
  Py_XDECREF(p->c_mode);
  Py_XDECREF(p->c_name);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbfile(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  if (p->close_ref) {
    e = (*v)(p->close_ref, a); if (e) return e;
  }
  if (p->c_mode) {
    e = (*v)(p->c_mode, a); if (e) return e;
  }
  if (p->c_name) {
    e = (*v)(p->c_name, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbfile(PyObject *o) {
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  PyObject *t;
  t = p->close_ref; 
  p->close_ref = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->c_mode; 
  p->c_mode = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->c_name; 
  p->c_name = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_6nbfile_closed(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_6closed___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_do_close(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_8do_close___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_limit(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_10read_limit___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_read_limit(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_6nbfile_10read_limit___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_mode(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_4mode___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_name(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_4name___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_softspace(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_9softspace___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_softspace(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_6nbfile_9softspace___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_encoding(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_8encoding___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_newlines(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_8newlines___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_errors(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_6errors___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_buffer_len(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_15read_buffer_len___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_write_buffer_len(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_16write_buffer_len___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_write_buffer_limit(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_18write_buffer_limit___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbfile[] = {
  {"fileno", (PyCFunction)__pyx_f_4coio_6nbfile_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"write_fileno", (PyCFunction)__pyx_f_4coio_6nbfile_write_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"close", (PyCFunction)__pyx_f_4coio_6nbfile_close, METH_VARARGS|METH_KEYWORDS, 0},
  {"write", (PyCFunction)__pyx_f_4coio_6nbfile_write, METH_VARARGS|METH_KEYWORDS, 0},
  {"flush", (PyCFunction)__pyx_f_4coio_6nbfile_flush, METH_VARARGS|METH_KEYWORDS, 0},
  {"discard_write_buffer", (PyCFunction)__pyx_f_4coio_6nbfile_discard_write_buffer, METH_VARARGS|METH_KEYWORDS, 0},
  {"discard", (PyCFunction)__pyx_f_4coio_6nbfile_discard, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_discard},
  {"discard_to_read_limit", (PyCFunction)__pyx_f_4coio_6nbfile_discard_to_read_limit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_discard_to_read_limit},
  {"read", (PyCFunction)__pyx_f_4coio_6nbfile_read, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_read},
  {"read_at_most", (PyCFunction)__pyx_f_4coio_6nbfile_read_at_most, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_read_at_most},
  {"readline", (PyCFunction)__pyx_f_4coio_6nbfile_readline, METH_VARARGS|METH_KEYWORDS, 0},
  {"xreadlines", (PyCFunction)__pyx_f_4coio_6nbfile_xreadlines, METH_VARARGS|METH_KEYWORDS, 0},
  {"isatty", (PyCFunction)__pyx_f_4coio_6nbfile_isatty, METH_VARARGS|METH_KEYWORDS, 0},
  {"truncate", (PyCFunction)__pyx_f_4coio_6nbfile_truncate, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbfile[] = {
  {"closed", __pyx_getprop_4coio_6nbfile_closed, 0, 0, 0},
  {"do_close", __pyx_getprop_4coio_6nbfile_do_close, 0, 0, 0},
  {"read_limit", __pyx_getprop_4coio_6nbfile_read_limit, __pyx_setprop_4coio_6nbfile_read_limit, 0, 0},
  {"mode", __pyx_getprop_4coio_6nbfile_mode, 0, 0, 0},
  {"name", __pyx_getprop_4coio_6nbfile_name, 0, 0, 0},
  {"softspace", __pyx_getprop_4coio_6nbfile_softspace, __pyx_setprop_4coio_6nbfile_softspace, 0, 0},
  {"encoding", __pyx_getprop_4coio_6nbfile_encoding, 0, 0, 0},
  {"newlines", __pyx_getprop_4coio_6nbfile_newlines, 0, 0, 0},
  {"errors", __pyx_getprop_4coio_6nbfile_errors, 0, 0, 0},
  {"read_buffer_len", __pyx_getprop_4coio_6nbfile_read_buffer_len, 0, 0, 0},
  {"write_buffer_len", __pyx_getprop_4coio_6nbfile_write_buffer_len, 0, 0, 0},
  {"write_buffer_limit", __pyx_getprop_4coio_6nbfile_write_buffer_limit, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbfile = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbfile = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbfile = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbfile = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_nbfile = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.nbfile", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbfile), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbfile, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbfile, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbfile, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbfile, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbfile, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "A non-blocking file (I/O channel).\n\n    The filehandles are assumed to be nonblocking.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_nbfile, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbfile, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_f_4coio_6nbfile___iter__, /*tp_iter*/
  __pyx_f_4coio_6nbfile___next__, /*tp_iternext*/
  __pyx_methods_4coio_nbfile, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbfile, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_6nbfile___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbfile, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_nbsocket(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbsocket *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbsocket *)o);
  p->realsock = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  Py_XDECREF(p->realsock);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbsocket(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  if (p->realsock) {
    e = (*v)(p->realsock, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  PyObject *t;
  t = p->realsock; 
  p->realsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_8nbsocket_do_close(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_8do_close___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket__sock(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_5_sock___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_type(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_4type___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_family(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_6family___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_timeout(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_7timeout___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_proto(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_5proto___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbsocket[] = {
  {"fileno", (PyCFunction)__pyx_f_4coio_8nbsocket_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"dup", (PyCFunction)__pyx_f_4coio_8nbsocket_dup, METH_VARARGS|METH_KEYWORDS, 0},
  {"close", (PyCFunction)__pyx_f_4coio_8nbsocket_close, METH_VARARGS|METH_KEYWORDS, 0},
  {"setdoclose", (PyCFunction)__pyx_f_4coio_8nbsocket_setdoclose, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8nbsocket_setdoclose},
  {"setsockopt", (PyCFunction)__pyx_f_4coio_8nbsocket_setsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockopt", (PyCFunction)__pyx_f_4coio_8nbsocket_getsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockname", (PyCFunction)__pyx_f_4coio_8nbsocket_getsockname, METH_VARARGS|METH_KEYWORDS, 0},
  {"getpeername", (PyCFunction)__pyx_f_4coio_8nbsocket_getpeername, METH_VARARGS|METH_KEYWORDS, 0},
  {"bind", (PyCFunction)__pyx_f_4coio_8nbsocket_bind, METH_VARARGS|METH_KEYWORDS, 0},
  {"listen", (PyCFunction)__pyx_f_4coio_8nbsocket_listen, METH_VARARGS|METH_KEYWORDS, 0},
  {"gettimeout", (PyCFunction)__pyx_f_4coio_8nbsocket_gettimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"setblocking", (PyCFunction)__pyx_f_4coio_8nbsocket_setblocking, METH_VARARGS|METH_KEYWORDS, 0},
  {"settimeout", (PyCFunction)__pyx_f_4coio_8nbsocket_settimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"accept", (PyCFunction)__pyx_f_4coio_8nbsocket_accept, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect", (PyCFunction)__pyx_f_4coio_8nbsocket_connect, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect_ex", (PyCFunction)__pyx_f_4coio_8nbsocket_connect_ex, METH_VARARGS|METH_KEYWORDS, 0},
  {"shutdown", (PyCFunction)__pyx_f_4coio_8nbsocket_shutdown, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv", (PyCFunction)__pyx_f_4coio_8nbsocket_recv, METH_VARARGS|METH_KEYWORDS, 0},
  {"recvfrom", (PyCFunction)__pyx_f_4coio_8nbsocket_recvfrom, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv_into", (PyCFunction)__pyx_f_4coio_8nbsocket_recv_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"recvfrom_into", (PyCFunction)__pyx_f_4coio_8nbsocket_recvfrom_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"send", (PyCFunction)__pyx_f_4coio_8nbsocket_send, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendto", (PyCFunction)__pyx_f_4coio_8nbsocket_sendto, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendall", (PyCFunction)__pyx_f_4coio_8nbsocket_sendall, METH_VARARGS|METH_KEYWORDS, 0},
  {"makefile_samefd", (PyCFunction)__pyx_f_4coio_8nbsocket_makefile_samefd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8nbsocket_makefile_samefd},
  {"makefile", (PyCFunction)__pyx_f_4coio_8nbsocket_makefile, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8nbsocket_makefile},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbsocket[] = {
  {"do_close", __pyx_getprop_4coio_8nbsocket_do_close, 0, 0, 0},
  {"_sock", __pyx_getprop_4coio_8nbsocket__sock, 0, 0, 0},
  {"type", __pyx_getprop_4coio_8nbsocket_type, 0, 0, 0},
  {"family", __pyx_getprop_4coio_8nbsocket_family, 0, 0, 0},
  {"timeout", __pyx_getprop_4coio_8nbsocket_timeout, 0, 0, 0},
  {"proto", __pyx_getprop_4coio_8nbsocket_proto, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbsocket = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbsocket = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbsocket = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbsocket = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_nbsocket = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.nbsocket", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbsocket), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbsocket, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbsocket, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbsocket, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbsocket, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbsocket, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Non-blocking drop-in replacement class for socket.socket.\n\n    See the function new_realsocket for using this class as a replacement for\n    socket._realsocket.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_nbsocket, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbsocket, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_nbsocket, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbsocket, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_8nbsocket___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbsocket, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_nbsslsocket(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbsslsocket *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbsslsocket *)o);
  p->realsock = Py_None; Py_INCREF(Py_None);
  p->sslsock = Py_None; Py_INCREF(Py_None);
  p->sslobj = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbsslsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  Py_XDECREF(p->realsock);
  Py_XDECREF(p->sslsock);
  Py_XDECREF(p->sslobj);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbsslsocket(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  if (p->realsock) {
    e = (*v)(p->realsock, a); if (e) return e;
  }
  if (p->sslsock) {
    e = (*v)(p->sslsock, a); if (e) return e;
  }
  if (p->sslobj) {
    e = (*v)(p->sslobj, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbsslsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  PyObject *t;
  t = p->realsock; 
  p->realsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->sslsock; 
  p->sslsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->sslobj; 
  p->sslobj = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_type(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_4type___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_family(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_6family___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_proto(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_5proto___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sslobj(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_7_sslobj___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sock(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_5_sock___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sslsock(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_8_sslsock___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_keyfile(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_7keyfile___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_certfile(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_8certfile___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_cert_reqs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_9cert_reqs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_ssl_version(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_11ssl_version___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_ca_certs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_8ca_certs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_do_handshake_on_connect(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_suppress_ragged_eofs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__makefile_refs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_14_makefile_refs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_timeout(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_7timeout___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbsslsocket[] = {
  {"fileno", (PyCFunction)__pyx_f_4coio_11nbsslsocket_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"dup", (PyCFunction)__pyx_f_4coio_11nbsslsocket_dup, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_dup},
  {"close", (PyCFunction)__pyx_f_4coio_11nbsslsocket_close, METH_VARARGS|METH_KEYWORDS, 0},
  {"setsockopt", (PyCFunction)__pyx_f_4coio_11nbsslsocket_setsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockopt", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockname", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getsockname, METH_VARARGS|METH_KEYWORDS, 0},
  {"getpeername", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getpeername, METH_VARARGS|METH_KEYWORDS, 0},
  {"bind", (PyCFunction)__pyx_f_4coio_11nbsslsocket_bind, METH_VARARGS|METH_KEYWORDS, 0},
  {"listen", (PyCFunction)__pyx_f_4coio_11nbsslsocket_listen, METH_VARARGS|METH_KEYWORDS, 0},
  {"gettimeout", (PyCFunction)__pyx_f_4coio_11nbsslsocket_gettimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"setblocking", (PyCFunction)__pyx_f_4coio_11nbsslsocket_setblocking, METH_VARARGS|METH_KEYWORDS, 0},
  {"settimeout", (PyCFunction)__pyx_f_4coio_11nbsslsocket_settimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"read", (PyCFunction)__pyx_f_4coio_11nbsslsocket_read, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_read},
  {"write", (PyCFunction)__pyx_f_4coio_11nbsslsocket_write, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_write},
  {"accept", (PyCFunction)__pyx_f_4coio_11nbsslsocket_accept, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect", (PyCFunction)__pyx_f_4coio_11nbsslsocket_connect, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect_ex", (PyCFunction)__pyx_f_4coio_11nbsslsocket_connect_ex, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_connect_ex},
  {"shutdown", (PyCFunction)__pyx_f_4coio_11nbsslsocket_shutdown, METH_VARARGS|METH_KEYWORDS, 0},
  {"pending", (PyCFunction)__pyx_f_4coio_11nbsslsocket_pending, METH_VARARGS|METH_KEYWORDS, 0},
  {"unwrap", (PyCFunction)__pyx_f_4coio_11nbsslsocket_unwrap, METH_VARARGS|METH_KEYWORDS, 0},
  {"do_handshake", (PyCFunction)__pyx_f_4coio_11nbsslsocket_do_handshake, METH_VARARGS|METH_KEYWORDS, 0},
  {"getpeercert", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getpeercert, METH_VARARGS|METH_KEYWORDS, 0},
  {"cipher", (PyCFunction)__pyx_f_4coio_11nbsslsocket_cipher, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recv, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_recv},
  {"recvfrom", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recvfrom, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv_into", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recv_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"recvfrom_into", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recvfrom_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"send", (PyCFunction)__pyx_f_4coio_11nbsslsocket_send, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendto", (PyCFunction)__pyx_f_4coio_11nbsslsocket_sendto, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendall", (PyCFunction)__pyx_f_4coio_11nbsslsocket_sendall, METH_VARARGS|METH_KEYWORDS, 0},
  {"makefile", (PyCFunction)__pyx_f_4coio_11nbsslsocket_makefile, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_makefile},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbsslsocket[] = {
  {"type", __pyx_getprop_4coio_11nbsslsocket_type, 0, 0, 0},
  {"family", __pyx_getprop_4coio_11nbsslsocket_family, 0, 0, 0},
  {"proto", __pyx_getprop_4coio_11nbsslsocket_proto, 0, 0, 0},
  {"_sslobj", __pyx_getprop_4coio_11nbsslsocket__sslobj, 0, 0, 0},
  {"_sock", __pyx_getprop_4coio_11nbsslsocket__sock, 0, 0, 0},
  {"_sslsock", __pyx_getprop_4coio_11nbsslsocket__sslsock, 0, 0, 0},
  {"keyfile", __pyx_getprop_4coio_11nbsslsocket_keyfile, 0, 0, 0},
  {"certfile", __pyx_getprop_4coio_11nbsslsocket_certfile, 0, 0, 0},
  {"cert_reqs", __pyx_getprop_4coio_11nbsslsocket_cert_reqs, 0, 0, 0},
  {"ssl_version", __pyx_getprop_4coio_11nbsslsocket_ssl_version, 0, 0, 0},
  {"ca_certs", __pyx_getprop_4coio_11nbsslsocket_ca_certs, 0, 0, 0},
  {"do_handshake_on_connect", __pyx_getprop_4coio_11nbsslsocket_do_handshake_on_connect, 0, 0, 0},
  {"suppress_ragged_eofs", __pyx_getprop_4coio_11nbsslsocket_suppress_ragged_eofs, 0, 0, 0},
  {"_makefile_refs", __pyx_getprop_4coio_11nbsslsocket__makefile_refs, 0, 0, 0},
  {"timeout", __pyx_getprop_4coio_11nbsslsocket_timeout, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbsslsocket = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbsslsocket = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbsslsocket = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbsslsocket = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_nbsslsocket = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.nbsslsocket", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbsslsocket), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbsslsocket, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbsslsocket, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbsslsocket, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbsslsocket, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbsslsocket, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Non-blocking drop-in replacement class for ssl.SSLSocket.\n\n    Please note that this class is not as speed-optimized as nbsocket or\n    nbfile, because how the `ssl\' module provides abstractions.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_nbsslsocket, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbsslsocket, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_nbsslsocket, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbsslsocket, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_11nbsslsocket___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbsslsocket, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_sleeper(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  return o;
}

static void __pyx_tp_dealloc_4coio_sleeper(PyObject *o) {
  (*o->ob_type->tp_free)(o);
}

static struct PyMethodDef __pyx_methods_4coio_sleeper[] = {
  {"sleep", (PyCFunction)__pyx_f_4coio_7sleeper_sleep, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_sleeper = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_sleeper = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_sleeper = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_sleeper = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_sleeper = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.sleeper", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_sleeper), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_sleeper, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_sleeper, /*tp_as_number*/
  &__pyx_tp_as_sequence_sleeper, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_sleeper, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_sleeper, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_sleeper, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_sleeper, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_dnsresult(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_dnsresult *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_dnsresult *)o);
  p->_values = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  if (__pyx_f_4coio_9dnsresult___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_4coio_dnsresult(PyObject *o) {
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  Py_XDECREF(((PyObject *)p->_values));
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_dnsresult(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  if (p->_values) {
    e = (*v)(((PyObject*)p->_values), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_dnsresult(PyObject *o) {
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  PyObject *t;
  t = ((PyObject *)p->_values); 
  p->_values = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_9dnsresult_t(PyObject *o, void *x) {
  return __pyx_f_4coio_9dnsresult_1t___get__(o);
}

static PyObject *__pyx_getprop_4coio_9dnsresult_ttl(PyObject *o, void *x) {
  return __pyx_f_4coio_9dnsresult_3ttl___get__(o);
}

static PyObject *__pyx_getprop_4coio_9dnsresult_values(PyObject *o, void *x) {
  return __pyx_f_4coio_9dnsresult_6values___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_dnsresult[] = {
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_dnsresult[] = {
  {"t", __pyx_getprop_4coio_9dnsresult_t, 0, 0, 0},
  {"ttl", __pyx_getprop_4coio_9dnsresult_ttl, 0, 0, 0},
  {"values", __pyx_getprop_4coio_9dnsresult_values, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_dnsresult = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_dnsresult = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_dnsresult = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_dnsresult = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_dnsresult = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.dnsresult", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_dnsresult), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_dnsresult, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_f_4coio_9dnsresult___repr__, /*tp_repr*/
  &__pyx_tp_as_number_dnsresult, /*tp_as_number*/
  &__pyx_tp_as_sequence_dnsresult, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_dnsresult, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_dnsresult, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Result of a DNS lookup call.\n\n    Attributes;\n      t: DNS record type constant, e.g. DNS_IPv4_A\n      ttl: time-to-live: number of seconds the result can be cached until\n      values: Nonempty list of ASCII strings containing result values. The\n        first value should be used by default. Repeating the query might\n        return the same values in different order.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_dnsresult, /*tp_traverse*/
  __pyx_tp_clear_4coio_dnsresult, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_dnsresult, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_dnsresult, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_dnsresult, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static struct PyMethodDef __pyx_methods[] = {
  {"dispatch", (PyCFunction)__pyx_f_4coio_dispatch, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dispatch},
  {"loop", (PyCFunction)__pyx_f_4coio_loop, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_loop},
  {"abort", (PyCFunction)__pyx_f_4coio_abort, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_abort},
  {"SendExceptionAndRun", (PyCFunction)__pyx_f_4coio_SendExceptionAndRun, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_SendExceptionAndRun},
  {"LinkHelper", (PyCFunction)__pyx_f_4coio_LinkHelper, METH_VARARGS|METH_KEYWORDS, 0},
  {"MainLoop", (PyCFunction)__pyx_f_4coio_MainLoop, METH_VARARGS|METH_KEYWORDS, 0},
  {"SigIntHandler", (PyCFunction)__pyx_f_4coio_SigIntHandler, METH_VARARGS|METH_KEYWORDS, 0},
  {"set_fd_blocking", (PyCFunction)__pyx_f_4coio_set_fd_blocking, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_set_fd_blocking},
  {"new_realsocket", (PyCFunction)__pyx_f_4coio_new_realsocket, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_new_realsocket},
  {"new_realsocket_fromfd", (PyCFunction)__pyx_f_4coio_new_realsocket_fromfd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_new_realsocket_fromfd},
  {"sleep", (PyCFunction)__pyx_f_4coio_sleep, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_sleep},
  {"fdopen", (PyCFunction)__pyx_f_4coio_fdopen, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_fdopen},
  {"dns_init", (PyCFunction)__pyx_f_4coio_dns_init, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_init},
  {"dns_init_force", (PyCFunction)__pyx_f_4coio_dns_init_force, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_init_force},
  {"dns_shutdown", (PyCFunction)__pyx_f_4coio_dns_shutdown, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_shutdown},
  {"dns_resolve_ipv4", (PyCFunction)__pyx_f_4coio_dns_resolve_ipv4, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_resolve_ipv4},
  {"dns_resolve_ipv6", (PyCFunction)__pyx_f_4coio_dns_resolve_ipv6, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_resolve_ipv6},
  {"dns_resolve_reverse", (PyCFunction)__pyx_f_4coio_dns_resolve_reverse, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_resolve_reverse},
  {"read_etc_hosts", (PyCFunction)__pyx_f_4coio_read_etc_hosts, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_read_etc_hosts},
  {"gethostbyname", (PyCFunction)__pyx_f_4coio_gethostbyname, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_gethostbyname},
  {"gethostbyaddr", (PyCFunction)__pyx_f_4coio_gethostbyaddr, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_gethostbyaddr},
  {"getfqdn", (PyCFunction)__pyx_f_4coio_getfqdn, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_getfqdn},
  {"gethostbyname_ex", (PyCFunction)__pyx_f_4coio_gethostbyname_ex, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_gethostbyname_ex},
  {"get_main_loop_tasklet", (PyCFunction)__pyx_f_4coio_get_main_loop_tasklet, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

PyMODINIT_FUNC initcoio(void); /*proto*/
PyMODINIT_FUNC initcoio(void) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  __pyx_init_filenames();
  __pyx_m = Py_InitModule4("coio", __pyx_methods, 0, 0, PYTHON_API_VERSION);
  if (!__pyx_m) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; goto __pyx_L1;};
  Py_INCREF(__pyx_m);
  __pyx_b = PyImport_AddModule("__builtin__");
  if (!__pyx_b) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; goto __pyx_L1;};
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; goto __pyx_L1;};
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; goto __pyx_L1;};
  __pyx_v_4coio_link_helper_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_4coio_main_loop_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_type_4coio_event.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "event", (PyObject *)&__pyx_type_4coio_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; goto __pyx_L1;}
  __pyx_ptype_4coio_event = &__pyx_type_4coio_event;
  __pyx_ptype_4coio_tasklet = __Pyx_ImportType("stackless", "tasklet", sizeof(PyTaskletObject)); if (!__pyx_ptype_4coio_tasklet) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 142; goto __pyx_L1;}
  __pyx_ptype_4coio_bomb = __Pyx_ImportType("stackless", "bomb", sizeof(PyBombObject)); if (!__pyx_ptype_4coio_bomb) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; goto __pyx_L1;}
  if (PyType_Ready(&__pyx_type_4coio_evbuffer) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "evbuffer", (PyObject *)&__pyx_type_4coio_evbuffer) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; goto __pyx_L1;}
  __pyx_ptype_4coio_evbuffer = &__pyx_type_4coio_evbuffer;
  __pyx_type_4coio_nbfile.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_nbfile) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 657; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "nbfile", (PyObject *)&__pyx_type_4coio_nbfile) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 657; goto __pyx_L1;}
  __pyx_ptype_4coio_nbfile = &__pyx_type_4coio_nbfile;
  __pyx_type_4coio_nbsocket.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_nbsocket) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1130; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "nbsocket", (PyObject *)&__pyx_type_4coio_nbsocket) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1130; goto __pyx_L1;}
  __pyx_ptype_4coio_nbsocket = &__pyx_type_4coio_nbsocket;
  __pyx_type_4coio_nbsslsocket.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_nbsslsocket) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1439; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "nbsslsocket", (PyObject *)&__pyx_type_4coio_nbsslsocket) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1439; goto __pyx_L1;}
  __pyx_ptype_4coio_nbsslsocket = &__pyx_type_4coio_nbsslsocket;
  if (PyType_Ready(&__pyx_type_4coio_sleeper) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1900; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "sleeper", (PyObject *)&__pyx_type_4coio_sleeper) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1900; goto __pyx_L1;}
  __pyx_ptype_4coio_sleeper = &__pyx_type_4coio_sleeper;
  __pyx_type_4coio_dnsresult.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_dnsresult) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "dnsresult", (PyObject *)&__pyx_type_4coio_dnsresult) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; goto __pyx_L1;}
  __pyx_ptype_4coio_dnsresult = &__pyx_type_4coio_dnsresult;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":18 */
  __pyx_1 = PyTuple_New(2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; goto __pyx_L1;}
  Py_INCREF(__pyx_k141p);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_k141p);
  Py_INCREF(__pyx_k142p);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_k142p);
  if (PyObject_SetAttr(__pyx_m, __pyx_n___author__, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":20 */
  __pyx_1 = PyTuple_New(2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; goto __pyx_L1;}
  Py_INCREF(__pyx_k144p);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_k144p);
  Py_INCREF(__pyx_k145p);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_k145p);
  if (PyObject_SetAttr(__pyx_m, __pyx_n___copyright__, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":22 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n___license__, __pyx_n_BSD) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":23 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n___url__, __pyx_k149p) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":24 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n___version__, __pyx_k151p) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":26 */
  __pyx_1 = __Pyx_Import(__pyx_n_sys, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_sys, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":69 */
  __pyx_1 = PyInt_FromLong(EV_TIMEOUT); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_TIMEOUT, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":70 */
  __pyx_1 = PyInt_FromLong(EV_READ); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_READ, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":71 */
  __pyx_1 = PyInt_FromLong(EV_WRITE); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_WRITE, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":72 */
  __pyx_1 = PyInt_FromLong(EV_SIGNAL); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_SIGNAL, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":73 */
  __pyx_1 = PyInt_FromLong(EV_PERSIST); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_PERSIST, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":75 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n___event_exc, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; goto __pyx_L1;}

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":109 */
  Py_INCREF(Py_None);
  __pyx_d1 = Py_None;
  __pyx_d2 = 0;
  __pyx_1 = PyInt_FromLong((-1)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; goto __pyx_L1;}
  __pyx_d3 = __pyx_1;
  __pyx_1 = 0;
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; goto __pyx_L1;}
  __pyx_d4 = __pyx_2;
  __pyx_2 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":150 */
  __pyx_d5 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/event.pxi":200 */
  Py_INCREF(Py_False);
  __pyx_d6 = Py_False;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":42 */
  __pyx_3 = __Pyx_Import(__pyx_n_stackless, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 42; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_stackless, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 42; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":43 */
  __pyx_3 = __Pyx_Import(__pyx_n_socket, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 43; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 43; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":45 */
  __pyx_3 = __Pyx_Import(__pyx_n_types, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 45; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_types, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 45; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":390 */
  __pyx_d7 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":405 */
  __pyx_d8 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":587 */
  __pyx_d9 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":608 */
  __pyx_d10 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":680 */
  __pyx_d11 = (-1);
  __pyx_d12 = 0;
  Py_INCREF(Py_None);
  __pyx_d13 = Py_None;
  Py_INCREF(__pyx_k60p);
  __pyx_d14 = __pyx_k60p;
  Py_INCREF(Py_None);
  __pyx_d15 = Py_None;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1120 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1120; goto __pyx_L1;}
  __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n__realsocket); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1120; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket_impl, __pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1120; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1122 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1122; goto __pyx_L1;}
  __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_fromfd); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1122; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket_fromfd, __pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1122; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1373 */
  __pyx_d16 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1395 */
  Py_INCREF(__pyx_k60p);
  __pyx_d17 = __pyx_k60p;
  __pyx_d18 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1406 */
  Py_INCREF(__pyx_n_r);
  __pyx_d19 = __pyx_n_r;
  __pyx_d20 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1427 */
  /*try:*/ {

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1428 */
    __pyx_3 = __Pyx_Import(__pyx_n_ssl, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1428; goto __pyx_L2;}
    if (PyObject_SetAttr(__pyx_m, __pyx_n_ssl, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1428; goto __pyx_L2;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1429 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1429; goto __pyx_L2;}
    __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_SSLSocket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1429; goto __pyx_L2;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (PyObject_SetAttr(__pyx_m, __pyx_n_sslsocket_impl, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1429; goto __pyx_L2;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1430 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1430; goto __pyx_L2;}
    __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_SSLError); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1430; goto __pyx_L2;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (PyObject_SetAttr(__pyx_m, __pyx_n_SSLError, __pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1430; goto __pyx_L2;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1431 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1431; goto __pyx_L2;}
    __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_SSL_ERROR_EOF); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1431; goto __pyx_L2;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1431; goto __pyx_L2;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_4coio_SSL_ERROR_EOF = __pyx_5;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1432 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1432; goto __pyx_L2;}
    __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_SSL_ERROR_WANT_READ); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1432; goto __pyx_L2;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1432; goto __pyx_L2;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_4coio_SSL_ERROR_WANT_READ = __pyx_5;

    /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1433 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1433; goto __pyx_L2;}
    __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_SSL_ERROR_WANT_WRITE); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1433; goto __pyx_L2;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1433; goto __pyx_L2;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_4coio_SSL_ERROR_WANT_WRITE = __pyx_5;
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1434 */
  __pyx_5 = PyErr_ExceptionMatches(PyExc_ImportError);
  if (__pyx_5) {
    __Pyx_AddTraceback("coio");
    if (__Pyx_GetException(&__pyx_4, &__pyx_3, &__pyx_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1434; goto __pyx_L1;}
    if (PyObject_SetAttr(__pyx_m, __pyx_n_sslsocket_impl, Py_None) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1435; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    goto __pyx_L3;
  }
  goto __pyx_L1;
  __pyx_L3:;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1601 */
  __pyx_4 = PyInt_FromLong(1024); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 1601; goto __pyx_L1;}
  __pyx_d21 = __pyx_4;
  __pyx_4 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1723 */
  Py_INCREF(Py_False);
  __pyx_d22 = Py_False;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1732 */
  __pyx_d23 = 1024;
  __pyx_d24 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1792 */
  __pyx_d25 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1825 */
  __pyx_d26 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1867 */
  Py_INCREF(__pyx_k60p);
  __pyx_d27 = __pyx_k60p;
  __pyx_d28 = (-1);

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/nbevent.pxi":1926 */
  Py_INCREF(__pyx_n_r);
  __pyx_d29 = __pyx_n_r;
  __pyx_d30 = (-1);
  __pyx_d31 = 1;
  Py_INCREF(Py_None);
  __pyx_d32 = Py_None;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":74 */
  __pyx_3 = PyInt_FromLong(HOST_NOT_FOUND); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 74; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_HOST_NOT_FOUND, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 74; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":75 */
  __pyx_6 = PyInt_FromLong(TRY_AGAIN); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 75; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_TRY_AGAIN, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 75; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":76 */
  __pyx_3 = PyInt_FromLong(NO_RECOVERY); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 76; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_NO_RECOVERY, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 76; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":77 */
  __pyx_6 = PyInt_FromLong(NO_DATA); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 77; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_NO_DATA, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 77; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":78 */
  __pyx_3 = PyInt_FromLong(NO_ADDRESS); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 78; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_NO_ADDRESS, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 78; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":81 */
  __pyx_6 = PyInt_FromLong(DNS_ERR_NONE); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 81; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_NONE, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 81; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":82 */
  __pyx_3 = PyInt_FromLong(DNS_ERR_FORMAT); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 82; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_FORMAT, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 82; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":83 */
  __pyx_6 = PyInt_FromLong(DNS_ERR_SERVERFAILED); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 83; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_SERVERFAILED, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 83; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":84 */
  __pyx_3 = PyInt_FromLong(DNS_ERR_NOTEXIST); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 84; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_NOTEXIST, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 84; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":85 */
  __pyx_6 = PyInt_FromLong(DNS_ERR_NOTIMPL); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_NOTIMPL, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":86 */
  __pyx_3 = PyInt_FromLong(DNS_ERR_REFUSED); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_REFUSED, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":87 */
  __pyx_6 = PyInt_FromLong(DNS_ERR_TRUNCATED); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 87; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_TRUNCATED, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 87; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":88 */
  __pyx_3 = PyInt_FromLong(DNS_ERR_UNKNOWN); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_UNKNOWN, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":89 */
  __pyx_6 = PyInt_FromLong(DNS_ERR_TIMEOUT); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 89; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_TIMEOUT, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 89; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":90 */
  __pyx_3 = PyInt_FromLong(DNS_ERR_SHUTDOWN); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 90; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_ERR_SHUTDOWN, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 90; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":93 */
  __pyx_6 = PyInt_FromLong(DNS_IPv4_A); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 93; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_IPv4_A, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 93; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":94 */
  __pyx_3 = PyInt_FromLong(DNS_PTR); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 94; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_PTR, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 94; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":95 */
  __pyx_6 = PyInt_FromLong(DNS_IPv6_AAAA); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_IPv6_AAAA, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":98 */
  __pyx_3 = PyInt_FromLong(DNS_QUERY_NO_SEARCH); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 98; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_QUERY_NO_SEARCH, __pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 98; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":101 */
  __pyx_v_4coio_dns_initialized = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":120 */
  __pyx_d33 = 1;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":169 */
  __pyx_6 = PyDict_New(); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 169; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 169; goto __pyx_L1;}
  Py_INCREF(PyExc_IOError);
  PyTuple_SET_ITEM(__pyx_3, 0, PyExc_IOError);
  __pyx_7 = __Pyx_CreateClass(__pyx_3, __pyx_6, __pyx_n_DnsLookupError, "coio"); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 169; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DnsLookupError, __pyx_7) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 169; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":172 */
  __pyx_3 = PyDict_New(); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 172; goto __pyx_L1;}
  __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 172; goto __pyx_L1;}
  Py_INCREF(PyExc_Exception);
  PyTuple_SET_ITEM(__pyx_7, 0, PyExc_Exception);
  __pyx_6 = __Pyx_CreateClass(__pyx_7, __pyx_3, __pyx_n_DnsResultParseError, "coio"); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 172; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DnsResultParseError, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 172; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":304 */
  __pyx_d34 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":315 */
  __pyx_d35 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":326 */
  __pyx_d36 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":371 */
  __pyx_7 = PyDict_New(); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 371; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_names_by_ip, __pyx_7) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 371; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":374 */
  __pyx_6 = PyDict_New(); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 374; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_names_by_nameip, __pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 374; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":377 */
  Py_INCREF(__pyx_k183p);
  __pyx_d37 = __pyx_k183p;
  Py_INCREF(Py_None);
  __pyx_d38 = Py_None;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/evdns.pxi":516 */
  Py_INCREF(__pyx_k23p);
  __pyx_d39 = __pyx_k23p;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":8 */
  event_init();

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":12 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_SigIntHandler); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_7, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_6 = PyDict_New(); if (!__pyx_6) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(SIGINT); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_6, __pyx_n_handle, __pyx_3) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_EV_SIGNAL); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  __pyx_8 = __Pyx_GetName(__pyx_m, __pyx_n_EV_PERSIST); if (!__pyx_8) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  __pyx_9 = PyNumber_Or(__pyx_3, __pyx_8); if (!__pyx_9) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  if (PyDict_SetItem(__pyx_6, __pyx_n_evtype, __pyx_9) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  Py_DECREF(__pyx_9); __pyx_9 = 0;
  __pyx_3 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_event), __pyx_7, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  __pyx_8 = PyObject_GetAttr(__pyx_3, __pyx_n_add); if (!__pyx_8) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_9 = PyObject_CallObject(__pyx_8, 0); if (!__pyx_9) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; goto __pyx_L1;}
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  Py_DECREF(__pyx_9); __pyx_9 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":16 */
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_7) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(__pyx_7, __pyx_n_tasklet); if (!__pyx_6) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_LinkHelper); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  __pyx_8 = PyTuple_New(1); if (!__pyx_8) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_8, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_9 = PyObject_CallObject(__pyx_6, __pyx_8); if (!__pyx_9) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  __pyx_7 = PyObject_CallObject(__pyx_9, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  Py_DECREF(__pyx_9); __pyx_9 = 0;
  __pyx_3 = PyObject_GetAttr(__pyx_7, __pyx_n_remove); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  __pyx_6 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (!__Pyx_TypeTest(__pyx_6, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  __pyx_v_4coio_link_helper_tasklet = ((PyTaskletObject *)__pyx_6);
  __pyx_6 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":22 */
  __pyx_8 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_8) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  __pyx_9 = PyObject_GetAttr(__pyx_8, __pyx_n_tasklet); if (!__pyx_9) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_MainLoop); if (!__pyx_7) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_7);
  __pyx_7 = 0;
  __pyx_6 = PyObject_CallObject(__pyx_9, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  Py_DECREF(__pyx_9); __pyx_9 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_8 = PyTuple_New(1); if (!__pyx_8) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  Py_INCREF(((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  PyTuple_SET_ITEM(__pyx_8, 0, ((PyObject *)__pyx_v_4coio_link_helper_tasklet));
  __pyx_7 = PyObject_CallObject(__pyx_6, __pyx_8); if (!__pyx_7) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  if (!__Pyx_TypeTest(__pyx_7, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_4coio_main_loop_tasklet));
  __pyx_v_4coio_main_loop_tasklet = ((PyTaskletObject *)__pyx_7);
  __pyx_7 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":24 */
  /*try:*/ {
    __pyx_9 = __Pyx_GetName(__pyx_m, __pyx_n_read_etc_hosts); if (!__pyx_9) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 25; goto __pyx_L4;}
    __pyx_3 = PyObject_CallObject(__pyx_9, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 25; goto __pyx_L4;}
    Py_DECREF(__pyx_9); __pyx_9 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }
  goto __pyx_L5;
  __pyx_L4:;
  Py_XDECREF(__pyx_6); __pyx_6 = 0;
  Py_XDECREF(__pyx_8); __pyx_8 = 0;
  Py_XDECREF(__pyx_7); __pyx_7 = 0;
  Py_XDECREF(__pyx_9); __pyx_9 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/kat/syncless/syncless/branches/with_ptsevent/coio_src/coio.pyx":26 */
  __pyx_5 = PyErr_ExceptionMatches(PyExc_IOError);
  if (__pyx_5) {
    __Pyx_AddTraceback("coio");
    if (__Pyx_GetException(&__pyx_6, &__pyx_8, &__pyx_7) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 26; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_8); __pyx_8 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    goto __pyx_L5;
  }
  goto __pyx_L1;
  __pyx_L5:;
  return;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  __Pyx_AddTraceback("coio");
}

static char *__pyx_filenames[] = {
  "event.pxi",
  "nbevent.pxi",
  "evdns.pxi",
  "coio.pyx",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static PyObject *__Pyx_GetItemInt(PyObject *o, Py_ssize_t i) {
    PyTypeObject *t = o->ob_type;
    PyObject *r;
    if (t->tp_as_sequence && t->tp_as_sequence->sq_item)
        r = PySequence_GetItem(o, i);
    else {
        PyObject *j = PyInt_FromLong(i);
        if (!j)
            return 0;
        r = PyObject_GetItem(o, j);
        Py_DECREF(j);
    }
    return r;
}

static void __Pyx_WriteUnraisable(char *name) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    PyErr_Fetch(&old_exc, &old_val, &old_tb);
    ctx = PyString_FromString(name);
    PyErr_Restore(old_exc, old_val, old_tb);
    if (!ctx)
        ctx = Py_None;
    PyErr_WriteUnraisable(ctx);
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_Get();
    PyErr_Fetch(type, value, tb);
    PyErr_NormalizeException(type, value, tb);
    if (PyErr_Occurred())
        goto bad;
    Py_INCREF(*type);
    Py_INCREF(*value);
    Py_INCREF(*tb);
    Py_XDECREF(tstate->exc_type);
    Py_XDECREF(tstate->exc_value);
    Py_XDECREF(tstate->exc_traceback);
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
    return 0;
bad:
    Py_XDECREF(*type);
    Py_XDECREF(*value);
    Py_XDECREF(*tb);
    return -1;
}

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    /* First, check the traceback argument, replacing None with NULL. */
    if (tb == Py_None) {
        Py_DECREF(tb);
        tb = 0;
    }
    else if (tb != NULL && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    /* Next, replace a missing value with None */
    if (value == NULL) {
        value = Py_None;
        Py_INCREF(value);
    }
    #if PY_VERSION_HEX < 0x02050000
    if (!PyClass_Check(type))
    #else
    if (!PyType_Check(type))
    #endif
    {
        /* Raising an instance.  The value should be a dummy. */
        if (value != Py_None) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        Py_DECREF(value);
        value = type;
        #if PY_VERSION_HEX < 0x02050000
            if (PyInstance_Check(type)) {
                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
                Py_INCREF(type);
            }
            else {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception must be an old-style class or instance");
                goto raise_error;
            }
        #else
            type = (PyObject*) type->ob_type;
            Py_INCREF(type);
            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception class must be a subclass of BaseException");
                goto raise_error;
            }
        #endif
    }
    PyErr_Restore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed, char *name) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if ((none_allowed && obj == Py_None) || PyObject_TypeCheck(obj, type))
        return 1;
    PyErr_Format(PyExc_TypeError,
        "Argument '%s' has incorrect type (expected %s, got %s)",
        name, type->tp_name, obj->ob_type->tp_name);
    return 0;
}

static int __Pyx_GetStarArgs(
    PyObject **args, 
    PyObject **kwds,
    char *kwd_list[], 
    Py_ssize_t nargs,
    PyObject **args2, 
    PyObject **kwds2,
    char rqd_kwds[])
{
    PyObject *x = 0, *args1 = 0, *kwds1 = 0;
    int i;
    char **p;
    
    if (args2)
        *args2 = 0;
    if (kwds2)
        *kwds2 = 0;
    
    if (args2) {
        args1 = PyTuple_GetSlice(*args, 0, nargs);
        if (!args1)
            goto bad;
        *args2 = PyTuple_GetSlice(*args, nargs, PyTuple_GET_SIZE(*args));
        if (!*args2)
            goto bad;
    }
    else if (PyTuple_GET_SIZE(*args) > nargs) {
        int m = nargs;
        int n = PyTuple_GET_SIZE(*args);
        PyErr_Format(PyExc_TypeError,
            "function takes at most %d positional arguments (%d given)",
                m, n);
        goto bad;
    }
    else {
        args1 = *args;
        Py_INCREF(args1);
    }
    
    if (rqd_kwds && !*kwds)
            for (i = 0, p = kwd_list; *p; i++, p++)
                if (rqd_kwds[i])
                    goto missing_kwarg;
    
    if (kwds2) {
        if (*kwds) {
            kwds1 = PyDict_New();
            if (!kwds1)
                goto bad;
            *kwds2 = PyDict_Copy(*kwds);
            if (!*kwds2)
                goto bad;
            for (i = 0, p = kwd_list; *p; i++, p++) {
                x = PyDict_GetItemString(*kwds, *p);
                if (x) {
                    if (PyDict_SetItemString(kwds1, *p, x) < 0)
                        goto bad;
                    if (PyDict_DelItemString(*kwds2, *p) < 0)
                        goto bad;
                }
                else if (rqd_kwds && rqd_kwds[i])
                    goto missing_kwarg;
            }
        }
        else {
            *kwds2 = PyDict_New();
            if (!*kwds2)
                goto bad;
        }
    }
    else {
        kwds1 = *kwds;
        Py_XINCREF(kwds1);
        if (rqd_kwds && *kwds)
            for (i = 0, p = kwd_list; *p; i++, p++)
                if (rqd_kwds[i] && !PyDict_GetItemString(*kwds, *p))
                        goto missing_kwarg;
    }
    
    *args = args1;
    *kwds = kwds1;
    return 0;
missing_kwarg:
    PyErr_Format(PyExc_TypeError,
        "required keyword argument '%s' is missing", *p);
bad:
    Py_XDECREF(args1);
    Py_XDECREF(kwds1);
    if (args2) {
        Py_XDECREF(*args2);
    }
    if (kwds2) {
        Py_XDECREF(*kwds2);
    }
    return -1;
}

static void __Pyx_UnpackError(void) {
    PyErr_SetString(PyExc_ValueError, "unpack sequence of wrong size");
}

static PyObject *__Pyx_UnpackItem(PyObject *iter) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred())
            __Pyx_UnpackError();
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        __Pyx_UnpackError();
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (obj == Py_None || PyObject_TypeCheck(obj, type))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %s to %s",
        obj->ob_type->tp_name, type->tp_name);
    return 0;
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        if (!*t->p)
            return -1;
        if (t->i)
            PyString_InternInPlace(t->p);
        ++t;
    }
    return 0;
}

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name, 
    long size) 
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    
    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    result = PyObject_GetAttrString(py_module, class_name);
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError, 
            "%s.%s is not a type object",
            module_name, class_name);
        goto bad;
    }
    if (((PyTypeObject *)result)->tp_basicsize != size) {
        PyErr_Format(PyExc_ValueError, 
            "%s.%s does not appear to be the correct type object",
            module_name, class_name);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(result);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(char *name) {
    PyObject *py_name = 0;
    
    py_name = PyString_FromString(name);
    if (!py_name)
        goto bad;
    return PyImport_Import(py_name);
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = PyObject_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunction(__import__, "OOOO",
        name, global_dict, empty_dict, list);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

static PyObject *__Pyx_CreateClass(
    PyObject *bases, PyObject *dict, PyObject *name, char *modname)
{
    PyObject *py_modname;
    PyObject *result = 0;
    
    py_modname = PyString_FromString(modname);
    if (!py_modname)
        goto bad;
    if (PyDict_SetItemString(dict, "__module__", py_modname) < 0)
        goto bad;
    result = PyClass_New(bases, dict, name);
bad:
    Py_XDECREF(py_modname);
    return result;
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyObject *empty_tuple = 0;
    PyObject *empty_string = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    
    py_srcfile = PyString_FromString(__pyx_filename);
    if (!py_srcfile) goto bad;
    py_funcname = PyString_FromString(funcname);
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    empty_tuple = PyTuple_New(0);
    if (!empty_tuple) goto bad;
    empty_string = PyString_FromString("");
    if (!empty_string) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        empty_string, /*PyObject *code,*/
        empty_tuple,  /*PyObject *consts,*/
        empty_tuple,  /*PyObject *names,*/
        empty_tuple,  /*PyObject *varnames,*/
        empty_tuple,  /*PyObject *freevars,*/
        empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        empty_string  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_Get(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(empty_tuple);
    Py_XDECREF(empty_string);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}
