/* Generated by Pyrex 0.9.9 on Sat May 15 15:17:16 2010 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)	PyInt_AsLong(o)
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#include "stdlib.h"
#include "unistd.h"
#include "string.h"
#include "errno.h"
#include "fcntl.h"
#include "signal.h"
#include "sys/socket.h"
#include "sys/select.h"
#include "stdio.h"
#include "./coio_c_include_libevent.h"
#include "./coio_c_evbuffer.h"
#include "pymem.h"
#include "bufferobject.h"
#include "./coio_c_fastsearch.h"
#include "./coio_c_stackless.h"
#include "./coio_c_helper.h"
#include "netdb.h"


typedef struct {PyObject **p; int i; char *s; long n;} __Pyx_StringTabEntry; /*proto*/

static PyObject *__pyx_m;
static PyObject *__pyx_b;
static int __pyx_lineno;
static char *__pyx_filename;
static char **__pyx_f;

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed, char *name); /*proto*/

static void __Pyx_WriteUnraisable(char *name); /*proto*/

static int __Pyx_NormalizeException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/

static int __Pyx_GetStarArgs(PyObject **args, PyObject **kwds, char *kwd_list[],     Py_ssize_t nargs, PyObject **args2, PyObject **kwds2, char rqd_kwds[]); /*proto*/

static PyObject *__Pyx_UnpackItem(PyObject *); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

static PyObject *__Pyx_GetItemInt(PyObject *o, Py_ssize_t i); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/

static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name, long size);  /*proto*/

static PyObject *__Pyx_ImportModule(char *name); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name, char *modname); /*proto*/

static void __Pyx_AddTraceback(char *funcname); /*proto*/

/* Declarations from coio */


/* Declarations from implementation of coio */

typedef void (*__pyx_t_4coio_event_handler)(int,short,void *);

enum __pyx_t_4coio_dummy {
  __pyx_e_4coio_DEFAULT_MIN_READ_BUFFER_SIZE = 8192,
  __pyx_e_4coio_DEFAULT_WRITE_BUFFER_LIMIT = 8192
};

struct __pyx_obj_4coio_nbfile {
  PyObject_HEAD
  PyObject *close_ref;
  struct event read_wakeup_ev;
  struct event write_wakeup_ev;
  int read_fd;
  int write_fd;
  int c_write_buffer_limit;
  int c_min_read_buffer_size;
  int c_read_limit;
  struct coio_evbuffer read_eb;
  struct coio_evbuffer write_eb;
  char c_do_close;
  char c_closed;
  char c_softspace;
  PyObject *c_mode;
  PyObject *c_name;
  PyObject *c_read_exc_class;
  PyObject *c_write_exc_class;
};

struct __pyx_obj_4coio_nbsocket {
  PyObject_HEAD
  struct coio_socket_wakeup_info swi;
  int c_family;
  PyObject *realsock;
  char c_do_close;
};

struct __pyx_obj_4coio_sockwrapper {
  PyObject_HEAD
  PyObject *c_sock;
};

struct __pyx_obj_4coio_nbsslsocket {
  PyObject_HEAD
  struct coio_socket_wakeup_info swi;
  PyObject *realsock;
  PyObject *sslsock;
  PyObject *sslobj;
};

struct __pyx_obj_4coio_selecter {
  PyObject_HEAD
  struct event *wakeup_evs;
  PyListObject *readable_fds;
  PyListObject *writeable_fds;
  PyTaskletObject *wakeup_tasklet;
};

struct __pyx_obj_4coio_wakeup_info_event {
  PyObject_HEAD
  struct event ev;
  struct __pyx_obj_4coio_wakeup_info *wakeup_info_obj;
};

struct __pyx_obj_4coio_wakeup_info {
  PyObject_HEAD
  PyTaskletObject *wakeup_tasklet;
  PyListObject *c_pending_events;
};

struct __pyx_obj_4coio_signal_event {
  PyObject_HEAD
  struct event ev;
};

struct __pyx_obj_4coio_concurrence_event {
  PyObject_HEAD
  struct event ev;
  PyObject *evtype;
  PyObject *callback;
  struct timeval tv;
};

typedef void (*__pyx_t_4coio_evdns_callback_type)(int,char,int,int,void *,void *);

enum __pyx_t_4coio_dns_dummy {
  __pyx_e_4coio_c_DNS_ERR_NONE = 0,
  __pyx_e_4coio_c_DNS_ERR_NOTEXIST = 3,
  __pyx_e_4coio_c_DNS_QUERY_NO_SEARCH = 1,
  __pyx_e_4coio_c_DNS_IPv4_A = 1,
  __pyx_e_4coio_c_DNS_PTR = 2,
  __pyx_e_4coio_c_DNS_IPv6_AAAA = 3
};

typedef int (*__pyx_t_4coio__evdns_call_t)(char const*,int,__pyx_t_4coio_evdns_callback_type,void *);

struct __pyx_obj_4coio_dnsresult {
  PyObject_HEAD
  char _t;
  int _ttl;
  PyListObject *_values;
};











static PyTypeObject *__pyx_ptype_4coio_tasklet = 0;
static PyTypeObject *__pyx_ptype_4coio_bomb = 0;
static PyTypeObject *__pyx_ptype_4coio_nbfile = 0;
static PyTypeObject *__pyx_ptype_4coio_nbsocket = 0;
static PyTypeObject *__pyx_ptype_4coio_nbsslsocket = 0;
static PyTypeObject *__pyx_ptype_4coio_sockwrapper = 0;
static PyTypeObject *__pyx_ptype_4coio_selecter = 0;
static PyTypeObject *__pyx_ptype_4coio_wakeup_info = 0;
static PyTypeObject *__pyx_ptype_4coio_wakeup_info_event = 0;
static PyTypeObject *__pyx_ptype_4coio_signal_event = 0;
static PyTypeObject *__pyx_ptype_4coio_concurrence_event = 0;
static PyTypeObject *__pyx_ptype_4coio_dnsresult = 0;
static PyObject *coio_socket_error;
static PyObject *coio_socket_timeout;
static struct event __pyx_v_4coio_sigint_ev;
static PyObject *coio_waiting_token;
static PyObject *coio_event_happened_token;
static int __pyx_v_4coio_SSL_ERROR_EOF;
static int __pyx_v_4coio_SSL_ERROR_WANT_READ;
static int __pyx_v_4coio_SSL_ERROR_WANT_WRITE;
static PyDictObject *__pyx_v_4coio_signal_events;
static PyListObject *__pyx_v_4coio_concurrence_triggered;
static PyListObject *__pyx_v_4coio_concurrence_main_tasklets;
static char __pyx_v_4coio_dns_initialized;
static PyTaskletObject *__pyx_v_4coio_main_loop_tasklet;
static void __pyx_f_4coio_set_fd_nonblocking(int); /*proto*/
static int __pyx_f_4coio_nbevent_read(struct coio_evbuffer *,int,int); /*proto*/
static PyObject *__pyx_f_4coio_write_all_to_fd(int,struct event *,char const*,Py_ssize_t,PyObject *); /*proto*/
static void __pyx_f_4coio_HandleCSigInt(int,short,void *); /*proto*/
static void __pyx_f_4coio__setup_sigint(void); /*proto*/
static void __pyx_f_4coio_HandleCWakeup(int,short,void *); /*proto*/
static void __pyx_f_4coio_HandleCTimeoutWakeup(int,short,void *); /*proto*/
static PyObject *__pyx_f_4coio_nbfile_readline_with_limit(struct __pyx_obj_4coio_nbfile *,int); /*proto*/
static void __pyx_f_4coio_HandleCSleepWakeup(int,short,void *); /*proto*/
static void __pyx_f_4coio_HandleCSelectWakeup(int,short,void *); /*proto*/
static void __pyx_f_4coio_HandleCWakeupInfoWakeup(int,short,void *); /*proto*/
static void __pyx_f_4coio_HandleCSignal(int,short,void *); /*proto*/
static void __pyx_f_4coio_HandleCConcurrence(int,short,void *); /*proto*/
__PYX_EXTERN_C DL_EXPORT(int) evdns_init(void); /*proto*/
__PYX_EXTERN_C char const* evdns_err_to_string(int); /*proto*/
__PYX_EXTERN_C DL_EXPORT(int) evdns_resolve_ipv4(char const*,int,__pyx_t_4coio_evdns_callback_type,void *); /*proto*/
__PYX_EXTERN_C DL_EXPORT(int) evdns_resolve_ipv6(char const*,int,__pyx_t_4coio_evdns_callback_type,void *); /*proto*/
__PYX_EXTERN_C DL_EXPORT(int) evdns_resolve_reverse(struct in_addr const*,int,__pyx_t_4coio_evdns_callback_type,void *); /*proto*/
__PYX_EXTERN_C DL_EXPORT(int) evdns_resolve_reverse_ipv6(struct in6_addr const*,int,__pyx_t_4coio_evdns_callback_type,void *); /*proto*/
__PYX_EXTERN_C DL_EXPORT(void) evdns_shutdown(int); /*proto*/
static PyObject *__pyx_f_4coio_format_ipv6_word(unsigned int,unsigned int); /*proto*/
static void __pyx_f_4coio__dns_callback(int,char,int,int,void *,void *); /*proto*/
static char __pyx_f_4coio_is_valid_hex_digit(char); /*proto*/
static char __pyx_f_4coio_is_valid_ipv6(char *); /*proto*/
static char __pyx_f_4coio_is_valid_ipv4(char *); /*proto*/
static struct __pyx_obj_4coio_dnsresult *__pyx_f_4coio_dns_call(__pyx_t_4coio__evdns_call_t,char const*,int); /*proto*/
static PyObject *__pyx_f_4coio_raise_gaierror(PyObject *,char); /*proto*/
static PyObject *__pyx_f_4coio_raise_herror(PyObject *); /*proto*/
static PyObject *__pyx_f_4coio_c_gethostbyname(PyObject *,int); /*proto*/

static char __pyx_k1[] = "event_reinit failed";
static char __pyx_k2[] = "next";
static char __pyx_k3[] = "remove";
static char __pyx_k4[] = "run";
static char __pyx_k5[] = "alive";
static char __pyx_k6[] = "blocked";
static char __pyx_k7[] = "insert";
static char __pyx_k8[] = "_schedule_helper_tasklet";
static char __pyx_k9[] = "_channel";
static char __pyx_k10[] = "preference";
static char __pyx_k11[] = "balance";
static char __pyx_k12[] = "send";
static char __pyx_k13[] = "insert_after_current";
static char __pyx_k14[] = "SendExceptionAndScheduleNext";
static char __pyx_k15[] = "stackless";
static char __pyx_k16[] = "main";
static char __pyx_k17[] = "SigIntHandler";
static char __pyx_k18[] = "TaskletExit";
static char __pyx_k19[] = "";
static char __pyx_k20[] = "w";
static char __pyx_k21[] = "r";
static char __pyx_k22[] = "r+";
static char __pyx_k23[] = "close";
static char __pyx_k24[] = "flush";
static char __pyx_k25[] = "discard";
static char __pyx_k26[] = "Timeout value out of range";
static char __pyx_k27[] = "readline";
static char __pyx_k28[] = "write";
static char __pyx_k29[] = "replace";
static char __pyx_k30[] = "b";
static char __pyx_k31[] = "os_popen";
static char __pyx_k32[] = "fileno";
static char __pyx_k33[] = "mode";
static char __pyx_k34[] = "write_buffer_limit";
static char __pyx_k35[] = "do_close";
static char __pyx_k36[] = "close_ref";
static char __pyx_k37[] = "bad mode: %r";
static char __pyx_k38[] = "min_read_buffer_size";
static char __pyx_k39[] = "socket_impl";
static char __pyx_k40[] = "pop";
static char __pyx_k41[] = "family";
static char __pyx_k42[] = "dup";
static char __pyx_k43[] = "socket";
static char __pyx_k44[] = "_closedsocket";
static char __pyx_k45[] = "type";
static char __pyx_k46[] = "proto";
static char __pyx_k47[] = "setsockopt";
static char __pyx_k48[] = "getsockopt";
static char __pyx_k49[] = "getsockname";
static char __pyx_k50[] = "getpeername";
static char __pyx_k51[] = "bind";
static char __pyx_k52[] = "listen";
static char __pyx_k53[] = "accept";
static char __pyx_k54[] = "connect_ex";
static char __pyx_k55[] = "connect_magic_usec";
static char __pyx_k56[] = "shutdown";
static char __pyx_k57[] = "recv";
static char __pyx_k58[] = "recvfrom";
static char __pyx_k59[] = "recv_into";
static char __pyx_k60[] = "recvfrom_into";
static char __pyx_k61[] = "sendto";
static char __pyx_k62[] = "args";
static char __pyx_k63[] = "do_set_fd_nonblocking";
static char __pyx_k64[] = "setdoclose";
static char __pyx_k65[] = "socket_realsocketpair";
static char __pyx_k66[] = "socket_fromfd";
static char __pyx_k67[] = "sslsocket_impl";
static char __pyx_k68[] = "_sock";
static char __pyx_k69[] = "socket_realsocket";
static char __pyx_k70[] = "bad type for underlying socket: ";
static char __pyx_k71[] = "do_handshake_on_connect= specified as positional argument";
static char __pyx_k72[] = "get";
static char __pyx_k73[] = "do_handshake_on_connect";
static char __pyx_k74[] = "_delegate_methods";
static char __pyx_k75[] = "_sslobj";
static char __pyx_k76[] = "gettimeout";
static char __pyx_k77[] = "setblocking";
static char __pyx_k78[] = "do_handshake";
static char __pyx_k79[] = "keyfile";
static char __pyx_k80[] = "cerfile";
static char __pyx_k81[] = "cert_reqs";
static char __pyx_k82[] = "ssl_version";
static char __pyx_k83[] = "ca_certs";
static char __pyx_k84[] = "_suppress_ragged_eofs";
static char __pyx_k85[] = "_makefile_refs";
static char __pyx_k86[] = "read";
static char __pyx_k87[] = "SSLError";
static char __pyx_k88[] = "errno";
static char __pyx_k89[] = "suppress_ragged_eofs";
static char __pyx_k90[] = "certfile";
static char __pyx_k91[] = "server_side";
static char __pyx_k92[] = "attempt to connect already-connected SSLSocket!";
static char __pyx_k93[] = "c_family";
static char __pyx_k94[] = "ssl";
static char __pyx_k95[] = "_ssl";
static char __pyx_k96[] = "sslwrap";
static char __pyx_k97[] = "connect";
static char __pyx_k98[] = "pending";
static char __pyx_k99[] = "No SSL wrapper around ";
static char __pyx_k100[] = "peer_certificate";
static char __pyx_k101[] = "cipher";
static char __pyx_k102[] = "flags=0 expected for recv on ";
static char __pyx_k103[] = "__class__";
static char __pyx_k104[] = "flags=0 expected for send on ";
static char __pyx_k105[] = "flags=0 expected for sendall on ";
static char __pyx_k106[] = "_fileobject";
static char __pyx_k107[] = "sleep";
static char __pyx_k108[] = "raise_exception";
static char __pyx_k109[] = "receive";
static char __pyx_k110[] = "tasklet";
static char __pyx_k111[] = "ReceiveSleepHelper";
static char __pyx_k112[] = "current";
static char __pyx_k113[] = "map";
static char __pyx_k114[] = "__getitem__";
static char __pyx_k115[] = "except-filehandles for select";
static char __pyx_k116[] = "do_select";
static char __pyx_k117[] = "EV_READ";
static char __pyx_k118[] = "EV_WRITE";
static char __pyx_k119[] = "delete";
static char __pyx_k120[] = "tick";
static char __pyx_k121[] = "callable";
static char __pyx_k122[] = "signal handler not callable";
static char __pyx_k123[] = "__init__";
static char __pyx_k124[] = "%s: %s";
static char __pyx_k125[] = "EventError";
static char __pyx_k126[] = "could not add event";
static char __pyx_k127[] = "could not delete event";
static char __pyx_k128[] = "<event flags=0x%x, callback=%s";
static char __pyx_k129[] = "<dnsresult t=%d, ttl=%d values=%r at 0x%x>";
static char __pyx_k130[] = "%x";
static char __pyx_k131[] = "DnsLookupError";
static char __pyx_k132[] = "%d.%d.%d.%d";
static char __pyx_k133[] = ":";
static char __pyx_k134[] = "join";
static char __pyx_k135[] = "DnsResultParseError";
static char __pyx_k136[] = "unknown type";
static char __pyx_k137[] = "value";
static char __pyx_k138[] = "traceback";
static char __pyx_k139[] = "t";
static char __pyx_k140[] = "bad type for ipv4";
static char __pyx_k141[] = "bad type for ipv6";
static char __pyx_k142[] = "bad type for reverse";
static char __pyx_k143[] = "ip must be a string";
static char __pyx_k144[] = ".";
static char __pyx_k145[] = "split";
static char __pyx_k146[] = "bad ipv4 address";
static char __pyx_k147[] = "bad ipv6 address";
static char __pyx_k148[] = "unknown ip address syntax: ";
static char __pyx_k149[] = "strip";
static char __pyx_k150[] = "startswith";
static char __pyx_k151[] = "#";
static char __pyx_k152[] = "names_by_ip";
static char __pyx_k153[] = "setdefault";
static char __pyx_k154[] = "names_by_nameip";
static char __pyx_k155[] = "gaierror";
static char __pyx_k156[] = "EAI_NONAME";
static char __pyx_k157[] = "Name or service not known";
static char __pyx_k158[] = "EAI_NODATA";
static char __pyx_k159[] = "No address associated with hostname";
static char __pyx_k160[] = "herror";
static char __pyx_k161[] = "HERROR_HOST_NOT_FOUND";
static char __pyx_k162[] = "Unknown host";
static char __pyx_k163[] = "EAI_ADDRFAMILY";
static char __pyx_k164[] = "Address family for hostname not supported";
static char __pyx_k165[] = "dns_resolve_ipv4";
static char __pyx_k166[] = "values";
static char __pyx_k167[] = "dns_resolve_ipv6";
static char __pyx_k168[] = "dns_resolve_reverse";
static char __pyx_k169[] = "gethostname";
static char __pyx_k170[] = "AF_INET";
static char __pyx_k171[] = "SOCK_STREAM";
static char __pyx_k172[] = "append";
static char __pyx_k173[] = "Maximum number of bytes to read from the file.\n\n        Negative values stand for unlimited. After each read from the file\n        (not from the buffer), this property is decremented accordingly.\n        \n        It is possible to set this property. A nonnegative value activates\n        the limit, a negative value makes it unlimited.\n        ";
static char __pyx_k174[] = "Setting the write_buffer_limit doesn\'t call flush().";
static char __pyx_k175[] = "Return a socket._realsocket.\n\n        This makes it possible to pass an nbsocket to the ssl.SSLSocket\n        constructor.\n        ";
static char __pyx_k176[] = "Return a nonnegative double, or -1.0 if there is no timeout.\n\n        socket._realsocket has a read-only .timeout, socket.socket doesn\'t\n        have an attribute named timeout.\n        ";
static char __pyx_k177[] = "Return the corresponding SSLSocket instance.\n\n        Property _sslsock is not present in SSLSocket.\n        ";
static char __pyx_k178[] = "Return a nonnegative double, or -1.0 if there is no timeout.";
static char __pyx_k179[] = "os";
static char __pyx_k180[] = "types";
static char __pyx_k181[] = "error";
static char __pyx_k182[] = "timeout";
static char __pyx_k183[] = "EV_TIMEOUT";
static char __pyx_k184[] = "EV_SIGNAL";
static char __pyx_k185[] = "EV_PERSIST";
static char __pyx_k186[] = "_schedule_helper";
static char __pyx_k187[] = "object";
static char __pyx_k188[] = "popen";
static char __pyx_k189[] = "_realsocket";
static char __pyx_k190[] = "_socket";
static char __pyx_k191[] = "socketpair";
static char __pyx_k192[] = "fromfd";
static char __pyx_k193[] = "SSLSocket";
static char __pyx_k194[] = "SSL_ERROR_EOF";
static char __pyx_k195[] = "SSL_ERROR_WANT_READ";
static char __pyx_k196[] = "SSL_ERROR_WANT_WRITE";
static char __pyx_k197[] = "e";
static char __pyx_k198[] = "_fake_ssl_globals";
static char __pyx_k199[] = "FunctionType";
static char __pyx_k200[] = "wrap_socket";
static char __pyx_k201[] = "func_code";
static char __pyx_k202[] = "func_defaults";
static char __pyx_k203[] = "ssl_wrap_socket";
static char __pyx_k204[] = "Non-blocking drop-in replacement for ssl.wrap_socket.";
static char __pyx_k205[] = "__doc__";
static char __pyx_k206[] = "globals";
static char __pyx_k207[] = "nbsslsocket";
static char __pyx_k208[] = "coio";
static char __pyx_k209[] = "DNS_QUERY_NO_SEARCH";
static char __pyx_k210[] = "HERROR_TRY_AGAIN";
static char __pyx_k211[] = "HERROR_NO_RECOVERY";
static char __pyx_k212[] = "HERROR_NO_DATA";
static char __pyx_k213[] = "HERROR_NO_ADDRESS";
static char __pyx_k214[] = "/etc/hosts";
static char __pyx_k215[] = "syncless.coio loaded multiple times";
static char __pyx_k216[] = "sys";
static char __pyx_k217[] = "gevent.core";
static char __pyx_k218[] = "modules";
static char __pyx_k219[] = "get_version";
static char __pyx_k220[] = "version";
static char __pyx_k221[] = "event_init failed";
static char __pyx_k222[] = "MainLoop";
static char __pyx_k223[] = "read_etc_hosts";

static PyObject *__pyx_n_AF_INET;
static PyObject *__pyx_n_DNS_QUERY_NO_SEARCH;
static PyObject *__pyx_n_DnsLookupError;
static PyObject *__pyx_n_DnsResultParseError;
static PyObject *__pyx_n_EAI_ADDRFAMILY;
static PyObject *__pyx_n_EAI_NODATA;
static PyObject *__pyx_n_EAI_NONAME;
static PyObject *__pyx_n_EV_PERSIST;
static PyObject *__pyx_n_EV_READ;
static PyObject *__pyx_n_EV_SIGNAL;
static PyObject *__pyx_n_EV_TIMEOUT;
static PyObject *__pyx_n_EV_WRITE;
static PyObject *__pyx_n_EventError;
static PyObject *__pyx_n_FunctionType;
static PyObject *__pyx_n_HERROR_HOST_NOT_FOUND;
static PyObject *__pyx_n_HERROR_NO_ADDRESS;
static PyObject *__pyx_n_HERROR_NO_DATA;
static PyObject *__pyx_n_HERROR_NO_RECOVERY;
static PyObject *__pyx_n_HERROR_TRY_AGAIN;
static PyObject *__pyx_n_MainLoop;
static PyObject *__pyx_n_ReceiveSleepHelper;
static PyObject *__pyx_n_SOCK_STREAM;
static PyObject *__pyx_n_SSLError;
static PyObject *__pyx_n_SSLSocket;
static PyObject *__pyx_n_SSL_ERROR_EOF;
static PyObject *__pyx_n_SSL_ERROR_WANT_READ;
static PyObject *__pyx_n_SSL_ERROR_WANT_WRITE;
static PyObject *__pyx_n_SendExceptionAndScheduleNext;
static PyObject *__pyx_n_SigIntHandler;
static PyObject *__pyx_n_TaskletExit;
static PyObject *__pyx_n___class__;
static PyObject *__pyx_n___doc__;
static PyObject *__pyx_n___getitem__;
static PyObject *__pyx_n___init__;
static PyObject *__pyx_n__channel;
static PyObject *__pyx_n__closedsocket;
static PyObject *__pyx_n__delegate_methods;
static PyObject *__pyx_n__fake_ssl_globals;
static PyObject *__pyx_n__fileobject;
static PyObject *__pyx_n__makefile_refs;
static PyObject *__pyx_n__realsocket;
static PyObject *__pyx_n__schedule_helper;
static PyObject *__pyx_n__schedule_helper_tasklet;
static PyObject *__pyx_n__sock;
static PyObject *__pyx_n__socket;
static PyObject *__pyx_n__ssl;
static PyObject *__pyx_n__sslobj;
static PyObject *__pyx_n__suppress_ragged_eofs;
static PyObject *__pyx_n_accept;
static PyObject *__pyx_n_alive;
static PyObject *__pyx_n_append;
static PyObject *__pyx_n_args;
static PyObject *__pyx_n_b;
static PyObject *__pyx_n_balance;
static PyObject *__pyx_n_bind;
static PyObject *__pyx_n_blocked;
static PyObject *__pyx_n_c_family;
static PyObject *__pyx_n_ca_certs;
static PyObject *__pyx_n_callable;
static PyObject *__pyx_n_cerfile;
static PyObject *__pyx_n_cert_reqs;
static PyObject *__pyx_n_certfile;
static PyObject *__pyx_n_cipher;
static PyObject *__pyx_n_close;
static PyObject *__pyx_n_close_ref;
static PyObject *__pyx_n_coio;
static PyObject *__pyx_n_connect;
static PyObject *__pyx_n_connect_ex;
static PyObject *__pyx_n_connect_magic_usec;
static PyObject *__pyx_n_current;
static PyObject *__pyx_n_delete;
static PyObject *__pyx_n_discard;
static PyObject *__pyx_n_dns_resolve_ipv4;
static PyObject *__pyx_n_dns_resolve_ipv6;
static PyObject *__pyx_n_dns_resolve_reverse;
static PyObject *__pyx_n_do_close;
static PyObject *__pyx_n_do_handshake;
static PyObject *__pyx_n_do_handshake_on_connect;
static PyObject *__pyx_n_do_select;
static PyObject *__pyx_n_do_set_fd_nonblocking;
static PyObject *__pyx_n_dup;
static PyObject *__pyx_n_e;
static PyObject *__pyx_n_errno;
static PyObject *__pyx_n_error;
static PyObject *__pyx_n_family;
static PyObject *__pyx_n_fileno;
static PyObject *__pyx_n_flush;
static PyObject *__pyx_n_fromfd;
static PyObject *__pyx_n_func_code;
static PyObject *__pyx_n_func_defaults;
static PyObject *__pyx_n_gaierror;
static PyObject *__pyx_n_get;
static PyObject *__pyx_n_get_version;
static PyObject *__pyx_n_gethostname;
static PyObject *__pyx_n_getpeername;
static PyObject *__pyx_n_getsockname;
static PyObject *__pyx_n_getsockopt;
static PyObject *__pyx_n_gettimeout;
static PyObject *__pyx_n_globals;
static PyObject *__pyx_n_herror;
static PyObject *__pyx_n_insert;
static PyObject *__pyx_n_insert_after_current;
static PyObject *__pyx_n_join;
static PyObject *__pyx_n_keyfile;
static PyObject *__pyx_n_listen;
static PyObject *__pyx_n_main;
static PyObject *__pyx_n_map;
static PyObject *__pyx_n_min_read_buffer_size;
static PyObject *__pyx_n_mode;
static PyObject *__pyx_n_modules;
static PyObject *__pyx_n_names_by_ip;
static PyObject *__pyx_n_names_by_nameip;
static PyObject *__pyx_n_nbsslsocket;
static PyObject *__pyx_n_next;
static PyObject *__pyx_n_object;
static PyObject *__pyx_n_os;
static PyObject *__pyx_n_os_popen;
static PyObject *__pyx_n_peer_certificate;
static PyObject *__pyx_n_pending;
static PyObject *__pyx_n_pop;
static PyObject *__pyx_n_popen;
static PyObject *__pyx_n_preference;
static PyObject *__pyx_n_proto;
static PyObject *__pyx_n_r;
static PyObject *__pyx_n_raise_exception;
static PyObject *__pyx_n_read;
static PyObject *__pyx_n_read_etc_hosts;
static PyObject *__pyx_n_readline;
static PyObject *__pyx_n_receive;
static PyObject *__pyx_n_recv;
static PyObject *__pyx_n_recv_into;
static PyObject *__pyx_n_recvfrom;
static PyObject *__pyx_n_recvfrom_into;
static PyObject *__pyx_n_remove;
static PyObject *__pyx_n_replace;
static PyObject *__pyx_n_run;
static PyObject *__pyx_n_send;
static PyObject *__pyx_n_sendto;
static PyObject *__pyx_n_server_side;
static PyObject *__pyx_n_setblocking;
static PyObject *__pyx_n_setdefault;
static PyObject *__pyx_n_setdoclose;
static PyObject *__pyx_n_setsockopt;
static PyObject *__pyx_n_shutdown;
static PyObject *__pyx_n_sleep;
static PyObject *__pyx_n_socket;
static PyObject *__pyx_n_socket_fromfd;
static PyObject *__pyx_n_socket_impl;
static PyObject *__pyx_n_socket_realsocket;
static PyObject *__pyx_n_socket_realsocketpair;
static PyObject *__pyx_n_socketpair;
static PyObject *__pyx_n_split;
static PyObject *__pyx_n_ssl;
static PyObject *__pyx_n_ssl_version;
static PyObject *__pyx_n_ssl_wrap_socket;
static PyObject *__pyx_n_sslsocket_impl;
static PyObject *__pyx_n_sslwrap;
static PyObject *__pyx_n_stackless;
static PyObject *__pyx_n_startswith;
static PyObject *__pyx_n_strip;
static PyObject *__pyx_n_suppress_ragged_eofs;
static PyObject *__pyx_n_sys;
static PyObject *__pyx_n_t;
static PyObject *__pyx_n_tasklet;
static PyObject *__pyx_n_tick;
static PyObject *__pyx_n_timeout;
static PyObject *__pyx_n_traceback;
static PyObject *__pyx_n_type;
static PyObject *__pyx_n_types;
static PyObject *__pyx_n_value;
static PyObject *__pyx_n_values;
static PyObject *__pyx_n_version;
static PyObject *__pyx_n_w;
static PyObject *__pyx_n_wrap_socket;
static PyObject *__pyx_n_write;
static PyObject *__pyx_n_write_buffer_limit;

static PyObject *__pyx_k1p;
static PyObject *__pyx_k19p;
static PyObject *__pyx_k22p;
static PyObject *__pyx_k26p;
static PyObject *__pyx_k37p;
static PyObject *__pyx_k70p;
static PyObject *__pyx_k71p;
static PyObject *__pyx_k92p;
static PyObject *__pyx_k99p;
static PyObject *__pyx_k102p;
static PyObject *__pyx_k104p;
static PyObject *__pyx_k105p;
static PyObject *__pyx_k115p;
static PyObject *__pyx_k122p;
static PyObject *__pyx_k124p;
static PyObject *__pyx_k126p;
static PyObject *__pyx_k127p;
static PyObject *__pyx_k128p;
static PyObject *__pyx_k129p;
static PyObject *__pyx_k133p;
static PyObject *__pyx_k136p;
static PyObject *__pyx_k140p;
static PyObject *__pyx_k141p;
static PyObject *__pyx_k142p;
static PyObject *__pyx_k143p;
static PyObject *__pyx_k144p;
static PyObject *__pyx_k146p;
static PyObject *__pyx_k147p;
static PyObject *__pyx_k148p;
static PyObject *__pyx_k151p;
static PyObject *__pyx_k157p;
static PyObject *__pyx_k159p;
static PyObject *__pyx_k162p;
static PyObject *__pyx_k164p;
static PyObject *__pyx_k204p;
static PyObject *__pyx_k214p;
static PyObject *__pyx_k215p;
static PyObject *__pyx_k217p;
static PyObject *__pyx_k221p;

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_n_AF_INET, 1, __pyx_k170, sizeof(__pyx_k170)},
  {&__pyx_n_DNS_QUERY_NO_SEARCH, 1, __pyx_k209, sizeof(__pyx_k209)},
  {&__pyx_n_DnsLookupError, 1, __pyx_k131, sizeof(__pyx_k131)},
  {&__pyx_n_DnsResultParseError, 1, __pyx_k135, sizeof(__pyx_k135)},
  {&__pyx_n_EAI_ADDRFAMILY, 1, __pyx_k163, sizeof(__pyx_k163)},
  {&__pyx_n_EAI_NODATA, 1, __pyx_k158, sizeof(__pyx_k158)},
  {&__pyx_n_EAI_NONAME, 1, __pyx_k156, sizeof(__pyx_k156)},
  {&__pyx_n_EV_PERSIST, 1, __pyx_k185, sizeof(__pyx_k185)},
  {&__pyx_n_EV_READ, 1, __pyx_k117, sizeof(__pyx_k117)},
  {&__pyx_n_EV_SIGNAL, 1, __pyx_k184, sizeof(__pyx_k184)},
  {&__pyx_n_EV_TIMEOUT, 1, __pyx_k183, sizeof(__pyx_k183)},
  {&__pyx_n_EV_WRITE, 1, __pyx_k118, sizeof(__pyx_k118)},
  {&__pyx_n_EventError, 1, __pyx_k125, sizeof(__pyx_k125)},
  {&__pyx_n_FunctionType, 1, __pyx_k199, sizeof(__pyx_k199)},
  {&__pyx_n_HERROR_HOST_NOT_FOUND, 1, __pyx_k161, sizeof(__pyx_k161)},
  {&__pyx_n_HERROR_NO_ADDRESS, 1, __pyx_k213, sizeof(__pyx_k213)},
  {&__pyx_n_HERROR_NO_DATA, 1, __pyx_k212, sizeof(__pyx_k212)},
  {&__pyx_n_HERROR_NO_RECOVERY, 1, __pyx_k211, sizeof(__pyx_k211)},
  {&__pyx_n_HERROR_TRY_AGAIN, 1, __pyx_k210, sizeof(__pyx_k210)},
  {&__pyx_n_MainLoop, 1, __pyx_k222, sizeof(__pyx_k222)},
  {&__pyx_n_ReceiveSleepHelper, 1, __pyx_k111, sizeof(__pyx_k111)},
  {&__pyx_n_SOCK_STREAM, 1, __pyx_k171, sizeof(__pyx_k171)},
  {&__pyx_n_SSLError, 1, __pyx_k87, sizeof(__pyx_k87)},
  {&__pyx_n_SSLSocket, 1, __pyx_k193, sizeof(__pyx_k193)},
  {&__pyx_n_SSL_ERROR_EOF, 1, __pyx_k194, sizeof(__pyx_k194)},
  {&__pyx_n_SSL_ERROR_WANT_READ, 1, __pyx_k195, sizeof(__pyx_k195)},
  {&__pyx_n_SSL_ERROR_WANT_WRITE, 1, __pyx_k196, sizeof(__pyx_k196)},
  {&__pyx_n_SendExceptionAndScheduleNext, 1, __pyx_k14, sizeof(__pyx_k14)},
  {&__pyx_n_SigIntHandler, 1, __pyx_k17, sizeof(__pyx_k17)},
  {&__pyx_n_TaskletExit, 1, __pyx_k18, sizeof(__pyx_k18)},
  {&__pyx_n___class__, 1, __pyx_k103, sizeof(__pyx_k103)},
  {&__pyx_n___doc__, 1, __pyx_k205, sizeof(__pyx_k205)},
  {&__pyx_n___getitem__, 1, __pyx_k114, sizeof(__pyx_k114)},
  {&__pyx_n___init__, 1, __pyx_k123, sizeof(__pyx_k123)},
  {&__pyx_n__channel, 1, __pyx_k9, sizeof(__pyx_k9)},
  {&__pyx_n__closedsocket, 1, __pyx_k44, sizeof(__pyx_k44)},
  {&__pyx_n__delegate_methods, 1, __pyx_k74, sizeof(__pyx_k74)},
  {&__pyx_n__fake_ssl_globals, 1, __pyx_k198, sizeof(__pyx_k198)},
  {&__pyx_n__fileobject, 1, __pyx_k106, sizeof(__pyx_k106)},
  {&__pyx_n__makefile_refs, 1, __pyx_k85, sizeof(__pyx_k85)},
  {&__pyx_n__realsocket, 1, __pyx_k189, sizeof(__pyx_k189)},
  {&__pyx_n__schedule_helper, 1, __pyx_k186, sizeof(__pyx_k186)},
  {&__pyx_n__schedule_helper_tasklet, 1, __pyx_k8, sizeof(__pyx_k8)},
  {&__pyx_n__sock, 1, __pyx_k68, sizeof(__pyx_k68)},
  {&__pyx_n__socket, 1, __pyx_k190, sizeof(__pyx_k190)},
  {&__pyx_n__ssl, 1, __pyx_k95, sizeof(__pyx_k95)},
  {&__pyx_n__sslobj, 1, __pyx_k75, sizeof(__pyx_k75)},
  {&__pyx_n__suppress_ragged_eofs, 1, __pyx_k84, sizeof(__pyx_k84)},
  {&__pyx_n_accept, 1, __pyx_k53, sizeof(__pyx_k53)},
  {&__pyx_n_alive, 1, __pyx_k5, sizeof(__pyx_k5)},
  {&__pyx_n_append, 1, __pyx_k172, sizeof(__pyx_k172)},
  {&__pyx_n_args, 1, __pyx_k62, sizeof(__pyx_k62)},
  {&__pyx_n_b, 1, __pyx_k30, sizeof(__pyx_k30)},
  {&__pyx_n_balance, 1, __pyx_k11, sizeof(__pyx_k11)},
  {&__pyx_n_bind, 1, __pyx_k51, sizeof(__pyx_k51)},
  {&__pyx_n_blocked, 1, __pyx_k6, sizeof(__pyx_k6)},
  {&__pyx_n_c_family, 1, __pyx_k93, sizeof(__pyx_k93)},
  {&__pyx_n_ca_certs, 1, __pyx_k83, sizeof(__pyx_k83)},
  {&__pyx_n_callable, 1, __pyx_k121, sizeof(__pyx_k121)},
  {&__pyx_n_cerfile, 1, __pyx_k80, sizeof(__pyx_k80)},
  {&__pyx_n_cert_reqs, 1, __pyx_k81, sizeof(__pyx_k81)},
  {&__pyx_n_certfile, 1, __pyx_k90, sizeof(__pyx_k90)},
  {&__pyx_n_cipher, 1, __pyx_k101, sizeof(__pyx_k101)},
  {&__pyx_n_close, 1, __pyx_k23, sizeof(__pyx_k23)},
  {&__pyx_n_close_ref, 1, __pyx_k36, sizeof(__pyx_k36)},
  {&__pyx_n_coio, 1, __pyx_k208, sizeof(__pyx_k208)},
  {&__pyx_n_connect, 1, __pyx_k97, sizeof(__pyx_k97)},
  {&__pyx_n_connect_ex, 1, __pyx_k54, sizeof(__pyx_k54)},
  {&__pyx_n_connect_magic_usec, 1, __pyx_k55, sizeof(__pyx_k55)},
  {&__pyx_n_current, 1, __pyx_k112, sizeof(__pyx_k112)},
  {&__pyx_n_delete, 1, __pyx_k119, sizeof(__pyx_k119)},
  {&__pyx_n_discard, 1, __pyx_k25, sizeof(__pyx_k25)},
  {&__pyx_n_dns_resolve_ipv4, 1, __pyx_k165, sizeof(__pyx_k165)},
  {&__pyx_n_dns_resolve_ipv6, 1, __pyx_k167, sizeof(__pyx_k167)},
  {&__pyx_n_dns_resolve_reverse, 1, __pyx_k168, sizeof(__pyx_k168)},
  {&__pyx_n_do_close, 1, __pyx_k35, sizeof(__pyx_k35)},
  {&__pyx_n_do_handshake, 1, __pyx_k78, sizeof(__pyx_k78)},
  {&__pyx_n_do_handshake_on_connect, 1, __pyx_k73, sizeof(__pyx_k73)},
  {&__pyx_n_do_select, 1, __pyx_k116, sizeof(__pyx_k116)},
  {&__pyx_n_do_set_fd_nonblocking, 1, __pyx_k63, sizeof(__pyx_k63)},
  {&__pyx_n_dup, 1, __pyx_k42, sizeof(__pyx_k42)},
  {&__pyx_n_e, 1, __pyx_k197, sizeof(__pyx_k197)},
  {&__pyx_n_errno, 1, __pyx_k88, sizeof(__pyx_k88)},
  {&__pyx_n_error, 1, __pyx_k181, sizeof(__pyx_k181)},
  {&__pyx_n_family, 1, __pyx_k41, sizeof(__pyx_k41)},
  {&__pyx_n_fileno, 1, __pyx_k32, sizeof(__pyx_k32)},
  {&__pyx_n_flush, 1, __pyx_k24, sizeof(__pyx_k24)},
  {&__pyx_n_fromfd, 1, __pyx_k192, sizeof(__pyx_k192)},
  {&__pyx_n_func_code, 1, __pyx_k201, sizeof(__pyx_k201)},
  {&__pyx_n_func_defaults, 1, __pyx_k202, sizeof(__pyx_k202)},
  {&__pyx_n_gaierror, 1, __pyx_k155, sizeof(__pyx_k155)},
  {&__pyx_n_get, 1, __pyx_k72, sizeof(__pyx_k72)},
  {&__pyx_n_get_version, 1, __pyx_k219, sizeof(__pyx_k219)},
  {&__pyx_n_gethostname, 1, __pyx_k169, sizeof(__pyx_k169)},
  {&__pyx_n_getpeername, 1, __pyx_k50, sizeof(__pyx_k50)},
  {&__pyx_n_getsockname, 1, __pyx_k49, sizeof(__pyx_k49)},
  {&__pyx_n_getsockopt, 1, __pyx_k48, sizeof(__pyx_k48)},
  {&__pyx_n_gettimeout, 1, __pyx_k76, sizeof(__pyx_k76)},
  {&__pyx_n_globals, 1, __pyx_k206, sizeof(__pyx_k206)},
  {&__pyx_n_herror, 1, __pyx_k160, sizeof(__pyx_k160)},
  {&__pyx_n_insert, 1, __pyx_k7, sizeof(__pyx_k7)},
  {&__pyx_n_insert_after_current, 1, __pyx_k13, sizeof(__pyx_k13)},
  {&__pyx_n_join, 1, __pyx_k134, sizeof(__pyx_k134)},
  {&__pyx_n_keyfile, 1, __pyx_k79, sizeof(__pyx_k79)},
  {&__pyx_n_listen, 1, __pyx_k52, sizeof(__pyx_k52)},
  {&__pyx_n_main, 1, __pyx_k16, sizeof(__pyx_k16)},
  {&__pyx_n_map, 1, __pyx_k113, sizeof(__pyx_k113)},
  {&__pyx_n_min_read_buffer_size, 1, __pyx_k38, sizeof(__pyx_k38)},
  {&__pyx_n_mode, 1, __pyx_k33, sizeof(__pyx_k33)},
  {&__pyx_n_modules, 1, __pyx_k218, sizeof(__pyx_k218)},
  {&__pyx_n_names_by_ip, 1, __pyx_k152, sizeof(__pyx_k152)},
  {&__pyx_n_names_by_nameip, 1, __pyx_k154, sizeof(__pyx_k154)},
  {&__pyx_n_nbsslsocket, 1, __pyx_k207, sizeof(__pyx_k207)},
  {&__pyx_n_next, 1, __pyx_k2, sizeof(__pyx_k2)},
  {&__pyx_n_object, 1, __pyx_k187, sizeof(__pyx_k187)},
  {&__pyx_n_os, 1, __pyx_k179, sizeof(__pyx_k179)},
  {&__pyx_n_os_popen, 1, __pyx_k31, sizeof(__pyx_k31)},
  {&__pyx_n_peer_certificate, 1, __pyx_k100, sizeof(__pyx_k100)},
  {&__pyx_n_pending, 1, __pyx_k98, sizeof(__pyx_k98)},
  {&__pyx_n_pop, 1, __pyx_k40, sizeof(__pyx_k40)},
  {&__pyx_n_popen, 1, __pyx_k188, sizeof(__pyx_k188)},
  {&__pyx_n_preference, 1, __pyx_k10, sizeof(__pyx_k10)},
  {&__pyx_n_proto, 1, __pyx_k46, sizeof(__pyx_k46)},
  {&__pyx_n_r, 1, __pyx_k21, sizeof(__pyx_k21)},
  {&__pyx_n_raise_exception, 1, __pyx_k108, sizeof(__pyx_k108)},
  {&__pyx_n_read, 1, __pyx_k86, sizeof(__pyx_k86)},
  {&__pyx_n_read_etc_hosts, 1, __pyx_k223, sizeof(__pyx_k223)},
  {&__pyx_n_readline, 1, __pyx_k27, sizeof(__pyx_k27)},
  {&__pyx_n_receive, 1, __pyx_k109, sizeof(__pyx_k109)},
  {&__pyx_n_recv, 1, __pyx_k57, sizeof(__pyx_k57)},
  {&__pyx_n_recv_into, 1, __pyx_k59, sizeof(__pyx_k59)},
  {&__pyx_n_recvfrom, 1, __pyx_k58, sizeof(__pyx_k58)},
  {&__pyx_n_recvfrom_into, 1, __pyx_k60, sizeof(__pyx_k60)},
  {&__pyx_n_remove, 1, __pyx_k3, sizeof(__pyx_k3)},
  {&__pyx_n_replace, 1, __pyx_k29, sizeof(__pyx_k29)},
  {&__pyx_n_run, 1, __pyx_k4, sizeof(__pyx_k4)},
  {&__pyx_n_send, 1, __pyx_k12, sizeof(__pyx_k12)},
  {&__pyx_n_sendto, 1, __pyx_k61, sizeof(__pyx_k61)},
  {&__pyx_n_server_side, 1, __pyx_k91, sizeof(__pyx_k91)},
  {&__pyx_n_setblocking, 1, __pyx_k77, sizeof(__pyx_k77)},
  {&__pyx_n_setdefault, 1, __pyx_k153, sizeof(__pyx_k153)},
  {&__pyx_n_setdoclose, 1, __pyx_k64, sizeof(__pyx_k64)},
  {&__pyx_n_setsockopt, 1, __pyx_k47, sizeof(__pyx_k47)},
  {&__pyx_n_shutdown, 1, __pyx_k56, sizeof(__pyx_k56)},
  {&__pyx_n_sleep, 1, __pyx_k107, sizeof(__pyx_k107)},
  {&__pyx_n_socket, 1, __pyx_k43, sizeof(__pyx_k43)},
  {&__pyx_n_socket_fromfd, 1, __pyx_k66, sizeof(__pyx_k66)},
  {&__pyx_n_socket_impl, 1, __pyx_k39, sizeof(__pyx_k39)},
  {&__pyx_n_socket_realsocket, 1, __pyx_k69, sizeof(__pyx_k69)},
  {&__pyx_n_socket_realsocketpair, 1, __pyx_k65, sizeof(__pyx_k65)},
  {&__pyx_n_socketpair, 1, __pyx_k191, sizeof(__pyx_k191)},
  {&__pyx_n_split, 1, __pyx_k145, sizeof(__pyx_k145)},
  {&__pyx_n_ssl, 1, __pyx_k94, sizeof(__pyx_k94)},
  {&__pyx_n_ssl_version, 1, __pyx_k82, sizeof(__pyx_k82)},
  {&__pyx_n_ssl_wrap_socket, 1, __pyx_k203, sizeof(__pyx_k203)},
  {&__pyx_n_sslsocket_impl, 1, __pyx_k67, sizeof(__pyx_k67)},
  {&__pyx_n_sslwrap, 1, __pyx_k96, sizeof(__pyx_k96)},
  {&__pyx_n_stackless, 1, __pyx_k15, sizeof(__pyx_k15)},
  {&__pyx_n_startswith, 1, __pyx_k150, sizeof(__pyx_k150)},
  {&__pyx_n_strip, 1, __pyx_k149, sizeof(__pyx_k149)},
  {&__pyx_n_suppress_ragged_eofs, 1, __pyx_k89, sizeof(__pyx_k89)},
  {&__pyx_n_sys, 1, __pyx_k216, sizeof(__pyx_k216)},
  {&__pyx_n_t, 1, __pyx_k139, sizeof(__pyx_k139)},
  {&__pyx_n_tasklet, 1, __pyx_k110, sizeof(__pyx_k110)},
  {&__pyx_n_tick, 1, __pyx_k120, sizeof(__pyx_k120)},
  {&__pyx_n_timeout, 1, __pyx_k182, sizeof(__pyx_k182)},
  {&__pyx_n_traceback, 1, __pyx_k138, sizeof(__pyx_k138)},
  {&__pyx_n_type, 1, __pyx_k45, sizeof(__pyx_k45)},
  {&__pyx_n_types, 1, __pyx_k180, sizeof(__pyx_k180)},
  {&__pyx_n_value, 1, __pyx_k137, sizeof(__pyx_k137)},
  {&__pyx_n_values, 1, __pyx_k166, sizeof(__pyx_k166)},
  {&__pyx_n_version, 1, __pyx_k220, sizeof(__pyx_k220)},
  {&__pyx_n_w, 1, __pyx_k20, sizeof(__pyx_k20)},
  {&__pyx_n_wrap_socket, 1, __pyx_k200, sizeof(__pyx_k200)},
  {&__pyx_n_write, 1, __pyx_k28, sizeof(__pyx_k28)},
  {&__pyx_n_write_buffer_limit, 1, __pyx_k34, sizeof(__pyx_k34)},
  {&__pyx_k1p, 0, __pyx_k1, sizeof(__pyx_k1)},
  {&__pyx_k19p, 0, __pyx_k19, sizeof(__pyx_k19)},
  {&__pyx_k22p, 0, __pyx_k22, sizeof(__pyx_k22)},
  {&__pyx_k26p, 0, __pyx_k26, sizeof(__pyx_k26)},
  {&__pyx_k37p, 0, __pyx_k37, sizeof(__pyx_k37)},
  {&__pyx_k70p, 0, __pyx_k70, sizeof(__pyx_k70)},
  {&__pyx_k71p, 0, __pyx_k71, sizeof(__pyx_k71)},
  {&__pyx_k92p, 0, __pyx_k92, sizeof(__pyx_k92)},
  {&__pyx_k99p, 0, __pyx_k99, sizeof(__pyx_k99)},
  {&__pyx_k102p, 0, __pyx_k102, sizeof(__pyx_k102)},
  {&__pyx_k104p, 0, __pyx_k104, sizeof(__pyx_k104)},
  {&__pyx_k105p, 0, __pyx_k105, sizeof(__pyx_k105)},
  {&__pyx_k115p, 0, __pyx_k115, sizeof(__pyx_k115)},
  {&__pyx_k122p, 0, __pyx_k122, sizeof(__pyx_k122)},
  {&__pyx_k124p, 0, __pyx_k124, sizeof(__pyx_k124)},
  {&__pyx_k126p, 0, __pyx_k126, sizeof(__pyx_k126)},
  {&__pyx_k127p, 0, __pyx_k127, sizeof(__pyx_k127)},
  {&__pyx_k128p, 0, __pyx_k128, sizeof(__pyx_k128)},
  {&__pyx_k129p, 0, __pyx_k129, sizeof(__pyx_k129)},
  {&__pyx_k133p, 0, __pyx_k133, sizeof(__pyx_k133)},
  {&__pyx_k136p, 0, __pyx_k136, sizeof(__pyx_k136)},
  {&__pyx_k140p, 0, __pyx_k140, sizeof(__pyx_k140)},
  {&__pyx_k141p, 0, __pyx_k141, sizeof(__pyx_k141)},
  {&__pyx_k142p, 0, __pyx_k142, sizeof(__pyx_k142)},
  {&__pyx_k143p, 0, __pyx_k143, sizeof(__pyx_k143)},
  {&__pyx_k144p, 0, __pyx_k144, sizeof(__pyx_k144)},
  {&__pyx_k146p, 0, __pyx_k146, sizeof(__pyx_k146)},
  {&__pyx_k147p, 0, __pyx_k147, sizeof(__pyx_k147)},
  {&__pyx_k148p, 0, __pyx_k148, sizeof(__pyx_k148)},
  {&__pyx_k151p, 0, __pyx_k151, sizeof(__pyx_k151)},
  {&__pyx_k157p, 0, __pyx_k157, sizeof(__pyx_k157)},
  {&__pyx_k159p, 0, __pyx_k159, sizeof(__pyx_k159)},
  {&__pyx_k162p, 0, __pyx_k162, sizeof(__pyx_k162)},
  {&__pyx_k164p, 0, __pyx_k164, sizeof(__pyx_k164)},
  {&__pyx_k204p, 0, __pyx_k204, sizeof(__pyx_k204)},
  {&__pyx_k214p, 0, __pyx_k214, sizeof(__pyx_k214)},
  {&__pyx_k215p, 0, __pyx_k215, sizeof(__pyx_k215)},
  {&__pyx_k217p, 0, __pyx_k217, sizeof(__pyx_k217)},
  {&__pyx_k221p, 0, __pyx_k221, sizeof(__pyx_k221)},
  {0, 0, 0, 0}
};

static int __pyx_d1;
static int __pyx_d2;
static int __pyx_d3;
static char __pyx_d4;
static char __pyx_d5;
static PyObject *__pyx_d6;
static PyObject *__pyx_d7;
static PyObject *__pyx_d8;
static PyObject *__pyx_d9;
static int __pyx_d10;
static PyObject *__pyx_d11;
static PyObject *__pyx_d12;
static PyObject *__pyx_d13;
static PyObject *__pyx_d14;
static PyObject *__pyx_d15;
static PyObject *__pyx_d16;
static PyObject *__pyx_d17;
static PyObject *__pyx_d18;
static int __pyx_d19;
static PyObject *__pyx_d20;
static int __pyx_d21;
static PyObject *__pyx_d22;
static int __pyx_d23;
static PyObject *__pyx_d24;
static char __pyx_d25;
static PyObject *__pyx_d26;
static int __pyx_d27;
static PyObject *__pyx_d28;
static int __pyx_d29;
static PyObject *__pyx_d30;
static int __pyx_d31;
static PyObject *__pyx_d32;
static PyObject *__pyx_d33;
static int __pyx_d34;
static int __pyx_d35;
static int __pyx_d36;
static int __pyx_d37;
static PyObject *__pyx_d38;
static int __pyx_d39;
static PyObject *__pyx_d40;
static PyObject *__pyx_d41;
static short __pyx_d42;
static PyObject *__pyx_d43;
static double __pyx_d44;
static int __pyx_d45;
static int __pyx_d46;
static int __pyx_d47;
static int __pyx_d48;
static PyObject *__pyx_d49;
static PyObject *__pyx_d50;
static PyObject *__pyx_d51;
static int __pyx_d52;
static int __pyx_d53;


/* Implementation of coio */

static PyObject *__pyx_f_4coio_has_feature_may_loop_return_1(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_has_feature_may_loop_return_1[] = "Return true iff loop() may return 1.";
static PyObject *__pyx_f_4coio_has_feature_may_loop_return_1(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_1 = PyInt_FromLong(FEATURE_MAY_EVENT_LOOP_RETURN_1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.has_feature_may_loop_return_1");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_has_feature_multiple_events_on_same_fd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_has_feature_multiple_events_on_same_fd[] = "Return true iff multiple events can be reliably registered on an fd.";
static PyObject *__pyx_f_4coio_has_feature_multiple_events_on_same_fd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_1 = PyInt_FromLong(FEATURE_MULTIPLE_EVENTS_ON_SAME_FD); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.has_feature_multiple_events_on_same_fd");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_version(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_version(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_1 = PyString_FromString(event_get_version()); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.version");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_method(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_method(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_1 = PyString_FromString(event_get_method()); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 297; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.method");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_reinit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_reinit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_do_recreate;
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"do_recreate",0};
  __pyx_v_do_recreate = __pyx_d1;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|i", __pyx_argnames, &__pyx_v_do_recreate)) return 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":301 */
  __pyx_1 = __pyx_v_do_recreate;
  if (__pyx_1) {
    __pyx_1 = __pyx_v_4coio_sigint_ev.ev_flags;
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":303 */
      event_del((&__pyx_v_4coio_sigint_ev));

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":304 */
      __pyx_v_got = coio_event_reinit(1);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":305 */
      __pyx_1 = (__pyx_v_got >= 0);
      if (__pyx_1) {
        __pyx_f_4coio__setup_sigint();
        goto __pyx_L4;
      }
      __pyx_L4:;
      goto __pyx_L3;
    }
    /*else*/ {
      __pyx_v_got = 0;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_v_got = coio_event_reinit(0);
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":311 */
  __pyx_1 = (__pyx_v_got < 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(EIO); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
    Py_INCREF(__pyx_k1p);
    PyTuple_SET_ITEM(__pyx_3, 1, __pyx_k1p);
    __pyx_2 = 0;
    __pyx_2 = PyObject_CallObject(PyExc_OSError, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; goto __pyx_L1;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.reinit");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_nonblocking_loop_for_tests(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_nonblocking_loop_for_tests[] = "Run event_loop(EVLOOP_ONCE | EVLOOP_NONBLOCK).\n\n    This method is intended to be used in tests to check that no events are\n    registered.\n    ";
static PyObject *__pyx_f_4coio_nonblocking_loop_for_tests(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_got;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":321 */
  /*with nogil:*/ {
    PyThreadState *_save;
    Py_UNBLOCK_THREADS
    /*try:*/ {
      __pyx_v_got = event_loop((EVLOOP_ONCE | EVLOOP_NONBLOCK));
    }
    /*finally:*/ {
      Py_BLOCK_THREADS
    }
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":323 */
  __pyx_1 = PyInt_FromLong(__pyx_v_got); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nonblocking_loop_for_tests");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio__schedule_helper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio__schedule_helper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_1 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_next); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_next); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_remove); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_run); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio._schedule_helper");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_insert_after_current(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_insert_after_current[] = "Insert next_tasklet after stackless.current if possible.";
static PyObject *__pyx_f_4coio_insert_after_current(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_next_tasklet = 0;
  PyObject *__pyx_v_next_now;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  static char *__pyx_argnames[] = {"next_tasklet",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_next_tasklet)) return 0;
  Py_INCREF(__pyx_v_next_tasklet);
  __pyx_v_next_now = Py_None; Py_INCREF(Py_None);
  __pyx_1 = __pyx_v_next_tasklet;
  Py_INCREF(__pyx_1);
  __pyx_2 = PyObject_IsTrue(__pyx_1); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; goto __pyx_L1;}
  if (__pyx_2) {
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_1 = PyObject_GetAttr(__pyx_v_next_tasklet, __pyx_n_alive); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; goto __pyx_L1;}
    __pyx_2 = PyObject_IsTrue(__pyx_1); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; goto __pyx_L1;}
    if (__pyx_2) {
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_v_next_tasklet, __pyx_n_blocked); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; goto __pyx_L1;}
      __pyx_4 = PyObject_IsTrue(__pyx_3); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_2 = (!__pyx_4);
      if (__pyx_2) {
        __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; goto __pyx_L1;}
        __pyx_2 = __pyx_v_next_tasklet != __pyx_3;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
      }
      __pyx_1 = PyInt_FromLong(__pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; goto __pyx_L1;}
    }
  }
  __pyx_4 = PyObject_IsTrue(__pyx_1); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_4) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":345 */
    __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; goto __pyx_L1;}
    __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_next); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_next_now);
    __pyx_v_next_now = __pyx_1;
    __pyx_1 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":346 */
    __pyx_2 = __pyx_v_next_now == __pyx_v_next_tasklet;
    if (__pyx_2) {
      goto __pyx_L3;
    }
    __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; goto __pyx_L1;}
    __pyx_4 = __pyx_v_next_now == __pyx_3;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_4) {
      __pyx_1 = PyObject_GetAttr(__pyx_v_next_tasklet, __pyx_n_insert); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; goto __pyx_L1;}
      __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L3;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":353 */
      __pyx_1 = PyObject_GetAttr(__pyx_v_next_tasklet, __pyx_n_remove); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; goto __pyx_L1;}
      __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":354 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n__schedule_helper_tasklet); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; goto __pyx_L1;}
      __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_insert); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":355 */
      __pyx_3 = PyObject_GetAttr(__pyx_v_next_tasklet, __pyx_n_insert); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; goto __pyx_L1;}
      __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":356 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n__schedule_helper_tasklet); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; goto __pyx_L1;}
      __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_run); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":357 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n__schedule_helper_tasklet); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; goto __pyx_L1;}
      __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_remove); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.insert_after_current");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_next_now);
  Py_DECREF(__pyx_v_next_tasklet);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_SendExceptionAndScheduleNext(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_SendExceptionAndScheduleNext[] = "Send exception to tasklet, even if it\'s blocked on a channel.\n\n    To get the tasklet is activated (to handle the exception) after\n    SendExceptionAndScheduleNext, just fall through to stackless.schedule()\n    and stackless.schedule_remove().\n\n    tasklet.insert() is called automatically to ensure that it eventually gets\n    scheduled.\n    ";
static PyObject *__pyx_f_4coio_SendExceptionAndScheduleNext(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyTaskletObject *__pyx_v_tasklet_obj = 0;
  PyObject *__pyx_v_exc_info = 0;
  PyObject *__pyx_v_bomb_obj;
  PyObject *__pyx_v_c;
  PyObject *__pyx_v_old_preference;
  PyObject *__pyx_v_i;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  Py_ssize_t __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"tasklet_obj","exc_info",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OO", __pyx_argnames, &__pyx_v_tasklet_obj, &__pyx_v_exc_info)) return 0;
  Py_INCREF(__pyx_v_tasklet_obj);
  Py_INCREF(__pyx_v_exc_info);
  __pyx_v_bomb_obj = Py_None; Py_INCREF(Py_None);
  __pyx_v_c = Py_None; Py_INCREF(Py_None);
  __pyx_v_old_preference = Py_None; Py_INCREF(Py_None);
  __pyx_v_i = Py_None; Py_INCREF(Py_None);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tasklet_obj), __pyx_ptype_4coio_tasklet, 1, "tasklet_obj")) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":370 */
  __pyx_1 = PyObject_IsInstance(__pyx_v_exc_info,((PyObject *)(&PyList_Type))); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; goto __pyx_L1;}
  if (!__pyx_1) {
    __pyx_1 = PyObject_IsInstance(__pyx_v_exc_info,((PyObject *)(&PyTuple_Type))); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; goto __pyx_L1;}
  }
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    __Pyx_Raise(PyExc_TypeError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":372 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_exc_info); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    __Pyx_Raise(PyExc_ValueError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":374 */
  __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; goto __pyx_L1;}
  __pyx_1 = ((PyObject *)__pyx_v_tasklet_obj) == __pyx_3;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {
    __pyx_4 = PyObject_Length(__pyx_v_exc_info); if (__pyx_4 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; goto __pyx_L1;}
    __pyx_2 = (__pyx_4 == 3);
    if (__pyx_2) {
      __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; goto __pyx_L1;}
      __pyx_5 = PyObject_GetItem(__pyx_v_exc_info, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; goto __pyx_L1;}
      __pyx_6 = PyObject_GetItem(__pyx_v_exc_info, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyInt_FromLong(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; goto __pyx_L1;}
      __pyx_7 = PyObject_GetItem(__pyx_v_exc_info, __pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_5, __pyx_6, __pyx_7);
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; goto __pyx_L1;}
      goto __pyx_L5;
    }
    __pyx_4 = PyObject_Length(__pyx_v_exc_info); if (__pyx_4 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; goto __pyx_L1;}
    __pyx_1 = (__pyx_4 == 2);
    if (__pyx_1) {
      __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; goto __pyx_L1;}
      __pyx_5 = PyObject_GetItem(__pyx_v_exc_info, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_6 = PyInt_FromLong(1); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; goto __pyx_L1;}
      __pyx_7 = PyObject_GetItem(__pyx_v_exc_info, __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __Pyx_Raise(__pyx_5, __pyx_7, Py_None);
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; goto __pyx_L1;}
      goto __pyx_L5;
    }
    /*else*/ {
      __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; goto __pyx_L1;}
      __pyx_6 = PyObject_GetItem(__pyx_v_exc_info, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_6, Py_None, Py_None);
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; goto __pyx_L1;}
    }
    __pyx_L5:;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":381 */
  __pyx_5 = PySequence_Tuple(__pyx_v_exc_info); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; goto __pyx_L1;}
  __pyx_7 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_bomb), __pyx_5); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  Py_DECREF(__pyx_v_bomb_obj);
  __pyx_v_bomb_obj = __pyx_7;
  __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":382 */
  __pyx_3 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_blocked); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; goto __pyx_L1;}
  __pyx_2 = PyObject_IsTrue(__pyx_3); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_2) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":383 */
    __pyx_6 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n__channel); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; goto __pyx_L1;}
    Py_DECREF(__pyx_v_c);
    __pyx_v_c = __pyx_6;
    __pyx_6 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":384 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_c, __pyx_n_preference); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; goto __pyx_L1;}
    Py_DECREF(__pyx_v_old_preference);
    __pyx_v_old_preference = __pyx_5;
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":385 */
    __pyx_7 = PyInt_FromLong(1); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; goto __pyx_L1;}
    if (PyObject_SetAttr(__pyx_v_c, __pyx_n_preference, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":389 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_c, __pyx_n_balance); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; goto __pyx_L1;}
    __pyx_6 = PyNumber_Negative(__pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_6);
    __pyx_6 = 0;
    __pyx_7 = PyObject_CallObject(((PyObject *)(&PyRange_Type)), __pyx_5); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_3 = PyObject_GetIter(__pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    for (;;) {
      __pyx_6 = PyIter_Next(__pyx_3);
      if (!__pyx_6) {
        if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; goto __pyx_L1;}
        break;
      }
      Py_DECREF(__pyx_v_i);
      __pyx_v_i = __pyx_6;
      __pyx_6 = 0;
      __pyx_5 = PyObject_GetAttr(__pyx_v_c, __pyx_n_send); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 390; goto __pyx_L1;}
      __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 390; goto __pyx_L1;}
      Py_INCREF(__pyx_v_bomb_obj);
      PyTuple_SET_ITEM(__pyx_7, 0, __pyx_v_bomb_obj);
      __pyx_6 = PyObject_CallObject(__pyx_5, __pyx_7); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 390; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
    }
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":391 */
    if (PyObject_SetAttr(__pyx_v_c, __pyx_n_preference, __pyx_v_old_preference) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":392 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    __pyx_5 = PyObject_GetAttr(((PyObject *)__pyx_v_tasklet_obj), __pyx_n_blocked); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; goto __pyx_L1;}
    __pyx_1 = PyObject_IsTrue(__pyx_5); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    if (!(!__pyx_1)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; goto __pyx_L1;}
    }
    #endif
    goto __pyx_L6;
  }
  /*else*/ {
    Py_INCREF(__pyx_v_bomb_obj);
    Py_DECREF(__pyx_v_tasklet_obj->tempval);
    __pyx_v_tasklet_obj->tempval = __pyx_v_bomb_obj;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":395 */
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_insert_after_current); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; goto __pyx_L1;}
  __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; goto __pyx_L1;}
  Py_INCREF(((PyObject *)__pyx_v_tasklet_obj));
  PyTuple_SET_ITEM(__pyx_6, 0, ((PyObject *)__pyx_v_tasklet_obj));
  __pyx_3 = PyObject_CallObject(__pyx_7, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.SendExceptionAndScheduleNext");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_bomb_obj);
  Py_DECREF(__pyx_v_c);
  Py_DECREF(__pyx_v_old_preference);
  Py_DECREF(__pyx_v_i);
  Py_DECREF(__pyx_v_tasklet_obj);
  Py_DECREF(__pyx_v_exc_info);
  return __pyx_r;
}

static void __pyx_f_4coio_set_fd_nonblocking(int __pyx_v_fd) {
  int __pyx_v_old;
  int __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":402 */
  __pyx_v_old = fcntl(__pyx_v_fd,F_GETFL);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":403 */
  __pyx_1 = (__pyx_v_old >= 0);
  if (__pyx_1) {
    __pyx_1 = (!(__pyx_v_old & O_NONBLOCK));
  }
  if (__pyx_1) {
    fcntl(__pyx_v_fd,F_SETFL,(__pyx_v_old | O_NONBLOCK));
    goto __pyx_L2;
  }
  __pyx_L2:;

}

static PyObject *__pyx_f_4coio_set_fd_blocking(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_set_fd_blocking[] = "Set a file descriptor blocking or non-blocking.\n\n    Please note that this may affect more than expected, for example it may\n    affect sys.stderr when called for sys.stdout.\n\n    Returns:\n      The old blocking value (True or False).\n    ";
static PyObject *__pyx_f_4coio_set_fd_blocking(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyObject *__pyx_v_is_blocking = 0;
  int __pyx_v_old;
  int __pyx_v_value;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"fd","is_blocking",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "iO", __pyx_argnames, &__pyx_v_fd, &__pyx_v_is_blocking)) return 0;
  Py_INCREF(__pyx_v_is_blocking);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":418 */
  __pyx_v_old = fcntl(__pyx_v_fd,F_GETFL);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":419 */
  __pyx_1 = (__pyx_v_old < 0);
  if (__pyx_1) {
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":421 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_is_blocking); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_v_value = (__pyx_v_old & (~O_NONBLOCK));
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_v_value = (__pyx_v_old | O_NONBLOCK);
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":425 */
  __pyx_1 = (__pyx_v_old != __pyx_v_value);
  if (__pyx_1) {
    fcntl(__pyx_v_fd,F_SETFL,__pyx_v_value);
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":427 */
  __pyx_2 = PyInt_FromLong((__pyx_v_old & O_NONBLOCK)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; goto __pyx_L1;}
  __pyx_1 = PyObject_IsTrue(__pyx_2); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyInt_FromLong(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.set_fd_blocking");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_is_blocking);
  return __pyx_r;
}

static int __pyx_f_4coio_nbevent_read(struct coio_evbuffer *__pyx_v_read_eb,int __pyx_v_fd,int __pyx_v_n) {
  int __pyx_v_got;
  int __pyx_r;
  int __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":446 */
  __pyx_1 = (__pyx_v_n > 0);
  if (__pyx_1) {
    coio_evbuffer_expand(__pyx_v_read_eb,__pyx_v_n);
    goto __pyx_L2;
  }
  __pyx_1 = (__pyx_v_n == 0);
  if (__pyx_1) {
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":451 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (!__pyx_v_read_eb->totallen) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 451; goto __pyx_L1;}
    }
    #endif

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":452 */
    __pyx_v_n = ((__pyx_v_read_eb->totallen - __pyx_v_read_eb->off) - __pyx_v_read_eb->misalign);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":453 */
    __pyx_1 = (__pyx_v_n == 0);
    if (__pyx_1) {
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L3;
    }
    __pyx_L3:;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":455 */
  __pyx_v_got = read(__pyx_v_fd,(((char *)__pyx_v_read_eb->buffer) + __pyx_v_read_eb->off),__pyx_v_n);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":456 */
  __pyx_1 = (__pyx_v_got > 0);
  if (__pyx_1) {
    __pyx_v_read_eb->off += __pyx_v_got;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":461 */
  __pyx_r = __pyx_v_got;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_WriteUnraisable("coio.nbevent_read");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_write_all_to_fd(int __pyx_v_fd,struct event *__pyx_v_write_wakeup_ev,char const* __pyx_v_p,Py_ssize_t __pyx_v_n,PyObject *__pyx_v_write_exc_class) {
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_INCREF(__pyx_v_write_exc_class);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":471 */
  while (1) {
    __pyx_1 = (__pyx_v_n > 0);
    if (!__pyx_1) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":472 */
    __pyx_v_got = write(__pyx_v_fd,__pyx_v_p,__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":473 */
    while (1) {
      __pyx_1 = (__pyx_v_got < 0);
      if (!__pyx_1) break;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":474 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(__pyx_v_write_exc_class, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":478 */
      __pyx_3 = coio_c_wait(__pyx_v_write_wakeup_ev,NULL); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":479 */
      __pyx_v_got = write(__pyx_v_fd,__pyx_v_p,__pyx_v_n);
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":480 */
    __pyx_v_p += __pyx_v_got;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":481 */
    __pyx_v_n -= __pyx_v_got;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.write_all_to_fd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_write_exc_class);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_MainLoop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_MainLoop(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_loop_retval;
  PyTaskletObject *__pyx_v_p;
  PyTaskletObject *__pyx_v_m;
  PyTaskletObject *__pyx_v_tm;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  long __pyx_2;
  int __pyx_3;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_v_tm = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":492 */
  __pyx_1 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 492; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_tm));
  __pyx_v_tm = ((PyTaskletObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":493 */
  __pyx_v_m = ((PyTaskletObject *)__pyx_v_tm);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":495 */
  while (1) {
    __pyx_2 = 1;
    if (!__pyx_2) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":510 */
    __pyx_3 = (__pyx_v_m->next != __pyx_v_m);
    if (__pyx_3) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":511 */
      __pyx_v_p = __pyx_v_m->prev;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":514 */
      Py_INCREF(((PyObject *)__pyx_v_p));

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":515 */
      /*with nogil:*/ {
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        /*try:*/ {
          event_loop((EVLOOP_ONCE | EVLOOP_NONBLOCK));
        }
        /*finally:*/ {
          Py_BLOCK_THREADS
        }
      }

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":517 */
      __pyx_3 = (__pyx_v_p->next != NULL);
      if (__pyx_3) {
        __pyx_3 = (!PyTasklet_GetBlocked(((PyTaskletObject *)__pyx_v_p)));
        if (__pyx_3) {
          __pyx_3 = (__pyx_v_p->next != __pyx_v_m);
        }
      }
      if (__pyx_3) {

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":525 */
        __pyx_v_m->prev->next = __pyx_v_m->next;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":526 */
        __pyx_v_m->next->prev = __pyx_v_m->prev;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":527 */
        __pyx_v_m->next = __pyx_v_p->next;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":528 */
        __pyx_v_m->prev = __pyx_v_p;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":529 */
        __pyx_v_p->next->prev = __pyx_v_m;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":530 */
        __pyx_v_p->next = __pyx_v_m;
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":531 */
      Py_DECREF(((PyObject *)__pyx_v_p));
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":534 */
      /*with nogil:*/ {
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        /*try:*/ {
          __pyx_v_loop_retval = event_loop(EVLOOP_ONCE);
        }
        /*finally:*/ {
          Py_BLOCK_THREADS
        }
      }

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":536 */
      __pyx_3 = __pyx_v_loop_retval;
      if (__pyx_3) {
        __pyx_r = Py_None; Py_INCREF(Py_None);
        goto __pyx_L0;
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":547 */
    __pyx_1 = PyStackless_Schedule(Py_None,0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.MainLoop");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_tm);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_SigIntHandler(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_SigIntHandler(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_SendExceptionAndScheduleNext); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; goto __pyx_L1;}
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_main); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; goto __pyx_L1;}
  Py_INCREF(PyExc_KeyboardInterrupt);
  PyTuple_SET_ITEM(__pyx_2, 0, PyExc_KeyboardInterrupt);
  __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_2);
  __pyx_3 = 0;
  __pyx_2 = 0;
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.SigIntHandler");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static void __pyx_f_4coio_HandleCSigInt(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  PyObject *__pyx_v_e;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  /*try:*/ {
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_SigIntHandler); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 560; goto __pyx_L2;}
    __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 560; goto __pyx_L2;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_1); __pyx_1 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":561 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_TaskletExit); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; goto __pyx_L1;}
  __pyx_3 = PyErr_ExceptionMatches(__pyx_1);
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_3) {
    __pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __Pyx_AddTraceback("coio.HandleCSigInt");
    PyErr_Fetch(&__pyx_2, &__pyx_1, &__pyx_4);
    if (__Pyx_NormalizeException(&__pyx_2, &__pyx_1, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; goto __pyx_L1;}
    Py_INCREF(__pyx_1);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_1;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_1); __pyx_1 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L3;
  }
  goto __pyx_L1;
  __pyx_L3:;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  __Pyx_WriteUnraisable("coio.HandleCSigInt");
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  PyGILState_Release(_save);
}

static void __pyx_f_4coio__setup_sigint(void) {

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":568 */
  event_set((&__pyx_v_4coio_sigint_ev),SIGINT,(EV_SIGNAL | EV_PERSIST),__pyx_f_4coio_HandleCSigInt,NULL);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":572 */
  __pyx_v_4coio_sigint_ev.ev_flags |= EVLIST_INTERNAL;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":575 */
  event_add((&__pyx_v_4coio_sigint_ev),NULL);

}

static void __pyx_f_4coio_HandleCWakeup(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  int __pyx_1;
  PyGILState_STATE _save = PyGILState_Ensure();

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":604 */
  __pyx_1 = ((PyTaskletObject *)__pyx_v_arg)->tempval == coio_waiting_token;
  if (__pyx_1) {
    Py_INCREF(coio_event_happened_token);
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = coio_event_happened_token;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":606 */
  __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_WriteUnraisable("coio.HandleCWakeup");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static void __pyx_f_4coio_HandleCTimeoutWakeup(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  int __pyx_1;
  PyGILState_STATE _save = PyGILState_Ensure();

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":612 */
  __pyx_1 = ((PyTaskletObject *)__pyx_v_arg)->tempval == coio_waiting_token;
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_evtype == EV_TIMEOUT);
    if (__pyx_1) {
      Py_INCREF(Py_None);
      Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
      ((PyTaskletObject *)__pyx_v_arg)->tempval = Py_None;
      goto __pyx_L3;
    }
    /*else*/ {
      Py_INCREF(coio_event_happened_token);
      Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
      ((PyTaskletObject *)__pyx_v_arg)->tempval = coio_event_happened_token;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":617 */
  __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_WriteUnraisable("coio.HandleCTimeoutWakeup");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static PyObject *__pyx_f_4coio_nbfile_readline_with_limit(struct __pyx_obj_4coio_nbfile *__pyx_v_self,int __pyx_v_limit) {
  int __pyx_v_n;
  int __pyx_v_got;
  int __pyx_v_min_off;
  char const* __pyx_v_q;
  int __pyx_v_fd;
  struct coio_evbuffer *__pyx_v_read_eb;
  int __pyx_v_had_short_read;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":664 */
  __pyx_v_read_eb = (&__pyx_v_self->read_eb);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":665 */
  __pyx_v_fd = __pyx_v_self->read_fd;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":666 */
  __pyx_v_had_short_read = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":667 */
  __pyx_v_min_off = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":668 */
  __pyx_1 = (__pyx_v_limit <= __pyx_v_read_eb->off);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":669 */
    __pyx_v_q = ((char const*)memchr(((void const*)__pyx_v_read_eb->buffer),'\n',__pyx_v_limit));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":670 */
    __pyx_1 = (__pyx_v_q != NULL);
    if (__pyx_1) {
      __pyx_v_limit = ((__pyx_v_q - ((char const*)__pyx_v_read_eb->buffer)) + 1);
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":672 */
    __pyx_2 = PyString_FromStringAndSize(((char const*)__pyx_v_read_eb->buffer),__pyx_v_limit); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; goto __pyx_L1;}
    Py_DECREF(__pyx_v_buf);
    __pyx_v_buf = __pyx_2;
    __pyx_2 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":673 */
    coio_evbuffer_drain(__pyx_v_read_eb,__pyx_v_limit);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":674 */
    Py_INCREF(__pyx_v_buf);
    __pyx_r = __pyx_v_buf;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":675 */
  __pyx_v_q = ((char const*)memchr(((void const*)__pyx_v_read_eb->buffer),'\n',__pyx_v_read_eb->off));

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":677 */
  while (1) {
    __pyx_1 = (__pyx_v_q == NULL);
    if (!__pyx_1) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":678 */
    __pyx_1 = __pyx_v_had_short_read;
    if (__pyx_1) {
      coio_evbuffer_expand(__pyx_v_read_eb,1);
      goto __pyx_L6;
    }
    __pyx_1 = (__pyx_v_read_eb->totallen == 0);
    if (__pyx_1) {
      coio_evbuffer_expand(__pyx_v_read_eb,__pyx_v_self->c_min_read_buffer_size);
      goto __pyx_L6;
    }
    /*else*/ {
      coio_evbuffer_expand(__pyx_v_read_eb,(__pyx_v_read_eb->totallen >> 1));
    }
    __pyx_L6:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":684 */
    __pyx_v_n = ((__pyx_v_read_eb->totallen - __pyx_v_read_eb->off) - __pyx_v_read_eb->misalign);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":685 */
    __pyx_1 = (__pyx_v_self->c_read_limit >= 0);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_self->c_read_limit < __pyx_v_n);
    }
    if (__pyx_1) {
      __pyx_v_n = __pyx_v_self->c_read_limit;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":688 */
    __pyx_v_got = __pyx_f_4coio_nbevent_read(__pyx_v_read_eb,__pyx_v_fd,__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":689 */
    while (1) {
      __pyx_1 = (__pyx_v_got < 0);
      if (!__pyx_1) break;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":690 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(__pyx_v_self->c_read_exc_class, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; goto __pyx_L1;}
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":694 */
      __pyx_3 = coio_c_wait((&__pyx_v_self->read_wakeup_ev),NULL); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":695 */
      __pyx_v_got = __pyx_f_4coio_nbevent_read(__pyx_v_read_eb,__pyx_v_fd,__pyx_v_n);
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":697 */
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":698 */
      __pyx_v_n = __pyx_v_read_eb->off;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":699 */
      __pyx_1 = (__pyx_v_limit < __pyx_v_n);
      if (__pyx_1) {

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":701 */
        __pyx_1 = (__pyx_v_limit == 0);
        if (__pyx_1) {
          Py_INCREF(__pyx_k19p);
          __pyx_r = __pyx_k19p;
          goto __pyx_L0;
          goto __pyx_L13;
        }
        __pyx_L13:;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":703 */
        __pyx_v_n = __pyx_v_limit;
        goto __pyx_L12;
      }
      __pyx_L12:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":704 */
      __pyx_4 = PyString_FromStringAndSize(((char const*)__pyx_v_read_eb->buffer),__pyx_v_n); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 704; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_4;
      __pyx_4 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":705 */
      coio_evbuffer_drain(__pyx_v_read_eb,__pyx_v_n);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":706 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L11;
    }
    __pyx_L11:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":707 */
    __pyx_1 = (__pyx_v_self->c_read_limit >= 0);
    if (__pyx_1) {
      __pyx_v_self->c_read_limit -= __pyx_v_got;
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":709 */
    __pyx_1 = (__pyx_v_limit <= __pyx_v_read_eb->off);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":710 */
      __pyx_v_q = ((char const*)memchr(((void const*)__pyx_v_read_eb->buffer),'\n',__pyx_v_limit));

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":711 */
      __pyx_1 = (__pyx_v_q != NULL);
      if (__pyx_1) {
        __pyx_v_limit = ((__pyx_v_q - ((char const*)__pyx_v_read_eb->buffer)) + 1);
        goto __pyx_L16;
      }
      __pyx_L16:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":713 */
      __pyx_2 = PyString_FromStringAndSize(((char const*)__pyx_v_read_eb->buffer),__pyx_v_limit); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_2;
      __pyx_2 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":714 */
      coio_evbuffer_drain(__pyx_v_read_eb,__pyx_v_limit);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":715 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L15;
    }
    __pyx_L15:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":716 */
    __pyx_1 = (__pyx_v_got < __pyx_v_n);
    if (__pyx_1) {
      __pyx_v_had_short_read = 1;
      goto __pyx_L17;
    }
    __pyx_L17:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":720 */
    __pyx_v_q = ((char const*)memchr(((void const*)(__pyx_v_read_eb->buffer + __pyx_v_min_off)),'\n',(__pyx_v_read_eb->off - __pyx_v_min_off)));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":722 */
    __pyx_v_min_off = __pyx_v_read_eb->off;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":723 */
  __pyx_v_n = ((__pyx_v_q - ((char const*)__pyx_v_read_eb->buffer)) + 1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":724 */
  __pyx_3 = PyString_FromStringAndSize(((char const*)__pyx_v_read_eb->buffer),__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 724; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":725 */
  coio_evbuffer_drain(__pyx_v_read_eb,__pyx_v_n);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":726 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile_readline_with_limit");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_6nbfile___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_read_fd;
  int __pyx_v_write_fd;
  int __pyx_v_write_buffer_limit;
  int __pyx_v_min_read_buffer_size;
  char __pyx_v_do_set_fd_nonblocking;
  char __pyx_v_do_close;
  PyObject *__pyx_v_close_ref = 0;
  PyObject *__pyx_v_mode = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  char __pyx_3;
  static char *__pyx_argnames[] = {"read_fd","write_fd","write_buffer_limit","min_read_buffer_size","do_set_fd_nonblocking","do_close","close_ref","mode","name",0};
  __pyx_v_write_buffer_limit = __pyx_d2;
  __pyx_v_min_read_buffer_size = __pyx_d3;
  __pyx_v_do_set_fd_nonblocking = __pyx_d4;
  __pyx_v_do_close = __pyx_d5;
  __pyx_v_close_ref = __pyx_d6;
  __pyx_v_mode = __pyx_d7;
  __pyx_v_name = __pyx_d8;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "ii|iibbOOO", __pyx_argnames, &__pyx_v_read_fd, &__pyx_v_write_fd, &__pyx_v_write_buffer_limit, &__pyx_v_min_read_buffer_size, &__pyx_v_do_set_fd_nonblocking, &__pyx_v_do_close, &__pyx_v_close_ref, &__pyx_v_mode, &__pyx_v_name)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_close_ref);
  Py_INCREF(__pyx_v_mode);
  Py_INCREF(__pyx_v_name);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":781 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = (__pyx_v_read_fd >= 0);
  if (!__pyx_1) {
    if (PyObject_Cmp(__pyx_v_mode, __pyx_n_w, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; goto __pyx_L1;}
    __pyx_1 = __pyx_1 == 0;
  }
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":782 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = (__pyx_v_write_fd >= 0);
  if (!__pyx_1) {
    if (PyObject_Cmp(__pyx_v_mode, __pyx_n_r, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; goto __pyx_L1;}
    __pyx_1 = __pyx_1 == 0;
  }
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":783 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; goto __pyx_L1;}
  Py_INCREF(__pyx_n_r);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_n_r);
  Py_INCREF(__pyx_n_w);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_n_w);
  Py_INCREF(__pyx_k22p);
  PyTuple_SET_ITEM(__pyx_2, 2, __pyx_k22p);
  __pyx_1 = PySequence_Contains(__pyx_2, __pyx_v_mode); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":784 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":785 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close = __pyx_v_do_close;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":786 */
  Py_INCREF(PyExc_IOError);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class = PyExc_IOError;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":787 */
  Py_INCREF(PyExc_IOError);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class = PyExc_IOError;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":788 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd = __pyx_v_read_fd;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":789 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd = __pyx_v_write_fd;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":790 */
  __pyx_3 = __pyx_v_do_set_fd_nonblocking;
  if (__pyx_3) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":791 */
    __pyx_1 = (__pyx_v_read_fd >= 0);
    if (__pyx_1) {
      __pyx_f_4coio_set_fd_nonblocking(__pyx_v_read_fd);
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":793 */
    __pyx_1 = (__pyx_v_write_fd >= 0);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_write_fd != __pyx_v_read_fd);
    }
    if (__pyx_1) {
      __pyx_f_4coio_set_fd_nonblocking(__pyx_v_write_fd);
      goto __pyx_L4;
    }
    __pyx_L4:;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":795 */
  __pyx_1 = (__pyx_v_write_buffer_limit < 0);
  if (__pyx_1) {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_e_4coio_DEFAULT_WRITE_BUFFER_LIMIT;
    goto __pyx_L5;
  }
  /*else*/ {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_v_write_buffer_limit;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":799 */
  __pyx_1 = (__pyx_v_min_read_buffer_size < 3);
  if (__pyx_1) {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size = __pyx_e_4coio_DEFAULT_MIN_READ_BUFFER_SIZE;
    goto __pyx_L6;
  }
  /*else*/ {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size = __pyx_v_min_read_buffer_size;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":803 */
  Py_INCREF(__pyx_v_close_ref);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref = __pyx_v_close_ref;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":804 */
  Py_INCREF(__pyx_v_mode);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode = __pyx_v_mode;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":805 */
  Py_INCREF(__pyx_v_name);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name = __pyx_v_name;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":809 */
  __pyx_1 = (__pyx_v_read_fd >= 0);
  if (__pyx_1) {
    event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),__pyx_v_read_fd,EV_READ,__pyx_f_4coio_HandleCWakeup,NULL);
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":812 */
  __pyx_1 = (__pyx_v_write_fd >= 0);
  if (__pyx_1) {
    event_set((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),__pyx_v_write_fd,EV_WRITE,__pyx_f_4coio_HandleCWakeup,NULL);
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_close_ref);
  Py_DECREF(__pyx_v_mode);
  Py_DECREF(__pyx_v_name);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd >= 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 818; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 820; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_write_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_write_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.write_fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static void __pyx_f_4coio_6nbfile___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_f_4coio_6nbfile___dealloc__(PyObject *__pyx_v_self) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_close); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.__dealloc__");
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
}

static PyObject *__pyx_f_4coio_6nbfile_forget_write_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_forget_write_fd[] = "Return and forget the write file descriptor.";
static PyObject *__pyx_f_4coio_6nbfile_forget_write_fd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_retval;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":834 */
  __pyx_v_retval = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":835 */
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":836 */
  __pyx_1 = PyInt_FromLong(__pyx_v_retval); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 836; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.forget_write_fd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_got;
  PyObject *__pyx_v_exc;
  PyObject *__pyx_v_close_ref;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  char __pyx_4;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_exc = Py_None; Py_INCREF(Py_None);
  __pyx_v_close_ref = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":840 */
  /*try:*/ {
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off > 0);
    if (__pyx_1) {
      __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_flush); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 843; goto __pyx_L3;}
      __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 843; goto __pyx_L3;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_why = 0; goto __pyx_L4;
    __pyx_L3: {
      __pyx_why = 4;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L4;
    }
    __pyx_L4:;
    __pyx_1 = (!((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":846 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed = 1;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":847 */
      __pyx_4 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close;
      if (__pyx_4) {
        __pyx_1 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref == Py_None;
        if (__pyx_1) {

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":849 */
          __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd >= 0);
          if (__pyx_1) {

            /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":850 */
            __pyx_v_got = close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd);

            /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":851 */
            __pyx_1 = (__pyx_v_got < 0);
            if (__pyx_1) {

              /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":852 */
              __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; goto __pyx_L6;}
              __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; goto __pyx_L6;}
              __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; goto __pyx_L6;}
              PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
              PyTuple_SET_ITEM(__pyx_5, 1, __pyx_3);
              __pyx_2 = 0;
              __pyx_3 = 0;
              __pyx_2 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; goto __pyx_L6;}
              Py_DECREF(__pyx_5); __pyx_5 = 0;
              Py_DECREF(__pyx_v_exc);
              __pyx_v_exc = __pyx_2;
              __pyx_2 = 0;

              /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":853 */
              close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd);

              /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":854 */
              __Pyx_Raise(__pyx_v_exc, 0, 0);
              {__pyx_filename = __pyx_f[0]; __pyx_lineno = 854; goto __pyx_L6;}
              goto __pyx_L11;
            }
            __pyx_L11:;
            goto __pyx_L10;
          }
          __pyx_L10:;

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":855 */
          __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd != ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd);
          if (__pyx_1) {
            __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd > 0);
          }
          if (__pyx_1) {

            /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":857 */
            __pyx_v_got = close(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd);

            /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":858 */
            __pyx_1 = (__pyx_v_got < 0);
            if (__pyx_1) {
              __pyx_3 = PyInt_FromLong(errno); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; goto __pyx_L6;}
              __pyx_5 = PyString_FromString(strerror(errno)); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; goto __pyx_L6;}
              __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; goto __pyx_L6;}
              PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
              PyTuple_SET_ITEM(__pyx_2, 1, __pyx_5);
              __pyx_3 = 0;
              __pyx_5 = 0;
              __pyx_3 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; goto __pyx_L6;}
              Py_DECREF(__pyx_2); __pyx_2 = 0;
              __Pyx_Raise(__pyx_3, 0, 0);
              Py_DECREF(__pyx_3); __pyx_3 = 0;
              {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; goto __pyx_L6;}
              goto __pyx_L13;
            }
            __pyx_L13:;
            goto __pyx_L12;
          }
          __pyx_L12:;
          goto __pyx_L9;
        }
        /*else*/ {

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":861 */
          Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
          Py_DECREF(__pyx_v_close_ref);
          __pyx_v_close_ref = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref;

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":862 */
          Py_INCREF(Py_False);
          Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref);
          ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->close_ref = Py_False;

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":863 */
          __pyx_1 = __pyx_v_close_ref != Py_False;
          if (__pyx_1) {
            __pyx_5 = PyObject_GetAttr(__pyx_v_close_ref, __pyx_n_close); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; goto __pyx_L6;}
            __pyx_2 = PyObject_CallObject(__pyx_5, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; goto __pyx_L6;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            __pyx_r = __pyx_2;
            __pyx_2 = 0;
            goto __pyx_L0;
            goto __pyx_L14;
          }
          __pyx_L14:;
        }
        __pyx_L9:;
        goto __pyx_L8;
      }
      __pyx_L8:;
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L15;
    __pyx_L6:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1;
    __pyx_L15:;
    switch (__pyx_why) {
      case 4: {
        PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1;
      }
    }
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.close");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc);
  Py_DECREF(__pyx_v_close_ref);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_6closed___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_6closed___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  char __pyx_1;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_closed;
  if (__pyx_1) {
    Py_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_8do_close___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_8do_close___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_do_close); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.do_close.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_10read_limit___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_10read_limit___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 889; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.read_limit.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile_10read_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_value); /*proto*/
static int __pyx_f_4coio_6nbfile_10read_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_value) {
  int __pyx_v_new_value;
  int __pyx_r;
  Py_INCREF(__pyx_v_self);
  __pyx_v_new_value = PyInt_AsLong(__pyx_arg_new_value); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 890; goto __pyx_L1;}
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit = __pyx_v_new_value;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.read_limit.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_14read_exc_class___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_14read_exc_class___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile_14read_exc_class___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_new_value); /*proto*/
static int __pyx_f_4coio_6nbfile_14read_exc_class___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_new_value) {
  int __pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_new_value);
  Py_INCREF(__pyx_v_new_value);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class = __pyx_v_new_value;

  __pyx_r = 0;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_new_value);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_15write_exc_class___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_15write_exc_class___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile_15write_exc_class___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_new_value); /*proto*/
static int __pyx_f_4coio_6nbfile_15write_exc_class___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_new_value) {
  int __pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_new_value);
  Py_INCREF(__pyx_v_new_value);
  Py_DECREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class);
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class = __pyx_v_new_value;

  __pyx_r = 0;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_new_value);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_4mode___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_4mode___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_mode;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_4name___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_4name___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name);
  __pyx_r = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_name;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_9softspace___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_9softspace___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_softspace); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 916; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.softspace.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile_9softspace___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_softspace); /*proto*/
static int __pyx_f_4coio_6nbfile_9softspace___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_softspace) {
  char __pyx_v_softspace;
  int __pyx_r;
  Py_INCREF(__pyx_v_self);
  __pyx_v_softspace = PyInt_AsLong(__pyx_arg_softspace); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 917; goto __pyx_L1;}
  ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_softspace = __pyx_v_softspace;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.softspace.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_8encoding___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_8encoding___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_8newlines___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_8newlines___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_6errors___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_6errors___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(Py_None);
  __pyx_r = Py_None;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_unread(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_unread[] = "Push back some data to beginning of the read buffer.\n\n        There is no such Python `file\' method (file.unread).\n\n        Please note that this can be slow (quadratic) if the same amount\n        (or a bit more) has not been read recently.\n        ";
static PyObject *__pyx_f_4coio_6nbfile_unread(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_buf = 0;
  char const* __pyx_v_p;
  Py_ssize_t __pyx_v_n;
  struct coio_evbuffer *__pyx_v_read_eb;
  PyObject *__pyx_r;
  int __pyx_1;
  static char *__pyx_argnames[] = {"buf",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_buf)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_buf);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":946 */
  __pyx_1 = PyObject_AsCharBuffer(__pyx_v_buf,(&__pyx_v_p),(&__pyx_v_n)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 946; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":947 */
  __pyx_1 = (__pyx_v_n <= 0);
  if (__pyx_1) {
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":949 */
  __pyx_v_read_eb = (&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":950 */
  __pyx_1 = (__pyx_v_read_eb->off == 0);
  if (__pyx_1) {
    coio_evbuffer_add(__pyx_v_read_eb,((void const*)__pyx_v_p),__pyx_v_n);
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_read_eb->misalign >= __pyx_v_n);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":953 */
    __pyx_v_read_eb->misalign -= __pyx_v_n;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":954 */
    __pyx_v_read_eb->buffer -= __pyx_v_n;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":955 */
    __pyx_v_read_eb->off += __pyx_v_n;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":956 */
    memcpy(__pyx_v_read_eb->buffer,((void const*)__pyx_v_p),__pyx_v_n);
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":960 */
    coio_evbuffer_expand(__pyx_v_read_eb,__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":961 */
    memmove((__pyx_v_read_eb->buffer + __pyx_v_n),((void const*)__pyx_v_read_eb->buffer),__pyx_v_read_eb->off);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":962 */
    memcpy(__pyx_v_read_eb->buffer,((void const*)__pyx_v_p),__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":963 */
    __pyx_v_read_eb->off += __pyx_v_n;
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.unread");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_buf);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_unread_append(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_unread_append[] = "Push back some data to end of the read buffer.\n\n        There is no such Python `file\' method (file.unread_buffer).\n\n        Please note that this call is always linear.\n        ";
static PyObject *__pyx_f_4coio_6nbfile_unread_append(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_buf = 0;
  char const* __pyx_v_p;
  Py_ssize_t __pyx_v_n;
  PyObject *__pyx_r;
  int __pyx_1;
  static char *__pyx_argnames[] = {"buf",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_buf)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_buf);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":975 */
  __pyx_1 = PyObject_AsCharBuffer(__pyx_v_buf,(&__pyx_v_p),(&__pyx_v_n)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":976 */
  __pyx_1 = (__pyx_v_n > 0);
  if (__pyx_1) {
    coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((void const*)__pyx_v_p),__pyx_v_n);
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.unread_append");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_buf);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_buf = 0;
  char const* __pyx_v_p;
  Py_ssize_t __pyx_v_k;
  Py_ssize_t __pyx_v_n;
  int __pyx_v_wlimit;
  int __pyx_v_keepc;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"buf",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_buf)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_buf);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":986 */
  __pyx_1 = PyObject_AsCharBuffer(__pyx_v_buf,(&__pyx_v_p),(&__pyx_v_n)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 986; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":987 */
  __pyx_1 = (__pyx_v_n <= 0);
  if (__pyx_1) {
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":989 */
  __pyx_v_wlimit = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":992 */
  __pyx_1 = (__pyx_v_wlimit == 2);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":993 */
    coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((void const*)__pyx_v_p),__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":994 */
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":995 */
  __pyx_1 = (__pyx_v_wlimit == 0);
  if (__pyx_1) {
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off == 0);
  }
  if (__pyx_1) {
    __pyx_2 = __pyx_f_4coio_write_all_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),__pyx_v_p,__pyx_v_n,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1003 */
  __pyx_1 = (__pyx_v_wlimit == 1);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1004 */
    __pyx_v_k = __pyx_v_n;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1005 */
    while (1) {
      __pyx_1 = (__pyx_v_k > 0);
      if (__pyx_1) {
        __pyx_1 = ((((char *)__pyx_v_p)[(__pyx_v_k - 1)]) != '\n');
      }
      if (!__pyx_1) break;
      __pyx_v_k -= 1;
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1007 */
    __pyx_1 = (__pyx_v_k == 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1008 */
      coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1009 */
      coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((void const*)__pyx_v_p),__pyx_v_n);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1010 */
      __pyx_r = Py_None; Py_INCREF(Py_None);
      goto __pyx_L0;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1011 */
    __pyx_v_keepc = (__pyx_v_n - __pyx_v_k);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1012 */
    __pyx_v_n = __pyx_v_k;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1015 */
    __pyx_v_k = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.totallen - (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off + ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.misalign));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1017 */
    __pyx_1 = (__pyx_v_k > __pyx_v_n);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1018 */
      coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((void const*)__pyx_v_p),__pyx_v_n);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1019 */
      __pyx_2 = __pyx_f_4coio_write_all_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1023 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.orig_buffer;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1024 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.misalign = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1025 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off = 0;
      goto __pyx_L9;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1027 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off > 0);
      if (__pyx_1) {

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1029 */
        __pyx_2 = __pyx_f_4coio_write_all_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1029; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1033 */
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.orig_buffer;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1034 */
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.misalign = 0;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1035 */
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off = 0;
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1037 */
      __pyx_2 = __pyx_f_4coio_write_all_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),__pyx_v_p,__pyx_v_n,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1037; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }
    __pyx_L9:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1039 */
    __pyx_1 = (__pyx_v_keepc > 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1040 */
      __pyx_v_p += __pyx_v_n;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1041 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.totallen == 0);
      if (__pyx_1) {
        coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size);
        goto __pyx_L12;
      }
      __pyx_L12:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1046 */
      coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((void const*)__pyx_v_p),__pyx_v_keepc);
      goto __pyx_L11;
    }
    __pyx_L11:;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1048 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off != 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1049 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.totallen == 0);
      if (__pyx_1) {
        coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),__pyx_v_wlimit);
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1051 */
      __pyx_v_k = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.totallen - (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off + ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.misalign));

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1053 */
      __pyx_1 = (__pyx_v_k > __pyx_v_n);
      if (__pyx_1) {

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1054 */
        coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((void const*)__pyx_v_p),__pyx_v_n);

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1055 */
        __pyx_r = Py_None; Py_INCREF(Py_None);
        goto __pyx_L0;
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1056 */
      coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((void const*)__pyx_v_p),__pyx_v_k);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1057 */
      __pyx_v_p += __pyx_v_k;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1058 */
      __pyx_v_n -= __pyx_v_k;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1063 */
      __pyx_2 = __pyx_f_4coio_write_all_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1067 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.orig_buffer;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1068 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.misalign = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1069 */
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off = 0;
      goto __pyx_L13;
    }
    __pyx_L13:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1071 */
    __pyx_1 = (__pyx_v_n >= __pyx_v_wlimit);
    if (__pyx_1) {
      __pyx_2 = __pyx_f_4coio_write_all_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),__pyx_v_p,__pyx_v_n,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1073; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L16;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1076 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.totallen == 0);
      if (__pyx_1) {
        coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),__pyx_v_wlimit);
        goto __pyx_L17;
      }
      __pyx_L17:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1078 */
      coio_evbuffer_add((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((void const*)__pyx_v_p),__pyx_v_n);
    }
    __pyx_L16:;
  }
  __pyx_L5:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.write");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_buf);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_flush(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_flush(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off > 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1084 */
    __pyx_2 = __pyx_f_4coio_write_all_to_fd(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_fd,(&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_wakeup_ev),((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1084; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1087 */
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.buffer = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.orig_buffer;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1088 */
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.misalign = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1089 */
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.flush");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_15read_buffer_len___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_15read_buffer_len___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1093; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.read_buffer_len.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_20read_buffer_misalign___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_20read_buffer_misalign___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.misalign); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.read_buffer_misalign.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_20read_buffer_totallen___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_20read_buffer_totallen___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1101; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.read_buffer_totallen.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_16write_buffer_len___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_16write_buffer_len___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1105; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.write_buffer_len.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_18write_buffer_limit___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_18write_buffer_limit___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbfile.write_buffer_limit.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_6nbfile_18write_buffer_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_limit); /*proto*/
static int __pyx_f_4coio_6nbfile_18write_buffer_limit___set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_new_limit) {
  int __pyx_v_new_limit;
  int __pyx_r;
  int __pyx_1;
  Py_INCREF(__pyx_v_self);
  __pyx_v_new_limit = PyInt_AsLong(__pyx_arg_new_limit); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1111; goto __pyx_L1;}
  __pyx_1 = (__pyx_v_new_limit < 0);
  if (__pyx_1) {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_e_4coio_DEFAULT_WRITE_BUFFER_LIMIT;
    goto __pyx_L2;
  }
  /*else*/ {
    ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_buffer_limit = __pyx_v_new_limit;
  }
  __pyx_L2:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbfile.write_buffer_limit.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_discard_write_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_discard_write_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->write_eb.off);

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_discard[] = "Read and discard exactly n bytes.\n\n        Please note that self.read_fd won\'t be read past the n bytes specified.\n        TODO(pts): Add an option to speed up HTTP keep-alives by batching\n        multiple read requests.\n\n        Args:\n          n: Number of bytes to discard. Negative values are treated as 0.\n        Returns:\n          The number of bytes not discarded because of EOF.\n        Raises:\n          self.c_read_exc_cass or IOError: (but not EOFError)\n        ";
static PyObject *__pyx_f_4coio_6nbfile_discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1135 */
  __pyx_1 = (__pyx_v_n <= 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1137 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1138 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off >= __pyx_v_n);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1139 */
      coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1140 */
      __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; goto __pyx_L1;}
      __pyx_r = __pyx_2;
      __pyx_2 = 0;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1141 */
    coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1142 */
    __pyx_v_n -= ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1143 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1144 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
    }
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1145 */
      __pyx_v_got = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1146 */
      __pyx_1 = (__pyx_v_got == 0);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; goto __pyx_L1;}
        __pyx_r = __pyx_2;
        __pyx_2 = 0;
        goto __pyx_L0;
        goto __pyx_L8;
      }
      __pyx_L8:;
      goto __pyx_L7;
    }
    /*else*/ {
      __pyx_v_got = __pyx_v_n;
    }
    __pyx_L7:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1150 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen == 0);
    if (__pyx_1) {
      coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size);
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1153 */
    __pyx_v_got = __pyx_f_4coio_nbevent_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_got);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1154 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1155 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; goto __pyx_L1;}
        __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
        __pyx_2 = 0;
        __pyx_4 = 0;
        __pyx_2 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; goto __pyx_L1;}
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1157 */
      __pyx_4 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1157; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L10;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {
      __pyx_5 = PyInt_FromLong(__pyx_v_n); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; goto __pyx_L1;}
      __pyx_r = __pyx_5;
      __pyx_5 = 0;
      goto __pyx_L0;
      goto __pyx_L10;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1161 */
      __pyx_v_n -= __pyx_v_got;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1162 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_1) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L12;
      }
      __pyx_L12:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1164 */
      coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_got);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1165 */
      __pyx_1 = (__pyx_v_n == 0);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; goto __pyx_L1;}
        __pyx_r = __pyx_2;
        __pyx_2 = 0;
        goto __pyx_L0;
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __pyx_L10:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.discard");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_discard_to_read_limit(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_discard_to_read_limit[] = "Discard the read buffer, and discard bytes from read_fd.\n\n        If there is no read limit set up, than no bytes will be discarded\n        from read_fd.\n\n        Returns:\n          The number of bytes not discarded because of EOF.\n        Raises:\n          self.c_read_exc_cass or IOError: (but not EOFError)\n        ";
static PyObject *__pyx_f_4coio_6nbfile_discard_to_read_limit(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1179 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_1) {
    coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1182 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit > 0);
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_discard); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1186; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.discard_to_read_limit");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_wait_for_readable(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_wait_for_readable(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  struct timeval __pyx_v_tv;
  double __pyx_v_timeout_double;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  double __pyx_3;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  __pyx_v_timeout = __pyx_d9;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_timeout);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1193 */
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    __pyx_2 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; goto __pyx_L1;}
    __pyx_1 = __pyx_2 == coio_event_happened_token;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyInt_FromLong(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1197 */
    __pyx_3 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; goto __pyx_L1;}
    __pyx_v_timeout_double = __pyx_3;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1198 */
    __pyx_1 = (__pyx_v_timeout_double < 0.0);
    if (__pyx_1) {
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1199; goto __pyx_L1;}
      Py_INCREF(__pyx_k26p);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_k26p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1199; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1199; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1200 */
    __pyx_1 = (__pyx_v_timeout_double == 0.0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1201 */
      __pyx_v_tv.tv_sec = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1202 */
      __pyx_v_tv.tv_usec = 1;
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1204 */
      __pyx_v_tv.tv_sec = ((long)__pyx_v_timeout_double);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1205 */
      __pyx_v_tv.tv_usec = ((unsigned int)((__pyx_v_timeout_double - ((double)__pyx_v_tv.tv_sec)) * 1000000.0));
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1207 */
    __pyx_2 = coio_c_wait_for(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,EV_READ,__pyx_f_4coio_HandleCTimeoutWakeup,(&__pyx_v_tv)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; goto __pyx_L1;}
    __pyx_1 = __pyx_2 == coio_event_happened_token;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_4 = PyInt_FromLong(__pyx_1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1209; goto __pyx_L1;}
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.wait_for_readable");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_read[] = "Read exactly n bytes (or less on EOF), and return string\n\n        Args:\n          n: Number of bytes to read. Negative values mean: read up to EOF\n            (or up to self.read_limit).\n        Returns:\n          String containing the bytes read; an empty string on EOF.\n        Raises:\n          self.c_read_exc_class or IOError: (but not EOFError)\n        ";
static PyObject *__pyx_f_4coio_6nbfile_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  int __pyx_v_got;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  long __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"n",0};
  __pyx_v_n = __pyx_d10;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1225 */
  __pyx_1 = (__pyx_v_n < 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1226 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1227 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen == 0);
      if (__pyx_1) {
        coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size);
        goto __pyx_L4;
      }
      __pyx_L4:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1230 */
      while (1) {
        __pyx_2 = 1;
        if (!__pyx_2) break;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1232 */
        coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen >> 1));

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1233 */
        __pyx_v_got = __pyx_f_4coio_nbevent_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,((((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off) - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.misalign));

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1237 */
        __pyx_1 = (__pyx_v_got < 0);
        if (__pyx_1) {

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1238 */
          __pyx_1 = (errno != EAGAIN);
          if (__pyx_1) {
            __pyx_3 = PyInt_FromLong(errno); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; goto __pyx_L1;}
            __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; goto __pyx_L1;}
            __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; goto __pyx_L1;}
            PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
            PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
            __pyx_3 = 0;
            __pyx_4 = 0;
            __pyx_3 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; goto __pyx_L1;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            __Pyx_Raise(__pyx_3, 0, 0);
            Py_DECREF(__pyx_3); __pyx_3 = 0;
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; goto __pyx_L1;}
            goto __pyx_L8;
          }
          __pyx_L8:;

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1240 */
          __pyx_4 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; goto __pyx_L1;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          goto __pyx_L7;
        }
        __pyx_1 = (__pyx_v_got == 0);
        if (__pyx_1) {
          goto __pyx_L6;
          goto __pyx_L7;
        }
        __pyx_L7:;
      }
      __pyx_L6:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1243 */
      __pyx_5 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1243; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_5;
      __pyx_5 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1245 */
      coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1246 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1247 */
    __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1248 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off >= __pyx_v_n);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1249 */
    __pyx_1 = (__pyx_v_n <= 0);
    if (__pyx_1) {
      Py_INCREF(__pyx_k19p);
      __pyx_r = __pyx_k19p;
      goto __pyx_L0;
      goto __pyx_L10;
    }
    __pyx_L10:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1251 */
    __pyx_3 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1251; goto __pyx_L1;}
    Py_DECREF(__pyx_v_buf);
    __pyx_v_buf = __pyx_3;
    __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1252 */
    coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1253 */
    Py_INCREF(__pyx_v_buf);
    __pyx_r = __pyx_v_buf;
    goto __pyx_L0;
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1260 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1261 */
    __pyx_v_got = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit + ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1262 */
    __pyx_1 = (__pyx_v_n > __pyx_v_got);
    if (__pyx_1) {
      __pyx_v_n = __pyx_v_got;
      goto __pyx_L12;
    }
    __pyx_L12:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1264 */
    __pyx_1 = (__pyx_v_n <= 0);
    if (__pyx_1) {
      Py_INCREF(__pyx_k19p);
      __pyx_r = __pyx_k19p;
      goto __pyx_L0;
      goto __pyx_L13;
    }
    __pyx_L13:;
    goto __pyx_L11;
  }
  __pyx_L11:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1266 */
  while (1) {
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off < __pyx_v_n);
    if (!__pyx_1) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1269 */
    __pyx_v_got = (__pyx_v_n - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1270 */
    __pyx_1 = (__pyx_v_got > 65536);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_got > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen);
    }
    if (__pyx_1) {
      __pyx_v_got = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen;
      goto __pyx_L16;
    }
    __pyx_L16:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1277 */
    __pyx_v_got = __pyx_f_4coio_nbevent_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_got);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1278 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1279 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_4 = PyInt_FromLong(errno); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1280; goto __pyx_L1;}
        __pyx_5 = PyString_FromString(strerror(errno)); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1280; goto __pyx_L1;}
        __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1280; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_3, 0, __pyx_4);
        PyTuple_SET_ITEM(__pyx_3, 1, __pyx_5);
        __pyx_4 = 0;
        __pyx_5 = 0;
        __pyx_4 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1280; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __Pyx_Raise(__pyx_4, 0, 0);
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1280; goto __pyx_L1;}
        goto __pyx_L18;
      }
      __pyx_L18:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1281 */
      __pyx_5 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      goto __pyx_L17;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1283 */
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1284 */
      goto __pyx_L15;
      goto __pyx_L17;
    }
    /*else*/ {
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_1) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L19;
      }
      __pyx_L19:;
    }
    __pyx_L17:;
  }
  __pyx_L15:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1288 */
  __pyx_3 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1289 */
  coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1290 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.read");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_read_at_most(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_read_at_most[] = "Read at most n bytes and return the string.\n\n        Negative values for n are not allowed.\n\n        If the read buffer is not empty (self.read_buffer_len), data inside it\n        will be returned, and no attempt is done to read self.read_fd.\n        ";
static PyObject *__pyx_f_4coio_6nbfile_read_at_most(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_n;
  int __pyx_v_got;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1301 */
  __pyx_1 = (__pyx_v_n <= 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1302 */
    __pyx_1 = (__pyx_v_n < 0);
    if (__pyx_1) {
      __Pyx_Raise(PyExc_ValueError, 0, 0);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1303; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1304 */
    Py_INCREF(__pyx_k19p);
    __pyx_r = __pyx_k19p;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1305 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off > 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1306 */
    __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off < __pyx_v_n);
    if (__pyx_1) {
      __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1308 */
    __pyx_2 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; goto __pyx_L1;}
    Py_DECREF(__pyx_v_buf);
    __pyx_v_buf = __pyx_2;
    __pyx_2 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1309 */
    coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1311 */
    Py_INCREF(__pyx_v_buf);
    __pyx_r = __pyx_v_buf;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1312 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
  }
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1313 */
    __pyx_v_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1314 */
    __pyx_1 = (__pyx_v_n <= 0);
    if (__pyx_1) {
      Py_INCREF(__pyx_k19p);
      __pyx_r = __pyx_k19p;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1316 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1319 */
    __pyx_v_got = __pyx_f_4coio_nbevent_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1320 */
    __pyx_1 = (__pyx_v_got < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1321 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1322; goto __pyx_L1;}
        __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1322; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1322; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
        __pyx_2 = 0;
        __pyx_4 = 0;
        __pyx_2 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1322; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1322; goto __pyx_L1;}
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1323 */
      __pyx_4 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1323; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L10;
    }
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {
      Py_INCREF(__pyx_k19p);
      __pyx_r = __pyx_k19p;
      goto __pyx_L0;
      goto __pyx_L10;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1327 */
      __pyx_5 = PyString_FromStringAndSize(((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer),__pyx_v_got); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1327; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_5;
      __pyx_5 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1329 */
      coio_evbuffer_drain((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),__pyx_v_got);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1330 */
      __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_1) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L12;
      }
      __pyx_L12:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1332 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
    }
    __pyx_L10:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.read_at_most");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_read_upto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_read_upto[] = "Read so that read buffer is >= n bytes long, return new size.\n\n        There is no such Python `file\' method (file.read_upto).\n\n        Args:\n          n: The minimum number of bytes the read buffer should contain when\n            this method returns. Negative values are treated as zero.\n        Returns:\n          The resulting number of bytes in the read buffer. It can be less\n          than n iff EOF was reached.\n        ";
static PyObject *__pyx_f_4coio_6nbfile_read_upto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_n = 0;
  Py_ssize_t __pyx_v_c_n;
  Py_ssize_t __pyx_v_got;
  PyObject *__pyx_r;
  Py_ssize_t __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_n);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1348 */
  __pyx_1 = PyInt_AsSsize_t(__pyx_v_n); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1348; goto __pyx_L1;}
  __pyx_v_c_n = __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1349 */
  __pyx_2 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_2) {
    __pyx_2 = (__pyx_v_c_n > (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off + ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit));
  }
  if (__pyx_2) {
    __pyx_v_c_n = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off + ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1352 */
  while (1) {
    __pyx_2 = (__pyx_v_c_n > ((Py_ssize_t)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off));
    if (!__pyx_2) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1353 */
    __pyx_2 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen == 0);
    if (__pyx_2) {
      coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size);
      goto __pyx_L5;
    }
    /*else*/ {
      coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen >> 1));
    }
    __pyx_L5:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1360 */
    __pyx_v_got = __pyx_f_4coio_nbevent_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,((((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off) - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.misalign));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1364 */
    __pyx_2 = (__pyx_v_got < 0);
    if (__pyx_2) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1365 */
      __pyx_2 = (errno != EAGAIN);
      if (__pyx_2) {
        __pyx_3 = PyInt_FromLong(errno); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; goto __pyx_L1;}
        __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
        __pyx_3 = 0;
        __pyx_4 = 0;
        __pyx_3 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_3, 0, 0);
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; goto __pyx_L1;}
        goto __pyx_L7;
      }
      __pyx_L7:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1367 */
      __pyx_4 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1367; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L6;
    }
    __pyx_2 = (__pyx_v_got == 0);
    if (__pyx_2) {
      goto __pyx_L4;
      goto __pyx_L6;
    }
    __pyx_2 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
    if (__pyx_2) {
      ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1372 */
  __pyx_5 = PyInt_FromLong(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; goto __pyx_L1;}
  __pyx_r = __pyx_5;
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.read_upto");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_n);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_read_more(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_read_more[] = "Read to buffer at least n more bytes, return number of bytes read.\n\n        There is no such Python `file\' method (file.read_more).\n\n        ";
static PyObject *__pyx_f_4coio_6nbfile_read_more(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_n = 0;
  Py_ssize_t __pyx_v_c_n;
  Py_ssize_t __pyx_v_got;
  Py_ssize_t __pyx_v_c_n0;
  PyObject *__pyx_r;
  Py_ssize_t __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"n",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_n)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_n);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1383 */
  __pyx_1 = PyInt_AsSsize_t(__pyx_v_n); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; goto __pyx_L1;}
  __pyx_v_c_n = __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1384 */
  __pyx_2 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_2) {
    __pyx_2 = (__pyx_v_c_n > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
  }
  if (__pyx_2) {
    __pyx_v_c_n = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1386 */
  __pyx_v_c_n0 = __pyx_v_c_n;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1387 */
  while (1) {
    __pyx_2 = (__pyx_v_c_n > 0);
    if (!__pyx_2) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1388 */
    __pyx_2 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen == 0);
    if (__pyx_2) {
      coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size);
      goto __pyx_L5;
    }
    /*else*/ {
      coio_evbuffer_expand((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen >> 1));
    }
    __pyx_L5:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1395 */
    __pyx_v_got = __pyx_f_4coio_nbevent_read((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb),((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,((((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.totallen - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off) - ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.misalign));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1399 */
    __pyx_2 = (__pyx_v_got < 0);
    if (__pyx_2) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1400 */
      __pyx_2 = (errno != EAGAIN);
      if (__pyx_2) {
        __pyx_3 = PyInt_FromLong(errno); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; goto __pyx_L1;}
        __pyx_4 = PyString_FromString(strerror(errno)); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; goto __pyx_L1;}
        __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
        PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
        __pyx_3 = 0;
        __pyx_4 = 0;
        __pyx_3 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_Raise(__pyx_3, 0, 0);
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; goto __pyx_L1;}
        goto __pyx_L7;
      }
      __pyx_L7:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1402 */
      __pyx_4 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L6;
    }
    __pyx_2 = (__pyx_v_got == 0);
    if (__pyx_2) {
      goto __pyx_L4;
      goto __pyx_L6;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1406 */
      __pyx_2 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
      if (__pyx_2) {
        ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit -= __pyx_v_got;
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1408 */
      __pyx_v_c_n -= __pyx_v_got;
    }
    __pyx_L6:;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1409 */
  __pyx_5 = PyInt_FromSsize_t((__pyx_v_c_n0 - __pyx_v_c_n)); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; goto __pyx_L1;}
  __pyx_r = __pyx_5;
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbfile.read_more");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_n);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_find(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_find[] = "Find the first occurrence of substring in read buffer.\n\n        There is no such Python `file\' method (file.find).\n\n        For a regular expression search, please use\n        re.search(r\'...\', nbfile_obj.get_read_buffer()).\n        ";
static PyObject *__pyx_f_4coio_6nbfile_find(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_substring = 0;
  PyObject *__pyx_v_start_idx = 0;
  PyObject *__pyx_v_end_idx = 0;
  Py_ssize_t __pyx_v_c_start_idx;
  Py_ssize_t __pyx_v_c_end_idx;
  char const* __pyx_v_sbuf;
  Py_ssize_t __pyx_v_slen;
  PyObject *__pyx_r;
  int __pyx_1;
  Py_ssize_t __pyx_2;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"substring","start_idx","end_idx",0};
  __pyx_v_start_idx = __pyx_d11;
  __pyx_v_end_idx = __pyx_d12;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|OO", __pyx_argnames, &__pyx_v_substring, &__pyx_v_start_idx, &__pyx_v_end_idx)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_substring);
  Py_INCREF(__pyx_v_start_idx);
  Py_INCREF(__pyx_v_end_idx);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1423 */
  __pyx_1 = PyObject_AsCharBuffer(__pyx_v_substring,(&__pyx_v_sbuf),(&__pyx_v_slen)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1423; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1424 */
  __pyx_1 = __pyx_v_end_idx == Py_None;
  if (__pyx_1) {
    __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1427 */
    __pyx_2 = PyInt_AsSsize_t(__pyx_v_end_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1427; goto __pyx_L1;}
    __pyx_v_c_end_idx = __pyx_2;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1428 */
    __pyx_1 = (__pyx_v_c_end_idx < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1429 */
      __pyx_v_c_end_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1430 */
      __pyx_1 = (__pyx_v_c_end_idx < 0);
      if (__pyx_1) {
        __pyx_v_c_end_idx = 0;
        goto __pyx_L4;
      }
      __pyx_L4:;
      goto __pyx_L3;
    }
    __pyx_1 = (__pyx_v_c_end_idx > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    if (__pyx_1) {
      __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
      goto __pyx_L3;
    }
    __pyx_L3:;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1434 */
  __pyx_2 = PyInt_AsSsize_t(__pyx_v_start_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; goto __pyx_L1;}
  __pyx_v_c_start_idx = __pyx_2;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1435 */
  __pyx_1 = (__pyx_v_c_start_idx < 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1436 */
    __pyx_v_c_start_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1437 */
    __pyx_1 = (__pyx_v_c_start_idx < 0);
    if (__pyx_1) {
      __pyx_v_c_start_idx = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1439 */
  __pyx_1 = (__pyx_v_c_start_idx > __pyx_v_c_end_idx);
  if (__pyx_1) {
    __pyx_3 = PyInt_FromLong((-1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1440; goto __pyx_L1;}
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1441 */
  __pyx_3 = PyInt_FromSsize_t(coio_stringlib_find((((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer) + __pyx_v_c_start_idx),(__pyx_v_c_end_idx - __pyx_v_c_start_idx),__pyx_v_sbuf,__pyx_v_slen,__pyx_v_c_start_idx)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbfile.find");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_substring);
  Py_DECREF(__pyx_v_start_idx);
  Py_DECREF(__pyx_v_end_idx);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_rfind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_rfind[] = "Find the last occurrence of substring in read buffer.\n\n        There is no such Python `file\' method (file.rfind).\n\n        ";
static PyObject *__pyx_f_4coio_6nbfile_rfind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_substring = 0;
  PyObject *__pyx_v_start_idx = 0;
  PyObject *__pyx_v_end_idx = 0;
  Py_ssize_t __pyx_v_c_start_idx;
  Py_ssize_t __pyx_v_c_end_idx;
  char const* __pyx_v_sbuf;
  Py_ssize_t __pyx_v_slen;
  PyObject *__pyx_r;
  int __pyx_1;
  Py_ssize_t __pyx_2;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"substring","start_idx","end_idx",0};
  __pyx_v_start_idx = __pyx_d13;
  __pyx_v_end_idx = __pyx_d14;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|OO", __pyx_argnames, &__pyx_v_substring, &__pyx_v_start_idx, &__pyx_v_end_idx)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_substring);
  Py_INCREF(__pyx_v_start_idx);
  Py_INCREF(__pyx_v_end_idx);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1455 */
  __pyx_1 = PyObject_AsCharBuffer(__pyx_v_substring,(&__pyx_v_sbuf),(&__pyx_v_slen)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1455; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1456 */
  __pyx_1 = __pyx_v_end_idx == Py_None;
  if (__pyx_1) {
    __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1459 */
    __pyx_2 = PyInt_AsSsize_t(__pyx_v_end_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1459; goto __pyx_L1;}
    __pyx_v_c_end_idx = __pyx_2;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1460 */
    __pyx_1 = (__pyx_v_c_end_idx < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1461 */
      __pyx_v_c_end_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1462 */
      __pyx_1 = (__pyx_v_c_end_idx < 0);
      if (__pyx_1) {
        __pyx_v_c_end_idx = 0;
        goto __pyx_L4;
      }
      __pyx_L4:;
      goto __pyx_L3;
    }
    __pyx_1 = (__pyx_v_c_end_idx > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    if (__pyx_1) {
      __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
      goto __pyx_L3;
    }
    __pyx_L3:;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1466 */
  __pyx_2 = PyInt_AsSsize_t(__pyx_v_start_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1466; goto __pyx_L1;}
  __pyx_v_c_start_idx = __pyx_2;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1467 */
  __pyx_1 = (__pyx_v_c_start_idx < 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1468 */
    __pyx_v_c_start_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1469 */
    __pyx_1 = (__pyx_v_c_start_idx < 0);
    if (__pyx_1) {
      __pyx_v_c_start_idx = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1471 */
  __pyx_1 = (__pyx_v_c_start_idx > __pyx_v_c_end_idx);
  if (__pyx_1) {
    __pyx_3 = PyInt_FromLong((-1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; goto __pyx_L1;}
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1473 */
  __pyx_3 = PyInt_FromSsize_t(coio_stringlib_rfind((((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer) + __pyx_v_c_start_idx),(__pyx_v_c_end_idx - __pyx_v_c_start_idx),__pyx_v_sbuf,__pyx_v_slen,__pyx_v_c_start_idx)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1473; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbfile.rfind");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_substring);
  Py_DECREF(__pyx_v_start_idx);
  Py_DECREF(__pyx_v_end_idx);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_get_string(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_get_string[] = "Get string from read buffer.\n\n        There is no such Python `file\' method (file.get_string).\n\n        ";
static PyObject *__pyx_f_4coio_6nbfile_get_string(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_start_idx = 0;
  PyObject *__pyx_v_end_idx = 0;
  Py_ssize_t __pyx_v_c_start_idx;
  Py_ssize_t __pyx_v_c_end_idx;
  PyObject *__pyx_r;
  int __pyx_1;
  Py_ssize_t __pyx_2;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"start_idx","end_idx",0};
  __pyx_v_start_idx = __pyx_d15;
  __pyx_v_end_idx = __pyx_d16;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|OO", __pyx_argnames, &__pyx_v_start_idx, &__pyx_v_end_idx)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_start_idx);
  Py_INCREF(__pyx_v_end_idx);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1485 */
  __pyx_1 = __pyx_v_end_idx == Py_None;
  if (__pyx_1) {
    __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1488 */
    __pyx_2 = PyInt_AsSsize_t(__pyx_v_end_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1488; goto __pyx_L1;}
    __pyx_v_c_end_idx = __pyx_2;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1489 */
    __pyx_1 = (__pyx_v_c_end_idx < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1490 */
      __pyx_v_c_end_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1491 */
      __pyx_1 = (__pyx_v_c_end_idx < 0);
      if (__pyx_1) {
        __pyx_v_c_end_idx = 0;
        goto __pyx_L4;
      }
      __pyx_L4:;
      goto __pyx_L3;
    }
    __pyx_1 = (__pyx_v_c_end_idx > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    if (__pyx_1) {
      __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
      goto __pyx_L3;
    }
    __pyx_L3:;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1495 */
  __pyx_2 = PyInt_AsSsize_t(__pyx_v_start_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; goto __pyx_L1;}
  __pyx_v_c_start_idx = __pyx_2;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1496 */
  __pyx_1 = (__pyx_v_c_start_idx < 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1497 */
    __pyx_v_c_start_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1498 */
    __pyx_1 = (__pyx_v_c_start_idx < 0);
    if (__pyx_1) {
      __pyx_v_c_start_idx = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1500 */
  __pyx_1 = (__pyx_v_c_start_idx >= __pyx_v_c_end_idx);
  if (__pyx_1) {
    Py_INCREF(__pyx_k19p);
    __pyx_r = __pyx_k19p;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1502 */
  __pyx_3 = PyString_FromStringAndSize((((char const*)((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer) + __pyx_v_c_start_idx),(__pyx_v_c_end_idx - __pyx_v_c_start_idx)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbfile.get_string");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_start_idx);
  Py_DECREF(__pyx_v_end_idx);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_get_read_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_6nbfile_get_read_buffer[] = "Get read-write buffer object pointing to our read buffer.\n\n        There is no such Python `file\' method (file.get_read_buffer).\n\n        Please note that the returned buffer points to a valid memory\n        location until this nbfile gets closed or a read or discard\n        operation is performed on it. If you attempt to use returned buffer\n        after that, you may find garbage inside, or you may get a Segmentation\n        fault for an invalid read.\n        ";
static PyObject *__pyx_f_4coio_6nbfile_get_read_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_start_idx = 0;
  PyObject *__pyx_v_end_idx = 0;
  Py_ssize_t __pyx_v_c_start_idx;
  Py_ssize_t __pyx_v_c_end_idx;
  PyObject *__pyx_r;
  int __pyx_1;
  Py_ssize_t __pyx_2;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"start_idx","end_idx",0};
  __pyx_v_start_idx = __pyx_d17;
  __pyx_v_end_idx = __pyx_d18;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|OO", __pyx_argnames, &__pyx_v_start_idx, &__pyx_v_end_idx)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_start_idx);
  Py_INCREF(__pyx_v_end_idx);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1519 */
  __pyx_1 = __pyx_v_end_idx == Py_None;
  if (__pyx_1) {
    __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1522 */
    __pyx_2 = PyInt_AsSsize_t(__pyx_v_end_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1522; goto __pyx_L1;}
    __pyx_v_c_end_idx = __pyx_2;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1523 */
    __pyx_1 = (__pyx_v_c_end_idx < 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1524 */
      __pyx_v_c_end_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1525 */
      __pyx_1 = (__pyx_v_c_end_idx < 0);
      if (__pyx_1) {
        __pyx_v_c_end_idx = 0;
        goto __pyx_L4;
      }
      __pyx_L4:;
      goto __pyx_L3;
    }
    __pyx_1 = (__pyx_v_c_end_idx > ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off);
    if (__pyx_1) {
      __pyx_v_c_end_idx = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;
      goto __pyx_L3;
    }
    __pyx_L3:;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1529 */
  __pyx_2 = PyInt_AsSsize_t(__pyx_v_start_idx); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1529; goto __pyx_L1;}
  __pyx_v_c_start_idx = __pyx_2;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1530 */
  __pyx_1 = (__pyx_v_c_start_idx < 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1531 */
    __pyx_v_c_start_idx += ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.off;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1532 */
    __pyx_1 = (__pyx_v_c_start_idx < 0);
    if (__pyx_1) {
      __pyx_v_c_start_idx = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1534 */
  __pyx_1 = (__pyx_v_c_start_idx >= __pyx_v_c_end_idx);
  if (__pyx_1) {
    __pyx_3 = PyBuffer_FromReadWriteMemory(NULL,0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1535; goto __pyx_L1;}
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1536 */
  __pyx_3 = PyBuffer_FromReadWriteMemory(((void *)(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb.buffer + __pyx_v_c_start_idx)),(__pyx_v_c_end_idx - __pyx_v_c_start_idx)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1536; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbfile.get_read_buffer");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_start_idx);
  Py_DECREF(__pyx_v_end_idx);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_readline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_readline(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_limit;
  int __pyx_v_n;
  int __pyx_v_got;
  int __pyx_v_min_off;
  char const* __pyx_v_q;
  int __pyx_v_fd;
  struct coio_evbuffer *__pyx_v_read_eb;
  int __pyx_v_had_short_read;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"limit",0};
  __pyx_v_limit = __pyx_d19;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|i", __pyx_argnames, &__pyx_v_limit)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1559 */
  __pyx_v_read_eb = (&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_eb);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1560 */
  __pyx_v_fd = ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1561 */
  __pyx_v_had_short_read = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1562 */
  __pyx_v_min_off = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1563 */
  __pyx_1 = (((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit >= 0);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_limit < 0);
    if (!__pyx_1) {
      __pyx_1 = (__pyx_v_limit > (__pyx_v_read_eb->off + ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit));
    }
    if (__pyx_1) {
      __pyx_v_limit = (__pyx_v_read_eb->off + ((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_limit);
      goto __pyx_L3;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1566 */
  __pyx_1 = (__pyx_v_limit >= 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1567 */
    __pyx_1 = (__pyx_v_limit == 0);
    if (__pyx_1) {
      Py_INCREF(__pyx_k19p);
      __pyx_r = __pyx_k19p;
      goto __pyx_L0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1569 */
    __pyx_2 = __pyx_f_4coio_nbfile_readline_with_limit(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self),__pyx_v_limit); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1569; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1572 */
  __pyx_v_q = ((char const*)memchr(((void const*)__pyx_v_read_eb->buffer),'\n',__pyx_v_read_eb->off));

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1573 */
  while (1) {
    __pyx_1 = (__pyx_v_q == NULL);
    if (!__pyx_1) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1574 */
    __pyx_1 = __pyx_v_had_short_read;
    if (__pyx_1) {
      coio_evbuffer_expand(__pyx_v_read_eb,1);
      goto __pyx_L8;
    }
    __pyx_1 = (__pyx_v_read_eb->totallen == 0);
    if (__pyx_1) {
      coio_evbuffer_expand(__pyx_v_read_eb,((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_min_read_buffer_size);
      goto __pyx_L8;
    }
    /*else*/ {
      coio_evbuffer_expand(__pyx_v_read_eb,(__pyx_v_read_eb->totallen >> 1));
    }
    __pyx_L8:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1582 */
    __pyx_v_n = ((__pyx_v_read_eb->totallen - __pyx_v_read_eb->off) - __pyx_v_read_eb->misalign);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1584 */
    __pyx_v_got = __pyx_f_4coio_nbevent_read(__pyx_v_read_eb,__pyx_v_fd,__pyx_v_n);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1585 */
    while (1) {
      __pyx_1 = (__pyx_v_got < 0);
      if (!__pyx_1) break;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1586 */
      __pyx_1 = (errno != EAGAIN);
      if (__pyx_1) {
        __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; goto __pyx_L1;}
        __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
        __pyx_2 = 0;
        __pyx_3 = 0;
        __pyx_2 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_2, 0, 0);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; goto __pyx_L1;}
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1590 */
      __pyx_3 = coio_c_wait((&((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_wakeup_ev),NULL); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1590; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1591 */
      __pyx_v_got = __pyx_f_4coio_nbevent_read(__pyx_v_read_eb,__pyx_v_fd,__pyx_v_n);
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1593 */
    __pyx_1 = (__pyx_v_got == 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1594 */
      __pyx_v_n = __pyx_v_read_eb->off;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1595 */
      __pyx_4 = PyString_FromStringAndSize(((char const*)__pyx_v_read_eb->buffer),__pyx_v_n); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1595; goto __pyx_L1;}
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_4;
      __pyx_4 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1596 */
      coio_evbuffer_drain(__pyx_v_read_eb,__pyx_v_n);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1597 */
      Py_INCREF(__pyx_v_buf);
      __pyx_r = __pyx_v_buf;
      goto __pyx_L0;
      goto __pyx_L12;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1599 */
      __pyx_1 = (__pyx_v_got < __pyx_v_n);
      if (__pyx_1) {
        __pyx_v_had_short_read = 1;
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1603 */
      __pyx_v_q = ((char const*)memchr(((void const*)(__pyx_v_read_eb->buffer + __pyx_v_min_off)),'\n',(__pyx_v_read_eb->off - __pyx_v_min_off)));

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1605 */
      __pyx_v_min_off = __pyx_v_read_eb->off;
    }
    __pyx_L12:;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1606 */
  __pyx_v_n = ((__pyx_v_q - ((char const*)__pyx_v_read_eb->buffer)) + 1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1607 */
  __pyx_2 = PyString_FromStringAndSize(((char const*)__pyx_v_read_eb->buffer),__pyx_v_n); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; goto __pyx_L1;}
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1608 */
  coio_evbuffer_drain(__pyx_v_read_eb,__pyx_v_n);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1609 */
  Py_INCREF(__pyx_v_buf);
  __pyx_r = __pyx_v_buf;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.readline");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile___next__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile___next__(PyObject *__pyx_v_self) {
  PyObject *__pyx_v_line;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  Py_INCREF(__pyx_v_self);
  __pyx_v_line = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1612 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_readline); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_line);
  __pyx_v_line = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1613 */
  __pyx_3 = PyObject_IsTrue(__pyx_v_line); if (__pyx_3 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1613; goto __pyx_L1;}
  if (__pyx_3) {
    Py_INCREF(__pyx_v_line);
    __pyx_r = __pyx_v_line;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1615 */
  __Pyx_Raise(PyExc_StopIteration, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1615; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbfile.__next__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_line);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile___iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile___iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_xreadlines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_xreadlines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_readlines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_readlines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyListObject *__pyx_v_lines;
  PyObject *__pyx_v_line;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  long __pyx_2;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  int __pyx_5;
  int __pyx_6;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_lines = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_line = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1628 */
  __pyx_1 = PyList_New(0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_lines));
  __pyx_v_lines = ((PyListObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1629 */
  while (1) {
    __pyx_2 = 1;
    if (!__pyx_2) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1630 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_readline); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1630; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1630; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_v_line);
    __pyx_v_line = __pyx_3;
    __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1631 */
    __pyx_4 = PyObject_IsTrue(__pyx_v_line); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1631; goto __pyx_L1;}
    __pyx_5 = (!__pyx_4);
    if (__pyx_5) {
      goto __pyx_L3;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1633 */
    __pyx_6 = PyList_Append(((PyObject *)__pyx_v_lines),__pyx_v_line); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1633; goto __pyx_L1;}
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1634 */
  Py_INCREF(((PyObject *)__pyx_v_lines));
  __pyx_r = ((PyObject *)__pyx_v_lines);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbfile.readlines");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_lines);
  Py_DECREF(__pyx_v_line);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_writelines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_writelines(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_lines = 0;
  PyObject *__pyx_v_line;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"lines",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_lines)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_lines);
  __pyx_v_line = Py_None; Py_INCREF(Py_None);
  __pyx_1 = PyObject_GetIter(__pyx_v_lines); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1637; goto __pyx_L1;}
  for (;;) {
    __pyx_2 = PyIter_Next(__pyx_1);
    if (!__pyx_2) {
      if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1637; goto __pyx_L1;}
      break;
    }
    Py_DECREF(__pyx_v_line);
    __pyx_v_line = __pyx_2;
    __pyx_2 = 0;
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_write); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1638; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1638; goto __pyx_L1;}
    Py_INCREF(__pyx_v_line);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_line);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1638; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
  }
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.writelines");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_line);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_lines);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_isatty(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_isatty(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_got;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1642 */
  __pyx_v_got = isatty(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1643 */
  __pyx_1 = (__pyx_v_got < 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_read_exc_class, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_1 = __pyx_v_got;
  if (__pyx_1) {
    Py_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.isatty");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_6nbfile_truncate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_6nbfile_truncate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_size;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"size",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i", __pyx_argnames, &__pyx_v_size)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (ftruncate(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->read_fd,__pyx_v_size) < 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(((struct __pyx_obj_4coio_nbfile *)__pyx_v_self)->c_write_exc_class, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbfile.truncate");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_popen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_popen[] = "Non-blocking drop-in replacement for os.popen.";
static PyObject *__pyx_f_4coio_popen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_command = 0;
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_v_f;
  PyObject *__pyx_v_fd;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"command","mode","bufsize",0};
  __pyx_v_mode = __pyx_d20;
  __pyx_v_bufsize = __pyx_d21;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|Oi", __pyx_argnames, &__pyx_v_command, &__pyx_v_mode, &__pyx_v_bufsize)) return 0;
  Py_INCREF(__pyx_v_command);
  Py_INCREF(__pyx_v_mode);
  __pyx_v_f = Py_None; Py_INCREF(Py_None);
  __pyx_v_fd = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1665 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_mode, __pyx_n_replace); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; goto __pyx_L1;}
  Py_INCREF(__pyx_n_b);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_n_b);
  Py_INCREF(__pyx_k19p);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_k19p);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_v_mode);
  __pyx_v_mode = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1666 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_os_popen); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1666; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1666; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(3); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1666; goto __pyx_L1;}
  Py_INCREF(__pyx_v_command);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_command);
  Py_INCREF(__pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_3, 2, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1666; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_v_f);
  __pyx_v_f = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1667 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_f, __pyx_n_fileno); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1667; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1667; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_fd);
  __pyx_v_fd = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1668 */
  __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  Py_INCREF(__pyx_v_fd);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_fd);
  Py_INCREF(__pyx_v_fd);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_fd);
  __pyx_1 = PyDict_New(); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_1, __pyx_n_mode, __pyx_v_mode) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_1, __pyx_n_write_buffer_limit, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyDict_SetItem(__pyx_1, __pyx_n_do_close, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_1, __pyx_n_close_ref, __pyx_v_f) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  __pyx_3 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_nbfile), __pyx_2, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1668; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.popen");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_f);
  Py_DECREF(__pyx_v_fd);
  Py_DECREF(__pyx_v_command);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_fdopen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_fdopen[] = "Non-blocking drop-in replacement for os.fdopen.";
static PyObject *__pyx_f_4coio_fdopen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fd;
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_v_write_buffer_limit = 0;
  char __pyx_v_do_close;
  PyObject *__pyx_v_name = 0;
  int __pyx_v_read_fd;
  int __pyx_v_write_fd;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  static char *__pyx_argnames[] = {"fd","mode","bufsize","write_buffer_limit","do_close","name",0};
  __pyx_v_mode = __pyx_d22;
  __pyx_v_bufsize = __pyx_d23;
  __pyx_v_write_buffer_limit = __pyx_d24;
  __pyx_v_do_close = __pyx_d25;
  __pyx_v_name = __pyx_d26;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "i|OiObO", __pyx_argnames, &__pyx_v_fd, &__pyx_v_mode, &__pyx_v_bufsize, &__pyx_v_write_buffer_limit, &__pyx_v_do_close, &__pyx_v_name)) return 0;
  Py_INCREF(__pyx_v_mode);
  Py_INCREF(__pyx_v_write_buffer_limit);
  Py_INCREF(__pyx_v_name);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1676 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (!(__pyx_v_fd >= 0)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1676; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1677 */
  __pyx_v_read_fd = __pyx_v_fd;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1678 */
  __pyx_v_write_fd = __pyx_v_fd;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1679 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_mode, __pyx_n_replace); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1679; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1679; goto __pyx_L1;}
  Py_INCREF(__pyx_n_b);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_n_b);
  Py_INCREF(__pyx_k19p);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_k19p);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1679; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_v_mode);
  __pyx_v_mode = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1681 */
  if (PyObject_Cmp(__pyx_v_mode, __pyx_n_r, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1681; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  if (__pyx_4) {
    __pyx_v_write_fd = (-1);
    goto __pyx_L2;
  }
  if (PyObject_Cmp(__pyx_v_mode, __pyx_n_w, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  if (__pyx_4) {
    __pyx_v_read_fd = (-1);
    goto __pyx_L2;
  }
  if (PyObject_Cmp(__pyx_v_mode, __pyx_k22p, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  if (__pyx_4) {
    goto __pyx_L2;
  }
  /*else*/ {
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (!0) {
      __pyx_1 = PyNumber_Remainder(__pyx_k37p, __pyx_v_mode); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; goto __pyx_L1;}
      PyErr_SetObject(PyExc_AssertionError, __pyx_1);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; goto __pyx_L1;}
    }
    #endif
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1689 */
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1689; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_v_write_buffer_limit, __pyx_2, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1689; goto __pyx_L1;}
  __pyx_4 = __pyx_4 < 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_4) {
    __pyx_3 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1690; goto __pyx_L1;}
    Py_DECREF(__pyx_v_write_buffer_limit);
    __pyx_v_write_buffer_limit = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1691 */
  __pyx_4 = (__pyx_v_write_fd >= 0);
  if (__pyx_4) {
    __pyx_1 = PyInt_FromLong((-1)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_v_write_buffer_limit, __pyx_1, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; goto __pyx_L1;}
    __pyx_4 = __pyx_4 == 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    if (__pyx_4) {
      __pyx_4 = (isatty(__pyx_v_write_fd) > 0);
    }
  }
  if (__pyx_4) {
    __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1694; goto __pyx_L1;}
    Py_DECREF(__pyx_v_write_buffer_limit);
    __pyx_v_write_buffer_limit = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1695 */
  __pyx_3 = PyInt_FromLong(__pyx_v_read_fd); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  __pyx_1 = PyInt_FromLong(__pyx_v_write_fd); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_1);
  __pyx_3 = 0;
  __pyx_1 = 0;
  __pyx_3 = PyDict_New(); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_3, __pyx_n_write_buffer_limit, __pyx_v_write_buffer_limit) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  __pyx_1 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1696; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_3, __pyx_n_min_read_buffer_size, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyInt_FromLong(__pyx_v_do_close); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1696; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_3, __pyx_n_do_close, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (PyDict_SetItem(__pyx_3, __pyx_n_mode, __pyx_v_mode) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  __pyx_1 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_nbfile), __pyx_2, __pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.fdopen");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_mode);
  Py_DECREF(__pyx_v_write_buffer_limit);
  Py_DECREF(__pyx_v_name);
  return __pyx_r;
}

static int __pyx_f_4coio_8nbsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_8nbsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_v_my_socket_impl;
  int __pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_ssize_t __pyx_5;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, &__pyx_v_kwargs, 0) < 0) return -1;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    Py_XDECREF(__pyx_v_kwargs);
    return -1;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_my_socket_impl = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1740 */
  __pyx_1 = PySequence_Contains(__pyx_v_kwargs, __pyx_n_socket_impl); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1740; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_pop); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1741; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1741; goto __pyx_L1;}
    Py_INCREF(__pyx_n_socket_impl);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_n_socket_impl);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1741; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_my_socket_impl);
    __pyx_v_my_socket_impl = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket_impl); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1743; goto __pyx_L1;}
    Py_DECREF(__pyx_v_my_socket_impl);
    __pyx_v_my_socket_impl = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1744 */
  __pyx_3 = __pyx_v_args;
  Py_INCREF(__pyx_3);
  __pyx_1 = PyObject_IsTrue(__pyx_3); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; goto __pyx_L1;}
  if (__pyx_1) {
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_args, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_1 = PyObject_IsInstance(__pyx_2,__pyx_v_my_socket_impl); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_3 = PyInt_FromLong(__pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; goto __pyx_L1;}
  }
  __pyx_1 = PyObject_IsTrue(__pyx_3); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1745 */
    __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1745; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_args, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1745; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_2;
    __pyx_2 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1746 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    __pyx_5 = PyObject_Length(__pyx_v_args); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1746; goto __pyx_L1;}
    if (!(__pyx_5 == 1)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1746; goto __pyx_L1;}
    }
    #endif
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_3 = PySequence_Tuple(__pyx_v_args); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1748; goto __pyx_L1;}
    __pyx_4 = PyEval_CallObjectWithKeywords(__pyx_v_my_socket_impl, __pyx_3, __pyx_v_kwargs); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1748; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_4;
    __pyx_4 = 0;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1749 */
  __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1749; goto __pyx_L1;}
  __pyx_1 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1749; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_family = __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1750 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_fileno); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1750; goto __pyx_L1;}
  __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1750; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_1 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1750; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd = __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1753 */
  __pyx_f_4coio_set_fd_nonblocking(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1754 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value = (-1.0);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1755 */
  event_set((&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.read_ev),((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd,EV_READ,__pyx_f_4coio_HandleCTimeoutWakeup,NULL);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1757 */
  event_set((&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.write_ev),((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd,EV_WRITE,__pyx_f_4coio_HandleCTimeoutWakeup,NULL);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsocket.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_v_kwargs);
  Py_DECREF(__pyx_v_my_socket_impl);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1761; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; goto __pyx_L1;}
  Py_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_self);
  __pyx_2 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_dup); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1768; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.dup");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static void __pyx_f_4coio_8nbsocket___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_f_4coio_8nbsocket___dealloc__(PyObject *__pyx_v_self) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_close); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.__dealloc__");
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
}

static PyObject *__pyx_f_4coio_8nbsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  char __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1776 */
  __pyx_1 = ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close;
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_close); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1779; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1779; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1782; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n__closedsocket); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1782; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1782; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1783 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd = (-1);

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.close");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_setdoclose(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_setdoclose[] = "With True, makes self.close() close the filehandle.\n\n        Returns:\n          self\n        ";
static PyObject *__pyx_f_4coio_8nbsocket_setdoclose(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char __pyx_v_do_close;
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {"do_close",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "b", __pyx_argnames, &__pyx_v_do_close)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1795 */
  ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close = __pyx_v_do_close;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1796 */
  Py_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_8do_close___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_8do_close___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_do_close); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1801; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.do_close.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_4type___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_4type___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_type); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1814; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.type.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_6family___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_6family___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1818; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.family.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_7timeout___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_7timeout___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1830; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.timeout.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_5proto___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_5proto___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_proto); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1834; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsocket.proto.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_setsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1837; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1837; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1837; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.setsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_getsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1840; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.getsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_getsockname); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.getsockname");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_getpeername); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1846; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1846; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1846; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.getpeername");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_bind); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1849; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1849; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1849; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.bind");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_listen); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1852; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1852; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1852; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.listen");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1858; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.gettimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_is_blocking = 0;
  PyObject *__pyx_r;
  int __pyx_1;
  double __pyx_2;
  static char *__pyx_argnames[] = {"is_blocking",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_is_blocking)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_is_blocking);
  __pyx_1 = PyObject_IsTrue(__pyx_v_is_blocking); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyFloat_AsDouble(Py_None); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; goto __pyx_L1;}
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value = __pyx_2;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1864 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value = 0.0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1865 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.tv.tv_sec = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1866 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.tv.tv_usec = 1;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbsocket.setblocking");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_is_blocking);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  double __pyx_v_timeout_double;
  PyObject *__pyx_r;
  int __pyx_1;
  double __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_timeout);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1870 */
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value = (-1.0);
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1875 */
    __pyx_2 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1875; goto __pyx_L1;}
    __pyx_v_timeout_double = __pyx_2;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1876 */
    __pyx_1 = (__pyx_v_timeout_double < 0.0);
    if (__pyx_1) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; goto __pyx_L1;}
      Py_INCREF(__pyx_k26p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k26p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1878 */
    ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.timeout_value = __pyx_v_timeout_double;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1879 */
    __pyx_1 = (__pyx_v_timeout_double == 0.0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1880 */
      ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.tv.tv_sec = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1881 */
      ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.tv.tv_usec = 1;
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1883 */
      ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.tv.tv_sec = ((long)__pyx_v_timeout_double);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1884 */
      ((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.tv.tv_usec = ((unsigned int)((__pyx_v_timeout_double - ((double)((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.tv.tv_sec)) * 1000000.0));
    }
    __pyx_L4:;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsocket.settimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_asock;
  PyObject *__pyx_v_addr;
  PyObject *__pyx_v_esock;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_asock = Py_None; Py_INCREF(Py_None);
  __pyx_v_addr = Py_None; Py_INCREF(Py_None);
  __pyx_v_esock = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1888 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_accept); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; goto __pyx_L1;}
  __pyx_3 = coio_c_socket_call(__pyx_1,__pyx_2,(&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyObject_GetIter(__pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; goto __pyx_L1;}
  Py_DECREF(__pyx_v_asock);
  __pyx_v_asock = __pyx_2;
  __pyx_2 = 0;
  __pyx_3 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; goto __pyx_L1;}
  Py_DECREF(__pyx_v_addr);
  __pyx_v_addr = __pyx_3;
  __pyx_3 = 0;
  if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1890 */
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1890; goto __pyx_L1;}
  Py_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_self);
  __pyx_3 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1890; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1890; goto __pyx_L1;}
  Py_INCREF(__pyx_v_asock);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_asock);
  __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1890; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_esock);
  __pyx_v_esock = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1891 */
  __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1891; goto __pyx_L1;}
  Py_INCREF(__pyx_v_esock);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_esock);
  Py_INCREF(__pyx_v_addr);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_v_addr);
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsocket.accept");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_asock);
  Py_DECREF(__pyx_v_addr);
  Py_DECREF(__pyx_v_esock);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  struct timeval __pyx_v_tv;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  unsigned int __pyx_6;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1897 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1897; goto __pyx_L1;}
  __pyx_2 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1897; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address,__pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1897; goto __pyx_L1;}
  Py_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_1;
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1899 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1900 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_connect_ex); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; goto __pyx_L1;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_address);
    __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_5;
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1901 */
    __pyx_2 = PyObject_IsTrue(__pyx_v_err); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1901; goto __pyx_L1;}
    if (__pyx_2) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1903 */
      __pyx_1 = PyInt_FromLong(EAGAIN); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_v_err, __pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; goto __pyx_L1;}
      __pyx_2 = __pyx_2 != 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      if (__pyx_2) {
        __pyx_4 = PyInt_FromLong(EINPROGRESS); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_v_err, __pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; goto __pyx_L1;}
        __pyx_2 = __pyx_2 != 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        if (__pyx_2) {
          __pyx_5 = PyInt_FromLong(EALREADY); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; goto __pyx_L1;}
          if (PyObject_Cmp(__pyx_v_err, __pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; goto __pyx_L1;}
          __pyx_2 = __pyx_2 != 0;
          Py_DECREF(__pyx_5); __pyx_5 = 0;
        }
      }
      if (__pyx_2) {
        __pyx_2 = PyInt_AsLong(__pyx_v_err); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; goto __pyx_L1;}
        __pyx_1 = PyString_FromString(strerror(__pyx_2)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; goto __pyx_L1;}
        __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; goto __pyx_L1;}
        Py_INCREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_err);
        PyTuple_SET_ITEM(__pyx_4, 1, __pyx_1);
        __pyx_1 = 0;
        __pyx_5 = PyObject_CallObject(coio_socket_error, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __Pyx_Raise(__pyx_5, 0, 0);
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; goto __pyx_L1;}
        goto __pyx_L5;
      }
      __pyx_L5:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1909 */
      __pyx_2 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_family == AF_INET);
      if (__pyx_2) {

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1910 */
        __pyx_v_tv.tv_sec = 0;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1911 */
        __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_connect_magic_usec); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1911; goto __pyx_L1;}
        __pyx_6 = PyInt_AsUnsignedLongMask(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1911; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_v_tv.tv_usec = __pyx_6;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1912 */
        select(0,NULL,NULL,NULL,(&__pyx_v_tv));
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1914 */
      __pyx_4 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1914; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L4;
    }
    /*else*/ {
      __pyx_r = Py_None; Py_INCREF(Py_None);
      goto __pyx_L0;
    }
    __pyx_L4:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbsocket.connect");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  struct timeval __pyx_v_tv;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  long __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  unsigned int __pyx_6;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1921 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; goto __pyx_L1;}
  __pyx_2 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address,__pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; goto __pyx_L1;}
  Py_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_1;
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1923 */
  while (1) {
    __pyx_3 = 1;
    if (!__pyx_3) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1924 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_connect_ex); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; goto __pyx_L1;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_address);
    __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_5;
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1926 */
    __pyx_1 = PyInt_FromLong(EAGAIN); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_v_err, __pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; goto __pyx_L1;}
    __pyx_2 = __pyx_2 != 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    if (__pyx_2) {
      __pyx_4 = PyInt_FromLong(EINPROGRESS); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_v_err, __pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; goto __pyx_L1;}
      __pyx_2 = __pyx_2 != 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      if (__pyx_2) {
        __pyx_5 = PyInt_FromLong(EALREADY); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_v_err, __pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; goto __pyx_L1;}
        __pyx_2 = __pyx_2 != 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
      }
    }
    if (__pyx_2) {
      Py_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1932 */
    __pyx_2 = (((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->c_family == AF_INET);
    if (__pyx_2) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1933 */
      __pyx_v_tv.tv_sec = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1934 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_connect_magic_usec); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1934; goto __pyx_L1;}
      __pyx_6 = PyInt_AsUnsignedLongMask(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1934; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_v_tv.tv_usec = __pyx_6;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1935 */
      select(0,NULL,NULL,NULL,(&__pyx_v_tv));
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1937 */
    __pyx_4 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1937; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbsocket.connect_ex");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_how = 0;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  static char *__pyx_argnames[] = {"how",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_how)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_how);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1941 */
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_shutdown); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1941; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1941; goto __pyx_L1;}
    Py_INCREF(__pyx_v_how);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_how);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1941; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_4;
    __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1942 */
    __pyx_2 = PyInt_FromLong(EAGAIN); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1942; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_v_err, __pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1942; goto __pyx_L1;}
    __pyx_5 = __pyx_5 != 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      Py_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1945 */
    __pyx_3 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1945; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsocket.shutdown");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_how);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recv); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1948; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1948; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.recv");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1952; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1952; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.recvfrom");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recv_into); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.recv_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom_into); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.recvfrom_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1964; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1964; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.send");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_sendto); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1968; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1968; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsocket.sendto");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8nbsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  int __pyx_v_got;
  int __pyx_v_got2;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  Py_ssize_t __pyx_8;
  static char *__pyx_argnames[] = {"data","flags",0};
  __pyx_v_flags = __pyx_d27;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_data, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1974 */
  /*try:*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1976 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; goto __pyx_L2;}
    __pyx_2 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; goto __pyx_L2;}
    __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; goto __pyx_L2;}
    Py_INCREF(__pyx_v_data);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
    PyTuple_SET_ITEM(__pyx_3, 1, __pyx_2);
    __pyx_2 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; goto __pyx_L2;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; goto __pyx_L2;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_got = __pyx_4;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1977 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (!(__pyx_v_got > 0)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; goto __pyx_L2;}
    }
    #endif
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_1); __pyx_1 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1978 */
  __pyx_4 = PyErr_ExceptionMatches(coio_socket_error);
  if (__pyx_4) {
    __pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __Pyx_AddTraceback("coio.sendall");
    PyErr_Fetch(&__pyx_1, &__pyx_3, &__pyx_2);
    if (__Pyx_NormalizeException(&__pyx_1, &__pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; goto __pyx_L1;}
    Py_INCREF(__pyx_3);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_3;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1979 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_args); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; goto __pyx_L1;}
    __pyx_6 = PyInt_FromLong(0); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; goto __pyx_L1;}
    __pyx_7 = PyObject_GetItem(__pyx_5, __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_5 = PyInt_FromLong(EAGAIN); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_7, __pyx_5, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; goto __pyx_L1;}
    __pyx_4 = __pyx_4 != 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    if (__pyx_4) {
      PyErr_Restore(__pyx_1, __pyx_3, __pyx_2);
      __pyx_1 = __pyx_3 = __pyx_2 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1980; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1981 */
    __pyx_6 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1981; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1982 */
    __pyx_v_got = 0;
    Py_XDECREF(__pyx_1); __pyx_1 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  goto __pyx_L1;
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1983 */
  while (1) {
    __pyx_8 = PyObject_Length(__pyx_v_data); if (__pyx_8 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; goto __pyx_L1;}
    __pyx_4 = (__pyx_v_got < __pyx_8);
    if (!__pyx_4) break;
    /*try:*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1985 */
      __pyx_7 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      __pyx_5 = PyInt_FromLong(__pyx_v_got); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      Py_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_data);
      PyTuple_SET_ITEM(__pyx_6, 1, __pyx_5);
      __pyx_5 = 0;
      __pyx_1 = PyObject_CallObject(((PyObject *)(&PyBuffer_Type)), __pyx_6); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_3 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
      PyTuple_SET_ITEM(__pyx_2, 1, __pyx_3);
      __pyx_1 = 0;
      __pyx_3 = 0;
      __pyx_5 = PyObject_CallObject(__pyx_7, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_4 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; goto __pyx_L7;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_v_got2 = __pyx_4;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1986 */
      #ifndef PYREX_WITHOUT_ASSERTIONS
      if (!(__pyx_v_got2 > 0)) {
        PyErr_SetNone(PyExc_AssertionError);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1986; goto __pyx_L7;}
      }
      #endif

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1987 */
      __pyx_v_got += __pyx_v_got2;
    }
    goto __pyx_L8;
    __pyx_L7:;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_1); __pyx_1 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1988 */
    __pyx_4 = PyErr_ExceptionMatches(coio_socket_error);
    if (__pyx_4) {
      __pyx_filename = __pyx_f[0]; __pyx_lineno = 1988; __Pyx_AddTraceback("coio.sendall");
      PyErr_Fetch(&__pyx_6, &__pyx_1, &__pyx_3);
      if (__Pyx_NormalizeException(&__pyx_6, &__pyx_1, &__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1988; goto __pyx_L1;}
      Py_INCREF(__pyx_1);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_1;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1989 */
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_args); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; goto __pyx_L1;}
      __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; goto __pyx_L1;}
      __pyx_5 = PyObject_GetItem(__pyx_7, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_7 = PyInt_FromLong(EAGAIN); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_5, __pyx_7, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; goto __pyx_L1;}
      __pyx_4 = __pyx_4 != 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_4) {
        PyErr_Restore(__pyx_6, __pyx_1, __pyx_3);
        __pyx_6 = __pyx_1 = __pyx_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1990; goto __pyx_L1;}
        goto __pyx_L9;
      }
      __pyx_L9:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1991 */
      __pyx_2 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1991; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_1); __pyx_1 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      goto __pyx_L8;
    }
    goto __pyx_L1;
    __pyx_L8:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsocket.sendall");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_makefile_samefd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_makefile_samefd[] = "Create and return an nbfile with self.swi.fd.\n\n        The nbfile will be buffered, and its close method won\'t cause an\n        os.close(self.swi.fd).\n\n        This method is not part of normal sockets.\n        ";
static PyObject *__pyx_f_4coio_8nbsocket_makefile_samefd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"mode","bufsize",0};
  __pyx_v_mode = __pyx_d28;
  __pyx_v_bufsize = __pyx_d29;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|Oi", __pyx_argnames, &__pyx_v_mode, &__pyx_v_bufsize)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_mode);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  __pyx_4 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  __pyx_5 = PyTuple_New(4); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
  PyTuple_SET_ITEM(__pyx_5, 2, __pyx_3);
  PyTuple_SET_ITEM(__pyx_5, 3, __pyx_4);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_1 = PyDict_New(); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2002; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_1, __pyx_n_do_set_fd_nonblocking, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_nbfile), __pyx_5, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.nbsocket.makefile_samefd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8nbsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_8nbsocket_makefile[] = "Create an nbfile (non-blocking file-like) object from self.\n\n        os.dup(self.swi.fd) will be passed to the new nbfile object, and its\n        .close() method will close that file descriptor.\n\n        Args:\n          mode: \'r\', \'w\', \'r+\' etc. The default is mode \'r\', just as for\n            socket.socket.makefile.\n        ";
static PyObject *__pyx_f_4coio_8nbsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  int __pyx_v_fd;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  static char *__pyx_argnames[] = {"mode","bufsize",0};
  __pyx_v_mode = __pyx_d30;
  __pyx_v_bufsize = __pyx_d31;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|Oi", __pyx_argnames, &__pyx_v_mode, &__pyx_v_bufsize)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_mode);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2015 */
  __pyx_v_fd = dup(((struct __pyx_obj_4coio_nbsocket *)__pyx_v_self)->swi.fd);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2016 */
  __pyx_1 = (__pyx_v_fd < 0);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(errno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2017; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(strerror(errno)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2017; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2017; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(coio_socket_error, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2017; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2017; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2019 */
  __pyx_3 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  __pyx_4 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  __pyx_5 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  __pyx_6 = PyTuple_New(4); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_6, 0, __pyx_3);
  PyTuple_SET_ITEM(__pyx_6, 1, __pyx_4);
  PyTuple_SET_ITEM(__pyx_6, 2, __pyx_2);
  PyTuple_SET_ITEM(__pyx_6, 3, __pyx_5);
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_2 = 0;
  __pyx_5 = 0;
  __pyx_3 = PyDict_New(); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  __pyx_4 = PyInt_FromLong(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_3, __pyx_n_do_close, __pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (PyDict_SetItem(__pyx_3, __pyx_n_close_ref, __pyx_v_self) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2020; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_3, __pyx_n_do_set_fd_nonblocking, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_5 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_nbfile), __pyx_6, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_r = __pyx_5;
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.nbsocket.makefile");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_new_realsocket(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_new_realsocket[] = "Non-blocking drop-in replacement for socket._realsocket.\n\n    The most important difference between socket.socket and socket._realsocket\n    is that socket._realsocket.close() closes the filehandle immediately,\n    while socket.socket.close() just breaks the reference.\n    ";
static PyObject *__pyx_f_4coio_new_realsocket(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  __pyx_1 = PySequence_Tuple(__pyx_v_args); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_setdoclose); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.new_realsocket");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_socketpair(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_socketpair[] = "Non-blocking drop-in replacement for socket.socketpair.";
static PyObject *__pyx_f_4coio_socketpair(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_sock1;
  PyObject *__pyx_v_sock2;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  __pyx_v_sock1 = Py_None; Py_INCREF(Py_None);
  __pyx_v_sock2 = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2035 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket_realsocketpair); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyObject_GetIter(__pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; goto __pyx_L1;}
  Py_DECREF(__pyx_v_sock1);
  __pyx_v_sock1 = __pyx_2;
  __pyx_2 = 0;
  __pyx_3 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; goto __pyx_L1;}
  Py_DECREF(__pyx_v_sock2);
  __pyx_v_sock2 = __pyx_3;
  __pyx_3 = 0;
  if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2036 */
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2036; goto __pyx_L1;}
  Py_INCREF(__pyx_v_sock1);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_sock1);
  __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2036; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2036; goto __pyx_L1;}
  Py_INCREF(__pyx_v_sock2);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_sock2);
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2036; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2036; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_2);
  __pyx_3 = 0;
  __pyx_2 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.socketpair");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_sock1);
  Py_DECREF(__pyx_v_sock2);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_new_realsocket_fromfd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_new_realsocket_fromfd[] = "Non-blocking drop-in replacement for socket.fromfd.\n\n    Please note that socket.fromfd returns a socket._realsocket in Python 2.6.\n\n    Please note that the fileno() of the returned socket is different from\n    args[0], because it\'s dup()ed. \n    ";
static PyObject *__pyx_f_4coio_new_realsocket_fromfd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket_fromfd); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_setdoclose); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyInt_FromLong(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
  __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.new_realsocket_fromfd");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static int __pyx_f_4coio_11sockwrapper___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_11sockwrapper___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_sock = 0;
  int __pyx_r;
  static char *__pyx_argnames[] = {"sock",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_sock)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_sock);
  Py_INCREF(__pyx_v_sock);
  Py_DECREF(((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock);
  ((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock = __pyx_v_sock;

  __pyx_r = 0;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_sock);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11sockwrapper_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11sockwrapper_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock);
  __pyx_r = ((struct __pyx_obj_4coio_sockwrapper *)__pyx_v_self)->c_sock;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_11nbsslsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_11nbsslsocket___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  int __pyx_v_do_handshake_now;
  PyObject *__pyx_v_my_sslsocket_impl;
  PyObject *__pyx_v_attr;
  PyObject *__pyx_v_timeout;
  int __pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_ssize_t __pyx_5;
  int __pyx_6;
  double __pyx_7;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, &__pyx_v_kwargs, 0) < 0) return -1;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    Py_XDECREF(__pyx_v_kwargs);
    return -1;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_v_my_sslsocket_impl = Py_None; Py_INCREF(Py_None);
  __pyx_v_attr = Py_None; Py_INCREF(Py_None);
  __pyx_v_timeout = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2121 */
  __pyx_1 = PySequence_Contains(__pyx_v_kwargs, __pyx_n_sslsocket_impl); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2121; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_pop); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2122; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2122; goto __pyx_L1;}
    Py_INCREF(__pyx_n_sslsocket_impl);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_n_sslsocket_impl);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2122; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_my_sslsocket_impl);
    __pyx_v_my_sslsocket_impl = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_sslsocket_impl); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2124; goto __pyx_L1;}
    Py_DECREF(__pyx_v_my_sslsocket_impl);
    __pyx_v_my_sslsocket_impl = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2125 */
  __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2125; goto __pyx_L1;}
  __pyx_4 = PyObject_GetItem(__pyx_v_args, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2125; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_1 = PyObject_HasAttr(__pyx_4,__pyx_n__sock); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2125; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2126; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_v_args, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2126; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n__sock); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2126; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket_realsocket); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2126; goto __pyx_L1;}
    __pyx_1 = PyObject_IsInstance(__pyx_4,__pyx_2); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2126; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
  }
  if (__pyx_1) {
    goto __pyx_L3;
  }
  __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2130; goto __pyx_L1;}
  __pyx_4 = PyObject_GetItem(__pyx_v_args, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2130; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket_realsocket); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2130; goto __pyx_L1;}
  __pyx_1 = PyObject_IsInstance(__pyx_4,__pyx_2); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2130; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2131 */
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2131; goto __pyx_L1;}
    Py_INCREF(__pyx_v_args);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_args);
    __pyx_4 = PyObject_CallObject(((PyObject *)(&PyList_Type)), __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2131; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_args);
    __pyx_v_args = __pyx_4;
    __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2132 */
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2132; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_v_args, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2132; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2132; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_sockwrapper), __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2132; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2132; goto __pyx_L1;}
    if (PyObject_SetItem(__pyx_v_args, __pyx_3, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2132; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_args, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_4 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_2 = PyNumber_Add(__pyx_k70p, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_4 = PyObject_CallObject(PyExc_TypeError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; goto __pyx_L1;}
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2135 */
  __pyx_5 = PyObject_Length(__pyx_v_args); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2135; goto __pyx_L1;}
  __pyx_1 = (__pyx_5 > 7);
  if (__pyx_1) {
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2136; goto __pyx_L1;}
    Py_INCREF(__pyx_k71p);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_k71p);
    __pyx_3 = PyObject_CallObject(PyExc_NotImplementedError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2136; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_Raise(__pyx_3, 0, 0);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2136; goto __pyx_L1;}
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2138 */
  __pyx_v_do_handshake_now = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2139 */
  __pyx_4 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_get); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2139; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2139; goto __pyx_L1;}
  Py_INCREF(__pyx_n_do_handshake_on_connect);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_n_do_handshake_on_connect);
  __pyx_3 = PyObject_CallObject(__pyx_4, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2139; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyObject_IsTrue(__pyx_3); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2139; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2140 */
    if (PyObject_SetItem(__pyx_v_kwargs, __pyx_n_do_handshake_on_connect, Py_False) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2140; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2141 */
    __pyx_v_do_handshake_now = 1;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2145 */
  __pyx_4 = PySequence_Tuple(__pyx_v_args); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2145; goto __pyx_L1;}
  __pyx_2 = PyEval_CallObjectWithKeywords(__pyx_v_my_sslsocket_impl, __pyx_4, __pyx_v_kwargs); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2145; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2146 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_recv); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2146; goto __pyx_L1;}
  __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2146; goto __pyx_L1;}
  __pyx_2 = PyObject_GetItem(__pyx_v_args, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2146; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n__sock); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2146; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_4, __pyx_n_recv); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2146; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_1 = __pyx_3 == __pyx_2;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_1) {
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2150; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n__delegate_methods); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2150; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_2 = PyObject_GetIter(__pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2150; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    for (;;) {
      __pyx_4 = PyIter_Next(__pyx_2);
      if (!__pyx_4) {
        if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2150; goto __pyx_L1;}
        break;
      }
      Py_DECREF(__pyx_v_attr);
      __pyx_v_attr = __pyx_4;
      __pyx_4 = 0;
      __pyx_6 = PyObject_DelAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock,__pyx_v_attr); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2151; goto __pyx_L1;}
    }
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2152 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sock); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2152; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2153 */
  __pyx_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2153; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_4;
  __pyx_4 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2154 */
  __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_fileno); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2154; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2154; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2154; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.fd = __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2155 */
  __pyx_4 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_gettimeout); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2155; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_4, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2155; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_v_timeout);
  __pyx_v_timeout = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2157 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_setblocking); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2157; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2157; goto __pyx_L1;}
  Py_INCREF(Py_False);
  PyTuple_SET_ITEM(__pyx_4, 0, Py_False);
  __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2157; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2159 */
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value = (-1.0);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2160 */
  event_set((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.read_ev),((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.fd,EV_READ,__pyx_f_4coio_HandleCTimeoutWakeup,NULL);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2162 */
  event_set((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.write_ev),((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.fd,EV_WRITE,__pyx_f_4coio_HandleCTimeoutWakeup,NULL);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2169 */
  __pyx_1 = __pyx_v_do_handshake_now;
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2171 */
    if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_do_handshake_on_connect, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2171; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2172 */
    __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2172; goto __pyx_L1;}
    if (__pyx_1) {
      __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_do_handshake); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2173; goto __pyx_L1;}
      __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2173; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L10;
    }
    __pyx_L10:;
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2176 */
  __pyx_1 = __pyx_v_timeout != Py_None;
  if (__pyx_1) {
    __pyx_7 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2177; goto __pyx_L1;}
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value = __pyx_7;
    goto __pyx_L11;
  }
  __pyx_L11:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_XDECREF(__pyx_v_kwargs);
  Py_DECREF(__pyx_v_my_sslsocket_impl);
  Py_DECREF(__pyx_v_attr);
  Py_DECREF(__pyx_v_timeout);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_fileno(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.fd); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2180; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.fileno");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_dup[] = "Duplicates to a non-SSL socket (as in SSLSocket.dup).";
static PyObject *__pyx_f_4coio_11nbsslsocket_dup(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_dup); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_nbsocket), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.dup");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static void __pyx_f_4coio_11nbsslsocket___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_f_4coio_11nbsslsocket___dealloc__(PyObject *__pyx_v_self) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_close); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2191; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2191; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.__dealloc__");
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
}

static PyObject *__pyx_f_4coio_11nbsslsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_close(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2194 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_close); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2195 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2195; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_1;
  __pyx_1 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.close");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_4type___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_4type___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_type); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2199; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.type.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_6family___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_6family___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2203; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.family.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_5proto___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_5proto___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_proto); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2207; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.proto.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_7_sslobj___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_7_sslobj___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_5_sock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_5_sock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_8_sslsock___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_8_sslsock___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __pyx_r = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_7keyfile___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_7keyfile___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_keyfile); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.keyfile.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_8certfile___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_8certfile___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_cerfile); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2231; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.certfile.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_9cert_reqs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_9cert_reqs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_cert_reqs); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2235; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.cert_reqs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_11ssl_version___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_11ssl_version___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ssl_version); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2239; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.ssl_version.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_8ca_certs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_8ca_certs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ca_certs); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2243; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.ca_certs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_do_handshake_on_connect); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2247; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake_on_connect.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_val); /*proto*/
static int __pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_val) {
  int __pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_val);
  __pyx_1 = PyObject_IsTrue(__pyx_v_val); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2249; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2249; goto __pyx_L1;}
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_do_handshake_on_connect, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2249; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake_on_connect.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_val);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__suppress_ragged_eofs); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2253; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket.suppress_ragged_eofs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_14_makefile_refs___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_14_makefile_refs___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__makefile_refs); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2257; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.nbsslsocket._makefile_refs.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_7timeout___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_7timeout___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2265; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.timeout.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_setsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_setsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2268; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2268; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2268; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.setsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getsockopt(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_getsockopt); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2271; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2271; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2271; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getsockopt");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getsockname(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_getsockname); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2274; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2274; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2274; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getsockname");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getpeername(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_getpeername); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getpeername");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_bind(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_bind); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2280; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2280; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2280; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.bind");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_listen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_listen); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2283; goto __pyx_L1;}
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2283; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2283; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.listen");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_gettimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value < 0);
  if (__pyx_1) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2289; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.gettimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_setblocking(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_is_blocking = 0;
  PyObject *__pyx_r;
  int __pyx_1;
  double __pyx_2;
  static char *__pyx_argnames[] = {"is_blocking",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_is_blocking)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_is_blocking);
  __pyx_1 = PyObject_IsTrue(__pyx_v_is_blocking); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2292; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyFloat_AsDouble(Py_None); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2293; goto __pyx_L1;}
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value = __pyx_2;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2295 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value = 0.0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2296 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.tv.tv_sec = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2297 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.tv.tv_usec = 1;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.nbsslsocket.setblocking");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_is_blocking);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_settimeout(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  double __pyx_v_timeout_double;
  PyObject *__pyx_r;
  int __pyx_1;
  double __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_timeout);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2301 */
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value = (-1.0);
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2304 */
    __pyx_2 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2304; goto __pyx_L1;}
    __pyx_v_timeout_double = __pyx_2;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2305 */
    __pyx_1 = (__pyx_v_timeout_double < 0.0);
    if (__pyx_1) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2306; goto __pyx_L1;}
      Py_INCREF(__pyx_k26p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k26p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2306; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2306; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2307 */
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.timeout_value = __pyx_v_timeout_double;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2308 */
    __pyx_1 = (__pyx_v_timeout_double == 0.0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2309 */
      ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.tv.tv_sec = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2310 */
      ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.tv.tv_usec = 1;
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2312 */
      ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.tv.tv_sec = ((long)__pyx_v_timeout_double);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2313 */
      ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.tv.tv_usec = ((unsigned int)((__pyx_v_timeout_double - ((double)((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi.tv.tv_sec)) * 1000000.0));
    }
    __pyx_L4:;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.settimeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_read[] = "Emulate ssl.SSLSocket.read, doesn\'t make much sense.";
static PyObject *__pyx_f_4coio_11nbsslsocket_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_len = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  static char *__pyx_argnames[] = {"len",0};
  __pyx_v_len = __pyx_d32;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_len)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_len);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_read); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2320; goto __pyx_L4;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2320; goto __pyx_L4;}
      Py_INCREF(__pyx_v_len);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_len);
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2320; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2321 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2321; goto __pyx_L1;}
    __pyx_5 = PyErr_ExceptionMatches(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      __pyx_filename = __pyx_f[0]; __pyx_lineno = 2321; __Pyx_AddTraceback("coio.read");
      PyErr_Fetch(&__pyx_3, &__pyx_4, &__pyx_2);
      if (__Pyx_NormalizeException(&__pyx_3, &__pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2321; goto __pyx_L1;}
      Py_INCREF(__pyx_4);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_4;
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __pyx_6 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2323; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2324; goto __pyx_L1;}
      __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2324; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2324; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_5) {
        __pyx_7 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2325; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; goto __pyx_L1;}
      __pyx_8 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_EOF); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_8, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_8); __pyx_8 = 0;
      __pyx_6 = PyInt_FromLong(__pyx_5); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; goto __pyx_L1;}
      __pyx_5 = PyObject_IsTrue(__pyx_6); if (__pyx_5 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; goto __pyx_L1;}
      if (__pyx_5) {
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_suppress_ragged_eofs); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2327; goto __pyx_L1;}
      }
      __pyx_5 = PyObject_IsTrue(__pyx_6); if (__pyx_5 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_5) {
        Py_INCREF(__pyx_k19p);
        __pyx_r = __pyx_k19p;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        goto __pyx_L0;
        goto __pyx_L6;
      }
      /*else*/ {
        PyErr_Restore(__pyx_3, __pyx_4, __pyx_2);
        __pyx_3 = __pyx_4 = __pyx_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2330; goto __pyx_L1;}
      }
      __pyx_L6:;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("coio.nbsslsocket.read");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_len);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_write[] = "Emulate ssl.SSLSocket.write, doesn\'t make much sense.";
static PyObject *__pyx_f_4coio_11nbsslsocket_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"data",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_data)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_write); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2336; goto __pyx_L4;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2336; goto __pyx_L4;}
      Py_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2336; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_r = __pyx_4;
      __pyx_4 = 0;
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2337 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2337; goto __pyx_L1;}
    __pyx_5 = PyErr_ExceptionMatches(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      __pyx_filename = __pyx_f[0]; __pyx_lineno = 2337; __Pyx_AddTraceback("coio.write");
      PyErr_Fetch(&__pyx_3, &__pyx_4, &__pyx_2);
      if (__Pyx_NormalizeException(&__pyx_3, &__pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2337; goto __pyx_L1;}
      Py_INCREF(__pyx_4);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_4;
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2338; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2338; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2338; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_5) {
        __pyx_6 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2339; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2340; goto __pyx_L1;}
      __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2340; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2340; goto __pyx_L1;}
      __pyx_5 = __pyx_5 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_5) {
        __pyx_7 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2341; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L6;
      }
      /*else*/ {
        PyErr_Restore(__pyx_3, __pyx_4, __pyx_2);
        __pyx_3 = __pyx_4 = __pyx_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2343; goto __pyx_L1;}
      }
      __pyx_L6:;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.write");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_accept(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4coio_nbsslsocket *__pyx_v_asslsock;
  PyObject *__pyx_v_asock;
  PyObject *__pyx_v_addr;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_asslsock = ((struct __pyx_obj_4coio_nbsslsocket *)Py_None); Py_INCREF(Py_None);
  __pyx_v_asock = Py_None; Py_INCREF(Py_None);
  __pyx_v_addr = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2347 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_accept); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2347; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2347; goto __pyx_L1;}
  __pyx_3 = coio_c_socket_call(__pyx_1,__pyx_2,(&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2347; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyObject_GetIter(__pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2347; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2347; goto __pyx_L1;}
  Py_DECREF(__pyx_v_asock);
  __pyx_v_asock = __pyx_2;
  __pyx_2 = 0;
  __pyx_3 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2347; goto __pyx_L1;}
  Py_DECREF(__pyx_v_addr);
  __pyx_v_addr = __pyx_3;
  __pyx_3 = 0;
  if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2347; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2349 */
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2350; goto __pyx_L1;}
  Py_INCREF(__pyx_v_asock);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_asock);
  __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_sockwrapper), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2350; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_2 = PyDict_New(); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_keyfile); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2351; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_keyfile, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_certfile); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2352; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_certfile, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyDict_SetItem(__pyx_2, __pyx_n_server_side, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_cert_reqs); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2354; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_cert_reqs, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ssl_version); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2355; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_ssl_version, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ca_certs); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2356; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_ca_certs, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyDict_SetItem(__pyx_2, __pyx_n_do_handshake_on_connect, Py_False) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_suppress_ragged_eofs); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2358; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_2, __pyx_n_suppress_ragged_eofs, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyEval_CallObjectWithKeywords(((PyObject *)__pyx_ptype_4coio_nbsslsocket), __pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_v_asslsock));
  __pyx_v_asslsock = ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2359 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_do_handshake_on_connect); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2359; goto __pyx_L1;}
  __pyx_4 = PyObject_IsTrue(__pyx_1); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2359; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_4) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2360 */
    if (PyObject_SetAttr(__pyx_v_asslsock->sslsock, __pyx_n_do_handshake_on_connect, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2360; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2361 */
    __pyx_2 = PyObject_GetAttr(((PyObject *)__pyx_v_asslsock), __pyx_n_do_handshake); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2361; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2361; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2362 */
  __pyx_1 = PyTuple_New(2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2362; goto __pyx_L1;}
  Py_INCREF(((PyObject *)__pyx_v_asslsock));
  PyTuple_SET_ITEM(__pyx_1, 0, ((PyObject *)__pyx_v_asslsock));
  Py_INCREF(__pyx_v_addr);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_v_addr);
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.accept");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_asslsock);
  Py_DECREF(__pyx_v_asock);
  Py_DECREF(__pyx_v_addr);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_connect(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  struct timeval __pyx_v_tv;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  unsigned int __pyx_6;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2366 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n__sslobj); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2366; goto __pyx_L1;}
  __pyx_2 = PyObject_IsTrue(__pyx_1); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2366; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_2) {
    __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2367; goto __pyx_L1;}
    Py_INCREF(__pyx_k92p);
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_k92p);
    __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2367; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_Raise(__pyx_3, 0, 0);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2367; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2371 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_family); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2371; goto __pyx_L1;}
  __pyx_2 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2371; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = __pyx_f_4coio_c_gethostbyname(__pyx_v_address,__pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2371; goto __pyx_L1;}
  Py_DECREF(__pyx_v_address);
  __pyx_v_address = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2373 */
  while (1) {
    __pyx_4 = 1;
    if (!__pyx_4) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2374 */
    __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_connect_ex); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2374; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2374; goto __pyx_L1;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_address);
    __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2374; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_5;
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2375 */
    __pyx_2 = PyObject_IsTrue(__pyx_v_err); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2375; goto __pyx_L1;}
    if (__pyx_2) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2376 */
      __pyx_1 = PyInt_FromLong(EAGAIN); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2376; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_v_err, __pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2376; goto __pyx_L1;}
      __pyx_2 = __pyx_2 != 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      if (__pyx_2) {
        __pyx_3 = PyInt_FromLong(EINPROGRESS); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2376; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_v_err, __pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2376; goto __pyx_L1;}
        __pyx_2 = __pyx_2 != 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
      }
      if (__pyx_2) {
        __pyx_2 = PyInt_AsLong(__pyx_v_err); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2377; goto __pyx_L1;}
        __pyx_5 = PyString_FromString(strerror(__pyx_2)); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2377; goto __pyx_L1;}
        __pyx_1 = PyTuple_New(2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2377; goto __pyx_L1;}
        Py_INCREF(__pyx_v_err);
        PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_err);
        PyTuple_SET_ITEM(__pyx_1, 1, __pyx_5);
        __pyx_5 = 0;
        __pyx_3 = PyObject_CallObject(coio_socket_error, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2377; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        __Pyx_Raise(__pyx_3, 0, 0);
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2377; goto __pyx_L1;}
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2382 */
      __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_c_family); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2382; goto __pyx_L1;}
      __pyx_1 = PyInt_FromLong(AF_INET); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2382; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_5, __pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2382; goto __pyx_L1;}
      __pyx_2 = __pyx_2 == 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      if (__pyx_2) {

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2383 */
        __pyx_v_tv.tv_sec = 0;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2384 */
        __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_connect_magic_usec); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2384; goto __pyx_L1;}
        __pyx_6 = PyInt_AsUnsignedLongMask(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2384; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_v_tv.tv_usec = __pyx_6;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2385 */
        select(0,NULL,NULL,NULL,(&__pyx_v_tv));
        goto __pyx_L7;
      }
      __pyx_L7:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2387 */
      __pyx_5 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2387; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      goto __pyx_L5;
    }
    /*else*/ {
      goto __pyx_L4;
    }
    __pyx_L5:;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2391 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2391; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n__ssl); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2391; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_5 = PyObject_GetAttr(__pyx_3, __pyx_n_sslwrap); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2391; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_keyfile); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2392; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_certfile); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2393; goto __pyx_L1;}
  __pyx_7 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_cert_reqs); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2393; goto __pyx_L1;}
  __pyx_8 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ssl_version); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2394; goto __pyx_L1;}
  __pyx_9 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_ca_certs); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2394; goto __pyx_L1;}
  __pyx_10 = PyTuple_New(7); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2391; goto __pyx_L1;}
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  PyTuple_SET_ITEM(__pyx_10, 0, ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock);
  Py_INCREF(Py_False);
  PyTuple_SET_ITEM(__pyx_10, 1, Py_False);
  PyTuple_SET_ITEM(__pyx_10, 2, __pyx_1);
  PyTuple_SET_ITEM(__pyx_10, 3, __pyx_3);
  PyTuple_SET_ITEM(__pyx_10, 4, __pyx_7);
  PyTuple_SET_ITEM(__pyx_10, 5, __pyx_8);
  PyTuple_SET_ITEM(__pyx_10, 6, __pyx_9);
  __pyx_1 = 0;
  __pyx_3 = 0;
  __pyx_7 = 0;
  __pyx_8 = 0;
  __pyx_9 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_5, __pyx_10); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2391; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  Py_DECREF(__pyx_10); __pyx_10 = 0;
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2391; goto __pyx_L1;}
  Py_INCREF(__pyx_1);
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = __pyx_1;
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2396 */
  __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_do_handshake_on_connect); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2396; goto __pyx_L1;}
  __pyx_2 = PyObject_IsTrue(__pyx_3); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2396; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_2) {
    __pyx_7 = PyObject_GetAttr(__pyx_v_self, __pyx_n_do_handshake); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2397; goto __pyx_L1;}
    __pyx_8 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2397; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_DECREF(__pyx_8); __pyx_8 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  __Pyx_AddTraceback("coio.nbsslsocket.connect");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_connect_ex[] = "Do a connect(2), and return 0 or the error code.\n\n        The implementation of connect_ex is not optimized for speed.\n\n        This is incompatible with SSLSocket.connect_ex, which doesn\'t do the\n        SSL handshake, and connects only the socket._realsocket.\n        \n        Returns:\n          0 on success; errno for socket_error and -800 - errno for\n          ssl.SSLError.\n        ";
static PyObject *__pyx_f_4coio_11nbsslsocket_connect_ex(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_address = 0;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"address",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_address)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_address);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2411 */
  /*try:*/ {
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connect); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2412; goto __pyx_L2;}
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2412; goto __pyx_L2;}
    Py_INCREF(__pyx_v_address);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_address);
    __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2412; goto __pyx_L2;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_1); __pyx_1 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2413 */
  __pyx_4 = PyErr_ExceptionMatches(coio_socket_error);
  if (__pyx_4) {
    __pyx_filename = __pyx_f[0]; __pyx_lineno = 2413; __Pyx_AddTraceback("coio.connect_ex");
    PyErr_Fetch(&__pyx_1, &__pyx_2, &__pyx_3);
    if (__Pyx_NormalizeException(&__pyx_1, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2413; goto __pyx_L1;}
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_2;
    __pyx_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_args); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2414; goto __pyx_L1;}
    __pyx_6 = PyInt_FromLong(0); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2414; goto __pyx_L1;}
    __pyx_7 = PyObject_GetItem(__pyx_5, __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2414; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_r = __pyx_7;
    __pyx_7 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L0;
    Py_XDECREF(__pyx_1); __pyx_1 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2415 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(__pyx_5, __pyx_n_SSLError); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_4 = PyErr_ExceptionMatches(__pyx_6);
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  if (__pyx_4) {
    __pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; __Pyx_AddTraceback("coio.connect_ex");
    PyErr_Fetch(&__pyx_7, &__pyx_1, &__pyx_2);
    if (__Pyx_NormalizeException(&__pyx_7, &__pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; goto __pyx_L1;}
    Py_INCREF(__pyx_1);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_1;
    __pyx_3 = PyInt_FromLong((-800)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2416; goto __pyx_L1;}
    __pyx_5 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2416; goto __pyx_L1;}
    __pyx_6 = PyNumber_Subtract(__pyx_3, __pyx_5); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2416; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_r = __pyx_6;
    __pyx_6 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    goto __pyx_L0;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_1); __pyx_1 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  goto __pyx_L1;
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2417 */
  __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2417; goto __pyx_L1;}
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.connect_ex");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_shutdown(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_how = 0;
  PyObject *__pyx_v_err;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  static char *__pyx_argnames[] = {"how",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_how)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_how);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2421 */
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2421; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2422 */
  Py_INCREF(Py_None);
  Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
  ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2423 */
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2424 */
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_shutdown); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2424; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2424; goto __pyx_L1;}
    Py_INCREF(__pyx_v_how);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_how);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2424; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_err);
    __pyx_v_err = __pyx_4;
    __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2425 */
    __pyx_2 = PyInt_FromLong(EAGAIN); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2425; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_v_err, __pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2425; goto __pyx_L1;}
    __pyx_5 = __pyx_5 != 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_5) {
      Py_INCREF(__pyx_v_err);
      __pyx_r = __pyx_v_err;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2428 */
    __pyx_3 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2428; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.shutdown");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_how);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_pending); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2432; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2432; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.pending");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_unwrap(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_unwrap(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_s;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_s = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2435 */
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2435; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2436 */
    __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_shutdown); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2436; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2436; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_s);
    __pyx_v_s = __pyx_3;
    __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2437 */
    if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__sslobj, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2437; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2438 */
    Py_INCREF(Py_None);
    Py_DECREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj);
    ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj = Py_None;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2439 */
    Py_INCREF(__pyx_v_s);
    __pyx_r = __pyx_v_s;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2440 */
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2440; goto __pyx_L1;}
  Py_INCREF(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  PyTuple_SET_ITEM(__pyx_2, 0, ((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock);
  __pyx_3 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2440; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyNumber_Add(__pyx_k99p, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2440; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2440; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2440; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_Raise(__pyx_2, 0, 0);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2440; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.unwrap");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_s);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_do_handshake(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_do_handshake(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  long __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  while (1) {
    __pyx_1 = 1;
    if (!__pyx_1) break;
    /*try:*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2445 */
      __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_do_handshake); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2445; goto __pyx_L4;}
      __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2445; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2446 */
      __pyx_r = Py_None; Py_INCREF(Py_None);
      goto __pyx_L0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2447 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2447; goto __pyx_L1;}
    __pyx_4 = PyErr_ExceptionMatches(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_4) {
      __pyx_filename = __pyx_f[0]; __pyx_lineno = 2447; __Pyx_AddTraceback("coio.do_handshake");
      PyErr_Fetch(&__pyx_3, &__pyx_2, &__pyx_5);
      if (__Pyx_NormalizeException(&__pyx_3, &__pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2447; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;
      __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2448; goto __pyx_L1;}
      __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2448; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2448; goto __pyx_L1;}
      __pyx_4 = __pyx_4 == 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      if (__pyx_4) {
        __pyx_6 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2449; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L6;
      }
      __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2450; goto __pyx_L1;}
      __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2450; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2450; goto __pyx_L1;}
      __pyx_4 = __pyx_4 == 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      if (__pyx_4) {
        __pyx_7 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2451; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L6;
      }
      /*else*/ {
        PyErr_Restore(__pyx_3, __pyx_2, __pyx_5);
        __pyx_3 = __pyx_2 = __pyx_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2453; goto __pyx_L1;}
      }
      __pyx_L6:;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.do_handshake");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_getpeercert(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_getpeercert(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_binary_form = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"binary_form",0};
  __pyx_v_binary_form = __pyx_d33;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_binary_form)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_binary_form);
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_peer_certificate); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2456; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2456; goto __pyx_L1;}
  Py_INCREF(__pyx_v_binary_form);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_binary_form);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2456; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.nbsslsocket.getpeercert");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_binary_form);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_cipher(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_cipher(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2459; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    Py_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_3 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_cipher); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2462; goto __pyx_L1;}
    __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2462; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.cipher");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_recv[] = "Receive data from the SSL or non-SSL connection.\n\n        The defaults for buflen and flags are the same as in ssl.SSLSocket.\n        ";
static PyObject *__pyx_f_4coio_11nbsslsocket_recv(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_buflen;
  int __pyx_v_flags;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  static char *__pyx_argnames[] = {"buflen","flags",0};
  __pyx_v_buflen = __pyx_d34;
  __pyx_v_flags = __pyx_d35;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|ii", __pyx_argnames, &__pyx_v_buflen, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2469 */
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2469; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2470 */
    __pyx_1 = __pyx_v_flags;
    if (__pyx_1) {
      __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n___class__); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2472; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2472; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
      __pyx_2 = 0;
      __pyx_2 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2472; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyNumber_Add(__pyx_k102p, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2472; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2471; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
      __pyx_3 = 0;
      __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2471; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_3, 0, 0);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2471; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2473 */
    while (1) {
      __pyx_4 = 1;
      if (!__pyx_4) break;
      /*try:*/ {
        __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_read); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2475; goto __pyx_L6;}
        __pyx_3 = PyInt_FromLong(__pyx_v_buflen); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2475; goto __pyx_L6;}
        __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2475; goto __pyx_L6;}
        PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
        __pyx_3 = 0;
        __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2475; goto __pyx_L6;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __pyx_r = __pyx_3;
        __pyx_3 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L7;
      __pyx_L6:;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2476 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2476; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      if (__pyx_1) {
        __pyx_filename = __pyx_f[0]; __pyx_lineno = 2476; __Pyx_AddTraceback("coio.recv");
        PyErr_Fetch(&__pyx_5, &__pyx_3, &__pyx_2);
        if (__Pyx_NormalizeException(&__pyx_5, &__pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2476; goto __pyx_L1;}
        Py_INCREF(__pyx_3);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_3;
        __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2477; goto __pyx_L1;}
        __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2477; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2477; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        if (__pyx_1) {
          __pyx_6 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2478; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          goto __pyx_L8;
        }
        __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2479; goto __pyx_L1;}
        __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2479; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2479; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        if (__pyx_1) {
          __pyx_7 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2480; goto __pyx_L1;}
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          goto __pyx_L8;
        }
        __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2481; goto __pyx_L1;}
        __pyx_8 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_EOF); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2481; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_7, __pyx_8, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2481; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        __pyx_6 = PyInt_FromLong(__pyx_1); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2481; goto __pyx_L1;}
        __pyx_1 = PyObject_IsTrue(__pyx_6); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2481; goto __pyx_L1;}
        if (__pyx_1) {
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n_suppress_ragged_eofs); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2482; goto __pyx_L1;}
        }
        __pyx_1 = PyObject_IsTrue(__pyx_6); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2481; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        if (__pyx_1) {
          Py_INCREF(__pyx_k19p);
          __pyx_r = __pyx_k19p;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          goto __pyx_L0;
          goto __pyx_L8;
        }
        /*else*/ {
          PyErr_Restore(__pyx_5, __pyx_3, __pyx_2);
          __pyx_5 = __pyx_3 = __pyx_2 = 0;
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2485; goto __pyx_L1;}
        }
        __pyx_L8:;
        Py_XDECREF(__pyx_5); __pyx_5 = 0;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        goto __pyx_L7;
      }
      goto __pyx_L1;
      __pyx_L7:;
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2486 */
  __pyx_7 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recv); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2486; goto __pyx_L1;}
  __pyx_8 = PyInt_FromLong(__pyx_v_buflen); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2486; goto __pyx_L1;}
  __pyx_6 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2486; goto __pyx_L1;}
  __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2486; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_8);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_6);
  __pyx_8 = 0;
  __pyx_6 = 0;
  __pyx_3 = coio_c_socket_call(__pyx_7,__pyx_5,(&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2486; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("coio.nbsslsocket.recv");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2490 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2490; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2491 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2491; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2491; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.recvfrom");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_recv_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2495 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2495; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2496 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recv_into); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2496; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2496; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.recv_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_recvfrom_into(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2500 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2500; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2501 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_recvfrom_into); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2501; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2501; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.recvfrom_into");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_send(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"data","flags",0};
  __pyx_v_flags = __pyx_d36;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_data, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2505 */
  __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2505; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2506 */
    __pyx_1 = __pyx_v_flags;
    if (__pyx_1) {
      __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n___class__); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2508; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2508; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
      __pyx_2 = 0;
      __pyx_2 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2508; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyNumber_Add(__pyx_k104p, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2508; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2507; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
      __pyx_3 = 0;
      __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2507; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_3, 0, 0);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2507; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2509 */
    while (1) {
      __pyx_4 = 1;
      if (!__pyx_4) break;
      /*try:*/ {
        __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_write); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; goto __pyx_L6;}
        __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; goto __pyx_L6;}
        Py_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
        __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; goto __pyx_L6;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_r = __pyx_5;
        __pyx_5 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L7;
      __pyx_L6:;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2512 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2512; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      if (__pyx_1) {
        __pyx_filename = __pyx_f[0]; __pyx_lineno = 2512; __Pyx_AddTraceback("coio.send");
        PyErr_Fetch(&__pyx_3, &__pyx_5, &__pyx_2);
        if (__Pyx_NormalizeException(&__pyx_3, &__pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2512; goto __pyx_L1;}
        Py_INCREF(__pyx_5);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_5;
        __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2513; goto __pyx_L1;}
        __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2513; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2513; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        if (__pyx_1) {
          __pyx_6 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2514; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          goto __pyx_L8;
        }
        __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2515; goto __pyx_L1;}
        __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2515; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2515; goto __pyx_L1;}
        __pyx_1 = __pyx_1 == 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        if (__pyx_1) {
          __pyx_7 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2516; goto __pyx_L1;}
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          goto __pyx_L8;
        }
        /*else*/ {
          PyErr_Restore(__pyx_3, __pyx_5, __pyx_2);
          __pyx_3 = __pyx_5 = __pyx_2 = 0;
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2518; goto __pyx_L1;}
        }
        __pyx_L8:;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        Py_XDECREF(__pyx_5); __pyx_5 = 0;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        goto __pyx_L7;
      }
      goto __pyx_L1;
      __pyx_L7:;
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2519 */
  __pyx_6 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; goto __pyx_L1;}
  __pyx_7 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; goto __pyx_L1;}
  Py_INCREF(__pyx_v_data);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_data);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_7);
  __pyx_7 = 0;
  __pyx_5 = coio_c_socket_call(__pyx_6,__pyx_3,(&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_r = __pyx_5;
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.nbsslsocket.send");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_sendto(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (__Pyx_GetStarArgs(&__pyx_args, &__pyx_kwds, __pyx_argnames, 0, &__pyx_v_args, 0, 0) < 0) return 0;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) {
    Py_XDECREF(__pyx_args);
    Py_XDECREF(__pyx_kwds);
    Py_XDECREF(__pyx_v_args);
    return 0;
  }
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2523 */
  __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2523; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2524 */
  __pyx_1 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_sendto); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2524; goto __pyx_L1;}
  __pyx_2 = coio_c_socket_call(__pyx_1,__pyx_v_args,(&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2524; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.nbsslsocket.sendto");
  __pyx_r = 0;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_self);
  Py_XDECREF(__pyx_args);
  Py_XDECREF(__pyx_kwds);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_11nbsslsocket_sendall(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  int __pyx_v_flags;
  int __pyx_v_got;
  int __pyx_v_got2;
  PyObject *__pyx_v_buf;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  long __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  Py_ssize_t __pyx_8;
  PyObject *__pyx_9 = 0;
  static char *__pyx_argnames[] = {"data","flags",0};
  __pyx_v_flags = __pyx_d37;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_data, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_data);
  __pyx_v_buf = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2530 */
  __pyx_v_got = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2531 */
  Py_INCREF(__pyx_v_data);
  Py_DECREF(__pyx_v_buf);
  __pyx_v_buf = __pyx_v_data;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2532 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_data); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2532; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2533 */
    __pyx_1 = PyObject_IsTrue(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2533; goto __pyx_L1;}
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2534 */
      __pyx_1 = __pyx_v_flags;
      if (__pyx_1) {
        __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n___class__); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2537; goto __pyx_L1;}
        __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2537; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
        __pyx_2 = 0;
        __pyx_2 = PyObject_CallObject(((PyObject *)(&PyString_Type)), __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2537; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_3 = PyNumber_Add(__pyx_k105p, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2536; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2535; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
        __pyx_3 = 0;
        __pyx_3 = PyObject_CallObject(PyExc_ValueError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2535; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_Raise(__pyx_3, 0, 0);
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2535; goto __pyx_L1;}
        goto __pyx_L4;
      }
      __pyx_L4:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2538 */
      while (1) {
        __pyx_4 = 1;
        if (!__pyx_4) break;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2539 */
        /*try:*/ {

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2540 */
          __pyx_v_got2 = 0;

          /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2541 */
          __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslobj, __pyx_n_write); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2541; goto __pyx_L7;}
          __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2541; goto __pyx_L7;}
          Py_INCREF(__pyx_v_buf);
          PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_buf);
          __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2541; goto __pyx_L7;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_1 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2541; goto __pyx_L7;}
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          __pyx_v_got2 = __pyx_1;
        }
        goto __pyx_L8;
        __pyx_L7:;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        Py_XDECREF(__pyx_5); __pyx_5 = 0;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2542 */
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_SSLError); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2542; goto __pyx_L1;}
        __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        if (__pyx_1) {
          __pyx_filename = __pyx_f[0]; __pyx_lineno = 2542; __Pyx_AddTraceback("coio.sendall");
          PyErr_Fetch(&__pyx_3, &__pyx_5, &__pyx_2);
          if (__Pyx_NormalizeException(&__pyx_3, &__pyx_5, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2542; goto __pyx_L1;}
          Py_INCREF(__pyx_5);
          Py_DECREF(__pyx_v_e);
          __pyx_v_e = __pyx_5;
          __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2543; goto __pyx_L1;}
          __pyx_7 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2543; goto __pyx_L1;}
          if (PyObject_Cmp(__pyx_6, __pyx_7, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2543; goto __pyx_L1;}
          __pyx_1 = __pyx_1 == 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          if (__pyx_1) {
            __pyx_6 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_READ); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2544; goto __pyx_L1;}
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            goto __pyx_L9;
          }
          __pyx_7 = PyObject_GetAttr(__pyx_v_e, __pyx_n_errno); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2545; goto __pyx_L1;}
          __pyx_6 = PyInt_FromLong(__pyx_v_4coio_SSL_ERROR_WANT_WRITE); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2545; goto __pyx_L1;}
          if (PyObject_Cmp(__pyx_7, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2545; goto __pyx_L1;}
          __pyx_1 = __pyx_1 == 0;
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          if (__pyx_1) {
            __pyx_7 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2546; goto __pyx_L1;}
            Py_DECREF(__pyx_7); __pyx_7 = 0;
            goto __pyx_L9;
          }
          /*else*/ {
            PyErr_Restore(__pyx_3, __pyx_5, __pyx_2);
            __pyx_3 = __pyx_5 = __pyx_2 = 0;
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2548; goto __pyx_L1;}
          }
          __pyx_L9:;
          Py_XDECREF(__pyx_3); __pyx_3 = 0;
          Py_XDECREF(__pyx_5); __pyx_5 = 0;
          Py_XDECREF(__pyx_2); __pyx_2 = 0;
          goto __pyx_L8;
        }
        goto __pyx_L1;
        __pyx_L8:;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2549 */
        #ifndef PYREX_WITHOUT_ASSERTIONS
        if (!(__pyx_v_got2 > 0)) {
          PyErr_SetNone(PyExc_AssertionError);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2549; goto __pyx_L1;}
        }
        #endif

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2550 */
        __pyx_v_got += __pyx_v_got2;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2551 */
        __pyx_8 = PyObject_Length(__pyx_v_data); if (__pyx_8 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2551; goto __pyx_L1;}
        __pyx_1 = (__pyx_v_got >= __pyx_8);
        if (__pyx_1) {
          __pyx_r = Py_None; Py_INCREF(Py_None);
          goto __pyx_L0;
          goto __pyx_L10;
        }
        __pyx_L10:;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2553 */
        __pyx_6 = PyInt_FromLong(__pyx_v_got); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; goto __pyx_L1;}
        __pyx_7 = PyTuple_New(2); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; goto __pyx_L1;}
        Py_INCREF(__pyx_v_data);
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_v_data);
        PyTuple_SET_ITEM(__pyx_7, 1, __pyx_6);
        __pyx_6 = 0;
        __pyx_3 = PyObject_CallObject(((PyObject *)(&PyBuffer_Type)), __pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_v_buf);
        __pyx_v_buf = __pyx_3;
        __pyx_3 = 0;
      }
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2555 */
    while (1) {
      __pyx_4 = 1;
      if (!__pyx_4) break;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2556 */
      /*try:*/ {

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2557 */
        __pyx_v_got2 = 0;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2558 */
        __pyx_5 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->realsock, __pyx_n_send); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2558; goto __pyx_L13;}
        __pyx_2 = PyInt_FromLong(__pyx_v_flags); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2558; goto __pyx_L13;}
        __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2558; goto __pyx_L13;}
        Py_INCREF(__pyx_v_buf);
        PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_buf);
        PyTuple_SET_ITEM(__pyx_6, 1, __pyx_2);
        __pyx_2 = 0;
        __pyx_7 = PyObject_CallObject(__pyx_5, __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2558; goto __pyx_L13;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_1 = PyInt_AsLong(__pyx_7); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2558; goto __pyx_L13;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_v_got2 = __pyx_1;
      }
      goto __pyx_L14;
      __pyx_L13:;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_7); __pyx_7 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2559 */
      __pyx_1 = PyErr_ExceptionMatches(coio_socket_error);
      if (__pyx_1) {
        __pyx_filename = __pyx_f[0]; __pyx_lineno = 2559; __Pyx_AddTraceback("coio.sendall");
        PyErr_Fetch(&__pyx_3, &__pyx_2, &__pyx_5);
        if (__Pyx_NormalizeException(&__pyx_3, &__pyx_2, &__pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2559; goto __pyx_L1;}
        Py_INCREF(__pyx_2);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_2;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2560 */
        __pyx_6 = PyObject_GetAttr(__pyx_v_e, __pyx_n_args); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2560; goto __pyx_L1;}
        __pyx_7 = PyInt_FromLong(0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2560; goto __pyx_L1;}
        __pyx_9 = PyObject_GetItem(__pyx_6, __pyx_7); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2560; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_6 = PyInt_FromLong(EAGAIN); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2560; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_9, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2560; goto __pyx_L1;}
        __pyx_1 = __pyx_1 != 0;
        Py_DECREF(__pyx_9); __pyx_9 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        if (__pyx_1) {
          PyErr_Restore(__pyx_3, __pyx_2, __pyx_5);
          __pyx_3 = __pyx_2 = __pyx_5 = 0;
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2561; goto __pyx_L1;}
          goto __pyx_L15;
        }
        __pyx_L15:;

        /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2562 */
        __pyx_7 = coio_c_handle_eagain((&((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->swi),EV_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2562; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        Py_XDECREF(__pyx_5); __pyx_5 = 0;
        goto __pyx_L14;
      }
      goto __pyx_L1;
      __pyx_L14:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2563 */
      #ifndef PYREX_WITHOUT_ASSERTIONS
      if (!(__pyx_v_got2 > 0)) {
        PyErr_SetNone(PyExc_AssertionError);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2563; goto __pyx_L1;}
      }
      #endif

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2564 */
      __pyx_v_got += __pyx_v_got2;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2565 */
      __pyx_8 = PyObject_Length(__pyx_v_data); if (__pyx_8 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2565; goto __pyx_L1;}
      __pyx_1 = (__pyx_v_got >= __pyx_8);
      if (__pyx_1) {
        __pyx_r = Py_None; Py_INCREF(Py_None);
        goto __pyx_L0;
        goto __pyx_L16;
      }
      __pyx_L16:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2569 */
      __pyx_9 = PyInt_FromLong(__pyx_v_got); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2569; goto __pyx_L1;}
      __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2569; goto __pyx_L1;}
      Py_INCREF(__pyx_v_data);
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_data);
      PyTuple_SET_ITEM(__pyx_6, 1, __pyx_9);
      __pyx_9 = 0;
      __pyx_7 = PyObject_CallObject(((PyObject *)(&PyBuffer_Type)), __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2569; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_v_buf);
      __pyx_v_buf = __pyx_7;
      __pyx_7 = 0;
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_9);
  __Pyx_AddTraceback("coio.nbsslsocket.sendall");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_buf);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_data);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11nbsslsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11nbsslsocket_makefile[] = "Create an nbfile (non-blocking file-like) object from self.\n\n        os.dup(self.swi.fd) will be passed to the new nbfile object, and its\n        .close() method will close that file descriptor.\n\n        As of now, the returned file object is slow (uses a pure Python\n        implementation of socket._fileobject).\n\n        Args:\n          mode: \'r\', \'w\', \'r+\' etc. The default is mode\'r\', just as for\n            socket.socket.makefile.\n        ";
static PyObject *__pyx_f_4coio_11nbsslsocket_makefile(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_bufsize;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"mode","bufsize",0};
  __pyx_v_mode = __pyx_d38;
  __pyx_v_bufsize = __pyx_d39;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|Oi", __pyx_argnames, &__pyx_v_mode, &__pyx_v_bufsize)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_mode);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2586 */
  __pyx_1 = PyInt_FromLong(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2586; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__makefile_refs); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2586; goto __pyx_L1;}
  __pyx_3 = PyNumber_InPlaceAdd(__pyx_2, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2586; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (PyObject_SetAttr(((struct __pyx_obj_4coio_nbsslsocket *)__pyx_v_self)->sslsock, __pyx_n__makefile_refs, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2586; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2587 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2587; goto __pyx_L1;}
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n__fileobject); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2587; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = PyInt_FromLong(__pyx_v_bufsize); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2587; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2587; goto __pyx_L1;}
  Py_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_self);
  Py_INCREF(__pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_mode);
  PyTuple_SET_ITEM(__pyx_2, 2, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyDict_New(); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2587; goto __pyx_L1;}
  if (PyDict_SetItem(__pyx_3, __pyx_n_close, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2587; goto __pyx_L1;}
  __pyx_4 = PyEval_CallObjectWithKeywords(__pyx_1, __pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2587; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_r = __pyx_4;
  __pyx_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.nbsslsocket.makefile");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static void __pyx_f_4coio_HandleCSleepWakeup(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  int __pyx_1;
  PyGILState_STATE _save = PyGILState_Ensure();

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2604 */
  __pyx_1 = ((PyTaskletObject *)__pyx_v_arg)->tempval == coio_waiting_token;
  if (__pyx_1) {
    Py_INCREF(coio_event_happened_token);
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = coio_event_happened_token;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2606 */
  __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2606; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_WriteUnraisable("coio.HandleCSleepWakeup");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static PyObject *__pyx_f_4coio_sleep(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_sleep[] = "Non-blocking drop-in replacement for time.sleep.\n\n    * If sleeping_tasklet.raise_exception(...) or sleeping_tasklet.kill()\n      was called while sleeping, then cancel the sleep and raise that\n      exception.\n    * Otherwise, if sleeping_tasklet.tempval was set to a stackless.bomb(...)\n      value and then sleeping_tasklet.insert() was called, and then\n      sleeping_tasklet got scheduled, then cancel the sleep and raise the\n      exception in the bomb.\n    * Otherwise, if sleeping_tasklet.tempval was set, and then\n      sleeping_tasklet.insert() was called, and then sleeping_tasklet got\n      scheduled, then cancel the sleep and return sleeping_tasklet.tempval.\n    * Otherwise, if sleeping_tasklet.tempval was not set, and then\n      sleeping_tasklet.insert() was called, and then sleeping_tasklet got\n      scheduled, then cancel the sleep and return waiting_token (a true value).\n      (Please don\'t explicitly check for that.)\n    * Otherwise sleep for the whole sleep duration, and return an object\n      (event_happened_token, a true value).\n    ";
static PyObject *__pyx_f_4coio_sleep(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_duration;
  struct timeval __pyx_v_tv;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"duration",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "d", __pyx_argnames, &__pyx_v_duration)) return 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2630 */
  __pyx_1 = (__pyx_v_duration <= 0);
  if (__pyx_1) {
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2632 */
  __pyx_v_tv.tv_sec = ((long)__pyx_v_duration);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2633 */
  __pyx_v_tv.tv_usec = ((unsigned int)((__pyx_v_duration - ((double)__pyx_v_tv.tv_sec)) * 1000000.0));

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2635 */
  __pyx_2 = coio_c_wait_for((-1),0,__pyx_f_4coio_HandleCSleepWakeup,(&__pyx_v_tv)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2635; goto __pyx_L1;}
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.sleep");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_ReceiveSleepHelper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_ReceiveSleepHelper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_timeout;
  PyTaskletObject *__pyx_v_receiver_tasklet = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  static char *__pyx_argnames[] = {"timeout","receiver_tasklet",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "dO", __pyx_argnames, &__pyx_v_timeout, &__pyx_v_receiver_tasklet)) return 0;
  Py_INCREF(__pyx_v_receiver_tasklet);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_receiver_tasklet), __pyx_ptype_4coio_tasklet, 1, "receiver_tasklet")) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2642; goto __pyx_L1;}
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_sleep); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2643; goto __pyx_L1;}
  __pyx_2 = PyFloat_FromDouble(__pyx_v_timeout); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2643; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2643; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2643; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_4 = PyObject_IsTrue(__pyx_2); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2643; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_4) {
    __pyx_4 = PyTasklet_Alive(__pyx_v_receiver_tasklet);
    if (__pyx_4) {
      __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_receiver_tasklet), __pyx_n_raise_exception); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2646; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2646; goto __pyx_L1;}
      Py_INCREF(PyExc_IndexError);
      PyTuple_SET_ITEM(__pyx_3, 0, PyExc_IndexError);
      __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2646; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L3;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.ReceiveSleepHelper");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_receiver_tasklet);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_receive_with_timeout(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_receive_with_timeout[] = "Receive from receive_channel with a timeout.\n\n  Args:\n    timeout: Number of seconds of timeout, or None if infinite.\n  ";
static PyObject *__pyx_f_4coio_receive_with_timeout(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  PyObject *__pyx_v_receive_channel = 0;
  PyObject *__pyx_v_default_value = 0;
  PyObject *__pyx_v_sleeper_tasklet;
  PyObject *__pyx_v_received_value;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"timeout","receive_channel","default_value",0};
  __pyx_v_default_value = __pyx_d40;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OO|O", __pyx_argnames, &__pyx_v_timeout, &__pyx_v_receive_channel, &__pyx_v_default_value)) return 0;
  Py_INCREF(__pyx_v_timeout);
  Py_INCREF(__pyx_v_receive_channel);
  Py_INCREF(__pyx_v_default_value);
  __pyx_v_sleeper_tasklet = Py_None; Py_INCREF(Py_None);
  __pyx_v_received_value = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2657 */
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    __pyx_2 = PyObject_GetAttr(__pyx_v_receive_channel, __pyx_n_receive); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2658; goto __pyx_L1;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2658; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2659 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_tasklet); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_ReceiveSleepHelper); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2660; goto __pyx_L1;}
  __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_current); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2660; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; goto __pyx_L1;}
  Py_INCREF(__pyx_v_timeout);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_timeout);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_4);
  __pyx_4 = 0;
  __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_v_sleeper_tasklet);
  __pyx_v_sleeper_tasklet = __pyx_4;
  __pyx_4 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2661 */
  /*try:*/ {
    __pyx_2 = PyObject_GetAttr(__pyx_v_receive_channel, __pyx_n_receive); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2662; goto __pyx_L3;}
    __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2662; goto __pyx_L3;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_received_value);
    __pyx_v_received_value = __pyx_3;
    __pyx_3 = 0;
  }
  goto __pyx_L4;
  __pyx_L3:;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2663 */
  __pyx_1 = PyErr_ExceptionMatches(PyExc_IndexError);
  if (__pyx_1) {
    __pyx_filename = __pyx_f[0]; __pyx_lineno = 2663; __Pyx_AddTraceback("coio.receive_with_timeout");
    PyErr_Fetch(&__pyx_4, &__pyx_2, &__pyx_3);
    if (__Pyx_NormalizeException(&__pyx_4, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2663; goto __pyx_L1;}
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_2;
    Py_INCREF(__pyx_v_default_value);
    Py_DECREF(__pyx_v_received_value);
    __pyx_v_received_value = __pyx_v_default_value;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L4;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2666 */
  /*except:*/ {
    PyErr_Fetch(&__pyx_4, &__pyx_2, &__pyx_3);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2667 */
    if (!__Pyx_TypeTest(__pyx_v_sleeper_tasklet, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; goto __pyx_L1;}
    __pyx_1 = PyTasklet_Alive(((PyTaskletObject *)__pyx_v_sleeper_tasklet));
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2668 */
      if (!__Pyx_TypeTest(__pyx_v_sleeper_tasklet, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2668; goto __pyx_L1;}
      __pyx_1 = PyTasklet_Remove(((PyTaskletObject *)__pyx_v_sleeper_tasklet)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2668; goto __pyx_L1;}

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2669 */
      if (!__Pyx_TypeTest(__pyx_v_sleeper_tasklet, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2669; goto __pyx_L1;}
      __pyx_1 = PyTasklet_Kill(((PyTaskletObject *)__pyx_v_sleeper_tasklet)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2669; goto __pyx_L1;}
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2670 */
    PyErr_Restore(__pyx_4, __pyx_2, __pyx_3);
    __pyx_4 = __pyx_2 = __pyx_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2670; goto __pyx_L1;}
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2671 */
  if (!__Pyx_TypeTest(__pyx_v_sleeper_tasklet, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2671; goto __pyx_L1;}
  __pyx_1 = PyTasklet_Alive(((PyTaskletObject *)__pyx_v_sleeper_tasklet));
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2672 */
    if (!__Pyx_TypeTest(__pyx_v_sleeper_tasklet, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2672; goto __pyx_L1;}
    __pyx_1 = PyTasklet_Remove(((PyTaskletObject *)__pyx_v_sleeper_tasklet)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2672; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2675 */
    if (!__Pyx_TypeTest(__pyx_v_sleeper_tasklet, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2675; goto __pyx_L1;}
    __pyx_1 = PyTasklet_Kill(((PyTaskletObject *)__pyx_v_sleeper_tasklet)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2675; goto __pyx_L1;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2676 */
  Py_INCREF(__pyx_v_received_value);
  __pyx_r = __pyx_v_received_value;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.receive_with_timeout");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_sleeper_tasklet);
  Py_DECREF(__pyx_v_received_value);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_timeout);
  Py_DECREF(__pyx_v_receive_channel);
  Py_DECREF(__pyx_v_default_value);
  return __pyx_r;
}

static void __pyx_f_4coio_HandleCSelectWakeup(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  struct __pyx_obj_4coio_selecter *__pyx_v_selecter_obj;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_v_selecter_obj = ((struct __pyx_obj_4coio_selecter *)Py_None); Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2684 */
  Py_INCREF(((PyObject *)__pyx_v_arg));
  Py_DECREF(((PyObject *)__pyx_v_selecter_obj));
  __pyx_v_selecter_obj = ((struct __pyx_obj_4coio_selecter *)__pyx_v_arg);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2687 */
  __pyx_1 = (__pyx_v_evtype & EV_READ);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2688; goto __pyx_L1;}
    __pyx_3 = PyList_Append(((PyObject *)__pyx_v_selecter_obj->readable_fds),__pyx_2); if (__pyx_3 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2688; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2689 */
  __pyx_1 = (__pyx_v_evtype & EV_WRITE);
  if (__pyx_1) {
    __pyx_2 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2690; goto __pyx_L1;}
    __pyx_3 = PyList_Append(((PyObject *)__pyx_v_selecter_obj->writeable_fds),__pyx_2); if (__pyx_3 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2690; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2692 */
  __pyx_1 = PyTasklet_Insert(__pyx_v_selecter_obj->wakeup_tasklet); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2692; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_WriteUnraisable("coio.HandleCSelectWakeup");
  __pyx_L0:;
  Py_DECREF(__pyx_v_selecter_obj);
  PyGILState_Release(_save);
}

static PyObject *__pyx_f_4coio_8selecter___destroy__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8selecter___destroy__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  int __pyx_1;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = (((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs != NULL);
  if (__pyx_1) {
    PyMem_Free(((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs);
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_8selecter_do_select(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_8selecter_do_select(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_rlist = 0;
  PyObject *__pyx_v_wlist = 0;
  PyObject *__pyx_v_timeout = 0;
  int __pyx_v_c;
  int __pyx_v_i;
  int __pyx_v_fd;
  struct timeval __pyx_v_tv;
  double __pyx_v_duration;
  PyDictObject *__pyx_v_fd_to_fh;
  PyListObject *__pyx_v_readable_fds;
  PyListObject *__pyx_v_writeable_fds;
  PyObject *__pyx_v_fh;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_ssize_t __pyx_2;
  Py_ssize_t __pyx_3;
  int __pyx_4;
  double __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  static char *__pyx_argnames[] = {"rlist","wlist","timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOO", __pyx_argnames, &__pyx_v_rlist, &__pyx_v_wlist, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_rlist);
  Py_INCREF(__pyx_v_wlist);
  Py_INCREF(__pyx_v_timeout);
  __pyx_v_fd_to_fh = ((PyDictObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_readable_fds = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_writeable_fds = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_fh = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2724 */
  __pyx_1 = PyList_New(0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2724; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2724; goto __pyx_L1;}
  Py_INCREF(__pyx_1);
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->readable_fds));
  ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->readable_fds = ((PyListObject *)__pyx_1);
  if (!__Pyx_TypeTest(__pyx_1, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2724; goto __pyx_L1;}
  Py_INCREF(__pyx_1);
  Py_DECREF(((PyObject *)__pyx_v_readable_fds));
  __pyx_v_readable_fds = ((PyListObject *)__pyx_1);
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2725 */
  __pyx_1 = PyList_New(0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2725; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2725; goto __pyx_L1;}
  Py_INCREF(__pyx_1);
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->writeable_fds));
  ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->writeable_fds = ((PyListObject *)__pyx_1);
  if (!__Pyx_TypeTest(__pyx_1, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2725; goto __pyx_L1;}
  Py_INCREF(__pyx_1);
  Py_DECREF(((PyObject *)__pyx_v_writeable_fds));
  __pyx_v_writeable_fds = ((PyListObject *)__pyx_1);
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2726 */
  __pyx_1 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2726; goto __pyx_L1;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_tasklet));
  ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_tasklet = ((PyTaskletObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2727 */
  __pyx_1 = PyDict_New(); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2727; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, (&PyDict_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2727; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_fd_to_fh));
  __pyx_v_fd_to_fh = ((PyDictObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2728 */
  __pyx_2 = PyObject_Length(__pyx_v_rlist); if (__pyx_2 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2728; goto __pyx_L1;}
  __pyx_3 = PyObject_Length(__pyx_v_wlist); if (__pyx_3 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2728; goto __pyx_L1;}
  __pyx_v_c = (__pyx_2 + __pyx_3);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2729 */
  __pyx_4 = __pyx_v_timeout != Py_None;
  if (__pyx_4) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2730 */
    __pyx_5 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2730; goto __pyx_L1;}
    __pyx_v_duration = __pyx_5;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2731 */
    __pyx_4 = (__pyx_v_duration <= 0);
    if (__pyx_4) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2732 */
      __pyx_4 = (__pyx_v_c == 0);
      if (__pyx_4) {
        __pyx_1 = PyList_New(0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2733; goto __pyx_L1;}
        __pyx_6 = PyList_New(0); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2733; goto __pyx_L1;}
        __pyx_7 = PyList_New(0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2733; goto __pyx_L1;}
        __pyx_8 = PyTuple_New(3); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2733; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_8, 0, __pyx_1);
        PyTuple_SET_ITEM(__pyx_8, 1, __pyx_6);
        PyTuple_SET_ITEM(__pyx_8, 2, __pyx_7);
        __pyx_1 = 0;
        __pyx_6 = 0;
        __pyx_7 = 0;
        __pyx_r = __pyx_8;
        __pyx_8 = 0;
        goto __pyx_L0;
        goto __pyx_L4;
      }
      __pyx_L4:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2734 */
      __pyx_v_tv.tv_sec = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2735 */
      __pyx_v_tv.tv_usec = 1;
      goto __pyx_L3;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2737 */
      __pyx_v_tv.tv_sec = ((long)__pyx_v_duration);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2738 */
      __pyx_v_tv.tv_usec = ((unsigned int)((__pyx_v_duration - ((double)__pyx_v_tv.tv_sec)) * 1000000.0));
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2740 */
    __pyx_v_c += 1;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2741 */
  __pyx_4 = (((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs != NULL);
  if (__pyx_4) {
    PyMem_Free(((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs);
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2743 */
  ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs = ((struct event *)PyMem_Malloc(((sizeof(struct event)) * __pyx_v_c)));

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2744 */
  __pyx_4 = (((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs == NULL);
  if (__pyx_4) {
    __Pyx_Raise(PyExc_MemoryError, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2745; goto __pyx_L1;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2746 */
  __pyx_v_i = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2747 */
  __pyx_1 = PyObject_GetIter(__pyx_v_rlist); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2747; goto __pyx_L1;}
  for (;;) {
    __pyx_6 = PyIter_Next(__pyx_1);
    if (!__pyx_6) {
      if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2747; goto __pyx_L1;}
      break;
    }
    Py_DECREF(__pyx_v_fh);
    __pyx_v_fh = __pyx_6;
    __pyx_6 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2748 */
    __pyx_4 = PyObject_IsInstance(__pyx_v_fh,((PyObject *)(&PyInt_Type))); if (__pyx_4 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2748; goto __pyx_L1;}
    if (__pyx_4) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2749 */
      __pyx_4 = PyInt_AsLong(__pyx_v_fh); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2749; goto __pyx_L1;}
      __pyx_v_fd = __pyx_4;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2750 */
      __pyx_7 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2750; goto __pyx_L1;}
      if (PyObject_SetItem(((PyObject *)__pyx_v_fd_to_fh), __pyx_7, __pyx_v_fh) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2750; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      goto __pyx_L9;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2752 */
      __pyx_8 = PyObject_GetAttr(__pyx_v_fh, __pyx_n_fileno); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2752; goto __pyx_L1;}
      __pyx_6 = PyObject_CallObject(__pyx_8, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2752; goto __pyx_L1;}
      Py_DECREF(__pyx_8); __pyx_8 = 0;
      __pyx_4 = PyInt_AsLong(__pyx_6); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2752; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_v_fd = __pyx_4;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2755 */
      __pyx_7 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2755; goto __pyx_L1;}
      if (PyObject_SetItem(((PyObject *)__pyx_v_fd_to_fh), __pyx_7, __pyx_v_fh) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2755; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
    }
    __pyx_L9:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2756 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (!(__pyx_v_fd >= 0)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2756; goto __pyx_L1;}
    }
    #endif

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2757 */
    event_set((((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs + __pyx_v_i),__pyx_v_fd,EV_READ,__pyx_f_4coio_HandleCSelectWakeup,((void *)__pyx_v_self));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2759 */
    event_add((((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs + __pyx_v_i),NULL);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2760 */
    __pyx_v_i += 1;
  }
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2761 */
  __pyx_8 = PyObject_GetIter(__pyx_v_wlist); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2761; goto __pyx_L1;}
  for (;;) {
    __pyx_6 = PyIter_Next(__pyx_8);
    if (!__pyx_6) {
      if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2761; goto __pyx_L1;}
      break;
    }
    Py_DECREF(__pyx_v_fh);
    __pyx_v_fh = __pyx_6;
    __pyx_6 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2762 */
    __pyx_4 = PyObject_IsInstance(__pyx_v_fh,((PyObject *)(&PyInt_Type))); if (__pyx_4 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2762; goto __pyx_L1;}
    if (__pyx_4) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2763 */
      __pyx_4 = PyInt_AsLong(__pyx_v_fh); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2763; goto __pyx_L1;}
      __pyx_v_fd = __pyx_4;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2764 */
      __pyx_7 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2764; goto __pyx_L1;}
      if (PyObject_SetItem(((PyObject *)__pyx_v_fd_to_fh), __pyx_7, __pyx_v_fh) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2764; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      goto __pyx_L12;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2766 */
      __pyx_1 = PyObject_GetAttr(__pyx_v_fh, __pyx_n_fileno); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2766; goto __pyx_L1;}
      __pyx_6 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2766; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_4 = PyInt_AsLong(__pyx_6); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2766; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_v_fd = __pyx_4;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2769 */
      __pyx_7 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2769; goto __pyx_L1;}
      if (PyObject_SetItem(((PyObject *)__pyx_v_fd_to_fh), __pyx_7, __pyx_v_fh) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2769; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
    }
    __pyx_L12:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2770 */
    #ifndef PYREX_WITHOUT_ASSERTIONS
    if (!(__pyx_v_fd >= 0)) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2770; goto __pyx_L1;}
    }
    #endif

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2771 */
    event_set((((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs + __pyx_v_i),__pyx_v_fd,EV_WRITE,__pyx_f_4coio_HandleCSelectWakeup,((void *)__pyx_v_self));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2775 */
    event_add((((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs + __pyx_v_i),NULL);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2776 */
    __pyx_v_i += 1;
  }
  Py_DECREF(__pyx_8); __pyx_8 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2777 */
  __pyx_4 = (__pyx_v_i < __pyx_v_c);
  if (__pyx_4) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2778 */
    event_set((((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs + __pyx_v_i),(-1),0,__pyx_f_4coio_HandleCWakeup,((void *)((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_tasklet));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2780 */
    event_add((((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs + __pyx_v_i),(&__pyx_v_tv));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2781 */
    __pyx_v_i += 1;
    goto __pyx_L13;
  }
  __pyx_L13:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2782 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (!(__pyx_v_i == __pyx_v_c)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2782; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2783 */
  /*try:*/ {
    __pyx_1 = PyStackless_Schedule(Py_None,1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2784; goto __pyx_L15;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_why = 0; goto __pyx_L16;
    __pyx_L15: {
      __pyx_why = 4;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_7); __pyx_7 = 0;
      Py_XDECREF(__pyx_8); __pyx_8 = 0;
      Py_XDECREF(__pyx_1); __pyx_1 = 0;
      PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L16;
    }
    __pyx_L16:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2786 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_c; ++__pyx_v_i) {
      event_del((((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs + __pyx_v_i));
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2788 */
    PyMem_Free(((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2789 */
    ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_evs = NULL;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2790 */
    Py_INCREF(Py_None);
    Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->readable_fds));
    ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->readable_fds = ((PyListObject *)Py_None);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2791 */
    Py_INCREF(Py_None);
    Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->writeable_fds));
    ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->writeable_fds = ((PyListObject *)Py_None);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2792 */
    Py_INCREF(Py_None);
    Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_tasklet));
    ((struct __pyx_obj_4coio_selecter *)__pyx_v_self)->wakeup_tasklet = ((PyTaskletObject *)Py_None);
    switch (__pyx_why) {
      case 4: {
        PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1;
      }
    }
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2793 */
  __pyx_6 = __Pyx_GetName(__pyx_b, __pyx_n_map); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2793; goto __pyx_L1;}
  __pyx_7 = PyObject_GetAttr(((PyObject *)__pyx_v_fd_to_fh), __pyx_n___getitem__); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2793; goto __pyx_L1;}
  __pyx_8 = PyTuple_New(2); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2793; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_8, 0, __pyx_7);
  Py_INCREF(((PyObject *)__pyx_v_readable_fds));
  PyTuple_SET_ITEM(__pyx_8, 1, ((PyObject *)__pyx_v_readable_fds));
  __pyx_7 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_6, __pyx_8); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2793; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  __pyx_7 = __Pyx_GetName(__pyx_b, __pyx_n_map); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2794; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(((PyObject *)__pyx_v_fd_to_fh), __pyx_n___getitem__); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2794; goto __pyx_L1;}
  __pyx_8 = PyTuple_New(2); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2794; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_8, 0, __pyx_6);
  Py_INCREF(((PyObject *)__pyx_v_writeable_fds));
  PyTuple_SET_ITEM(__pyx_8, 1, ((PyObject *)__pyx_v_writeable_fds));
  __pyx_6 = 0;
  __pyx_6 = PyObject_CallObject(__pyx_7, __pyx_8); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2794; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  __pyx_7 = PyList_New(0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2795; goto __pyx_L1;}
  __pyx_8 = PyTuple_New(3); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2793; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_8, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_8, 1, __pyx_6);
  PyTuple_SET_ITEM(__pyx_8, 2, __pyx_7);
  __pyx_1 = 0;
  __pyx_6 = 0;
  __pyx_7 = 0;
  __pyx_r = __pyx_8;
  __pyx_8 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("coio.selecter.do_select");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_fd_to_fh);
  Py_DECREF(__pyx_v_readable_fds);
  Py_DECREF(__pyx_v_writeable_fds);
  Py_DECREF(__pyx_v_fh);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_rlist);
  Py_DECREF(__pyx_v_wlist);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_select(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_select[] = "Non-blocking drop-in replacement for select.select.\n\n    Please note that select(2) is inherently slow (compared to libevent,\n    Linux epoll, BSD kqueue etc.), so please use other Syncless features\n    (such as a combination of nbsocket and tasklets) for performance-critical\n    operation. If your program uses select(2), please consider redesigning it\n    so it would use Syncless non-blocking communication classes and tasklets.\n\n    Limitation: Exceptional filehandles (non-empty xlist) are not\n    supported.\n\n    Please note that because of the slow speed of select(2), this function is\n    provided only for completeness and for legacy application compatibility.\n    ";
static PyObject *__pyx_f_4coio_select(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_rlist = 0;
  PyObject *__pyx_v_wlist = 0;
  PyObject *__pyx_v_xlist = 0;
  PyObject *__pyx_v_timeout = 0;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"rlist","wlist","xlist","timeout",0};
  __pyx_v_timeout = __pyx_d41;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOO|O", __pyx_argnames, &__pyx_v_rlist, &__pyx_v_wlist, &__pyx_v_xlist, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_rlist);
  Py_INCREF(__pyx_v_wlist);
  Py_INCREF(__pyx_v_xlist);
  Py_INCREF(__pyx_v_timeout);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2812 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_xlist); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2812; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2813; goto __pyx_L1;}
    Py_INCREF(__pyx_k115p);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_k115p);
    __pyx_3 = PyObject_CallObject(PyExc_NotImplementedError, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2813; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_Raise(__pyx_3, 0, 0);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2813; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2815 */
  __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_selecter), 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2815; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_do_select); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2815; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2815; goto __pyx_L1;}
  Py_INCREF(__pyx_v_rlist);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_rlist);
  Py_INCREF(__pyx_v_wlist);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_wlist);
  Py_INCREF(__pyx_v_timeout);
  PyTuple_SET_ITEM(__pyx_2, 2, __pyx_v_timeout);
  __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2815; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_4;
  __pyx_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.select");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_rlist);
  Py_DECREF(__pyx_v_wlist);
  Py_DECREF(__pyx_v_xlist);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static void __pyx_f_4coio_HandleCWakeupInfoWakeup(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  struct __pyx_obj_4coio_wakeup_info *__pyx_v_wakeup_info_obj;
  int __pyx_v_mode;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_v_wakeup_info_obj = ((struct __pyx_obj_4coio_wakeup_info *)Py_None); Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2824 */
  Py_INCREF(((PyObject *)__pyx_v_arg));
  Py_DECREF(((PyObject *)__pyx_v_wakeup_info_obj));
  __pyx_v_wakeup_info_obj = ((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_arg);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2825 */
  __pyx_1 = (__pyx_v_fd >= 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2826 */
    __pyx_v_mode = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2827 */
    __pyx_2 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2827; goto __pyx_L1;}
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_EV_READ); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2827; goto __pyx_L1;}
    __pyx_4 = PyNumber_And(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2827; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_1 = PyObject_IsTrue(__pyx_4); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2827; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_1) {
      __pyx_v_mode |= 1;
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2829 */
    __pyx_2 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2829; goto __pyx_L1;}
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_EV_WRITE); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2829; goto __pyx_L1;}
    __pyx_4 = PyNumber_And(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2829; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_1 = PyObject_IsTrue(__pyx_4); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2829; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_1) {
      __pyx_v_mode |= 2;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2833 */
    __pyx_2 = PyInt_FromLong(__pyx_v_fd); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2833; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(__pyx_v_mode); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2833; goto __pyx_L1;}
    __pyx_4 = PyList_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2833; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyList_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_5 = PyList_Append(((PyObject *)__pyx_v_wakeup_info_obj->c_pending_events),__pyx_4); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2833; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2834 */
  __pyx_1 = PyObject_IsTrue(((PyObject *)__pyx_v_wakeup_info_obj->wakeup_tasklet)); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2834; goto __pyx_L1;}
  if (__pyx_1) {
    __pyx_1 = PyTasklet_Insert(__pyx_v_wakeup_info_obj->wakeup_tasklet); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2835; goto __pyx_L1;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_WriteUnraisable("coio.HandleCWakeupInfoWakeup");
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_info_obj);
  PyGILState_Release(_save);
}

static int __pyx_f_4coio_17wakeup_info_event___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_17wakeup_info_event___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4coio_wakeup_info *__pyx_v_wakeup_info_obj = 0;
  int __pyx_v_evtype;
  int __pyx_v_handle;
  PyObject *__pyx_v_timeout = 0;
  struct timeval __pyx_v_tv;
  double __pyx_v_timeout_double;
  int __pyx_r;
  int __pyx_1;
  double __pyx_2;
  static char *__pyx_argnames[] = {"wakeup_info_obj","evtype","handle","timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OiiO", __pyx_argnames, &__pyx_v_wakeup_info_obj, &__pyx_v_evtype, &__pyx_v_handle, &__pyx_v_timeout)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_wakeup_info_obj);
  Py_INCREF(__pyx_v_timeout);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_wakeup_info_obj), __pyx_ptype_4coio_wakeup_info, 1, "wakeup_info_obj")) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2843; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2849 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = PyObject_IsTrue(((PyObject *)__pyx_v_wakeup_info_obj)); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; goto __pyx_L1;}
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2850 */
  Py_INCREF(((PyObject *)__pyx_v_wakeup_info_obj));
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->wakeup_info_obj));
  ((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->wakeup_info_obj = __pyx_v_wakeup_info_obj;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2851 */
  event_set((&((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->ev),__pyx_v_handle,__pyx_v_evtype,__pyx_f_4coio_HandleCWakeupInfoWakeup,((void *)__pyx_v_wakeup_info_obj));

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2853 */
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    event_add((&((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->ev),NULL);
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2856 */
    __pyx_2 = PyFloat_AsDouble(__pyx_v_timeout); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2856; goto __pyx_L1;}
    __pyx_v_timeout_double = __pyx_2;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2857 */
    __pyx_1 = (__pyx_v_timeout_double <= 0);
    if (__pyx_1) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2858 */
      __pyx_v_tv.tv_sec = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2859 */
      __pyx_v_tv.tv_usec = 1;
      goto __pyx_L3;
    }
    /*else*/ {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2861 */
      __pyx_v_tv.tv_sec = ((long)__pyx_v_timeout_double);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2862 */
      __pyx_v_tv.tv_usec = ((unsigned int)((__pyx_v_timeout_double - ((double)__pyx_v_tv.tv_sec)) * 1000000.0));
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2864 */
    event_add((&((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->ev),(&__pyx_v_tv));
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2865 */
  Py_INCREF(__pyx_v_self);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.wakeup_info_event.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_wakeup_info_obj);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_17wakeup_info_event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_17wakeup_info_event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2868 */
  event_del((&((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->ev));

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2869 */
  Py_DECREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2870 */
  Py_INCREF(Py_None);
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->wakeup_info_obj));
  ((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_v_self)->wakeup_info_obj = ((struct __pyx_obj_4coio_wakeup_info *)Py_None);

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_11wakeup_info___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_11wakeup_info___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return -1;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyList_New(0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2886; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2886; goto __pyx_L1;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events));
  ((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events = ((PyListObject *)__pyx_1);
  __pyx_1 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.wakeup_info.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11wakeup_info_14pending_events___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_11wakeup_info_14pending_events___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events));
  __pyx_r = ((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11wakeup_info_create_event(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11wakeup_info_create_event[] = "Create and return an event object with a .delete() method.";
static PyObject *__pyx_f_4coio_11wakeup_info_create_event(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_fd = 0;
  PyObject *__pyx_v_mode = 0;
  int __pyx_v_evtype;
  int __pyx_v_c_mode;
  PyObject *__pyx_r;
  int __pyx_1;
  long __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"fd","mode",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OO", __pyx_argnames, &__pyx_v_fd, &__pyx_v_mode)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_fd);
  Py_INCREF(__pyx_v_mode);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2896 */
  __pyx_1 = PyInt_AsLong(__pyx_v_mode); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2896; goto __pyx_L1;}
  __pyx_v_c_mode = __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2897 */
  __pyx_v_evtype = EV_PERSIST;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2898 */
  __pyx_2 = (__pyx_v_c_mode & 1);
  if (__pyx_2) {
    __pyx_v_evtype |= EV_READ;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2900 */
  __pyx_2 = (__pyx_v_c_mode & 2);
  if (__pyx_2) {
    __pyx_v_evtype |= EV_WRITE;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2902 */
  __pyx_3 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2902; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(4); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2902; goto __pyx_L1;}
  Py_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_self);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
  Py_INCREF(__pyx_v_fd);
  PyTuple_SET_ITEM(__pyx_4, 2, __pyx_v_fd);
  Py_INCREF(Py_None);
  PyTuple_SET_ITEM(__pyx_4, 3, Py_None);
  __pyx_3 = 0;
  __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_wakeup_info_event), __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2902; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.wakeup_info.create_event");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_fd);
  Py_DECREF(__pyx_v_mode);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11wakeup_info_tick(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11wakeup_info_tick[] = "Do one tick of the main loop iteration up to timeout.\n\n        Returns:\n          The list of pending (fd, mode) pairs. The caller must remove\n          items from the list before the next call to tick() as it\'s\n          processing the events, by pop()ping the item before calling the\n          event handler.\n        ";
static PyObject *__pyx_f_4coio_11wakeup_info_tick(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  struct __pyx_obj_4coio_wakeup_info_event *__pyx_v_timeout_event;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_timeout);
  __pyx_v_timeout_event = ((struct __pyx_obj_4coio_wakeup_info_event *)Py_None); Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2915 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = ((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->wakeup_tasklet) == Py_None;
  if (!__pyx_1) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2915; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2916 */
  __pyx_2 = ((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events);
  Py_INCREF(__pyx_2);
  __pyx_1 = PyObject_IsTrue(__pyx_2); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2916; goto __pyx_L1;}
  if (!__pyx_1) {
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = __pyx_v_timeout != Py_None;
    if (__pyx_1) {
      __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2916; goto __pyx_L1;}
      if (PyObject_Cmp(__pyx_v_timeout, __pyx_3, &__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2916; goto __pyx_L1;}
      __pyx_1 = __pyx_1 <= 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
    }
    __pyx_2 = PyInt_FromLong(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2916; goto __pyx_L1;}
  }
  __pyx_1 = PyObject_IsTrue(__pyx_2); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2916; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_1) {
    __pyx_3 = PyStackless_Schedule(Py_None,0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2918; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_1 = __pyx_v_timeout == Py_None;
  if (__pyx_1) {
    /*try:*/ {
      __pyx_2 = PyStackless_Schedule(Py_None,1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2923; goto __pyx_L4;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }
    /*finally:*/ {
      int __pyx_why;
      PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
      int __pyx_exc_lineno;
      __pyx_why = 0; goto __pyx_L5;
      __pyx_L4: {
        __pyx_why = 4;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
        __pyx_exc_lineno = __pyx_lineno;
        goto __pyx_L5;
      }
      __pyx_L5:;
      Py_INCREF(Py_None);
      Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->wakeup_tasklet));
      ((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->wakeup_tasklet = ((PyTaskletObject *)Py_None);
      switch (__pyx_why) {
        case 4: {
          PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
          __pyx_lineno = __pyx_exc_lineno;
          __pyx_exc_type = 0;
          __pyx_exc_value = 0;
          __pyx_exc_tb = 0;
          goto __pyx_L1;
        }
      }
    }
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2927 */
    __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2927; goto __pyx_L1;}
    __pyx_2 = PyInt_FromLong((-1)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2927; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(4); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2927; goto __pyx_L1;}
    Py_INCREF(__pyx_v_self);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_self);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    PyTuple_SET_ITEM(__pyx_4, 2, __pyx_2);
    Py_INCREF(__pyx_v_timeout);
    PyTuple_SET_ITEM(__pyx_4, 3, __pyx_v_timeout);
    __pyx_3 = 0;
    __pyx_2 = 0;
    __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_wakeup_info_event), __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2927; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(((PyObject *)__pyx_v_timeout_event));
    __pyx_v_timeout_event = ((struct __pyx_obj_4coio_wakeup_info_event *)__pyx_3);
    __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2928 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2928; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_current); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2928; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (!__Pyx_TypeTest(__pyx_4, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2928; goto __pyx_L1;}
    Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->wakeup_tasklet));
    ((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->wakeup_tasklet = ((PyTaskletObject *)__pyx_4);
    __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2931 */
    /*try:*/ {
      __pyx_3 = PyStackless_Schedule(Py_None,1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2932; goto __pyx_L8;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
    }
    /*finally:*/ {
      int __pyx_why;
      PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
      int __pyx_exc_lineno;
      __pyx_why = 0; goto __pyx_L9;
      __pyx_L8: {
        __pyx_why = 4;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        Py_XDECREF(__pyx_4); __pyx_4 = 0;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
        __pyx_exc_lineno = __pyx_lineno;
        goto __pyx_L9;
      }
      __pyx_L9:;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2934 */
      Py_INCREF(Py_None);
      Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->wakeup_tasklet));
      ((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->wakeup_tasklet = ((PyTaskletObject *)Py_None);

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2935 */
      __pyx_2 = PyObject_GetAttr(((PyObject *)__pyx_v_timeout_event), __pyx_n_delete); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2935; goto __pyx_L10;}
      __pyx_4 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2935; goto __pyx_L10;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L11;
      __pyx_L10:;
      if (__pyx_why == 4) {
        Py_XDECREF(__pyx_exc_type);
        Py_XDECREF(__pyx_exc_value);
        Py_XDECREF(__pyx_exc_tb);
      }
      goto __pyx_L1;
      __pyx_L11:;
      switch (__pyx_why) {
        case 4: {
          PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
          __pyx_lineno = __pyx_exc_lineno;
          __pyx_exc_type = 0;
          __pyx_exc_value = 0;
          __pyx_exc_tb = 0;
          goto __pyx_L1;
        }
      }
    }
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2936 */
  Py_INCREF(((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events));
  __pyx_r = ((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.wakeup_info.tick");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_timeout_event);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_11wakeup_info_tick_and_move(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_11wakeup_info_tick_and_move[] = "Like self.tick(), but create a new list on each call.";
static PyObject *__pyx_f_4coio_11wakeup_info_tick_and_move(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_timeout = 0;
  PyListObject *__pyx_v_list_obj;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_timeout);
  __pyx_v_list_obj = ((PyListObject *)Py_None); Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2941 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tick); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2941; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2941; goto __pyx_L1;}
  Py_INCREF(__pyx_v_timeout);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_timeout);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2941; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2941; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_2 = PyObject_CallObject(((PyObject *)(&PyList_Type)), __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2941; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_v_list_obj));
  __pyx_v_list_obj = ((PyListObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2942 */
  if (PySequence_DelSlice(((PyObject *)((struct __pyx_obj_4coio_wakeup_info *)__pyx_v_self)->c_pending_events), 0, PY_SSIZE_T_MAX) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2942; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2943 */
  Py_INCREF(((PyObject *)__pyx_v_list_obj));
  __pyx_r = ((PyObject *)__pyx_v_list_obj);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.wakeup_info.tick_and_move");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_list_obj);
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_timeout);
  return __pyx_r;
}

static void __pyx_f_4coio_HandleCSignal(int __pyx_v_signum,short __pyx_v_evtype,void *__pyx_v_arg) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_1 = PyInt_FromLong(__pyx_v_signum); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2952; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2952; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
  __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(((PyObject *)__pyx_v_arg), __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2952; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_WriteUnraisable("coio.HandleCSignal");
  __pyx_L0:;
  PyGILState_Release(_save);
}

static int __pyx_f_4coio_12signal_event___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_12signal_event___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_signum;
  PyObject *__pyx_v_handler = 0;
  int __pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  int __pyx_5;
  static char *__pyx_argnames[] = {"signum","handler",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "iO", __pyx_argnames, &__pyx_v_signum, &__pyx_v_handler)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_handler);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2960 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_callable); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2960; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2960; goto __pyx_L1;}
  Py_INCREF(__pyx_v_handler);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_handler);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2960; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_4 = PyObject_IsTrue(__pyx_3); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2960; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_5 = (!__pyx_4);
  if (__pyx_5) {
    __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2961; goto __pyx_L1;}
    Py_INCREF(__pyx_k122p);
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_k122p);
    __pyx_2 = PyObject_CallObject(PyExc_TypeError, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2961; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2961; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2962 */
  __pyx_4 = (__pyx_v_signum == SIGINT);
  if (__pyx_4) {
    __pyx_4 = (__pyx_v_4coio_sigint_ev.ev_flags != 0);
  }
  if (__pyx_4) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2963 */
    event_del((&__pyx_v_4coio_sigint_ev));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2964 */
    __pyx_v_4coio_sigint_ev.ev_flags = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2966 */
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2967 */
  Py_INCREF(__pyx_v_handler);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2968 */
  event_set((&((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev),__pyx_v_signum,(EV_SIGNAL | EV_PERSIST),__pyx_f_4coio_HandleCSignal,((void *)__pyx_v_handler));

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2972 */
  ((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev.ev_flags |= EVLIST_INTERNAL;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2973 */
  event_add((&((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev),NULL);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.signal_event.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_handler);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_12signal_event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_12signal_event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_signum;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2977 */
  __pyx_1 = (((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev.ev_flags != 0);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2978 */
    __pyx_v_signum = ((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev.ev_fd;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2979 */
    Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev.ev_arg));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2980 */
    event_del((&((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2981 */
    ((struct __pyx_obj_4coio_signal_event *)__pyx_v_self)->ev.ev_flags = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2982 */
    Py_DECREF(__pyx_v_self);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2983 */
    __pyx_2 = PyObject_GetAttr(((PyObject *)__pyx_v_4coio_signal_events), __pyx_n_pop); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2983; goto __pyx_L1;}
    __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2983; goto __pyx_L1;}
    Py_INCREF(__pyx_v_self);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_self);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_3, 1, Py_None);
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2983; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2984 */
    __pyx_1 = (__pyx_v_signum == SIGINT);
    if (__pyx_1) {
      __pyx_1 = (__pyx_v_4coio_sigint_ev.ev_flags == 0);
    }
    if (__pyx_1) {
      __pyx_f_4coio__setup_sigint();
      goto __pyx_L3;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.signal_event.delete");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_signal(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_signal[] = "Register or unregister a signal handler.\n\n    Args:\n      signum: Positive signal number (e.g. signal.SIGINT). Unchecked.\n      handler: Callable or None. handler(signum) will be called in the event\n        loop as soon as the signal numbered signum gets received, and as many\n        times as it gets received. Exceptions raised by the handler are printed\n        briefly (without a traceback), and get ignored.\n    Returns:\n      The resulting signal_event object or None if unregistered.\n    ";
static PyObject *__pyx_f_4coio_signal(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_signum;
  PyObject *__pyx_v_handler = 0;
  struct event *__pyx_v_ev;
  PyObject *__pyx_v_signum_obj;
  PyObject *__pyx_v_signal_event_obj;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  static char *__pyx_argnames[] = {"signum","handler",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "iO", __pyx_argnames, &__pyx_v_signum, &__pyx_v_handler)) return 0;
  Py_INCREF(__pyx_v_handler);
  __pyx_v_signum_obj = Py_None; Py_INCREF(Py_None);
  __pyx_v_signal_event_obj = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3000 */
  __pyx_1 = PyInt_FromLong(__pyx_v_signum); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3000; goto __pyx_L1;}
  Py_DECREF(__pyx_v_signum_obj);
  __pyx_v_signum_obj = __pyx_1;
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3002 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_4coio_signal_events), __pyx_n_get); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3002; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3002; goto __pyx_L1;}
  Py_INCREF(__pyx_v_signum_obj);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_signum_obj);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3002; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_v_signal_event_obj);
  __pyx_v_signal_event_obj = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3003 */
  __pyx_4 = __pyx_v_signal_event_obj == Py_None;
  if (__pyx_4) {
    __pyx_4 = __pyx_v_handler != Py_None;
    if (__pyx_4) {

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3005 */
      __pyx_1 = PyInt_FromLong(__pyx_v_signum); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3005; goto __pyx_L1;}
      __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3005; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
      Py_INCREF(__pyx_v_handler);
      PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_handler);
      __pyx_1 = 0;
      __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_signal_event), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3005; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_v_signal_event_obj);
      __pyx_v_signal_event_obj = __pyx_3;
      __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3006 */
      if (PyObject_SetItem(((PyObject *)__pyx_v_4coio_signal_events), __pyx_v_signum_obj, __pyx_v_signal_event_obj) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3006; goto __pyx_L1;}

      /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3007 */
      Py_INCREF(__pyx_v_signal_event_obj);
      __pyx_r = __pyx_v_signal_event_obj;
      goto __pyx_L0;
      goto __pyx_L3;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  __pyx_4 = __pyx_v_handler == Py_None;
  if (__pyx_4) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3009 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_signal_event_obj, __pyx_n_delete); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3009; goto __pyx_L1;}
    __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3009; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3010 */
    if (PyObject_DelItem(((PyObject *)__pyx_v_4coio_signal_events), __pyx_v_signum_obj) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3010; goto __pyx_L1;}
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3012 */
    __pyx_v_ev = (&((struct __pyx_obj_4coio_signal_event *)__pyx_v_signal_event_obj)->ev);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3013 */
    Py_DECREF(((PyObject *)__pyx_v_ev->ev_arg));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3014 */
    Py_INCREF(__pyx_v_handler);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3015 */
    __pyx_v_ev->ev_arg = ((void *)__pyx_v_handler);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3016 */
    Py_INCREF(__pyx_v_signal_event_obj);
    __pyx_r = __pyx_v_signal_event_obj;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.signal");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_signum_obj);
  Py_DECREF(__pyx_v_signal_event_obj);
  Py_DECREF(__pyx_v_handler);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_get_concurrence_triggered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_get_concurrence_triggered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(((PyObject *)__pyx_v_4coio_concurrence_triggered));
  __pyx_r = ((PyObject *)__pyx_v_4coio_concurrence_triggered);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_get_swap_concurrence_triggered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_get_swap_concurrence_triggered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_retval;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_v_retval = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3030 */
  Py_INCREF(((PyObject *)__pyx_v_4coio_concurrence_triggered));
  Py_DECREF(__pyx_v_retval);
  __pyx_v_retval = ((PyObject *)__pyx_v_4coio_concurrence_triggered);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3031 */
  __pyx_1 = PyList_New(0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3031; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3031; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_4coio_concurrence_triggered));
  __pyx_v_4coio_concurrence_triggered = ((PyListObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3032 */
  Py_INCREF(__pyx_v_retval);
  __pyx_r = __pyx_v_retval;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.get_swap_concurrence_triggered");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_retval);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_get_concurrence_main_tasklets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_get_concurrence_main_tasklets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(((PyObject *)__pyx_v_4coio_concurrence_main_tasklets));
  __pyx_r = ((PyObject *)__pyx_v_4coio_concurrence_main_tasklets);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  return __pyx_r;
}

static void __pyx_f_4coio_HandleCConcurrence(int __pyx_v_fd,short __pyx_v_evtype,void *__pyx_v_arg) {
  PyObject *__pyx_v_pair;
  PyObject *__pyx_v_tasklet_obj;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  int __pyx_4;
  int __pyx_5;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_v_pair = Py_None; Py_INCREF(Py_None);
  __pyx_v_tasklet_obj = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3043 */
  __pyx_1 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3043; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3043; goto __pyx_L1;}
  Py_INCREF(((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_arg)->callback);
  PyTuple_SET_ITEM(__pyx_2, 0, ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_arg)->callback);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_1);
  __pyx_1 = 0;
  Py_DECREF(__pyx_v_pair);
  __pyx_v_pair = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3044 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_arg), __pyx_n_pending); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3044; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3044; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_IsTrue(__pyx_2); if (__pyx_3 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3044; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_4 = (!__pyx_3);
  if (__pyx_4) {
    Py_DECREF(((PyObject *)__pyx_v_arg));
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3046 */
  __pyx_5 = PyList_Append(((PyObject *)__pyx_v_4coio_concurrence_triggered),__pyx_v_pair); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3046; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3047 */
  __pyx_1 = PyObject_GetIter(((PyObject *)__pyx_v_4coio_concurrence_main_tasklets)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3047; goto __pyx_L1;}
  for (;;) {
    __pyx_2 = PyIter_Next(__pyx_1);
    if (!__pyx_2) {
      if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3047; goto __pyx_L1;}
      break;
    }
    Py_DECREF(__pyx_v_tasklet_obj);
    __pyx_v_tasklet_obj = __pyx_2;
    __pyx_2 = 0;
    __pyx_3 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_tasklet_obj)); if (__pyx_3 == (-1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3048; goto __pyx_L1;}
  }
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_WriteUnraisable("coio.HandleCConcurrence");
  __pyx_L0:;
  Py_DECREF(__pyx_v_pair);
  Py_DECREF(__pyx_v_tasklet_obj);
  PyGILState_Release(_save);
}

static PyObject *__pyx_f_4coio_10EventError___init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4coio_10EventError___init__ = {"__init__", (PyCFunction)__pyx_f_4coio_10EventError___init__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_f_4coio_10EventError___init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_msg = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"self","msg",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OO", __pyx_argnames, &__pyx_v_self, &__pyx_v_msg)) return 0;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_msg);
  __pyx_1 = PyObject_GetAttr(PyExc_Exception, __pyx_n___init__); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3052; goto __pyx_L1;}
  __pyx_2 = PyString_FromString(strerror(errno)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3052; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3052; goto __pyx_L1;}
  Py_INCREF(__pyx_v_msg);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_msg);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyNumber_Remainder(__pyx_k124p, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3052; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3052; goto __pyx_L1;}
  Py_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_self);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3052; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.EventError.__init__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_msg);
  return __pyx_r;
}

static int __pyx_f_4coio_17concurrence_event___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_17concurrence_event___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_callback = 0;
  short __pyx_v_evtype;
  PyObject *__pyx_v_handle = 0;
  int __pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  int __pyx_5;
  static char *__pyx_argnames[] = {"callback","evtype","handle",0};
  __pyx_v_evtype = __pyx_d42;
  __pyx_v_handle = __pyx_d43;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|hO", __pyx_argnames, &__pyx_v_callback, &__pyx_v_evtype, &__pyx_v_handle)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_callback);
  Py_INCREF(__pyx_v_handle);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3072 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_callable); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3072; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3072; goto __pyx_L1;}
  Py_INCREF(__pyx_v_handle);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_handle);
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3072; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_4 = PyObject_IsTrue(__pyx_3); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3072; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_4) {
    __pyx_1 = __pyx_v_callback;
    Py_INCREF(__pyx_1);
    __pyx_2 = __pyx_v_handle;
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_handle);
    __pyx_v_handle = __pyx_1;
    __pyx_1 = 0;
    Py_DECREF(__pyx_v_callback);
    __pyx_v_callback = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3076 */
  Py_INCREF(__pyx_v_callback);
  Py_DECREF(((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->callback);
  ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->callback = __pyx_v_callback;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3077 */
  __pyx_3 = PyInt_FromLong(__pyx_v_evtype); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3077; goto __pyx_L1;}
  Py_DECREF(((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->evtype);
  ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->evtype = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3078 */
  __pyx_4 = (__pyx_v_evtype == 0);
  if (__pyx_4) {
    __pyx_5 = PyObject_IsTrue(__pyx_v_handle); if (__pyx_5 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3078; goto __pyx_L1;}
    __pyx_4 = (!__pyx_5);
  }
  if (__pyx_4) {
    event_set((&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev),(-1),0,__pyx_f_4coio_HandleCConcurrence,((void *)__pyx_v_self));
    goto __pyx_L3;
  }
  __pyx_5 = PyObject_IsInstance(__pyx_v_handle,((PyObject *)(&PyInt_Type))); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3080; goto __pyx_L1;}
  if (__pyx_5) {
    __pyx_4 = PyInt_AsLong(__pyx_v_handle); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3081; goto __pyx_L1;}
    event_set((&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev),__pyx_4,__pyx_v_evtype,__pyx_f_4coio_HandleCConcurrence,((void *)__pyx_v_self));
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_1 = PyObject_GetAttr(__pyx_v_handle, __pyx_n_fileno); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3083; goto __pyx_L1;}
    __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3083; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_5 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3083; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    event_set((&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev),__pyx_5,__pyx_v_evtype,__pyx_f_4coio_HandleCConcurrence,((void *)__pyx_v_self));
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.concurrence_event.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_callback);
  Py_DECREF(__pyx_v_handle);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_17concurrence_event_add(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_17concurrence_event_add[] = "Add event to be executed after an optional timeout.";
static PyObject *__pyx_f_4coio_17concurrence_event_add(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_timeout;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"timeout",0};
  __pyx_v_timeout = __pyx_d44;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|d", __pyx_argnames, &__pyx_v_timeout)) return 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3091 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_pending); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3091; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3091; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_IsTrue(__pyx_2); if (__pyx_3 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3091; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_4 = (!__pyx_3);
  if (__pyx_4) {
    Py_INCREF(__pyx_v_self);
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3094 */
  __pyx_3 = (__pyx_v_timeout >= 0.0);
  if (__pyx_3) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3095 */
    ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->tv.tv_sec = ((long)__pyx_v_timeout);

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3096 */
    ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->tv.tv_usec = ((long)((__pyx_v_timeout - ((double)((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->tv.tv_sec)) * 1000000.0));

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3097 */
    __pyx_4 = (event_add((&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev),(&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->tv)) == (-1));
    if (__pyx_4) {
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_EventError); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3098; goto __pyx_L1;}
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3098; goto __pyx_L1;}
      Py_INCREF(__pyx_k126p);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_k126p);
      __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3098; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_5, 0, 0);
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3098; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3100 */
    ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->tv.tv_sec = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3101 */
    ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->tv.tv_usec = 1;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3102 */
    __pyx_3 = (event_add((&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev),NULL) == (-1));
    if (__pyx_3) {
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_EventError); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3103; goto __pyx_L1;}
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3103; goto __pyx_L1;}
      Py_INCREF(__pyx_k126p);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_k126p);
      __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3103; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_5, 0, 0);
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3103; goto __pyx_L1;}
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.concurrence_event.add");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_17concurrence_event_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_17concurrence_event_pending[] = "Return 1 if the event is scheduled to run, or else 0.";
static PyObject *__pyx_f_4coio_17concurrence_event_pending(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(event_pending((&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev),(((EV_TIMEOUT | EV_SIGNAL) | EV_READ) | EV_WRITE),NULL)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3107; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.concurrence_event.pending");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_17concurrence_event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_17concurrence_event_delete[] = "Remove event from the event queue.";
static PyObject *__pyx_f_4coio_17concurrence_event_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_pending); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3111; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3111; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_IsTrue(__pyx_2); if (__pyx_3 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3111; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_3) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3112 */
    __pyx_3 = (event_del((&((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev)) == (-1));
    if (__pyx_3) {
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_EventError); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3113; goto __pyx_L1;}
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3113; goto __pyx_L1;}
      Py_INCREF(__pyx_k127p);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_k127p);
      __pyx_4 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3113; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3113; goto __pyx_L1;}
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3114 */
    Py_DECREF(__pyx_v_self);
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.concurrence_event.delete");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_17concurrence_event___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_17concurrence_event___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->ev.ev_flags); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3117; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3117; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
  Py_INCREF(((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->callback);
  PyTuple_SET_ITEM(__pyx_2, 1, ((struct __pyx_obj_4coio_concurrence_event *)__pyx_v_self)->callback);
  __pyx_1 = 0;
  __pyx_1 = PyNumber_Remainder(__pyx_k128p, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3117; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.concurrence_event.__repr__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_init(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_init[] = "Initialize async DNS resolver unless already intitialized.\n\n    The resolver functions call this automatically if needed.    \n    ";
static PyObject *__pyx_f_4coio_dns_init(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":89 */
    evdns_init();

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":90 */
    __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 90; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("coio.dns_init");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_init_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_init_force[] = "Initialize async DNS resolver, force reinit";
static PyObject *__pyx_f_4coio_dns_init_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":94 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":95 */
    evdns_shutdown(1);

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":96 */
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 96; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":97 */
  evdns_init();

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":98 */
  __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 98; goto __pyx_L1;}
  Py_DECREF(__pyx_v_dns_initialized);
  __pyx_v_dns_initialized = __pyx_2;
  __pyx_2 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.dns_init_force");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_shutdown(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_shutdown[] = "Shutdown the async DNS resolver and terminate all active requests.";
static PyObject *__pyx_f_4coio_dns_shutdown(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_fail_requests;
  PyObject *__pyx_v_dns_initialized;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  static char *__pyx_argnames[] = {"fail_requests",0};
  __pyx_v_fail_requests = __pyx_d45;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|i", __pyx_argnames, &__pyx_v_fail_requests)) return 0;
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":103 */
    evdns_shutdown(__pyx_v_fail_requests);

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":104 */
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.dns_shutdown");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult_1t___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult_1t___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 122; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dnsresult.t.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult_3ttl___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult_3ttl___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dnsresult.ttl.__get__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult_6values___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult_6values___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  __pyx_r = ((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static int __pyx_f_4coio_9dnsresult___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_4coio_9dnsresult___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char __pyx_v_t;
  int __pyx_v_ttl;
  PyListObject *__pyx_v_values = 0;
  int __pyx_r;
  static char *__pyx_argnames[] = {"t","ttl","values",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "biO", __pyx_argnames, &__pyx_v_t, &__pyx_v_ttl, &__pyx_v_values)) return -1;
  Py_INCREF(__pyx_v_self);
  Py_INCREF(__pyx_v_values);
  if (!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_values), (&PyList_Type), 1, "values")) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 132; goto __pyx_L1;}

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":133 */
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t = __pyx_v_t;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":134 */
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl = __pyx_v_ttl;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":135 */
  Py_INCREF(((PyObject *)__pyx_v_values));
  Py_DECREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values = __pyx_v_values;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1:;
  __Pyx_AddTraceback("coio.dnsresult.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  Py_DECREF(__pyx_v_values);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_9dnsresult___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_f_4coio_9dnsresult___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_t); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 139; goto __pyx_L1;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_ttl); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 139; goto __pyx_L1;}
  __pyx_3 = PyInt_FromLong(((size_t)((void *)__pyx_v_self))); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 139; goto __pyx_L1;}
  __pyx_4 = PyTuple_New(4); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 139; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_2);
  Py_INCREF(((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  PyTuple_SET_ITEM(__pyx_4, 2, ((PyObject *)((struct __pyx_obj_4coio_dnsresult *)__pyx_v_self)->_values));
  PyTuple_SET_ITEM(__pyx_4, 3, __pyx_3);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_1 = PyNumber_Remainder(__pyx_k129p, __pyx_4); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("coio.dnsresult.__repr__");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_format_ipv6_word(unsigned int __pyx_v_hi,unsigned int __pyx_v_lo) {
  PyObject *__pyx_r;
  unsigned int __pyx_1;
  PyObject *__pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":142 */
  __pyx_v_lo += (__pyx_v_hi << 8);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":143 */
  __pyx_1 = __pyx_v_lo;
  if (__pyx_1) {
    __pyx_2 = PyString_FromFormat(((char const*)((char *)__pyx_k130)),__pyx_v_lo); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(__pyx_k19p);
    __pyx_r = __pyx_k19p;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("coio.format_ipv6_word");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static void __pyx_f_4coio__dns_callback(int __pyx_v_resultcode,char __pyx_v_t,int __pyx_v_count,int __pyx_v_ttl,void *__pyx_v_addrs,void *__pyx_v_arg) {
  PyObject *__pyx_v_exc;
  int __pyx_v_i;
  unsigned char *__pyx_v_p;
  PyListObject *__pyx_v_xlist;
  PyObject *__pyx_v_x;
  PyObject *__pyx_v_words;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  int __pyx_6;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  PyObject *__pyx_11 = 0;
  PyGILState_STATE _save = PyGILState_Ensure();
  __pyx_v_exc = Py_None; Py_INCREF(Py_None);
  __pyx_v_xlist = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_x = Py_None; Py_INCREF(Py_None);
  __pyx_v_words = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":162 */
  __pyx_1 = __pyx_v_resultcode;
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":165 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 165; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong((-__pyx_v_resultcode)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 165; goto __pyx_L1;}
    __pyx_4 = PyString_FromString(((char *)evdns_err_to_string(__pyx_v_resultcode))); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 166; goto __pyx_L1;}
    __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 165; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
    __pyx_3 = 0;
    __pyx_4 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 165; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_v_exc);
    __pyx_v_exc = __pyx_3;
    __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":167 */
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
    Py_INCREF(__pyx_v_exc);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_exc);
    __pyx_2 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyTuple_New(3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
    Py_INCREF(__pyx_v_exc);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_v_exc);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_5, 2, Py_None);
    __pyx_2 = 0;
    __pyx_3 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_bomb), __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 167; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_3;
    __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":168 */
    __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 168; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":169 */
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":170 */
  __pyx_1 = (__pyx_v_t == __pyx_e_4coio_c_DNS_IPv4_A);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_count > 0);
  }
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":171 */
    __pyx_4 = PyList_New(0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 171; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_4, (&PyList_Type))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 171; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_xlist));
    __pyx_v_xlist = ((PyListObject *)__pyx_4);
    __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":172 */
    __pyx_v_p = ((unsigned char *)__pyx_v_addrs);

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":173 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_count; ++__pyx_v_i) {

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":175 */
      __pyx_2 = PyString_FromFormat(((char const*)((char *)__pyx_k132)),(__pyx_v_p[0]),(__pyx_v_p[1]),(__pyx_v_p[2]),(__pyx_v_p[3])); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 175; goto __pyx_L1;}
      __pyx_6 = PyList_Append(((PyObject *)__pyx_v_xlist),__pyx_2); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 175; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":177 */
      __pyx_v_p += 4;
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":178 */
    Py_INCREF(((PyObject *)__pyx_v_xlist));
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = ((PyObject *)__pyx_v_xlist);
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_t == __pyx_e_4coio_c_DNS_IPv6_AAAA);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_count > 0);
  }
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":180 */
    __pyx_5 = PyList_New(0); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 180; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, (&PyList_Type))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 180; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_xlist));
    __pyx_v_xlist = ((PyListObject *)__pyx_5);
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":181 */
    __pyx_v_p = ((unsigned char *)__pyx_v_addrs);

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":182 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_count; ++__pyx_v_i) {

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":183 */
      __pyx_3 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[0]),(__pyx_v_p[1])); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 183; goto __pyx_L1;}
      __pyx_4 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[2]),(__pyx_v_p[3])); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 184; goto __pyx_L1;}
      __pyx_2 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[4]),(__pyx_v_p[5])); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 185; goto __pyx_L1;}
      __pyx_5 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[6]),(__pyx_v_p[7])); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 186; goto __pyx_L1;}
      __pyx_7 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[8]),(__pyx_v_p[9])); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 187; goto __pyx_L1;}
      __pyx_8 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[10]),(__pyx_v_p[11])); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 188; goto __pyx_L1;}
      __pyx_9 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[12]),(__pyx_v_p[13])); if (!__pyx_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 189; goto __pyx_L1;}
      __pyx_10 = __pyx_f_4coio_format_ipv6_word((__pyx_v_p[14]),(__pyx_v_p[15])); if (!__pyx_10) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 190; goto __pyx_L1;}
      __pyx_11 = PyList_New(8); if (!__pyx_11) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 183; goto __pyx_L1;}
      PyList_SET_ITEM(__pyx_11, 0, __pyx_3);
      PyList_SET_ITEM(__pyx_11, 1, __pyx_4);
      PyList_SET_ITEM(__pyx_11, 2, __pyx_2);
      PyList_SET_ITEM(__pyx_11, 3, __pyx_5);
      PyList_SET_ITEM(__pyx_11, 4, __pyx_7);
      PyList_SET_ITEM(__pyx_11, 5, __pyx_8);
      PyList_SET_ITEM(__pyx_11, 6, __pyx_9);
      PyList_SET_ITEM(__pyx_11, 7, __pyx_10);
      __pyx_3 = 0;
      __pyx_4 = 0;
      __pyx_2 = 0;
      __pyx_5 = 0;
      __pyx_7 = 0;
      __pyx_8 = 0;
      __pyx_9 = 0;
      __pyx_10 = 0;
      Py_DECREF(__pyx_v_words);
      __pyx_v_words = __pyx_11;
      __pyx_11 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":191 */
      __pyx_v_p += 16;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":192 */
      __pyx_3 = PyObject_GetAttr(__pyx_k133p, __pyx_n_join); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 192; goto __pyx_L1;}
      __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 192; goto __pyx_L1;}
      Py_INCREF(__pyx_v_words);
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_words);
      __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 192; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_6 = PyList_Append(((PyObject *)__pyx_v_xlist),__pyx_2); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 192; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":193 */
    Py_INCREF(((PyObject *)__pyx_v_xlist));
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = ((PyObject *)__pyx_v_xlist);
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_t == __pyx_e_4coio_c_DNS_PTR);
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_count == 1);
  }
  if (__pyx_1) {
    __pyx_5 = PyString_FromString((((char const* *)__pyx_v_addrs)[0])); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 195; goto __pyx_L1;}
    __pyx_7 = PyList_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 195; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_7, 0, __pyx_5);
    __pyx_5 = 0;
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = __pyx_7;
    __pyx_7 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
    Py_INCREF(Py_None);
    Py_DECREF(__pyx_v_x);
    __pyx_v_x = Py_None;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":198 */
  __pyx_1 = __pyx_v_x == Py_None;
  if (__pyx_1) {
    __pyx_8 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 200; goto __pyx_L1;}
    __pyx_9 = PyTuple_New(3); if (!__pyx_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 199; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_9, 0, __pyx_8);
    Py_INCREF(__pyx_k136p);
    PyTuple_SET_ITEM(__pyx_9, 1, __pyx_k136p);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_9, 2, Py_None);
    __pyx_8 = 0;
    __pyx_10 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_bomb), __pyx_9); if (!__pyx_10) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 199; goto __pyx_L1;}
    Py_DECREF(__pyx_9); __pyx_9 = 0;
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_10;
    __pyx_10 = 0;
    goto __pyx_L8;
  }
  /*else*/ {
    __pyx_11 = PyInt_FromLong(__pyx_v_t); if (!__pyx_11) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 202; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(__pyx_v_ttl); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 202; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 202; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_11);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    Py_INCREF(__pyx_v_x);
    PyTuple_SET_ITEM(__pyx_4, 2, __pyx_v_x);
    __pyx_11 = 0;
    __pyx_3 = 0;
    __pyx_2 = PyObject_CallObject(((PyObject *)__pyx_ptype_4coio_dnsresult), __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 202; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(((PyTaskletObject *)__pyx_v_arg)->tempval);
    ((PyTaskletObject *)__pyx_v_arg)->tempval = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L8:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":203 */
  __pyx_1 = PyTasklet_Insert(((PyTaskletObject *)__pyx_v_arg)); if (__pyx_1 == (-1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 203; goto __pyx_L1;}

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  Py_XDECREF(__pyx_11);
  __Pyx_WriteUnraisable("coio._dns_callback");
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc);
  Py_DECREF(__pyx_v_xlist);
  Py_DECREF(__pyx_v_x);
  Py_DECREF(__pyx_v_words);
  PyGILState_Release(_save);
}

static char __pyx_f_4coio_is_valid_hex_digit(char __pyx_v_p) {
  char __pyx_r;
  int __pyx_1;
  __pyx_1 = (__pyx_v_p >= '0');
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_p <= '9');
  }
  if (__pyx_1) {
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_1 = (__pyx_v_p >= 'a');
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_p <= 'f');
  }
  if (__pyx_1) {
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_1 = (__pyx_v_p >= 'A');
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_p <= 'F');
  }
  if (__pyx_1) {
    __pyx_r = 1;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_r = 0;
    goto __pyx_L0;
  }
  __pyx_L2:;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static char __pyx_f_4coio_is_valid_ipv6(char *__pyx_v_p) {
  int __pyx_v_i;
  char __pyx_r;
  int __pyx_1;
  char __pyx_2;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":220 */
  __pyx_1 = (!__pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0])));
  if (__pyx_1) {
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":222 */
  for (__pyx_v_i = 1; __pyx_v_i < 8; ++__pyx_v_i) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":223 */
    while (1) {
      __pyx_2 = __pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0]));
      if (!__pyx_2) break;
      __pyx_v_p += 1;
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":225 */
    __pyx_1 = ((__pyx_v_p[0]) != ':');
    if (__pyx_1) {
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":227 */
    __pyx_v_p += 1;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":228 */
  while (1) {
    __pyx_2 = __pyx_f_4coio_is_valid_hex_digit((__pyx_v_p[0]));
    if (!__pyx_2) break;
    __pyx_v_p += 1;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":230 */
  __pyx_r = ((__pyx_v_p[0]) == '\0');
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static char __pyx_f_4coio_is_valid_ipv4(char *__pyx_v_p) {
  int __pyx_v_i;
  char __pyx_r;
  int __pyx_1;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":234 */
  for (__pyx_v_i = 1; __pyx_v_i < 4; ++__pyx_v_i) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":235 */
    __pyx_1 = ((__pyx_v_p[0]) < '0');
    if (!__pyx_1) {
      __pyx_1 = ((__pyx_v_p[0]) > '9');
    }
    if (__pyx_1) {
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":237 */
    __pyx_v_p += 1;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":238 */
    while (1) {
      __pyx_1 = ((__pyx_v_p[0]) >= '0');
      if (__pyx_1) {
        __pyx_1 = ((__pyx_v_p[0]) <= '9');
      }
      if (!__pyx_1) break;
      __pyx_v_p += 1;
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":240 */
    __pyx_1 = ((__pyx_v_p[0]) != '.');
    if (__pyx_1) {
      __pyx_r = 0;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":242 */
    __pyx_v_p += 1;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":243 */
  __pyx_1 = ((__pyx_v_p[0]) < '0');
  if (!__pyx_1) {
    __pyx_1 = ((__pyx_v_p[0]) > '9');
  }
  if (__pyx_1) {
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":245 */
  __pyx_v_p += 1;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":246 */
  while (1) {
    __pyx_1 = ((__pyx_v_p[0]) >= '0');
    if (__pyx_1) {
      __pyx_1 = ((__pyx_v_p[0]) <= '9');
    }
    if (!__pyx_1) break;
    __pyx_v_p += 1;
  }

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":248 */
  __pyx_r = ((__pyx_v_p[0]) == '\0');
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static struct __pyx_obj_4coio_dnsresult *__pyx_f_4coio_dns_call(__pyx_t_4coio__evdns_call_t __pyx_v_call,char const* __pyx_v_name,int __pyx_v_flags) {
  PyTaskletObject *__pyx_v_wakeup_tasklet;
  PyObject *__pyx_v_tempval;
  int __pyx_v_result;
  struct __pyx_obj_4coio_dnsresult *__pyx_v_dnsresult_obj;
  PyObject *__pyx_v_dns_initialized;
  struct __pyx_obj_4coio_dnsresult *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_tempval = Py_None; Py_INCREF(Py_None);
  __pyx_v_dnsresult_obj = ((struct __pyx_obj_4coio_dnsresult *)Py_None); Py_INCREF(Py_None);
  __pyx_v_dns_initialized = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":255 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_dns_initialized); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 255; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":256 */
    evdns_init();

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":257 */
    __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 257; goto __pyx_L1;}
    Py_DECREF(__pyx_v_dns_initialized);
    __pyx_v_dns_initialized = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":258 */
  __pyx_3 = ((PyObject *)PyStackless_GetCurrent()); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 258; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_wakeup_tasklet));
  __pyx_v_wakeup_tasklet = ((PyTaskletObject *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":259 */
  Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_wakeup_tasklet->tempval);
  __pyx_v_wakeup_tasklet->tempval = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":260 */
  __pyx_v_result = __pyx_v_call(__pyx_v_name,__pyx_v_flags,__pyx_f_4coio__dns_callback,((void *)__pyx_v_wakeup_tasklet));

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":261 */
  __pyx_1 = __pyx_v_result;
  if (__pyx_1) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 262; goto __pyx_L1;}
    __pyx_4 = PyInt_FromLong((-__pyx_v_result)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 262; goto __pyx_L1;}
    __pyx_5 = PyString_FromString(((char *)evdns_err_to_string(__pyx_v_result))); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 262; goto __pyx_L1;}
    __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 262; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_4);
    PyTuple_SET_ITEM(__pyx_6, 1, __pyx_5);
    __pyx_4 = 0;
    __pyx_5 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_6); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 262; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 262; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":263 */
  __pyx_2 = __pyx_v_wakeup_tasklet->tempval == Py_None;
  if (__pyx_2) {
    __pyx_5 = PyStackless_Schedule(Py_None,1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 264; goto __pyx_L1;}
    Py_DECREF(__pyx_v_tempval);
    __pyx_v_tempval = __pyx_5;
    __pyx_5 = 0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":267 */
    Py_INCREF(__pyx_v_wakeup_tasklet->tempval);
    Py_DECREF(__pyx_v_tempval);
    __pyx_v_tempval = __pyx_v_wakeup_tasklet->tempval;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":268 */
    Py_INCREF(Py_None);
    Py_DECREF(__pyx_v_wakeup_tasklet->tempval);
    __pyx_v_wakeup_tasklet->tempval = Py_None;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":269 */
    __pyx_1 = PyObject_IsInstance(__pyx_v_tempval,((PyObject *)__pyx_ptype_4coio_bomb)); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 269; goto __pyx_L1;}
    if (__pyx_1) {
      __pyx_3 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_type); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 270; goto __pyx_L1;}
      __pyx_6 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_value); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 270; goto __pyx_L1;}
      __pyx_4 = PyObject_GetAttr(__pyx_v_tempval, __pyx_n_traceback); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 270; goto __pyx_L1;}
      __Pyx_Raise(__pyx_3, __pyx_6, __pyx_4);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 270; goto __pyx_L1;}
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":271 */
  if (!__Pyx_TypeTest(__pyx_v_tempval, __pyx_ptype_4coio_dnsresult)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 271; goto __pyx_L1;}
  Py_INCREF(__pyx_v_tempval);
  Py_DECREF(((PyObject *)__pyx_v_dnsresult_obj));
  __pyx_v_dnsresult_obj = ((struct __pyx_obj_4coio_dnsresult *)__pyx_v_tempval);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":272 */
  __pyx_2 = (__pyx_v_call == (&evdns_resolve_ipv4));
  if (__pyx_2) {
    __pyx_5 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_t); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 273; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(__pyx_e_4coio_c_DNS_IPv4_A); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 273; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_5, __pyx_3, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 273; goto __pyx_L1;}
    __pyx_1 = __pyx_1 != 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_1) {
      __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 274; goto __pyx_L1;}
      __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 274; goto __pyx_L1;}
      Py_INCREF(__pyx_k140p);
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_k140p);
      __pyx_5 = PyObject_CallObject(__pyx_6, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 274; goto __pyx_L1;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __Pyx_Raise(__pyx_5, 0, 0);
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 274; goto __pyx_L1;}
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L6;
  }
  __pyx_2 = (__pyx_v_call == (&evdns_resolve_ipv6));
  if (__pyx_2) {
    __pyx_3 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_t); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 276; goto __pyx_L1;}
    __pyx_6 = PyInt_FromLong(__pyx_e_4coio_c_DNS_IPv6_AAAA); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 276; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_3, __pyx_6, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 276; goto __pyx_L1;}
    __pyx_1 = __pyx_1 != 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    if (__pyx_1) {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 277; goto __pyx_L1;}
      __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 277; goto __pyx_L1;}
      Py_INCREF(__pyx_k141p);
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_k141p);
      __pyx_3 = PyObject_CallObject(__pyx_4, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 277; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __Pyx_Raise(__pyx_3, 0, 0);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 277; goto __pyx_L1;}
      goto __pyx_L8;
    }
    __pyx_L8:;
    goto __pyx_L6;
  }
  __pyx_2 = (__pyx_v_call == ((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse));
  if (!__pyx_2) {
    __pyx_2 = (__pyx_v_call == ((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse_ipv6));
  }
  if (__pyx_2) {
    __pyx_6 = PyObject_GetAttr(((PyObject *)__pyx_v_dnsresult_obj), __pyx_n_t); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 280; goto __pyx_L1;}
    __pyx_4 = PyInt_FromLong(__pyx_e_4coio_c_DNS_PTR); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 280; goto __pyx_L1;}
    if (PyObject_Cmp(__pyx_6, __pyx_4, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 280; goto __pyx_L1;}
    __pyx_1 = __pyx_1 != 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_1) {
      __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_DnsResultParseError); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 281; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 281; goto __pyx_L1;}
      Py_INCREF(__pyx_k142p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k142p);
      __pyx_6 = PyObject_CallObject(__pyx_5, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 281; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_6, 0, 0);
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 281; goto __pyx_L1;}
      goto __pyx_L9;
    }
    __pyx_L9:;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":282 */
  Py_INCREF(((PyObject *)__pyx_v_dnsresult_obj));
  __pyx_r = __pyx_v_dnsresult_obj;
  goto __pyx_L0;

  __pyx_r = ((struct __pyx_obj_4coio_dnsresult *)Py_None); Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.dns_call");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wakeup_tasklet);
  Py_DECREF(__pyx_v_tempval);
  Py_DECREF(__pyx_v_dnsresult_obj);
  Py_DECREF(__pyx_v_dns_initialized);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_resolve_ipv4(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_ipv4[] = "Lookup an A record (IPV4) for a given name.\n\n    Args:\n      name     -- DNS hostname\n      flags    -- either 0 (default) or c_DNS_QUERY_NO_SEARCH\n    Returns:\n      A dnsresult() object.\n    ";
static PyObject *__pyx_f_4coio_dns_resolve_ipv4(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  int __pyx_v_flags;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {"name","flags",0};
  __pyx_v_flags = __pyx_d46;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s|i", __pyx_argnames, &__pyx_v_name, &__pyx_v_flags)) return 0;
  __pyx_1 = ((PyObject *)__pyx_f_4coio_dns_call(evdns_resolve_ipv4,((char const*)__pyx_v_name),__pyx_v_flags)); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 293; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dns_resolve_ipv4");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_resolve_ipv6(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_ipv6[] = "Lookup an AAAA record (IPV6) for a given name.\n\n    Args:\n      name     -- DNS hostname\n      flags    -- either 0 (default) or c_DNS_QUERY_NO_SEARCH\n    Returns:\n      A dnsresult() object.\n    ";
static PyObject *__pyx_f_4coio_dns_resolve_ipv6(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  int __pyx_v_flags;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {"name","flags",0};
  __pyx_v_flags = __pyx_d47;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s|i", __pyx_argnames, &__pyx_v_name, &__pyx_v_flags)) return 0;
  __pyx_1 = ((PyObject *)__pyx_f_4coio_dns_call(evdns_resolve_ipv6,((char const*)__pyx_v_name),__pyx_v_flags)); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 304; goto __pyx_L1;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("coio.dns_resolve_ipv6");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_dns_resolve_reverse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_dns_resolve_reverse[] = "Lookup a PTR record for a given IPv4 address.\n\n    Arguments:\n\n    ip       -- IPv4 or IPv6 address in ASCII\n    flags    -- either 0 (default) or c_DNS_QUERY_NO_SEARCH\n    ";
static PyObject *__pyx_f_4coio_dns_resolve_reverse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ip = 0;
  int __pyx_v_flags;
  PyListObject *__pyx_v_items;
  PyObject *__pyx_v_tmp;
  char *__pyx_v_p;
  int __pyx_v_i;
  int __pyx_v_j;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  Py_ssize_t __pyx_6;
  char *__pyx_7;
  static char *__pyx_argnames[] = {"ip","flags",0};
  __pyx_v_flags = __pyx_d48;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|i", __pyx_argnames, &__pyx_v_ip, &__pyx_v_flags)) return 0;
  Py_INCREF(__pyx_v_ip);
  __pyx_v_items = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_tmp = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":319 */
  __pyx_1 = PyObject_IsInstance(__pyx_v_ip,((PyObject *)(&PyString_Type))); if (__pyx_1 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 319; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 320; goto __pyx_L1;}
    Py_INCREF(__pyx_k143p);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k143p);
    __pyx_4 = PyObject_CallObject(PyExc_TypeError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 320; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 320; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":321 */
  __pyx_1 = PySequence_Contains(__pyx_v_ip, __pyx_k144p); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 321; goto __pyx_L1;}
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":322 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_ip, __pyx_n_split); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 322; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 322; goto __pyx_L1;}
    Py_INCREF(__pyx_k144p);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_k144p);
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 322; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (!__Pyx_TypeTest(__pyx_5, (&PyList_Type))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 322; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_items));
    __pyx_v_items = ((PyListObject *)__pyx_5);
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":323 */
    __pyx_6 = PyObject_Length(((PyObject *)__pyx_v_items)); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 323; goto __pyx_L1;}
    __pyx_2 = (__pyx_6 != 4);
    if (__pyx_2) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 324; goto __pyx_L1;}
      Py_INCREF(__pyx_k146p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k146p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 324; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 324; goto __pyx_L1;}
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":325 */
    __pyx_5 = PyString_FromStringAndSize(NULL,4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 325; goto __pyx_L1;}
    Py_DECREF(__pyx_v_tmp);
    __pyx_v_tmp = __pyx_5;
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":326 */
    __pyx_7 = PyString_AsString(__pyx_v_tmp); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; goto __pyx_L1;}
    __pyx_v_p = __pyx_7;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":327 */
    for (__pyx_v_i = 0; __pyx_v_i < 4; ++__pyx_v_i) {

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":329 */
      __pyx_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_items), __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 329; goto __pyx_L1;}
      __pyx_7 = PyString_AsString(__pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 329; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_4 = PyInt_FromString(__pyx_7,NULL,10); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 329; goto __pyx_L1;}
      __pyx_1 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 329; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_j = __pyx_1;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":330 */
      (__pyx_v_p[__pyx_v_i]) = ((unsigned char)__pyx_v_j);
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":331 */
    __pyx_5 = ((PyObject *)__pyx_f_4coio_dns_call(((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse),((char const*)__pyx_v_p),__pyx_v_flags)); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 331; goto __pyx_L1;}
    __pyx_r = __pyx_5;
    __pyx_5 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_2 = PySequence_Contains(__pyx_v_ip, __pyx_k133p); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 333; goto __pyx_L1;}
  if (__pyx_2) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":334 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_ip, __pyx_n_split); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 334; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 334; goto __pyx_L1;}
    Py_INCREF(__pyx_k133p);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_k133p);
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 334; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (!__Pyx_TypeTest(__pyx_5, (&PyList_Type))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 334; goto __pyx_L1;}
    Py_DECREF(((PyObject *)__pyx_v_items));
    __pyx_v_items = ((PyListObject *)__pyx_5);
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":335 */
    __pyx_6 = PyObject_Length(((PyObject *)__pyx_v_items)); if (__pyx_6 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 335; goto __pyx_L1;}
    __pyx_1 = (__pyx_6 != 8);
    if (__pyx_1) {
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 336; goto __pyx_L1;}
      Py_INCREF(__pyx_k147p);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_k147p);
      __pyx_4 = PyObject_CallObject(PyExc_ValueError, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 336; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 336; goto __pyx_L1;}
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":337 */
    __pyx_5 = PyString_FromStringAndSize(NULL,16); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 337; goto __pyx_L1;}
    Py_DECREF(__pyx_v_tmp);
    __pyx_v_tmp = __pyx_5;
    __pyx_5 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":338 */
    __pyx_7 = PyString_AsString(__pyx_v_tmp); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 338; goto __pyx_L1;}
    __pyx_v_p = __pyx_7;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":339 */
    for (__pyx_v_i = 0; __pyx_v_i < 8; ++__pyx_v_i) {

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":341 */
      __pyx_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_items), __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 341; goto __pyx_L1;}
      __pyx_7 = PyString_AsString(__pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 341; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_4 = PyInt_FromString(__pyx_7,NULL,16); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 341; goto __pyx_L1;}
      __pyx_2 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 341; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_j = __pyx_2;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":342 */
      (__pyx_v_p[(__pyx_v_i * 2)]) = (__pyx_v_j >> 8);

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":343 */
      (__pyx_v_p[((__pyx_v_i * 2) + 1)]) = (__pyx_v_j & 255);
    }

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":344 */
    __pyx_5 = ((PyObject *)__pyx_f_4coio_dns_call(((__pyx_t_4coio__evdns_call_t)evdns_resolve_reverse_ipv6),((char const*)__pyx_v_p),__pyx_v_flags)); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 344; goto __pyx_L1;}
    __pyx_r = __pyx_5;
    __pyx_5 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {
    __pyx_3 = PyNumber_Add(__pyx_k148p, __pyx_v_ip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_5 = PyObject_CallObject(PyExc_ValueError, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __Pyx_Raise(__pyx_5, 0, 0);
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.dns_resolve_reverse");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_items);
  Py_DECREF(__pyx_v_tmp);
  Py_DECREF(__pyx_v_ip);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_read_etc_hosts(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_read_etc_hosts[] = "Load IPv4 addresses and hostnames from /etc/hosts.\n\n    Data already loaded to names_by_ip and names_by_nameip is not overridden.\n\n    Raises:\n      IOError:\n    ";
static PyObject *__pyx_f_4coio_read_etc_hosts(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_filename = 0;
  PyObject *__pyx_v_f = 0;
  PyObject *__pyx_v_line;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_v_name;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_ssize_t __pyx_5;
  PyObject *__pyx_6 = 0;
  int __pyx_7;
  char *__pyx_8;
  char __pyx_9;
  PyObject *__pyx_10 = 0;
  static char *__pyx_argnames[] = {"filename","f",0};
  __pyx_v_filename = __pyx_d49;
  __pyx_v_f = __pyx_d50;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|OO", __pyx_argnames, &__pyx_v_filename, &__pyx_v_f)) return 0;
  Py_INCREF(__pyx_v_filename);
  Py_INCREF(__pyx_v_f);
  __pyx_v_line = Py_None; Py_INCREF(Py_None);
  __pyx_v_items = Py_None; Py_INCREF(Py_None);
  __pyx_v_ip = Py_None; Py_INCREF(Py_None);
  __pyx_v_name = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":366 */
  __pyx_1 = __pyx_v_f == Py_None;
  if (__pyx_1) {
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 367; goto __pyx_L1;}
    Py_INCREF(__pyx_v_filename);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_filename);
    __pyx_3 = PyObject_CallObject(((PyObject *)(&PyFile_Type)), __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 367; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_f);
    __pyx_v_f = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":368 */
  /*try:*/ {
    __pyx_2 = PyObject_GetIter(__pyx_v_f); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 369; goto __pyx_L4;}
    for (;;) {
      __pyx_3 = PyIter_Next(__pyx_2);
      if (!__pyx_3) {
        if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 369; goto __pyx_L4;}
        break;
      }
      Py_DECREF(__pyx_v_line);
      __pyx_v_line = __pyx_3;
      __pyx_3 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":370 */
      __pyx_3 = PyObject_GetAttr(__pyx_v_line, __pyx_n_strip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 370; goto __pyx_L4;}
      __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 370; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_split); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 370; goto __pyx_L4;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_4 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 370; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_items);
      __pyx_v_items = __pyx_4;
      __pyx_4 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":371 */
      __pyx_5 = PyObject_Length(__pyx_v_items); if (__pyx_5 == -1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; goto __pyx_L4;}
      __pyx_1 = (__pyx_5 > 1);
      if (__pyx_1) {
        __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; goto __pyx_L4;}
        __pyx_4 = PyObject_GetItem(__pyx_v_items, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; goto __pyx_L4;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_startswith); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; goto __pyx_L4;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; goto __pyx_L4;}
        Py_INCREF(__pyx_k151p);
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_k151p);
        __pyx_6 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; goto __pyx_L4;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __pyx_7 = PyObject_IsTrue(__pyx_6); if (__pyx_7 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 371; goto __pyx_L4;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_1 = (!__pyx_7);
      }
      if (__pyx_1) {

        /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":372 */
        __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L4;}
        __pyx_4 = PyObject_GetItem(__pyx_v_items, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L4;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_v_ip);
        __pyx_v_ip = __pyx_4;
        __pyx_4 = 0;

        /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":373 */
        __pyx_8 = PyString_AsString(__pyx_v_ip); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 373; goto __pyx_L4;}
        __pyx_9 = __pyx_f_4coio_is_valid_ipv4(__pyx_8);
        if (__pyx_9) {

          /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":375 */
          __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 375; goto __pyx_L4;}
          __pyx_3 = PyObject_GetAttr(__pyx_6, __pyx_n_setdefault); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 375; goto __pyx_L4;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 375; goto __pyx_L4;}
          Py_INCREF(__pyx_v_ip);
          PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_ip);
          Py_INCREF(__pyx_v_items);
          PyTuple_SET_ITEM(__pyx_4, 1, __pyx_v_items);
          __pyx_6 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 375; goto __pyx_L4;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;

          /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":376 */
          __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 376; goto __pyx_L4;}
          __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_setdefault); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 376; goto __pyx_L4;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 376; goto __pyx_L4;}
          Py_INCREF(__pyx_v_ip);
          PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_ip);
          Py_INCREF(__pyx_v_items);
          PyTuple_SET_ITEM(__pyx_6, 1, __pyx_v_items);
          __pyx_3 = PyObject_CallObject(__pyx_4, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 376; goto __pyx_L4;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;

          /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":377 */
          __pyx_4 = PyObject_GetIter(__pyx_v_items); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 377; goto __pyx_L4;}
          for (;;) {
            __pyx_6 = PyIter_Next(__pyx_4);
            if (!__pyx_6) {
              if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 377; goto __pyx_L4;}
              break;
            }
            Py_DECREF(__pyx_v_name);
            __pyx_v_name = __pyx_6;
            __pyx_6 = 0;
            __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 378; goto __pyx_L4;}
            __pyx_6 = PyObject_GetAttr(__pyx_3, __pyx_n_setdefault); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 378; goto __pyx_L4;}
            Py_DECREF(__pyx_3); __pyx_3 = 0;
            __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 378; goto __pyx_L4;}
            Py_INCREF(__pyx_v_name);
            PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_name);
            Py_INCREF(__pyx_v_items);
            PyTuple_SET_ITEM(__pyx_3, 1, __pyx_v_items);
            __pyx_10 = PyObject_CallObject(__pyx_6, __pyx_3); if (!__pyx_10) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 378; goto __pyx_L4;}
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            Py_DECREF(__pyx_3); __pyx_3 = 0;
            Py_DECREF(__pyx_10); __pyx_10 = 0;
          }
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          goto __pyx_L9;
        }
        __pyx_L9:;
        goto __pyx_L8;
      }
      __pyx_L8:;
    }
    Py_DECREF(__pyx_2); __pyx_2 = 0;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_10); __pyx_10 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    __pyx_6 = PyObject_GetAttr(__pyx_v_f, __pyx_n_close); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 380; goto __pyx_L12;}
    __pyx_3 = PyObject_CallObject(__pyx_6, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 380; goto __pyx_L12;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L13;
    __pyx_L12:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1;
    __pyx_L13:;
    switch (__pyx_why) {
      case 4: {
        PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1;
      }
    }
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_10);
  __Pyx_AddTraceback("coio.read_etc_hosts");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_line);
  Py_DECREF(__pyx_v_items);
  Py_DECREF(__pyx_v_ip);
  Py_DECREF(__pyx_v_name);
  Py_DECREF(__pyx_v_filename);
  Py_DECREF(__pyx_v_f);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_raise_gaierror(PyObject *__pyx_v_exc_info,char __pyx_v_is_name) {
  int __pyx_v_result;
  PyObject *__pyx_v_exc_type;
  PyObject *__pyx_v_exc_value;
  PyObject *__pyx_v_exc_tb;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  char __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  Py_INCREF(__pyx_v_exc_info);
  __pyx_v_exc_type = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_value = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_tb = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":384 */
  __pyx_1 = PyObject_GetIter(__pyx_v_exc_info); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 384; goto __pyx_L1;}
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 384; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_type);
  __pyx_v_exc_type = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 384; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_value);
  __pyx_v_exc_value = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 384; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_tb);
  __pyx_v_exc_tb = __pyx_2;
  __pyx_2 = 0;
  if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 384; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":388 */
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 388; goto __pyx_L1;}
  __pyx_1 = PyObject_GetItem(__pyx_v_exc_value, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 388; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 388; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_result = __pyx_3;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":389 */
  __pyx_v_result = (-__pyx_v_result);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":392 */
  __pyx_3 = (__pyx_v_result == __pyx_e_4coio_c_DNS_ERR_NOTEXIST);
  if (__pyx_3) {
    __pyx_4 = __pyx_v_is_name;
    if (__pyx_4) {
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; goto __pyx_L1;}
      __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 395; goto __pyx_L1;}
      __pyx_5 = PyObject_GetAttr(__pyx_2, __pyx_n_EAI_NONAME); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 395; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_5);
      Py_INCREF(__pyx_k157p);
      PyTuple_SET_ITEM(__pyx_2, 1, __pyx_k157p);
      __pyx_5 = 0;
      __pyx_5 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 394; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_v_exc_value);
      __pyx_v_exc_value = __pyx_5;
      __pyx_5 = 0;
      goto __pyx_L3;
    }
    /*else*/ {
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; goto __pyx_L1;}
      __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_gaierror); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 398; goto __pyx_L1;}
      __pyx_1 = PyObject_GetAttr(__pyx_5, __pyx_n_EAI_NODATA); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 398; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_5 = PyTuple_New(2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
      Py_INCREF(__pyx_k159p);
      PyTuple_SET_ITEM(__pyx_5, 1, __pyx_k159p);
      __pyx_1 = 0;
      __pyx_1 = PyObject_CallObject(__pyx_2, __pyx_5); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 397; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_v_exc_value);
      __pyx_v_exc_value = __pyx_1;
      __pyx_1 = 0;
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
    __pyx_5 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = PyInt_FromLong(((-__pyx_v_result) - 900)); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
    __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
    __pyx_6 = PyObject_GetItem(__pyx_v_exc_value, __pyx_2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_6);
    __pyx_1 = 0;
    __pyx_6 = 0;
    __pyx_1 = PyObject_CallObject(__pyx_5, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 400; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_1;
    __pyx_1 = 0;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":401 */
  __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 401; goto __pyx_L1;}
  Py_INCREF(__pyx_v_exc_value);
  PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_exc_value);
  __pyx_5 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_6); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 401; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  __Pyx_Raise(__pyx_5, __pyx_v_exc_value, __pyx_v_exc_tb);
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 401; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.raise_gaierror");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc_type);
  Py_DECREF(__pyx_v_exc_value);
  Py_DECREF(__pyx_v_exc_tb);
  Py_DECREF(__pyx_v_exc_info);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_raise_herror(PyObject *__pyx_v_exc_info) {
  int __pyx_v_result;
  PyObject *__pyx_v_exc_type;
  PyObject *__pyx_v_exc_value;
  PyObject *__pyx_v_exc_tb;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  Py_INCREF(__pyx_v_exc_info);
  __pyx_v_exc_type = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_value = Py_None; Py_INCREF(Py_None);
  __pyx_v_exc_tb = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":405 */
  __pyx_1 = PyObject_GetIter(__pyx_v_exc_info); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 405; goto __pyx_L1;}
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 405; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_type);
  __pyx_v_exc_type = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 405; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_value);
  __pyx_v_exc_value = __pyx_2;
  __pyx_2 = 0;
  __pyx_2 = __Pyx_UnpackItem(__pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 405; goto __pyx_L1;}
  Py_DECREF(__pyx_v_exc_tb);
  __pyx_v_exc_tb = __pyx_2;
  __pyx_2 = 0;
  if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 405; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":407 */
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 407; goto __pyx_L1;}
  __pyx_1 = PyObject_GetItem(__pyx_v_exc_value, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 407; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 407; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_result = __pyx_3;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":408 */
  __pyx_v_result = (-__pyx_v_result);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":411 */
  __pyx_3 = (__pyx_v_result == __pyx_e_4coio_c_DNS_ERR_NOTEXIST);
  if (__pyx_3) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 412; goto __pyx_L1;}
    __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_herror); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 412; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_HERROR_HOST_NOT_FOUND); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 413; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 412; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    Py_INCREF(__pyx_k162p);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_k162p);
    __pyx_2 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 412; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 415; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_1, __pyx_n_herror); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 415; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_2 = PyInt_FromLong(((-__pyx_v_result) - 900)); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 415; goto __pyx_L1;}
    __pyx_1 = PyInt_FromLong(1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 415; goto __pyx_L1;}
    __pyx_5 = PyObject_GetItem(__pyx_v_exc_value, __pyx_1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 415; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_1 = PyTuple_New(2); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 415; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_1, 1, __pyx_5);
    __pyx_2 = 0;
    __pyx_5 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_4, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 415; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_v_exc_value);
    __pyx_v_exc_value = __pyx_2;
    __pyx_2 = 0;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":416 */
  __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 416; goto __pyx_L1;}
  Py_INCREF(__pyx_v_exc_value);
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_v_exc_value);
  __pyx_4 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 416; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __Pyx_Raise(__pyx_4, __pyx_v_exc_value, __pyx_v_exc_tb);
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 416; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("coio.raise_herror");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_exc_type);
  Py_DECREF(__pyx_v_exc_value);
  Py_DECREF(__pyx_v_exc_tb);
  Py_DECREF(__pyx_v_exc_info);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_gethostbyname(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_gethostbyname[] = "Non-blocking drop-in replacement for socket.gethostbyname.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Returns:\n      An IPv4 address as an ASCII string (e.g. \'192.168.1.2\').\n    Raises:\n      socket.gaierror: The error names and codes may be different.\n    ";
static PyObject *__pyx_f_4coio_gethostbyname(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  char __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"name",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s", __pyx_argnames, &__pyx_v_name)) return 0;
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":429 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 430; goto __pyx_L1;}
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":431 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 432; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 432; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 433; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_EAI_ADDRFAMILY); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 433; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 432; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
    Py_INCREF(__pyx_k164p);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_k164p);
    __pyx_4 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 432; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 432; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":434 */
  __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; goto __pyx_L1;}
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; goto __pyx_L1;}
  __pyx_5 = PySequence_Contains(__pyx_2, __pyx_3); if (__pyx_5 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 434; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_5) {
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 435; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 435; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_4, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 435; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 435; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_2, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 435; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":436 */
  /*try:*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; goto __pyx_L5;}
    __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; goto __pyx_L5;}
    __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; goto __pyx_L5;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_4);
    __pyx_4 = 0;
    __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; goto __pyx_L5;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_2 = PyObject_GetAttr(__pyx_4, __pyx_n_values); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; goto __pyx_L5;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; goto __pyx_L5;}
    __pyx_4 = PyObject_GetItem(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 437; goto __pyx_L5;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
  }
  goto __pyx_L6;
  __pyx_L5:;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":438 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 438; goto __pyx_L1;}
  __pyx_5 = PyErr_ExceptionMatches(__pyx_2);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_5) {
    __pyx_filename = __pyx_f[1]; __pyx_lineno = 438; __Pyx_AddTraceback("coio.gethostbyname");
    PyErr_Fetch(&__pyx_3, &__pyx_4, &__pyx_2);
    if (__Pyx_NormalizeException(&__pyx_3, &__pyx_4, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 438; goto __pyx_L1;}
    Py_INCREF(__pyx_4);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_4;
    __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 439; goto __pyx_L1;}
    Py_INCREF(__pyx_v_e);
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_e);
    __pyx_7 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_6); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 439; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_6 = PyTuple_New(3); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 439; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_7);
    Py_INCREF(__pyx_v_e);
    PyTuple_SET_ITEM(__pyx_6, 1, __pyx_v_e);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_6, 2, Py_None);
    __pyx_7 = 0;
    __pyx_7 = __pyx_f_4coio_raise_gaierror(__pyx_6,0); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 439; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L6;
  }
  goto __pyx_L1;
  __pyx_L6:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.gethostbyname");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_c_gethostbyname(PyObject *__pyx_v_address,int __pyx_v_family) {
  char *__pyx_v_name;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  char *__pyx_4;
  char __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  Py_INCREF(__pyx_v_address);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":448 */
  __pyx_1 = (__pyx_v_family == AF_INET);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":449 */
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 449; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_v_address, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 449; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_4 = PyString_AsString(__pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 449; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_name = __pyx_4;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":450 */
    __pyx_5 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
    if (__pyx_5) {
      Py_INCREF(__pyx_v_address);
      __pyx_r = __pyx_v_address;
      goto __pyx_L0;
      goto __pyx_L3;
    }
    __pyx_L3:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":452 */
    __pyx_1 = (!__pyx_f_4coio_is_valid_ipv6(__pyx_v_name));
    if (__pyx_1) {
      /*try:*/ {
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        PyTuple_SET_ITEM(__pyx_6, 0, __pyx_3);
        __pyx_3 = 0;
        __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_2 = PyObject_GetAttr(__pyx_3, __pyx_n_values); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_6 = PyInt_FromLong(0); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        __pyx_3 = PyObject_GetItem(__pyx_2, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        __pyx_6 = PyObject_GetItem(__pyx_v_address, __pyx_2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 454; goto __pyx_L5;}
        PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
        PyTuple_SET_ITEM(__pyx_2, 1, __pyx_6);
        __pyx_3 = 0;
        __pyx_6 = 0;
        __pyx_r = __pyx_2;
        __pyx_2 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L6;
      __pyx_L5:;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":455 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 455; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_3);
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      if (__pyx_1) {
        __pyx_filename = __pyx_f[1]; __pyx_lineno = 455; __Pyx_AddTraceback("coio.c_gethostbyname");
        PyErr_Fetch(&__pyx_6, &__pyx_2, &__pyx_3);
        if (__Pyx_NormalizeException(&__pyx_6, &__pyx_2, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 455; goto __pyx_L1;}
        Py_INCREF(__pyx_2);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_2;
        __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; goto __pyx_L1;}
        Py_INCREF(__pyx_v_e);
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_v_e);
        __pyx_8 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_7); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_7 = PyTuple_New(3); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_8);
        Py_INCREF(__pyx_v_e);
        PyTuple_SET_ITEM(__pyx_7, 1, __pyx_v_e);
        Py_INCREF(Py_None);
        PyTuple_SET_ITEM(__pyx_7, 2, Py_None);
        __pyx_8 = 0;
        __pyx_8 = __pyx_f_4coio_raise_gaierror(__pyx_7,0); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 456; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        Py_XDECREF(__pyx_6); __pyx_6 = 0;
        Py_XDECREF(__pyx_2); __pyx_2 = 0;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        goto __pyx_L6;
      }
      goto __pyx_L1;
      __pyx_L6:;
      goto __pyx_L4;
    }
    __pyx_L4:;
    goto __pyx_L2;
  }
  __pyx_1 = (__pyx_v_family == AF_INET6);
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":458 */
    __pyx_7 = PyInt_FromLong(0); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; goto __pyx_L1;}
    __pyx_8 = PyObject_GetItem(__pyx_v_address, __pyx_7); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_4 = PyString_AsString(__pyx_8); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 458; goto __pyx_L1;}
    Py_DECREF(__pyx_8); __pyx_8 = 0;
    __pyx_v_name = __pyx_4;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":459 */
    __pyx_5 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
    if (__pyx_5) {
      Py_INCREF(__pyx_v_address);
      __pyx_r = __pyx_v_address;
      goto __pyx_L0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":461 */
    __pyx_1 = (!__pyx_f_4coio_is_valid_ipv4(__pyx_v_name));
    if (__pyx_1) {
      /*try:*/ {
        __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv6); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
        __pyx_2 = 0;
        __pyx_7 = PyObject_CallObject(__pyx_6, __pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_8 = PyObject_GetAttr(__pyx_7, __pyx_n_values); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        __pyx_6 = PyObject_GetItem(__pyx_8, __pyx_2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        __pyx_7 = PyObject_GetItem(__pyx_v_address, __pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_8 = PyTuple_New(2); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 463; goto __pyx_L9;}
        PyTuple_SET_ITEM(__pyx_8, 0, __pyx_6);
        PyTuple_SET_ITEM(__pyx_8, 1, __pyx_7);
        __pyx_6 = 0;
        __pyx_7 = 0;
        __pyx_r = __pyx_8;
        __pyx_8 = 0;
        goto __pyx_L0;
      }
      goto __pyx_L10;
      __pyx_L9:;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_7); __pyx_7 = 0;
      Py_XDECREF(__pyx_8); __pyx_8 = 0;

      /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":464 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
      __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      if (__pyx_1) {
        __pyx_filename = __pyx_f[1]; __pyx_lineno = 464; __Pyx_AddTraceback("coio.c_gethostbyname");
        PyErr_Fetch(&__pyx_3, &__pyx_6, &__pyx_7);
        if (__Pyx_NormalizeException(&__pyx_3, &__pyx_6, &__pyx_7) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
        Py_INCREF(__pyx_6);
        Py_DECREF(__pyx_v_e);
        __pyx_v_e = __pyx_6;
        __pyx_8 = PyTuple_New(1); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 465; goto __pyx_L1;}
        Py_INCREF(__pyx_v_e);
        PyTuple_SET_ITEM(__pyx_8, 0, __pyx_v_e);
        __pyx_2 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_8); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 465; goto __pyx_L1;}
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        __pyx_8 = PyTuple_New(3); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 465; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_8, 0, __pyx_2);
        Py_INCREF(__pyx_v_e);
        PyTuple_SET_ITEM(__pyx_8, 1, __pyx_v_e);
        Py_INCREF(Py_None);
        PyTuple_SET_ITEM(__pyx_8, 2, Py_None);
        __pyx_2 = 0;
        __pyx_2 = __pyx_f_4coio_raise_gaierror(__pyx_8,0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 465; goto __pyx_L1;}
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_XDECREF(__pyx_3); __pyx_3 = 0;
        Py_XDECREF(__pyx_6); __pyx_6 = 0;
        Py_XDECREF(__pyx_7); __pyx_7 = 0;
        goto __pyx_L10;
      }
      goto __pyx_L1;
      __pyx_L10:;
      goto __pyx_L8;
    }
    __pyx_L8:;
    goto __pyx_L2;
  }
  /*else*/ {
    Py_INCREF(__pyx_v_address);
    __pyx_r = __pyx_v_address;
    goto __pyx_L0;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":468 */
  __pyx_8 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_8, __pyx_n_gaierror); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; goto __pyx_L1;}
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(__pyx_3, __pyx_n_EAI_ADDRFAMILY); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_7 = PyTuple_New(2); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_7, 0, __pyx_6);
  Py_INCREF(__pyx_k164p);
  PyTuple_SET_ITEM(__pyx_7, 1, __pyx_k164p);
  __pyx_6 = 0;
  __pyx_8 = PyObject_CallObject(__pyx_2, __pyx_7); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  __Pyx_Raise(__pyx_8, 0, 0);
  Py_DECREF(__pyx_8); __pyx_8 = 0;
  {__pyx_filename = __pyx_f[1]; __pyx_lineno = 468; goto __pyx_L1;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("coio.c_gethostbyname");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_address);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_gethostbyaddr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_gethostbyaddr[] = "Non-blocking drop-in replacement for socket.gethostbyaddr.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Raises:\n      socket.herror: The error names and codes may be different.\n      socket.gaierror: The error names and codes may be different.\n    ";
static PyObject *__pyx_f_4coio_gethostbyaddr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_v_e;
  PyObject *__pyx_v_items;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  static char *__pyx_argnames[] = {"name",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s", __pyx_argnames, &__pyx_v_name)) return 0;
  __pyx_v_ip = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  __pyx_v_items = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":480 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (!__pyx_1) {
    __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  }
  if (__pyx_1) {
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 481; goto __pyx_L1;}
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L2;
  }
  __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; goto __pyx_L1;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; goto __pyx_L1;}
  __pyx_1 = PySequence_Contains(__pyx_3, __pyx_2); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 482; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 483; goto __pyx_L1;}
    __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 483; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 483; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 483; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_4, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 483; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  /*else*/ {
    /*try:*/ {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 486; goto __pyx_L3;}
      __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 486; goto __pyx_L3;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 486; goto __pyx_L3;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
      __pyx_2 = 0;
      __pyx_2 = PyObject_CallObject(__pyx_4, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 486; goto __pyx_L3;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_values); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 486; goto __pyx_L3;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 486; goto __pyx_L3;}
      __pyx_2 = PyObject_GetItem(__pyx_4, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 486; goto __pyx_L3;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_v_ip);
      __pyx_v_ip = __pyx_2;
      __pyx_2 = 0;
    }
    goto __pyx_L4;
    __pyx_L3:;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":487 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; goto __pyx_L1;}
    __pyx_1 = PyErr_ExceptionMatches(__pyx_4);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_1) {
      __pyx_filename = __pyx_f[1]; __pyx_lineno = 487; __Pyx_AddTraceback("coio.gethostbyaddr");
      PyErr_Fetch(&__pyx_3, &__pyx_2, &__pyx_4);
      if (__Pyx_NormalizeException(&__pyx_3, &__pyx_2, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 487; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;
      __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 488; goto __pyx_L1;}
      Py_INCREF(__pyx_v_e);
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_v_e);
      __pyx_6 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_5); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 488; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_5 = PyTuple_New(3); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 488; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_6);
      Py_INCREF(__pyx_v_e);
      PyTuple_SET_ITEM(__pyx_5, 1, __pyx_v_e);
      Py_INCREF(Py_None);
      PyTuple_SET_ITEM(__pyx_5, 2, Py_None);
      __pyx_6 = 0;
      __pyx_6 = __pyx_f_4coio_raise_gaierror(__pyx_5,0); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 488; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L4;
    }
    goto __pyx_L1;
    __pyx_L4:;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":489 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 489; goto __pyx_L1;}
  __pyx_1 = PySequence_Contains(__pyx_5, __pyx_v_ip); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 489; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  if (__pyx_1) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":490 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 490; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_6, __pyx_v_ip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 490; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_v_items);
    __pyx_v_items = __pyx_3;
    __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":491 */
    __pyx_2 = PyInt_FromLong(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 491; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_v_items, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 491; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = PySequence_GetSlice(__pyx_v_items, 2, PY_SSIZE_T_MAX); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 491; goto __pyx_L1;}
    __pyx_6 = PyList_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 491; goto __pyx_L1;}
    Py_INCREF(__pyx_v_ip);
    PyList_SET_ITEM(__pyx_6, 0, __pyx_v_ip);
    __pyx_3 = PyTuple_New(3); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 491; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_4);
    PyTuple_SET_ITEM(__pyx_3, 1, __pyx_5);
    PyTuple_SET_ITEM(__pyx_3, 2, __pyx_6);
    __pyx_4 = 0;
    __pyx_5 = 0;
    __pyx_6 = 0;
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":492 */
  /*try:*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_reverse); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    Py_INCREF(__pyx_v_ip);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_ip);
    __pyx_5 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_6 = PyObject_GetAttr(__pyx_5, __pyx_n_values); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    __pyx_2 = PyObject_GetItem(__pyx_6, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_4 = PyList_New(0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    __pyx_5 = PyList_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    Py_INCREF(__pyx_v_ip);
    PyList_SET_ITEM(__pyx_5, 0, __pyx_v_ip);
    __pyx_6 = PyTuple_New(3); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 493; goto __pyx_L6;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_6, 1, __pyx_4);
    PyTuple_SET_ITEM(__pyx_6, 2, __pyx_5);
    __pyx_2 = 0;
    __pyx_4 = 0;
    __pyx_5 = 0;
    __pyx_r = __pyx_6;
    __pyx_6 = 0;
    goto __pyx_L0;
  }
  goto __pyx_L7;
  __pyx_L6:;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;
  Py_XDECREF(__pyx_5); __pyx_5 = 0;
  Py_XDECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":494 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 494; goto __pyx_L1;}
  __pyx_1 = PyErr_ExceptionMatches(__pyx_3);
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_1) {
    __pyx_filename = __pyx_f[1]; __pyx_lineno = 494; __Pyx_AddTraceback("coio.gethostbyaddr");
    PyErr_Fetch(&__pyx_2, &__pyx_4, &__pyx_5);
    if (__Pyx_NormalizeException(&__pyx_2, &__pyx_4, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 494; goto __pyx_L1;}
    Py_INCREF(__pyx_4);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_4;
    __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 497; goto __pyx_L1;}
    Py_INCREF(__pyx_v_e);
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_e);
    __pyx_3 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 497; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_6 = PyTuple_New(3); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 497; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_3);
    Py_INCREF(__pyx_v_e);
    PyTuple_SET_ITEM(__pyx_6, 1, __pyx_v_e);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_6, 2, Py_None);
    __pyx_3 = 0;
    __pyx_3 = __pyx_f_4coio_raise_herror(__pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 497; goto __pyx_L1;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;
    goto __pyx_L7;
  }
  goto __pyx_L1;
  __pyx_L7:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.gethostbyaddr");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_ip);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_items);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_getfqdn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_getfqdn[] = "Non-blocking drop-in replacement for socket.getfqdn.\n\n    This function returns data from /etc/hosts as read at module load time.\n    ";
static PyObject *__pyx_f_4coio_getfqdn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  char *__pyx_v_cname;
  PyObject *__pyx_v_ip;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  char *__pyx_5;
  PyObject *__pyx_6 = 0;
  static char *__pyx_argnames[] = {"name",0};
  __pyx_v_name = __pyx_d51;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_name)) return 0;
  Py_INCREF(__pyx_v_name);
  __pyx_v_ip = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":505 */
  __pyx_v_cname = NULL;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":506 */
  __pyx_1 = PyObject_IsTrue(__pyx_v_name); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 506; goto __pyx_L1;}
  __pyx_2 = (!__pyx_1);
  if (__pyx_2) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 507; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_gethostname); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 507; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_4, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 507; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_name);
    __pyx_v_name = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":508 */
  __pyx_5 = PyString_AsString(__pyx_v_name); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 508; goto __pyx_L1;}
  __pyx_v_cname = __pyx_5;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":509 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_cname);
  if (!__pyx_1) {
    __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_cname);
  }
  if (__pyx_1) {
    __pyx_4 = PyString_FromString(__pyx_v_cname); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 510; goto __pyx_L1;}
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L3;
  }
  __pyx_3 = PyString_FromString(__pyx_v_cname); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 511; goto __pyx_L1;}
  __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 511; goto __pyx_L1;}
  __pyx_2 = PySequence_Contains(__pyx_4, __pyx_3); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 511; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_2) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_3, __pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; goto __pyx_L1;}
    __pyx_6 = PyObject_GetItem(__pyx_4, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 512; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_ip);
    __pyx_v_ip = __pyx_6;
    __pyx_6 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
    /*try:*/ {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 515; goto __pyx_L4;}
      __pyx_3 = PyString_FromString(__pyx_v_cname); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 515; goto __pyx_L4;}
      __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 515; goto __pyx_L4;}
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_3);
      __pyx_3 = 0;
      __pyx_3 = PyObject_CallObject(__pyx_4, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 515; goto __pyx_L4;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_values); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 515; goto __pyx_L4;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_6 = PyInt_FromLong(0); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 515; goto __pyx_L4;}
      __pyx_3 = PyObject_GetItem(__pyx_4, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 515; goto __pyx_L4;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_v_ip);
      __pyx_v_ip = __pyx_3;
      __pyx_3 = 0;
    }
    goto __pyx_L5;
    __pyx_L4:;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":516 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 516; goto __pyx_L1;}
    __pyx_1 = PyErr_ExceptionMatches(__pyx_4);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_1) {
      __pyx_filename = __pyx_f[1]; __pyx_lineno = 516; __Pyx_AddTraceback("coio.getfqdn");
      PyErr_Fetch(&__pyx_6, &__pyx_3, &__pyx_4);
      if (__Pyx_NormalizeException(&__pyx_6, &__pyx_3, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 516; goto __pyx_L1;}
      Py_INCREF(__pyx_3);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_3;
      Py_INCREF(__pyx_v_name);
      __pyx_r = __pyx_v_name;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      goto __pyx_L0;
      Py_XDECREF(__pyx_6); __pyx_6 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L5;
    }
    goto __pyx_L1;
    __pyx_L5:;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":518 */
  __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 518; goto __pyx_L1;}
  __pyx_2 = PySequence_Contains(__pyx_6, __pyx_v_ip); if (__pyx_2 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 518; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  if (__pyx_2) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 519; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_3, __pyx_v_ip); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 519; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_6 = PyInt_FromLong(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 519; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_4, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 519; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":520 */
  /*try:*/ {
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_reverse); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 521; goto __pyx_L7;}
    __pyx_6 = PyTuple_New(1); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 521; goto __pyx_L7;}
    Py_INCREF(__pyx_v_ip);
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_ip);
    __pyx_3 = PyObject_CallObject(__pyx_4, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 521; goto __pyx_L7;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_values); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 521; goto __pyx_L7;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_6 = PyInt_FromLong(0); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 521; goto __pyx_L7;}
    __pyx_3 = PyObject_GetItem(__pyx_4, __pyx_6); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 521; goto __pyx_L7;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
  }
  goto __pyx_L8;
  __pyx_L7:;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;
  Py_XDECREF(__pyx_6); __pyx_6 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":522 */
  __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 522; goto __pyx_L1;}
  __pyx_1 = PyErr_ExceptionMatches(__pyx_4);
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_1) {
    __pyx_filename = __pyx_f[1]; __pyx_lineno = 522; __Pyx_AddTraceback("coio.getfqdn");
    PyErr_Fetch(&__pyx_6, &__pyx_3, &__pyx_4);
    if (__Pyx_NormalizeException(&__pyx_6, &__pyx_3, &__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 522; goto __pyx_L1;}
    Py_INCREF(__pyx_3);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_3;
    Py_INCREF(__pyx_v_name);
    __pyx_r = __pyx_v_name;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    goto __pyx_L0;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L8;
  }
  goto __pyx_L1;
  __pyx_L8:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("coio.getfqdn");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_ip);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_name);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_gethostbyname_ex(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_gethostbyname_ex[] = "Non-blocking drop-in replacement for socket.gethostbyname_ex.\n\n    This function returns data from /etc/hosts as read at module load time.\n\n    Avoid using this function if possible.\n    Please note that this function is less faithful to its socket.*\n    counterpart than the other functions in this module. This is because the\n    underlying DNS lookup mechanism (evdns) can\'t return the CNAME records\n    in evdns_resolve_ipv4(). The CNAME emulation here is inaccurate (see the\n    unit tests) and slower (needs 2 DNS requests).\n    ";
static PyObject *__pyx_f_4coio_gethostbyname_ex(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_name;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_ips;
  PyObject *__pyx_v_e;
  PyObject *__pyx_v_canonical;
  PyObject *__pyx_r;
  char __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  int __pyx_6;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"name",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "s", __pyx_argnames, &__pyx_v_name)) return 0;
  __pyx_v_items = Py_None; Py_INCREF(Py_None);
  __pyx_v_ips = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  __pyx_v_canonical = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":537 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = PyString_FromString(__pyx_v_name); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; goto __pyx_L1;}
    __pyx_3 = PyList_New(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; goto __pyx_L1;}
    __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; goto __pyx_L1;}
    __pyx_5 = PyList_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_5, 0, __pyx_4);
    __pyx_4 = 0;
    __pyx_4 = PyTuple_New(3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 538; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    PyTuple_SET_ITEM(__pyx_4, 2, __pyx_5);
    __pyx_2 = 0;
    __pyx_3 = 0;
    __pyx_5 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":539 */
  __pyx_1 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_name);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 540; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_gaierror); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 540; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 541; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_5, __pyx_n_EAI_ADDRFAMILY); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 541; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 540; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
    Py_INCREF(__pyx_k164p);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_k164p);
    __pyx_4 = 0;
    __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 540; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_Raise(__pyx_5, 0, 0);
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 540; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":542 */
  __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 542; goto __pyx_L1;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 542; goto __pyx_L1;}
  __pyx_6 = PySequence_Contains(__pyx_3, __pyx_4); if (__pyx_6 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 542; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_6) {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":543 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 543; goto __pyx_L1;}
    __pyx_5 = PyString_FromString(__pyx_v_name); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 543; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_2, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 543; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_v_items);
    __pyx_v_items = __pyx_4;
    __pyx_4 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":544 */
    __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 544; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_items, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 544; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_5 = PySequence_GetSlice(__pyx_v_items, 2, PY_SSIZE_T_MAX); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 544; goto __pyx_L1;}
    __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 544; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_v_items, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 544; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_4 = PyList_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 544; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_3 = PyTuple_New(3); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 544; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_3, 1, __pyx_5);
    PyTuple_SET_ITEM(__pyx_3, 2, __pyx_4);
    __pyx_2 = 0;
    __pyx_5 = 0;
    __pyx_4 = 0;
    __pyx_r = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":545 */
  /*try:*/ {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 546; goto __pyx_L5;}
    __pyx_5 = PyString_FromString(__pyx_v_name); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 546; goto __pyx_L5;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 546; goto __pyx_L5;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_5);
    __pyx_5 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 546; goto __pyx_L5;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyObject_GetAttr(__pyx_3, __pyx_n_values); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 546; goto __pyx_L5;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_v_ips);
    __pyx_v_ips = __pyx_5;
    __pyx_5 = 0;
  }
  goto __pyx_L6;
  __pyx_L5:;
  Py_XDECREF(__pyx_2); __pyx_2 = 0;
  Py_XDECREF(__pyx_4); __pyx_4 = 0;
  Py_XDECREF(__pyx_3); __pyx_3 = 0;
  Py_XDECREF(__pyx_5); __pyx_5 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":547 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 547; goto __pyx_L1;}
  __pyx_6 = PyErr_ExceptionMatches(__pyx_2);
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_6) {
    __pyx_filename = __pyx_f[1]; __pyx_lineno = 547; __Pyx_AddTraceback("coio.gethostbyname_ex");
    PyErr_Fetch(&__pyx_4, &__pyx_3, &__pyx_5);
    if (__Pyx_NormalizeException(&__pyx_4, &__pyx_3, &__pyx_5) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 547; goto __pyx_L1;}
    Py_INCREF(__pyx_3);
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_3;
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 548; goto __pyx_L1;}
    Py_INCREF(__pyx_v_e);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_e);
    __pyx_7 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_2); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 548; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 548; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_7);
    Py_INCREF(__pyx_v_e);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_e);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_2, 2, Py_None);
    __pyx_7 = 0;
    __pyx_7 = __pyx_f_4coio_raise_gaierror(__pyx_2,0); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 548; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;
    goto __pyx_L6;
  }
  goto __pyx_L1;
  __pyx_L6:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":550 */
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 550; goto __pyx_L1;}
  __pyx_7 = PyObject_GetItem(__pyx_v_ips, __pyx_2); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 550; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 550; goto __pyx_L1;}
  __pyx_6 = PySequence_Contains(__pyx_4, __pyx_7); if (__pyx_6 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 550; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_6) {
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_ip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 551; goto __pyx_L1;}
    __pyx_5 = PyInt_FromLong(0); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 551; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_ips, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 551; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_7 = PyObject_GetItem(__pyx_3, __pyx_2); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 551; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_4 = PyInt_FromLong(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 551; goto __pyx_L1;}
    __pyx_5 = PyObject_GetItem(__pyx_7, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 551; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_v_canonical);
    __pyx_v_canonical = __pyx_5;
    __pyx_5 = 0;
    goto __pyx_L7;
  }
  /*else*/ {
    /*try:*/ {
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_reverse); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      __pyx_7 = PyObject_GetItem(__pyx_v_ips, __pyx_2); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_7);
      __pyx_7 = 0;
      __pyx_5 = PyObject_CallObject(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_2 = PyObject_GetAttr(__pyx_5, __pyx_n_values); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_7 = PyInt_FromLong(0); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      __pyx_3 = PyObject_GetItem(__pyx_2, __pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 554; goto __pyx_L8;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_v_canonical);
      __pyx_v_canonical = __pyx_3;
      __pyx_3 = 0;
    }
    goto __pyx_L9;
    __pyx_L8:;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_5); __pyx_5 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":555 */
    __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 555; goto __pyx_L1;}
    __pyx_6 = PyErr_ExceptionMatches(__pyx_4);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_6) {
      __pyx_filename = __pyx_f[1]; __pyx_lineno = 555; __Pyx_AddTraceback("coio.gethostbyname_ex");
      PyErr_Fetch(&__pyx_5, &__pyx_2, &__pyx_7);
      if (__Pyx_NormalizeException(&__pyx_5, &__pyx_2, &__pyx_7) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 555; goto __pyx_L1;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_2;
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 556; goto __pyx_L1;}
      Py_INCREF(__pyx_v_e);
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_e);
      __pyx_4 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 556; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyTuple_New(3); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 556; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_4);
      Py_INCREF(__pyx_v_e);
      PyTuple_SET_ITEM(__pyx_3, 1, __pyx_v_e);
      Py_INCREF(Py_None);
      PyTuple_SET_ITEM(__pyx_3, 2, Py_None);
      __pyx_4 = 0;
      __pyx_4 = __pyx_f_4coio_raise_gaierror(__pyx_3,0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 556; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_XDECREF(__pyx_5); __pyx_5 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_7); __pyx_7 = 0;
      goto __pyx_L9;
    }
    goto __pyx_L1;
    __pyx_L9:;
  }
  __pyx_L7:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":557 */
  __pyx_3 = PyString_FromString(__pyx_v_name); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 557; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_v_canonical, __pyx_3, &__pyx_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 557; goto __pyx_L1;}
  __pyx_6 = __pyx_6 == 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_6) {
    __pyx_4 = PyString_FromString(__pyx_v_name); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 558; goto __pyx_L1;}
    __pyx_5 = PyList_New(0); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 558; goto __pyx_L1;}
    __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 558; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_5);
    Py_INCREF(__pyx_v_ips);
    PyTuple_SET_ITEM(__pyx_2, 2, __pyx_v_ips);
    __pyx_4 = 0;
    __pyx_5 = 0;
    __pyx_r = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L0;
    goto __pyx_L10;
  }
  /*else*/ {
    __pyx_7 = PyString_FromString(__pyx_v_name); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 560; goto __pyx_L1;}
    __pyx_3 = PyList_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 560; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_3, 0, __pyx_7);
    __pyx_7 = 0;
    __pyx_4 = PyTuple_New(3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 560; goto __pyx_L1;}
    Py_INCREF(__pyx_v_canonical);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_canonical);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    Py_INCREF(__pyx_v_ips);
    PyTuple_SET_ITEM(__pyx_4, 2, __pyx_v_ips);
    __pyx_3 = 0;
    __pyx_r = __pyx_4;
    __pyx_4 = 0;
    goto __pyx_L0;
  }
  __pyx_L10:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("coio.gethostbyname_ex");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_items);
  Py_DECREF(__pyx_v_ips);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_canonical);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_partial_getaddrinfo(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4coio_partial_getaddrinfo[] = "A partial implementation of socket.getaddrinfo.\n\n    Please note that this looks up only IPV4 addresses, and it returns\n    None as the canonical name.\n    ";
static PyObject *__pyx_f_4coio_partial_getaddrinfo(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_host;
  int __pyx_v_port;
  int __pyx_v_family;
  int __pyx_v_socktype;
  int __pyx_v_proto;
  int __pyx_v_flags;
  PyObject *__pyx_v_addrs;
  PyObject *__pyx_v_e;
  PyObject *__pyx_v_items;
  PyObject *__pyx_v_addr;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  char __pyx_5;
  char *__pyx_6;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  static char *__pyx_argnames[] = {"host","port","family","socktype","proto","flags",0};
  __pyx_v_proto = __pyx_d52;
  __pyx_v_flags = __pyx_d53;
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "siii|ii", __pyx_argnames, &__pyx_v_host, &__pyx_v_port, &__pyx_v_family, &__pyx_v_socktype, &__pyx_v_proto, &__pyx_v_flags)) return 0;
  __pyx_v_addrs = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);
  __pyx_v_items = Py_None; Py_INCREF(Py_None);
  __pyx_v_addr = Py_None; Py_INCREF(Py_None);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":574 */
  __pyx_1 = (__pyx_v_family == 0);
  if (__pyx_1) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 575; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_AF_INET); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 575; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 575; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_family = __pyx_1;
    goto __pyx_L2;
  }
  __pyx_2 = PyInt_FromLong(__pyx_v_family); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 576; goto __pyx_L1;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 576; goto __pyx_L1;}
  __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_AF_INET); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 576; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyObject_Cmp(__pyx_2, __pyx_4, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 576; goto __pyx_L1;}
  __pyx_1 = __pyx_1 != 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_1) {
    __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 577; goto __pyx_L1;}
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":578 */
  __pyx_3 = PyInt_FromLong(__pyx_v_socktype); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 578; goto __pyx_L1;}
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 578; goto __pyx_L1;}
  __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_n_SOCK_STREAM); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 578; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (PyObject_Cmp(__pyx_3, __pyx_4, &__pyx_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 578; goto __pyx_L1;}
  __pyx_1 = __pyx_1 != 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_1) {
    __Pyx_Raise(PyExc_NotImplementedError, 0, 0);
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 579; goto __pyx_L1;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":581 */
  __pyx_5 = __pyx_f_4coio_is_valid_ipv4(__pyx_v_host);
  if (__pyx_5) {
    __pyx_2 = PyString_FromString(__pyx_v_host); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 582; goto __pyx_L1;}
    __pyx_3 = PyList_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 582; goto __pyx_L1;}
    PyList_SET_ITEM(__pyx_3, 0, __pyx_2);
    __pyx_2 = 0;
    Py_DECREF(__pyx_v_addrs);
    __pyx_v_addrs = __pyx_3;
    __pyx_3 = 0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":584 */
    __pyx_5 = __pyx_f_4coio_is_valid_ipv6(__pyx_v_host);
    if (__pyx_5) {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 585; goto __pyx_L1;}
      __pyx_2 = PyObject_GetAttr(__pyx_4, __pyx_n_gaierror); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 585; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 586; goto __pyx_L1;}
      __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_n_EAI_ADDRFAMILY); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 586; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 585; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_4);
      Py_INCREF(__pyx_k164p);
      PyTuple_SET_ITEM(__pyx_3, 1, __pyx_k164p);
      __pyx_4 = 0;
      __pyx_4 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 585; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 585; goto __pyx_L1;}
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":588 */
    __pyx_2 = PyString_FromString(__pyx_v_host); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 588; goto __pyx_L1;}
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 588; goto __pyx_L1;}
    __pyx_1 = PySequence_Contains(__pyx_3, __pyx_2); if (__pyx_1 < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 588; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__pyx_1) {
      __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_n_names_by_nameip); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 589; goto __pyx_L1;}
      __pyx_2 = PyString_FromString(__pyx_v_host); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 589; goto __pyx_L1;}
      __pyx_3 = PyObject_GetItem(__pyx_4, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 589; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 589; goto __pyx_L1;}
      __pyx_2 = PyObject_GetItem(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 589; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_6 = PyString_AsString(__pyx_2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 589; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_host = __pyx_6;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":590 */
    /*try:*/ {
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_dns_resolve_ipv4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 592; goto __pyx_L7;}
      __pyx_4 = PyString_FromString(__pyx_v_host); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 592; goto __pyx_L7;}
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 592; goto __pyx_L7;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
      __pyx_4 = 0;
      __pyx_4 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 592; goto __pyx_L7;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_n_values); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 592; goto __pyx_L7;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_v_addrs);
      __pyx_v_addrs = __pyx_3;
      __pyx_3 = 0;
    }
    goto __pyx_L8;
    __pyx_L7:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":593 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_DnsLookupError); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 593; goto __pyx_L1;}
    __pyx_1 = PyErr_ExceptionMatches(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (__pyx_1) {
      __pyx_filename = __pyx_f[1]; __pyx_lineno = 593; __Pyx_AddTraceback("coio.partial_getaddrinfo");
      PyErr_Fetch(&__pyx_4, &__pyx_3, &__pyx_2);
      if (__Pyx_NormalizeException(&__pyx_4, &__pyx_3, &__pyx_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 593; goto __pyx_L1;}
      Py_INCREF(__pyx_3);
      Py_DECREF(__pyx_v_e);
      __pyx_v_e = __pyx_3;
      __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 594; goto __pyx_L1;}
      Py_INCREF(__pyx_v_e);
      PyTuple_SET_ITEM(__pyx_7, 0, __pyx_v_e);
      __pyx_8 = PyObject_CallObject(((PyObject *)(&PyType_Type)), __pyx_7); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 594; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      __pyx_7 = PyTuple_New(3); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 594; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_7, 0, __pyx_8);
      Py_INCREF(__pyx_v_e);
      PyTuple_SET_ITEM(__pyx_7, 1, __pyx_v_e);
      Py_INCREF(Py_None);
      PyTuple_SET_ITEM(__pyx_7, 2, Py_None);
      __pyx_8 = 0;
      __pyx_8 = __pyx_f_4coio_raise_gaierror(__pyx_7,0); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 594; goto __pyx_L1;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_8); __pyx_8 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      Py_XDECREF(__pyx_3); __pyx_3 = 0;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L8;
    }
    goto __pyx_L1;
    __pyx_L8:;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":596 */
  __pyx_7 = PyList_New(0); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 596; goto __pyx_L1;}
  Py_DECREF(__pyx_v_items);
  __pyx_v_items = __pyx_7;
  __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":597 */
  __pyx_8 = PyObject_GetIter(__pyx_v_addrs); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 597; goto __pyx_L1;}
  for (;;) {
    __pyx_4 = PyIter_Next(__pyx_8);
    if (!__pyx_4) {
      if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 597; goto __pyx_L1;}
      break;
    }
    Py_DECREF(__pyx_v_addr);
    __pyx_v_addr = __pyx_4;
    __pyx_4 = 0;
    __pyx_3 = PyObject_GetAttr(__pyx_v_items, __pyx_n_append); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    __pyx_2 = PyInt_FromLong(__pyx_v_family); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    __pyx_7 = PyInt_FromLong(__pyx_v_socktype); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    __pyx_4 = PyInt_FromLong(__pyx_v_proto); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    __pyx_9 = PyInt_FromLong(__pyx_v_port); if (!__pyx_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    __pyx_10 = PyTuple_New(2); if (!__pyx_10) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    Py_INCREF(__pyx_v_addr);
    PyTuple_SET_ITEM(__pyx_10, 0, __pyx_v_addr);
    PyTuple_SET_ITEM(__pyx_10, 1, __pyx_9);
    __pyx_9 = 0;
    __pyx_9 = PyTuple_New(5); if (!__pyx_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_9, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_9, 1, __pyx_7);
    PyTuple_SET_ITEM(__pyx_9, 2, __pyx_4);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_9, 3, Py_None);
    PyTuple_SET_ITEM(__pyx_9, 4, __pyx_10);
    __pyx_2 = 0;
    __pyx_7 = 0;
    __pyx_4 = 0;
    __pyx_10 = 0;
    __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_9);
    __pyx_9 = 0;
    __pyx_7 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
  }
  Py_DECREF(__pyx_8); __pyx_8 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":600 */
  Py_INCREF(__pyx_v_items);
  __pyx_r = __pyx_v_items;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  __Pyx_AddTraceback("coio.partial_getaddrinfo");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_addrs);
  Py_DECREF(__pyx_v_e);
  Py_DECREF(__pyx_v_items);
  Py_DECREF(__pyx_v_addr);
  return __pyx_r;
}

static PyObject *__pyx_f_4coio_get_main_loop_tasklet(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4coio_get_main_loop_tasklet(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "", __pyx_argnames)) return 0;
  Py_INCREF(((PyObject *)__pyx_v_4coio_main_loop_tasklet));
  __pyx_r = ((PyObject *)__pyx_v_4coio_main_loop_tasklet);
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_tp_new_4coio_nbfile(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbfile *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbfile *)o);
  p->close_ref = Py_None; Py_INCREF(Py_None);
  p->c_mode = Py_None; Py_INCREF(Py_None);
  p->c_name = Py_None; Py_INCREF(Py_None);
  p->c_read_exc_class = Py_None; Py_INCREF(Py_None);
  p->c_write_exc_class = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbfile(PyObject *o) {
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++o->ob_refcnt;
    __pyx_f_4coio_6nbfile___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --o->ob_refcnt;
    PyErr_Restore(etype, eval, etb);
  }
  Py_XDECREF(p->close_ref);
  Py_XDECREF(p->c_mode);
  Py_XDECREF(p->c_name);
  Py_XDECREF(p->c_read_exc_class);
  Py_XDECREF(p->c_write_exc_class);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbfile(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  if (p->close_ref) {
    e = (*v)(p->close_ref, a); if (e) return e;
  }
  if (p->c_mode) {
    e = (*v)(p->c_mode, a); if (e) return e;
  }
  if (p->c_name) {
    e = (*v)(p->c_name, a); if (e) return e;
  }
  if (p->c_read_exc_class) {
    e = (*v)(p->c_read_exc_class, a); if (e) return e;
  }
  if (p->c_write_exc_class) {
    e = (*v)(p->c_write_exc_class, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbfile(PyObject *o) {
  struct __pyx_obj_4coio_nbfile *p = (struct __pyx_obj_4coio_nbfile *)o;
  PyObject *t;
  t = p->close_ref; 
  p->close_ref = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->c_mode; 
  p->c_mode = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->c_name; 
  p->c_name = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->c_read_exc_class; 
  p->c_read_exc_class = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->c_write_exc_class; 
  p->c_write_exc_class = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_6nbfile_closed(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_6closed___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_do_close(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_8do_close___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_limit(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_10read_limit___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_read_limit(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_6nbfile_10read_limit___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_exc_class(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_14read_exc_class___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_read_exc_class(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_6nbfile_14read_exc_class___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_write_exc_class(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_15write_exc_class___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_write_exc_class(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_6nbfile_15write_exc_class___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_mode(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_4mode___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_name(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_4name___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_softspace(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_9softspace___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_softspace(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_6nbfile_9softspace___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_6nbfile_encoding(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_8encoding___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_newlines(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_8newlines___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_errors(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_6errors___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_buffer_len(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_15read_buffer_len___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_buffer_misalign(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_20read_buffer_misalign___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_read_buffer_totallen(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_20read_buffer_totallen___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_write_buffer_len(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_16write_buffer_len___get__(o);
}

static PyObject *__pyx_getprop_4coio_6nbfile_write_buffer_limit(PyObject *o, void *x) {
  return __pyx_f_4coio_6nbfile_18write_buffer_limit___get__(o);
}

static int __pyx_setprop_4coio_6nbfile_write_buffer_limit(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_6nbfile_18write_buffer_limit___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static struct PyMethodDef __pyx_methods_4coio_nbfile[] = {
  {"fileno", (PyCFunction)__pyx_f_4coio_6nbfile_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"write_fileno", (PyCFunction)__pyx_f_4coio_6nbfile_write_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"forget_write_fd", (PyCFunction)__pyx_f_4coio_6nbfile_forget_write_fd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_forget_write_fd},
  {"close", (PyCFunction)__pyx_f_4coio_6nbfile_close, METH_VARARGS|METH_KEYWORDS, 0},
  {"unread", (PyCFunction)__pyx_f_4coio_6nbfile_unread, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_unread},
  {"unread_append", (PyCFunction)__pyx_f_4coio_6nbfile_unread_append, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_unread_append},
  {"write", (PyCFunction)__pyx_f_4coio_6nbfile_write, METH_VARARGS|METH_KEYWORDS, 0},
  {"flush", (PyCFunction)__pyx_f_4coio_6nbfile_flush, METH_VARARGS|METH_KEYWORDS, 0},
  {"discard_write_buffer", (PyCFunction)__pyx_f_4coio_6nbfile_discard_write_buffer, METH_VARARGS|METH_KEYWORDS, 0},
  {"discard", (PyCFunction)__pyx_f_4coio_6nbfile_discard, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_discard},
  {"discard_to_read_limit", (PyCFunction)__pyx_f_4coio_6nbfile_discard_to_read_limit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_discard_to_read_limit},
  {"wait_for_readable", (PyCFunction)__pyx_f_4coio_6nbfile_wait_for_readable, METH_VARARGS|METH_KEYWORDS, 0},
  {"read", (PyCFunction)__pyx_f_4coio_6nbfile_read, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_read},
  {"read_at_most", (PyCFunction)__pyx_f_4coio_6nbfile_read_at_most, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_read_at_most},
  {"read_upto", (PyCFunction)__pyx_f_4coio_6nbfile_read_upto, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_read_upto},
  {"read_more", (PyCFunction)__pyx_f_4coio_6nbfile_read_more, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_read_more},
  {"find", (PyCFunction)__pyx_f_4coio_6nbfile_find, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_find},
  {"rfind", (PyCFunction)__pyx_f_4coio_6nbfile_rfind, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_rfind},
  {"get_string", (PyCFunction)__pyx_f_4coio_6nbfile_get_string, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_get_string},
  {"get_read_buffer", (PyCFunction)__pyx_f_4coio_6nbfile_get_read_buffer, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_6nbfile_get_read_buffer},
  {"readline", (PyCFunction)__pyx_f_4coio_6nbfile_readline, METH_VARARGS|METH_KEYWORDS, 0},
  {"xreadlines", (PyCFunction)__pyx_f_4coio_6nbfile_xreadlines, METH_VARARGS|METH_KEYWORDS, 0},
  {"readlines", (PyCFunction)__pyx_f_4coio_6nbfile_readlines, METH_VARARGS|METH_KEYWORDS, 0},
  {"writelines", (PyCFunction)__pyx_f_4coio_6nbfile_writelines, METH_VARARGS|METH_KEYWORDS, 0},
  {"isatty", (PyCFunction)__pyx_f_4coio_6nbfile_isatty, METH_VARARGS|METH_KEYWORDS, 0},
  {"truncate", (PyCFunction)__pyx_f_4coio_6nbfile_truncate, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbfile[] = {
  {"closed", __pyx_getprop_4coio_6nbfile_closed, 0, 0, 0},
  {"do_close", __pyx_getprop_4coio_6nbfile_do_close, 0, 0, 0},
  {"read_limit", __pyx_getprop_4coio_6nbfile_read_limit, __pyx_setprop_4coio_6nbfile_read_limit, __pyx_k173, 0},
  {"read_exc_class", __pyx_getprop_4coio_6nbfile_read_exc_class, __pyx_setprop_4coio_6nbfile_read_exc_class, 0, 0},
  {"write_exc_class", __pyx_getprop_4coio_6nbfile_write_exc_class, __pyx_setprop_4coio_6nbfile_write_exc_class, 0, 0},
  {"mode", __pyx_getprop_4coio_6nbfile_mode, 0, 0, 0},
  {"name", __pyx_getprop_4coio_6nbfile_name, 0, 0, 0},
  {"softspace", __pyx_getprop_4coio_6nbfile_softspace, __pyx_setprop_4coio_6nbfile_softspace, 0, 0},
  {"encoding", __pyx_getprop_4coio_6nbfile_encoding, 0, 0, 0},
  {"newlines", __pyx_getprop_4coio_6nbfile_newlines, 0, 0, 0},
  {"errors", __pyx_getprop_4coio_6nbfile_errors, 0, 0, 0},
  {"read_buffer_len", __pyx_getprop_4coio_6nbfile_read_buffer_len, 0, 0, 0},
  {"read_buffer_misalign", __pyx_getprop_4coio_6nbfile_read_buffer_misalign, 0, 0, 0},
  {"read_buffer_totallen", __pyx_getprop_4coio_6nbfile_read_buffer_totallen, 0, 0, 0},
  {"write_buffer_len", __pyx_getprop_4coio_6nbfile_write_buffer_len, 0, 0, 0},
  {"write_buffer_limit", __pyx_getprop_4coio_6nbfile_write_buffer_limit, __pyx_setprop_4coio_6nbfile_write_buffer_limit, __pyx_k174, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbfile = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbfile = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbfile = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbfile = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_nbfile = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.nbfile", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbfile), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbfile, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbfile, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbfile, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbfile, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbfile, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "A non-blocking file (I/O channel).\n\n    The filehandles are assumed to be non-blocking.\n\n    Please note that nbfile supports line buffering (write_buffer_limit=1),\n    but it doesn\'t set up write buffering by default for terminal devices.\n    For that, please use our fdopen (defined below).\n\n    Please note that changing self.write_buffer_limit doesn\'t flush the\n    write buffer, but it will affect subsequent self.write(...) operations.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_nbfile, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbfile, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_f_4coio_6nbfile___iter__, /*tp_iter*/
  __pyx_f_4coio_6nbfile___next__, /*tp_iternext*/
  __pyx_methods_4coio_nbfile, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbfile, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_6nbfile___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbfile, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_nbsocket(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbsocket *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbsocket *)o);
  p->realsock = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++o->ob_refcnt;
    __pyx_f_4coio_8nbsocket___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --o->ob_refcnt;
    PyErr_Restore(etype, eval, etb);
  }
  Py_XDECREF(p->realsock);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbsocket(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  if (p->realsock) {
    e = (*v)(p->realsock, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsocket *p = (struct __pyx_obj_4coio_nbsocket *)o;
  PyObject *t;
  t = p->realsock; 
  p->realsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_8nbsocket_do_close(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_8do_close___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket__sock(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_5_sock___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_type(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_4type___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_family(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_6family___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_timeout(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_7timeout___get__(o);
}

static PyObject *__pyx_getprop_4coio_8nbsocket_proto(PyObject *o, void *x) {
  return __pyx_f_4coio_8nbsocket_5proto___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbsocket[] = {
  {"fileno", (PyCFunction)__pyx_f_4coio_8nbsocket_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"dup", (PyCFunction)__pyx_f_4coio_8nbsocket_dup, METH_VARARGS|METH_KEYWORDS, 0},
  {"close", (PyCFunction)__pyx_f_4coio_8nbsocket_close, METH_VARARGS|METH_KEYWORDS, 0},
  {"setdoclose", (PyCFunction)__pyx_f_4coio_8nbsocket_setdoclose, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8nbsocket_setdoclose},
  {"setsockopt", (PyCFunction)__pyx_f_4coio_8nbsocket_setsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockopt", (PyCFunction)__pyx_f_4coio_8nbsocket_getsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockname", (PyCFunction)__pyx_f_4coio_8nbsocket_getsockname, METH_VARARGS|METH_KEYWORDS, 0},
  {"getpeername", (PyCFunction)__pyx_f_4coio_8nbsocket_getpeername, METH_VARARGS|METH_KEYWORDS, 0},
  {"bind", (PyCFunction)__pyx_f_4coio_8nbsocket_bind, METH_VARARGS|METH_KEYWORDS, 0},
  {"listen", (PyCFunction)__pyx_f_4coio_8nbsocket_listen, METH_VARARGS|METH_KEYWORDS, 0},
  {"gettimeout", (PyCFunction)__pyx_f_4coio_8nbsocket_gettimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"setblocking", (PyCFunction)__pyx_f_4coio_8nbsocket_setblocking, METH_VARARGS|METH_KEYWORDS, 0},
  {"settimeout", (PyCFunction)__pyx_f_4coio_8nbsocket_settimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"accept", (PyCFunction)__pyx_f_4coio_8nbsocket_accept, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect", (PyCFunction)__pyx_f_4coio_8nbsocket_connect, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect_ex", (PyCFunction)__pyx_f_4coio_8nbsocket_connect_ex, METH_VARARGS|METH_KEYWORDS, 0},
  {"shutdown", (PyCFunction)__pyx_f_4coio_8nbsocket_shutdown, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv", (PyCFunction)__pyx_f_4coio_8nbsocket_recv, METH_VARARGS|METH_KEYWORDS, 0},
  {"recvfrom", (PyCFunction)__pyx_f_4coio_8nbsocket_recvfrom, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv_into", (PyCFunction)__pyx_f_4coio_8nbsocket_recv_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"recvfrom_into", (PyCFunction)__pyx_f_4coio_8nbsocket_recvfrom_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"send", (PyCFunction)__pyx_f_4coio_8nbsocket_send, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendto", (PyCFunction)__pyx_f_4coio_8nbsocket_sendto, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendall", (PyCFunction)__pyx_f_4coio_8nbsocket_sendall, METH_VARARGS|METH_KEYWORDS, 0},
  {"makefile_samefd", (PyCFunction)__pyx_f_4coio_8nbsocket_makefile_samefd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8nbsocket_makefile_samefd},
  {"makefile", (PyCFunction)__pyx_f_4coio_8nbsocket_makefile, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_8nbsocket_makefile},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbsocket[] = {
  {"do_close", __pyx_getprop_4coio_8nbsocket_do_close, 0, 0, 0},
  {"_sock", __pyx_getprop_4coio_8nbsocket__sock, 0, __pyx_k175, 0},
  {"type", __pyx_getprop_4coio_8nbsocket_type, 0, 0, 0},
  {"family", __pyx_getprop_4coio_8nbsocket_family, 0, 0, 0},
  {"timeout", __pyx_getprop_4coio_8nbsocket_timeout, 0, __pyx_k176, 0},
  {"proto", __pyx_getprop_4coio_8nbsocket_proto, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbsocket = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbsocket = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbsocket = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbsocket = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_nbsocket = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.nbsocket", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbsocket), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbsocket, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbsocket, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbsocket, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbsocket, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbsocket, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Non-blocking drop-in replacement class for socket.socket.\n\n    See the function new_realsocket for using this class as a replacement for\n    socket._realsocket.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_nbsocket, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbsocket, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_nbsocket, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbsocket, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_8nbsocket___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbsocket, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_nbsslsocket(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_nbsslsocket *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_nbsslsocket *)o);
  p->realsock = Py_None; Py_INCREF(Py_None);
  p->sslsock = Py_None; Py_INCREF(Py_None);
  p->sslobj = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_nbsslsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++o->ob_refcnt;
    __pyx_f_4coio_11nbsslsocket___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --o->ob_refcnt;
    PyErr_Restore(etype, eval, etb);
  }
  Py_XDECREF(p->realsock);
  Py_XDECREF(p->sslsock);
  Py_XDECREF(p->sslobj);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_nbsslsocket(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  if (p->realsock) {
    e = (*v)(p->realsock, a); if (e) return e;
  }
  if (p->sslsock) {
    e = (*v)(p->sslsock, a); if (e) return e;
  }
  if (p->sslobj) {
    e = (*v)(p->sslobj, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_nbsslsocket(PyObject *o) {
  struct __pyx_obj_4coio_nbsslsocket *p = (struct __pyx_obj_4coio_nbsslsocket *)o;
  PyObject *t;
  t = p->realsock; 
  p->realsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->sslsock; 
  p->sslsock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->sslobj; 
  p->sslobj = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_type(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_4type___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_family(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_6family___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_proto(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_5proto___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sslobj(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_7_sslobj___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sock(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_5_sock___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__sslsock(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_8_sslsock___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_keyfile(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_7keyfile___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_certfile(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_8certfile___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_cert_reqs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_9cert_reqs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_ssl_version(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_11ssl_version___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_ca_certs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_8ca_certs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_do_handshake_on_connect(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___get__(o);
}

static int __pyx_setprop_4coio_11nbsslsocket_do_handshake_on_connect(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_f_4coio_11nbsslsocket_23do_handshake_on_connect___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_suppress_ragged_eofs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_20suppress_ragged_eofs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket__makefile_refs(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_14_makefile_refs___get__(o);
}

static PyObject *__pyx_getprop_4coio_11nbsslsocket_timeout(PyObject *o, void *x) {
  return __pyx_f_4coio_11nbsslsocket_7timeout___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_nbsslsocket[] = {
  {"fileno", (PyCFunction)__pyx_f_4coio_11nbsslsocket_fileno, METH_VARARGS|METH_KEYWORDS, 0},
  {"dup", (PyCFunction)__pyx_f_4coio_11nbsslsocket_dup, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_dup},
  {"close", (PyCFunction)__pyx_f_4coio_11nbsslsocket_close, METH_VARARGS|METH_KEYWORDS, 0},
  {"setsockopt", (PyCFunction)__pyx_f_4coio_11nbsslsocket_setsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockopt", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getsockopt, METH_VARARGS|METH_KEYWORDS, 0},
  {"getsockname", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getsockname, METH_VARARGS|METH_KEYWORDS, 0},
  {"getpeername", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getpeername, METH_VARARGS|METH_KEYWORDS, 0},
  {"bind", (PyCFunction)__pyx_f_4coio_11nbsslsocket_bind, METH_VARARGS|METH_KEYWORDS, 0},
  {"listen", (PyCFunction)__pyx_f_4coio_11nbsslsocket_listen, METH_VARARGS|METH_KEYWORDS, 0},
  {"gettimeout", (PyCFunction)__pyx_f_4coio_11nbsslsocket_gettimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"setblocking", (PyCFunction)__pyx_f_4coio_11nbsslsocket_setblocking, METH_VARARGS|METH_KEYWORDS, 0},
  {"settimeout", (PyCFunction)__pyx_f_4coio_11nbsslsocket_settimeout, METH_VARARGS|METH_KEYWORDS, 0},
  {"read", (PyCFunction)__pyx_f_4coio_11nbsslsocket_read, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_read},
  {"write", (PyCFunction)__pyx_f_4coio_11nbsslsocket_write, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_write},
  {"accept", (PyCFunction)__pyx_f_4coio_11nbsslsocket_accept, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect", (PyCFunction)__pyx_f_4coio_11nbsslsocket_connect, METH_VARARGS|METH_KEYWORDS, 0},
  {"connect_ex", (PyCFunction)__pyx_f_4coio_11nbsslsocket_connect_ex, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_connect_ex},
  {"shutdown", (PyCFunction)__pyx_f_4coio_11nbsslsocket_shutdown, METH_VARARGS|METH_KEYWORDS, 0},
  {"pending", (PyCFunction)__pyx_f_4coio_11nbsslsocket_pending, METH_VARARGS|METH_KEYWORDS, 0},
  {"unwrap", (PyCFunction)__pyx_f_4coio_11nbsslsocket_unwrap, METH_VARARGS|METH_KEYWORDS, 0},
  {"do_handshake", (PyCFunction)__pyx_f_4coio_11nbsslsocket_do_handshake, METH_VARARGS|METH_KEYWORDS, 0},
  {"getpeercert", (PyCFunction)__pyx_f_4coio_11nbsslsocket_getpeercert, METH_VARARGS|METH_KEYWORDS, 0},
  {"cipher", (PyCFunction)__pyx_f_4coio_11nbsslsocket_cipher, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recv, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_recv},
  {"recvfrom", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recvfrom, METH_VARARGS|METH_KEYWORDS, 0},
  {"recv_into", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recv_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"recvfrom_into", (PyCFunction)__pyx_f_4coio_11nbsslsocket_recvfrom_into, METH_VARARGS|METH_KEYWORDS, 0},
  {"send", (PyCFunction)__pyx_f_4coio_11nbsslsocket_send, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendto", (PyCFunction)__pyx_f_4coio_11nbsslsocket_sendto, METH_VARARGS|METH_KEYWORDS, 0},
  {"sendall", (PyCFunction)__pyx_f_4coio_11nbsslsocket_sendall, METH_VARARGS|METH_KEYWORDS, 0},
  {"makefile", (PyCFunction)__pyx_f_4coio_11nbsslsocket_makefile, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11nbsslsocket_makefile},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_nbsslsocket[] = {
  {"type", __pyx_getprop_4coio_11nbsslsocket_type, 0, 0, 0},
  {"family", __pyx_getprop_4coio_11nbsslsocket_family, 0, 0, 0},
  {"proto", __pyx_getprop_4coio_11nbsslsocket_proto, 0, 0, 0},
  {"_sslobj", __pyx_getprop_4coio_11nbsslsocket__sslobj, 0, 0, 0},
  {"_sock", __pyx_getprop_4coio_11nbsslsocket__sock, 0, 0, 0},
  {"_sslsock", __pyx_getprop_4coio_11nbsslsocket__sslsock, 0, __pyx_k177, 0},
  {"keyfile", __pyx_getprop_4coio_11nbsslsocket_keyfile, 0, 0, 0},
  {"certfile", __pyx_getprop_4coio_11nbsslsocket_certfile, 0, 0, 0},
  {"cert_reqs", __pyx_getprop_4coio_11nbsslsocket_cert_reqs, 0, 0, 0},
  {"ssl_version", __pyx_getprop_4coio_11nbsslsocket_ssl_version, 0, 0, 0},
  {"ca_certs", __pyx_getprop_4coio_11nbsslsocket_ca_certs, 0, 0, 0},
  {"do_handshake_on_connect", __pyx_getprop_4coio_11nbsslsocket_do_handshake_on_connect, __pyx_setprop_4coio_11nbsslsocket_do_handshake_on_connect, 0, 0},
  {"suppress_ragged_eofs", __pyx_getprop_4coio_11nbsslsocket_suppress_ragged_eofs, 0, 0, 0},
  {"_makefile_refs", __pyx_getprop_4coio_11nbsslsocket__makefile_refs, 0, 0, 0},
  {"timeout", __pyx_getprop_4coio_11nbsslsocket_timeout, 0, __pyx_k178, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_nbsslsocket = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_nbsslsocket = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_nbsslsocket = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_nbsslsocket = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_nbsslsocket = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.nbsslsocket", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_nbsslsocket), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_nbsslsocket, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_nbsslsocket, /*tp_as_number*/
  &__pyx_tp_as_sequence_nbsslsocket, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_nbsslsocket, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_nbsslsocket, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Non-blocking drop-in replacement class for ssl.SSLSocket.\n\n    Please note that this class is not as speed-optimized as nbsocket or\n    nbfile, because how the `ssl\' module provides abstractions.\n\n    Just like ssl.SSLSocket, nbsslsocket uses a socket._realsocket\n    (derived from the first constructor argument) for the underlying raw\n    communication.\n\n    Just like ssl.SSLSocket, please don\'t communicate using the unerlying socket._realsocket\n    after the nbsslsocket has been created -- but close it when\n    necessary. Just like ssl.SSLSocket, nbsslsocket will never call the\n    .close() method of the underlying socket._realsocket, it will just\n    drop reference to it.\n\n    Args:\n      args: Same arguments as to the ssl.SSLSocket constructor.\n        ssl.SSLSocket requires a socket.socket as a first argument, and\n        derives its underlying the socket._realsocket from its first\n        argument (using the ._sock property). As an exterions to this,\n        nbsslsocket accepts a socket.socket, socket._realsocket or\n        nbsocket (all treated equvalently) in its first argument, and gets\n        its underlying socket._realsocket accordingly.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_nbsslsocket, /*tp_traverse*/
  __pyx_tp_clear_4coio_nbsslsocket, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_nbsslsocket, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_nbsslsocket, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_11nbsslsocket___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_nbsslsocket, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_sockwrapper(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_sockwrapper *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_sockwrapper *)o);
  p->c_sock = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_sockwrapper(PyObject *o) {
  struct __pyx_obj_4coio_sockwrapper *p = (struct __pyx_obj_4coio_sockwrapper *)o;
  Py_XDECREF(p->c_sock);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_sockwrapper(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_sockwrapper *p = (struct __pyx_obj_4coio_sockwrapper *)o;
  if (p->c_sock) {
    e = (*v)(p->c_sock, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_sockwrapper(PyObject *o) {
  struct __pyx_obj_4coio_sockwrapper *p = (struct __pyx_obj_4coio_sockwrapper *)o;
  PyObject *t;
  t = p->c_sock; 
  p->c_sock = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_11sockwrapper__sock(PyObject *o, void *x) {
  return __pyx_f_4coio_11sockwrapper_5_sock___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_sockwrapper[] = {
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_sockwrapper[] = {
  {"_sock", __pyx_getprop_4coio_11sockwrapper__sock, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_sockwrapper = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_sockwrapper = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_sockwrapper = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_sockwrapper = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_sockwrapper = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.sockwrapper", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_sockwrapper), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_sockwrapper, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_sockwrapper, /*tp_as_number*/
  &__pyx_tp_as_sequence_sockwrapper, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_sockwrapper, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_sockwrapper, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "A helper class for holding a self._sock.", /*tp_doc*/
  __pyx_tp_traverse_4coio_sockwrapper, /*tp_traverse*/
  __pyx_tp_clear_4coio_sockwrapper, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_sockwrapper, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_sockwrapper, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_11sockwrapper___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_sockwrapper, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_selecter(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_selecter *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_selecter *)o);
  p->readable_fds = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  p->writeable_fds = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  p->wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_selecter(PyObject *o) {
  struct __pyx_obj_4coio_selecter *p = (struct __pyx_obj_4coio_selecter *)o;
  Py_XDECREF(((PyObject *)p->readable_fds));
  Py_XDECREF(((PyObject *)p->writeable_fds));
  Py_XDECREF(((PyObject *)p->wakeup_tasklet));
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_selecter(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_selecter *p = (struct __pyx_obj_4coio_selecter *)o;
  if (p->readable_fds) {
    e = (*v)(((PyObject*)p->readable_fds), a); if (e) return e;
  }
  if (p->writeable_fds) {
    e = (*v)(((PyObject*)p->writeable_fds), a); if (e) return e;
  }
  if (p->wakeup_tasklet) {
    e = (*v)(((PyObject*)p->wakeup_tasklet), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_selecter(PyObject *o) {
  struct __pyx_obj_4coio_selecter *p = (struct __pyx_obj_4coio_selecter *)o;
  PyObject *t;
  t = ((PyObject *)p->readable_fds); 
  p->readable_fds = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = ((PyObject *)p->writeable_fds); 
  p->writeable_fds = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = ((PyObject *)p->wakeup_tasklet); 
  p->wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static struct PyMethodDef __pyx_methods_4coio_selecter[] = {
  {"__destroy__", (PyCFunction)__pyx_f_4coio_8selecter___destroy__, METH_VARARGS|METH_KEYWORDS, 0},
  {"do_select", (PyCFunction)__pyx_f_4coio_8selecter_do_select, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_selecter = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_selecter = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_selecter = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_selecter = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_selecter = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.selecter", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_selecter), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_selecter, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_selecter, /*tp_as_number*/
  &__pyx_tp_as_sequence_selecter, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_selecter, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_selecter, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Helper class for the select() emulation. Call coio.select instead.\n\n    The caller must ensure that there are no multiple self.do_select() calls\n    on the same selecter object. That\'s because some instance variables are\n    shared.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_selecter, /*tp_traverse*/
  __pyx_tp_clear_4coio_selecter, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_selecter, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_selecter, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_wakeup_info(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_wakeup_info *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_wakeup_info *)o);
  p->wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  p->c_pending_events = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  if (__pyx_f_4coio_11wakeup_info___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_4coio_wakeup_info(PyObject *o) {
  struct __pyx_obj_4coio_wakeup_info *p = (struct __pyx_obj_4coio_wakeup_info *)o;
  Py_XDECREF(((PyObject *)p->wakeup_tasklet));
  Py_XDECREF(((PyObject *)p->c_pending_events));
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_wakeup_info(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_wakeup_info *p = (struct __pyx_obj_4coio_wakeup_info *)o;
  if (p->wakeup_tasklet) {
    e = (*v)(((PyObject*)p->wakeup_tasklet), a); if (e) return e;
  }
  if (p->c_pending_events) {
    e = (*v)(((PyObject*)p->c_pending_events), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_wakeup_info(PyObject *o) {
  struct __pyx_obj_4coio_wakeup_info *p = (struct __pyx_obj_4coio_wakeup_info *)o;
  PyObject *t;
  t = ((PyObject *)p->wakeup_tasklet); 
  p->wakeup_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = ((PyObject *)p->c_pending_events); 
  p->c_pending_events = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_11wakeup_info_pending_events(PyObject *o, void *x) {
  return __pyx_f_4coio_11wakeup_info_14pending_events___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_wakeup_info[] = {
  {"create_event", (PyCFunction)__pyx_f_4coio_11wakeup_info_create_event, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11wakeup_info_create_event},
  {"tick", (PyCFunction)__pyx_f_4coio_11wakeup_info_tick, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11wakeup_info_tick},
  {"tick_and_move", (PyCFunction)__pyx_f_4coio_11wakeup_info_tick_and_move, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_11wakeup_info_tick_and_move},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_wakeup_info[] = {
  {"pending_events", __pyx_getprop_4coio_11wakeup_info_pending_events, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_wakeup_info = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_wakeup_info = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_wakeup_info = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_wakeup_info = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_wakeup_info = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.wakeup_info", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_wakeup_info), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_wakeup_info, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_wakeup_info, /*tp_as_number*/
  &__pyx_tp_as_sequence_wakeup_info, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_wakeup_info, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_wakeup_info, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Information for event handlers to wake up the main loop tasklet.\n\n    In the various methods, mode is an or-ed bitmask of 1 for reading, and\n    2 for writing.    \n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_wakeup_info, /*tp_traverse*/
  __pyx_tp_clear_4coio_wakeup_info, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_wakeup_info, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_wakeup_info, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_wakeup_info, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_wakeup_info_event(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_wakeup_info_event *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_wakeup_info_event *)o);
  p->wakeup_info_obj = ((struct __pyx_obj_4coio_wakeup_info *)Py_None); Py_INCREF(Py_None);
  if (__pyx_f_4coio_17wakeup_info_event___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_4coio_wakeup_info_event(PyObject *o) {
  struct __pyx_obj_4coio_wakeup_info_event *p = (struct __pyx_obj_4coio_wakeup_info_event *)o;
  Py_XDECREF(((PyObject *)p->wakeup_info_obj));
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_wakeup_info_event(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_wakeup_info_event *p = (struct __pyx_obj_4coio_wakeup_info_event *)o;
  if (p->wakeup_info_obj) {
    e = (*v)(((PyObject*)p->wakeup_info_obj), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_wakeup_info_event(PyObject *o) {
  struct __pyx_obj_4coio_wakeup_info_event *p = (struct __pyx_obj_4coio_wakeup_info_event *)o;
  PyObject *t;
  t = ((PyObject *)p->wakeup_info_obj); 
  p->wakeup_info_obj = ((struct __pyx_obj_4coio_wakeup_info *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static struct PyMethodDef __pyx_methods_4coio_wakeup_info_event[] = {
  {"delete", (PyCFunction)__pyx_f_4coio_17wakeup_info_event_delete, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_wakeup_info_event = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_wakeup_info_event = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_wakeup_info_event = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_wakeup_info_event = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_wakeup_info_event = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.wakeup_info_event", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_wakeup_info_event), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_wakeup_info_event, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_wakeup_info_event, /*tp_as_number*/
  &__pyx_tp_as_sequence_wakeup_info_event, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_wakeup_info_event, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_wakeup_info_event, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_4coio_wakeup_info_event, /*tp_traverse*/
  __pyx_tp_clear_4coio_wakeup_info_event, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_wakeup_info_event, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_wakeup_info_event, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_signal_event(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  if (__pyx_f_4coio_12signal_event___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_4coio_signal_event(PyObject *o) {
  (*o->ob_type->tp_free)(o);
}

static struct PyMethodDef __pyx_methods_4coio_signal_event[] = {
  {"delete", (PyCFunction)__pyx_f_4coio_12signal_event_delete, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_signal_event = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_signal_event = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_signal_event = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_signal_event = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_signal_event = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.signal_event", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_signal_event), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_signal_event, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_signal_event, /*tp_as_number*/
  &__pyx_tp_as_sequence_signal_event, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_signal_event, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_signal_event, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_signal_event, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_signal_event, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_concurrence_event(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_concurrence_event *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_concurrence_event *)o);
  p->evtype = Py_None; Py_INCREF(Py_None);
  p->callback = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4coio_concurrence_event(PyObject *o) {
  struct __pyx_obj_4coio_concurrence_event *p = (struct __pyx_obj_4coio_concurrence_event *)o;
  Py_XDECREF(p->evtype);
  Py_XDECREF(p->callback);
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_concurrence_event(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_concurrence_event *p = (struct __pyx_obj_4coio_concurrence_event *)o;
  if (p->evtype) {
    e = (*v)(p->evtype, a); if (e) return e;
  }
  if (p->callback) {
    e = (*v)(p->callback, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_concurrence_event(PyObject *o) {
  struct __pyx_obj_4coio_concurrence_event *p = (struct __pyx_obj_4coio_concurrence_event *)o;
  PyObject *t;
  t = p->evtype; 
  p->evtype = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  t = p->callback; 
  p->callback = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static struct PyMethodDef __pyx_methods_4coio_concurrence_event[] = {
  {"add", (PyCFunction)__pyx_f_4coio_17concurrence_event_add, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_17concurrence_event_add},
  {"pending", (PyCFunction)__pyx_f_4coio_17concurrence_event_pending, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_17concurrence_event_pending},
  {"delete", (PyCFunction)__pyx_f_4coio_17concurrence_event_delete, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_17concurrence_event_delete},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_concurrence_event = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_concurrence_event = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_concurrence_event = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_concurrence_event = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_concurrence_event = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.concurrence_event", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_concurrence_event), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_concurrence_event, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_f_4coio_17concurrence_event___repr__, /*tp_repr*/
  &__pyx_tp_as_number_concurrence_event, /*tp_as_number*/
  &__pyx_tp_as_sequence_concurrence_event, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_concurrence_event, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_concurrence_event, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "event(callback, evtype=0, handle=None) -> event object\n    \n    Create a new event object with a user callback.\n\n    Arguments:\n\n    callback -- user callback with (ev, handle, evtype, arg) prototype\n    arg      -- optional callback arguments\n    evtype   -- bitmask of EV_READ or EV_WRITE, or EV_SIGNAL\n    handle   -- for EV_READ or EV_WRITE, a file handle, descriptor, or socket\n                for EV_SIGNAL, a signal number\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_concurrence_event, /*tp_traverse*/
  __pyx_tp_clear_4coio_concurrence_event, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_concurrence_event, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_f_4coio_17concurrence_event___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_concurrence_event, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_4coio_dnsresult(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_4coio_dnsresult *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_4coio_dnsresult *)o);
  p->_values = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  if (__pyx_f_4coio_9dnsresult___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_4coio_dnsresult(PyObject *o) {
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  Py_XDECREF(((PyObject *)p->_values));
  (*o->ob_type->tp_free)(o);
}

static int __pyx_tp_traverse_4coio_dnsresult(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  if (p->_values) {
    e = (*v)(((PyObject*)p->_values), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4coio_dnsresult(PyObject *o) {
  struct __pyx_obj_4coio_dnsresult *p = (struct __pyx_obj_4coio_dnsresult *)o;
  PyObject *t;
  t = ((PyObject *)p->_values); 
  p->_values = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(t);
  return 0;
}

static PyObject *__pyx_getprop_4coio_9dnsresult_t(PyObject *o, void *x) {
  return __pyx_f_4coio_9dnsresult_1t___get__(o);
}

static PyObject *__pyx_getprop_4coio_9dnsresult_ttl(PyObject *o, void *x) {
  return __pyx_f_4coio_9dnsresult_3ttl___get__(o);
}

static PyObject *__pyx_getprop_4coio_9dnsresult_values(PyObject *o, void *x) {
  return __pyx_f_4coio_9dnsresult_6values___get__(o);
}

static struct PyMethodDef __pyx_methods_4coio_dnsresult[] = {
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4coio_dnsresult[] = {
  {"t", __pyx_getprop_4coio_9dnsresult_t, 0, 0, 0},
  {"ttl", __pyx_getprop_4coio_9dnsresult_ttl, 0, 0, 0},
  {"values", __pyx_getprop_4coio_9dnsresult_values, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_dnsresult = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  0, /*nb_divide*/
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  0, /*nb_coerce*/
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  0, /*nb_oct*/
  0, /*nb_hex*/
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  0, /*nb_inplace_divide*/
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_dnsresult = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_dnsresult = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_dnsresult = {
  0, /*bf_getreadbuffer*/
  0, /*bf_getwritebuffer*/
  0, /*bf_getsegcount*/
  0, /*bf_getcharbuffer*/
};

PyTypeObject __pyx_type_4coio_dnsresult = {
  PyObject_HEAD_INIT(0)
  0, /*ob_size*/
  "coio.dnsresult", /*tp_name*/
  sizeof(struct __pyx_obj_4coio_dnsresult), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4coio_dnsresult, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_f_4coio_9dnsresult___repr__, /*tp_repr*/
  &__pyx_tp_as_number_dnsresult, /*tp_as_number*/
  &__pyx_tp_as_sequence_dnsresult, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_dnsresult, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_dnsresult, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "Result of a DNS lookup call.\n\n    Attributes;\n      t: DNS record type constant, e.g. DNS_IPv4_A\n      ttl: time-to-live: number of seconds the result can be cached until\n      values: Nonempty list of ASCII strings containing result values. The\n        first value should be used by default. Repeating the query might\n        return the same values in different order.\n    ", /*tp_doc*/
  __pyx_tp_traverse_4coio_dnsresult, /*tp_traverse*/
  __pyx_tp_clear_4coio_dnsresult, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4coio_dnsresult, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4coio_dnsresult, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4coio_dnsresult, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static struct PyMethodDef __pyx_methods[] = {
  {"has_feature_may_loop_return_1", (PyCFunction)__pyx_f_4coio_has_feature_may_loop_return_1, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_has_feature_may_loop_return_1},
  {"has_feature_multiple_events_on_same_fd", (PyCFunction)__pyx_f_4coio_has_feature_multiple_events_on_same_fd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_has_feature_multiple_events_on_same_fd},
  {"version", (PyCFunction)__pyx_f_4coio_version, METH_VARARGS|METH_KEYWORDS, 0},
  {"method", (PyCFunction)__pyx_f_4coio_method, METH_VARARGS|METH_KEYWORDS, 0},
  {"reinit", (PyCFunction)__pyx_f_4coio_reinit, METH_VARARGS|METH_KEYWORDS, 0},
  {"nonblocking_loop_for_tests", (PyCFunction)__pyx_f_4coio_nonblocking_loop_for_tests, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_nonblocking_loop_for_tests},
  {"_schedule_helper", (PyCFunction)__pyx_f_4coio__schedule_helper, METH_VARARGS|METH_KEYWORDS, 0},
  {"insert_after_current", (PyCFunction)__pyx_f_4coio_insert_after_current, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_insert_after_current},
  {"SendExceptionAndScheduleNext", (PyCFunction)__pyx_f_4coio_SendExceptionAndScheduleNext, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_SendExceptionAndScheduleNext},
  {"set_fd_blocking", (PyCFunction)__pyx_f_4coio_set_fd_blocking, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_set_fd_blocking},
  {"MainLoop", (PyCFunction)__pyx_f_4coio_MainLoop, METH_VARARGS|METH_KEYWORDS, 0},
  {"SigIntHandler", (PyCFunction)__pyx_f_4coio_SigIntHandler, METH_VARARGS|METH_KEYWORDS, 0},
  {"popen", (PyCFunction)__pyx_f_4coio_popen, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_popen},
  {"fdopen", (PyCFunction)__pyx_f_4coio_fdopen, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_fdopen},
  {"new_realsocket", (PyCFunction)__pyx_f_4coio_new_realsocket, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_new_realsocket},
  {"socketpair", (PyCFunction)__pyx_f_4coio_socketpair, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_socketpair},
  {"new_realsocket_fromfd", (PyCFunction)__pyx_f_4coio_new_realsocket_fromfd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_new_realsocket_fromfd},
  {"sleep", (PyCFunction)__pyx_f_4coio_sleep, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_sleep},
  {"ReceiveSleepHelper", (PyCFunction)__pyx_f_4coio_ReceiveSleepHelper, METH_VARARGS|METH_KEYWORDS, 0},
  {"receive_with_timeout", (PyCFunction)__pyx_f_4coio_receive_with_timeout, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_receive_with_timeout},
  {"select", (PyCFunction)__pyx_f_4coio_select, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_select},
  {"signal", (PyCFunction)__pyx_f_4coio_signal, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_signal},
  {"get_concurrence_triggered", (PyCFunction)__pyx_f_4coio_get_concurrence_triggered, METH_VARARGS|METH_KEYWORDS, 0},
  {"get_swap_concurrence_triggered", (PyCFunction)__pyx_f_4coio_get_swap_concurrence_triggered, METH_VARARGS|METH_KEYWORDS, 0},
  {"get_concurrence_main_tasklets", (PyCFunction)__pyx_f_4coio_get_concurrence_main_tasklets, METH_VARARGS|METH_KEYWORDS, 0},
  {"dns_init", (PyCFunction)__pyx_f_4coio_dns_init, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_init},
  {"dns_init_force", (PyCFunction)__pyx_f_4coio_dns_init_force, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_init_force},
  {"dns_shutdown", (PyCFunction)__pyx_f_4coio_dns_shutdown, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_shutdown},
  {"dns_resolve_ipv4", (PyCFunction)__pyx_f_4coio_dns_resolve_ipv4, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_resolve_ipv4},
  {"dns_resolve_ipv6", (PyCFunction)__pyx_f_4coio_dns_resolve_ipv6, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_resolve_ipv6},
  {"dns_resolve_reverse", (PyCFunction)__pyx_f_4coio_dns_resolve_reverse, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_dns_resolve_reverse},
  {"read_etc_hosts", (PyCFunction)__pyx_f_4coio_read_etc_hosts, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_read_etc_hosts},
  {"gethostbyname", (PyCFunction)__pyx_f_4coio_gethostbyname, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_gethostbyname},
  {"gethostbyaddr", (PyCFunction)__pyx_f_4coio_gethostbyaddr, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_gethostbyaddr},
  {"getfqdn", (PyCFunction)__pyx_f_4coio_getfqdn, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_getfqdn},
  {"gethostbyname_ex", (PyCFunction)__pyx_f_4coio_gethostbyname_ex, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_gethostbyname_ex},
  {"partial_getaddrinfo", (PyCFunction)__pyx_f_4coio_partial_getaddrinfo, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4coio_partial_getaddrinfo},
  {"get_main_loop_tasklet", (PyCFunction)__pyx_f_4coio_get_main_loop_tasklet, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

PyMODINIT_FUNC initcoio(void); /*proto*/
PyMODINIT_FUNC initcoio(void) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  int __pyx_8;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  PyObject *__pyx_11 = 0;
  PyObject *__pyx_12 = 0;
  #if PY_VERSION_HEX < 0x02040000 && defined(WITH_THREAD)
    PyEval_InitThreads();
  #endif
  __pyx_init_filenames();
  __pyx_m = Py_InitModule4("coio", __pyx_methods, 0, 0, PYTHON_API_VERSION);
  if (!__pyx_m) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 1; goto __pyx_L1;};
  Py_INCREF(__pyx_m);
  __pyx_b = PyImport_AddModule("__builtin__");
  if (!__pyx_b) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 1; goto __pyx_L1;};
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 1; goto __pyx_L1;};
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 1; goto __pyx_L1;};
  coio_socket_error = Py_None; Py_INCREF(Py_None);
  coio_socket_timeout = Py_None; Py_INCREF(Py_None);
  coio_waiting_token = Py_None; Py_INCREF(Py_None);
  coio_event_happened_token = Py_None; Py_INCREF(Py_None);
  __pyx_v_4coio_signal_events = ((PyDictObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_4coio_concurrence_triggered = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_4coio_concurrence_main_tasklets = ((PyListObject *)Py_None); Py_INCREF(Py_None);
  __pyx_v_4coio_main_loop_tasklet = ((PyTaskletObject *)Py_None); Py_INCREF(Py_None);
  __pyx_ptype_4coio_tasklet = __Pyx_ImportType("stackless", "tasklet", sizeof(PyTaskletObject)); if (!__pyx_ptype_4coio_tasklet) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; goto __pyx_L1;}
  __pyx_ptype_4coio_bomb = __Pyx_ImportType("stackless", "bomb", sizeof(PyBombObject)); if (!__pyx_ptype_4coio_bomb) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; goto __pyx_L1;}
  __pyx_type_4coio_nbfile.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_nbfile) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "nbfile", (PyObject *)&__pyx_type_4coio_nbfile) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; goto __pyx_L1;}
  __pyx_ptype_4coio_nbfile = &__pyx_type_4coio_nbfile;
  __pyx_type_4coio_nbsocket.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_nbsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1727; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "nbsocket", (PyObject *)&__pyx_type_4coio_nbsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1727; goto __pyx_L1;}
  __pyx_ptype_4coio_nbsocket = &__pyx_type_4coio_nbsocket;
  __pyx_type_4coio_nbsslsocket.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_nbsslsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2084; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "nbsslsocket", (PyObject *)&__pyx_type_4coio_nbsslsocket) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2084; goto __pyx_L1;}
  __pyx_ptype_4coio_nbsslsocket = &__pyx_type_4coio_nbsslsocket;
  __pyx_type_4coio_sockwrapper.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_sockwrapper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2067; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "sockwrapper", (PyObject *)&__pyx_type_4coio_sockwrapper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2067; goto __pyx_L1;}
  __pyx_ptype_4coio_sockwrapper = &__pyx_type_4coio_sockwrapper;
  __pyx_type_4coio_selecter.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_selecter) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2694; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "selecter", (PyObject *)&__pyx_type_4coio_selecter) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2694; goto __pyx_L1;}
  __pyx_ptype_4coio_selecter = &__pyx_type_4coio_selecter;
  __pyx_type_4coio_wakeup_info.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_wakeup_info) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2876; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "wakeup_info", (PyObject *)&__pyx_type_4coio_wakeup_info) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2876; goto __pyx_L1;}
  __pyx_ptype_4coio_wakeup_info = &__pyx_type_4coio_wakeup_info;
  __pyx_type_4coio_wakeup_info_event.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_wakeup_info_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2837; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "wakeup_info_event", (PyObject *)&__pyx_type_4coio_wakeup_info_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2837; goto __pyx_L1;}
  __pyx_ptype_4coio_wakeup_info_event = &__pyx_type_4coio_wakeup_info_event;
  if (PyType_Ready(&__pyx_type_4coio_signal_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2956; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "signal_event", (PyObject *)&__pyx_type_4coio_signal_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2956; goto __pyx_L1;}
  __pyx_ptype_4coio_signal_event = &__pyx_type_4coio_signal_event;
  __pyx_type_4coio_concurrence_event.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_concurrence_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3054; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "concurrence_event", (PyObject *)&__pyx_type_4coio_concurrence_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3054; goto __pyx_L1;}
  __pyx_ptype_4coio_concurrence_event = &__pyx_type_4coio_concurrence_event;
  __pyx_type_4coio_dnsresult.tp_free = _PyObject_GC_Del;
  if (PyType_Ready(&__pyx_type_4coio_dnsresult) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 106; goto __pyx_L1;}
  if (PyObject_SetAttrString(__pyx_m, "dnsresult", (PyObject *)&__pyx_type_4coio_dnsresult) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 106; goto __pyx_L1;}
  __pyx_ptype_4coio_dnsresult = &__pyx_type_4coio_dnsresult;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":51 */
  __pyx_1 = __Pyx_Import(__pyx_n_os, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_os, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":52 */
  __pyx_1 = __Pyx_Import(__pyx_n_stackless, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_stackless, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":53 */
  __pyx_1 = __Pyx_Import(__pyx_n_socket, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":55 */
  __pyx_1 = __Pyx_Import(__pyx_n_types, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_types, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":58 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 58; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_error); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 58; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(coio_socket_error);
  coio_socket_error = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":60 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_timeout); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(coio_socket_timeout);
  coio_socket_timeout = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":186 */
  __pyx_1 = PyInt_FromLong(EV_TIMEOUT); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_TIMEOUT, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":187 */
  __pyx_2 = PyInt_FromLong(EV_READ); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_READ, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":188 */
  __pyx_1 = PyInt_FromLong(EV_WRITE); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_WRITE, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":189 */
  __pyx_2 = PyInt_FromLong(EV_SIGNAL); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_SIGNAL, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":190 */
  __pyx_1 = PyInt_FromLong(EV_PERSIST); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EV_PERSIST, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":299 */
  __pyx_d1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":328 */
  __pyx_2 = PyInt_FromLong(120); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_connect_magic_usec, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":335 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_tasklet); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n__schedule_helper); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_1);
  __pyx_1 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_remove); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n__schedule_helper_tasklet, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":565 */
  __pyx_v_4coio_sigint_ev.ev_flags = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":586 */
  __pyx_2 = __Pyx_GetName(__pyx_b, __pyx_n_object); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 586; goto __pyx_L1;}
  __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 586; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(coio_waiting_token);
  coio_waiting_token = __pyx_3;
  __pyx_3 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":597 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_object); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; goto __pyx_L1;}
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(coio_event_happened_token);
  coio_event_happened_token = __pyx_2;
  __pyx_2 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":775 */
  __pyx_d2 = (-1);
  __pyx_d3 = (-1);
  __pyx_d4 = 1;
  __pyx_d5 = 0;
  Py_INCREF(Py_None);
  __pyx_d6 = Py_None;
  Py_INCREF(__pyx_k22p);
  __pyx_d7 = __pyx_k22p;
  Py_INCREF(Py_None);
  __pyx_d8 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1188 */
  Py_INCREF(Py_None);
  __pyx_d9 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1211 */
  __pyx_d10 = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1411 */
  __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1411; goto __pyx_L1;}
  __pyx_d11 = __pyx_3;
  __pyx_3 = 0;
  Py_INCREF(Py_None);
  __pyx_d12 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1445 */
  __pyx_1 = PyInt_FromLong(0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; goto __pyx_L1;}
  __pyx_d13 = __pyx_1;
  __pyx_1 = 0;
  Py_INCREF(Py_None);
  __pyx_d14 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1477 */
  __pyx_2 = PyInt_FromLong(0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1477; goto __pyx_L1;}
  __pyx_d15 = __pyx_2;
  __pyx_2 = 0;
  Py_INCREF(Py_None);
  __pyx_d16 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1506 */
  __pyx_4 = PyInt_FromLong(0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1506; goto __pyx_L1;}
  __pyx_d17 = __pyx_4;
  __pyx_4 = 0;
  Py_INCREF(Py_None);
  __pyx_d18 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1540 */
  __pyx_d19 = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1661 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_n_os); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(__pyx_5, __pyx_n_popen); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; goto __pyx_L1;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_os_popen, __pyx_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1663 */
  Py_INCREF(__pyx_n_r);
  __pyx_d20 = __pyx_n_r;
  __pyx_d21 = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1671 */
  Py_INCREF(__pyx_n_r);
  __pyx_d22 = __pyx_n_r;
  __pyx_d23 = (-1);
  __pyx_5 = PyInt_FromLong((-1)); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1672; goto __pyx_L1;}
  __pyx_d24 = __pyx_5;
  __pyx_5 = 0;
  __pyx_d25 = 1;
  Py_INCREF(Py_None);
  __pyx_d26 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1711 */
  __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; goto __pyx_L1;}
  __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n__realsocket); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket_impl, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1715 */
  __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; goto __pyx_L1;}
  __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n__realsocket); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket_realsocket, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1717 */
  __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; goto __pyx_L1;}
  __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n__socket); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  __pyx_6 = PyObject_GetAttr(__pyx_7, __pyx_n_socketpair); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket_realsocketpair, __pyx_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1719 */
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_socket); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1719; goto __pyx_L1;}
  __pyx_6 = PyObject_GetAttr(__pyx_7, __pyx_n_fromfd); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1719; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_socket_fromfd, __pyx_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1719; goto __pyx_L1;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1971 */
  __pyx_d27 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":1993 */
  Py_INCREF(__pyx_k22p);
  __pyx_d28 = __pyx_k22p;
  __pyx_d29 = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2004 */
  Py_INCREF(__pyx_n_r);
  __pyx_d30 = __pyx_n_r;
  __pyx_d31 = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2055 */
  /*try:*/ {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2056 */
    __pyx_7 = __Pyx_Import(__pyx_n_ssl, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2056; goto __pyx_L2;}
    if (PyObject_SetAttr(__pyx_m, __pyx_n_ssl, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2056; goto __pyx_L2;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2057 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; goto __pyx_L2;}
    __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n_SSLSocket); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; goto __pyx_L2;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    if (PyObject_SetAttr(__pyx_m, __pyx_n_sslsocket_impl, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; goto __pyx_L2;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2058 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2058; goto __pyx_L2;}
    __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n_SSLError); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2058; goto __pyx_L2;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    if (PyObject_SetAttr(__pyx_m, __pyx_n_SSLError, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2058; goto __pyx_L2;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2059 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2059; goto __pyx_L2;}
    __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n_SSL_ERROR_EOF); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2059; goto __pyx_L2;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_8 = PyInt_AsLong(__pyx_7); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2059; goto __pyx_L2;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_v_4coio_SSL_ERROR_EOF = __pyx_8;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2060 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; goto __pyx_L2;}
    __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n_SSL_ERROR_WANT_READ); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; goto __pyx_L2;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_8 = PyInt_AsLong(__pyx_7); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; goto __pyx_L2;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_v_4coio_SSL_ERROR_WANT_READ = __pyx_8;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2061 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2061; goto __pyx_L2;}
    __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_n_SSL_ERROR_WANT_WRITE); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2061; goto __pyx_L2;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_8 = PyInt_AsLong(__pyx_7); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2061; goto __pyx_L2;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_v_4coio_SSL_ERROR_WANT_WRITE = __pyx_8;
  }
  goto __pyx_L3;
  __pyx_L2:;
  Py_XDECREF(__pyx_6); __pyx_6 = 0;
  Py_XDECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2062 */
  __pyx_8 = PyErr_ExceptionMatches(PyExc_ImportError);
  if (__pyx_8) {
    __pyx_filename = __pyx_f[0]; __pyx_lineno = 2062; __Pyx_AddTraceback("coio");
    PyErr_Fetch(&__pyx_6, &__pyx_7, &__pyx_9);
    if (__Pyx_NormalizeException(&__pyx_6, &__pyx_7, &__pyx_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2062; goto __pyx_L1;}
    if (PyObject_SetAttr(__pyx_m, __pyx_n_e, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2062; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2063 */
    if (PyObject_SetAttr(__pyx_m, __pyx_n_sslsocket_impl, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2063; goto __pyx_L1;}

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2064 */
    if (PyObject_SetAttr(__pyx_m, __pyx_n_ssl, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; goto __pyx_L1;}
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_9); __pyx_9 = 0;
    goto __pyx_L3;
  }
  goto __pyx_L1;
  __pyx_L3:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2316 */
  __pyx_6 = PyInt_FromLong(1024); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2316; goto __pyx_L1;}
  __pyx_d32 = __pyx_6;
  __pyx_6 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2455 */
  Py_INCREF(Py_False);
  __pyx_d33 = Py_False;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2464 */
  __pyx_d34 = 1024;
  __pyx_d35 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2504 */
  __pyx_d36 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2527 */
  __pyx_d37 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2571 */
  Py_INCREF(__pyx_k22p);
  __pyx_d38 = __pyx_k22p;
  __pyx_d39 = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2589 */
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2589; goto __pyx_L1;}
  __pyx_8 = PyObject_IsTrue(__pyx_7); if (__pyx_8 < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2589; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  if (__pyx_8) {

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2590 */
    __pyx_9 = PyDict_New(); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2590; goto __pyx_L1;}
    if (PyDict_SetItem(__pyx_9, __pyx_n_SSLSocket, ((PyObject *)__pyx_ptype_4coio_nbsslsocket)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2590; goto __pyx_L1;}
    if (PyObject_SetAttr(__pyx_m, __pyx_n__fake_ssl_globals, __pyx_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2590; goto __pyx_L1;}
    Py_DECREF(__pyx_9); __pyx_9 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2591 */
    __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_types); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2591; goto __pyx_L1;}
    __pyx_9 = PyObject_GetAttr(__pyx_7, __pyx_n_FunctionType); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2591; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2592; goto __pyx_L1;}
    __pyx_10 = PyObject_GetAttr(__pyx_7, __pyx_n_wrap_socket); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2592; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_7 = PyObject_GetAttr(__pyx_10, __pyx_n_func_code); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2592; goto __pyx_L1;}
    Py_DECREF(__pyx_10); __pyx_10 = 0;
    __pyx_10 = __Pyx_GetName(__pyx_m, __pyx_n__fake_ssl_globals); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2592; goto __pyx_L1;}
    __pyx_11 = __Pyx_GetName(__pyx_m, __pyx_n_ssl); if (!__pyx_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2593; goto __pyx_L1;}
    __pyx_12 = PyObject_GetAttr(__pyx_11, __pyx_n_wrap_socket); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2593; goto __pyx_L1;}
    Py_DECREF(__pyx_11); __pyx_11 = 0;
    __pyx_11 = PyObject_GetAttr(__pyx_12, __pyx_n_func_defaults); if (!__pyx_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2593; goto __pyx_L1;}
    Py_DECREF(__pyx_12); __pyx_12 = 0;
    __pyx_12 = PyTuple_New(4); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2591; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_12, 0, __pyx_7);
    PyTuple_SET_ITEM(__pyx_12, 1, __pyx_10);
    Py_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_12, 2, Py_None);
    PyTuple_SET_ITEM(__pyx_12, 3, __pyx_11);
    __pyx_7 = 0;
    __pyx_10 = 0;
    __pyx_11 = 0;
    __pyx_7 = PyObject_CallObject(__pyx_9, __pyx_12); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2591; goto __pyx_L1;}
    Py_DECREF(__pyx_9); __pyx_9 = 0;
    Py_DECREF(__pyx_12); __pyx_12 = 0;
    if (PyObject_SetAttr(__pyx_m, __pyx_n_ssl_wrap_socket, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2591; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;

    /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2595 */
    __pyx_10 = __Pyx_GetName(__pyx_m, __pyx_n_ssl_wrap_socket); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2594; goto __pyx_L1;}
    if (PyObject_SetAttr(__pyx_10, __pyx_n___doc__, __pyx_k204p) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2594; goto __pyx_L1;}
    Py_DECREF(__pyx_10); __pyx_10 = 0;
    goto __pyx_L4;
  }
  /*else*/ {
    __pyx_11 = __Pyx_GetName(__pyx_b, __pyx_n_globals); if (!__pyx_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2597; goto __pyx_L1;}
    __pyx_9 = PyObject_CallObject(__pyx_11, 0); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2597; goto __pyx_L1;}
    Py_DECREF(__pyx_11); __pyx_11 = 0;
    if (PyObject_SetItem(__pyx_9, __pyx_n_nbsslsocket, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2597; goto __pyx_L1;}
    Py_DECREF(__pyx_9); __pyx_9 = 0;
  }
  __pyx_L4:;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2649 */
  Py_INCREF(Py_None);
  __pyx_d40 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2797 */
  Py_INCREF(Py_None);
  __pyx_d41 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":2949 */
  __pyx_12 = PyDict_New(); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2949; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_12, (&PyDict_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2949; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_4coio_signal_events));
  __pyx_v_4coio_signal_events = ((PyDictObject *)__pyx_12);
  __pyx_12 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3023 */
  __pyx_7 = PyList_New(0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3023; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_7, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3023; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_4coio_concurrence_triggered));
  __pyx_v_4coio_concurrence_triggered = ((PyListObject *)__pyx_7);
  __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3035 */
  __pyx_10 = PyList_New(0); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3035; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_10, (&PyList_Type))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3035; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_4coio_concurrence_main_tasklets));
  __pyx_v_4coio_concurrence_main_tasklets = ((PyListObject *)__pyx_10);
  __pyx_10 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3050 */
  __pyx_11 = PyDict_New(); if (!__pyx_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3050; goto __pyx_L1;}
  __pyx_9 = PyTuple_New(1); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3050; goto __pyx_L1;}
  Py_INCREF(PyExc_Exception);
  PyTuple_SET_ITEM(__pyx_9, 0, PyExc_Exception);
  __pyx_12 = __Pyx_CreateClass(__pyx_9, __pyx_11, __pyx_n_EventError, "coio"); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3050; goto __pyx_L1;}
  Py_DECREF(__pyx_9); __pyx_9 = 0;
  __pyx_7 = PyCFunction_NewEx(&__pyx_mdef_4coio_10EventError___init__, 0, __pyx_n_coio); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3051; goto __pyx_L1;}
  __pyx_10 = PyMethod_New(__pyx_7, 0, __pyx_12); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3051; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  if (PyObject_SetAttr(__pyx_12, __pyx_n___init__, __pyx_10) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3051; goto __pyx_L1;}
  Py_DECREF(__pyx_10); __pyx_10 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_EventError, __pyx_12) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3050; goto __pyx_L1;}
  Py_DECREF(__pyx_12); __pyx_12 = 0;
  Py_DECREF(__pyx_11); __pyx_11 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3071 */
  __pyx_d42 = 0;
  __pyx_9 = PyInt_FromLong((-1)); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3071; goto __pyx_L1;}
  __pyx_d43 = __pyx_9;
  __pyx_9 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/nbevent.pxi":3089 */
  __pyx_d44 = (-1);

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":59 */
  __pyx_7 = PyInt_FromLong(__pyx_e_4coio_c_DNS_QUERY_NO_SEARCH); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DNS_QUERY_NO_SEARCH, __pyx_7) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":74 */
  __pyx_10 = PyInt_FromLong(HOST_NOT_FOUND); if (!__pyx_10) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_HOST_NOT_FOUND, __pyx_10) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; goto __pyx_L1;}
  Py_DECREF(__pyx_10); __pyx_10 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":75 */
  __pyx_12 = PyInt_FromLong(TRY_AGAIN); if (!__pyx_12) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_TRY_AGAIN, __pyx_12) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; goto __pyx_L1;}
  Py_DECREF(__pyx_12); __pyx_12 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":76 */
  __pyx_11 = PyInt_FromLong(NO_RECOVERY); if (!__pyx_11) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_NO_RECOVERY, __pyx_11) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; goto __pyx_L1;}
  Py_DECREF(__pyx_11); __pyx_11 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":77 */
  __pyx_7 = PyInt_FromLong(NO_DATA); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 77; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_NO_DATA, __pyx_7) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 77; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":78 */
  __pyx_10 = PyInt_FromLong(NO_ADDRESS); if (!__pyx_10) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_HERROR_NO_ADDRESS, __pyx_10) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
  Py_DECREF(__pyx_10); __pyx_10 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":81 */
  __pyx_v_4coio_dns_initialized = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":100 */
  __pyx_d45 = 1;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":149 */
  __pyx_12 = PyDict_New(); if (!__pyx_12) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; goto __pyx_L1;}
  __pyx_11 = PyTuple_New(1); if (!__pyx_11) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; goto __pyx_L1;}
  Py_INCREF(PyExc_IOError);
  PyTuple_SET_ITEM(__pyx_11, 0, PyExc_IOError);
  __pyx_7 = __Pyx_CreateClass(__pyx_11, __pyx_12, __pyx_n_DnsLookupError, "coio"); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; goto __pyx_L1;}
  Py_DECREF(__pyx_11); __pyx_11 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DnsLookupError, __pyx_7) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_12); __pyx_12 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":152 */
  __pyx_10 = PyDict_New(); if (!__pyx_10) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; goto __pyx_L1;}
  __pyx_11 = PyTuple_New(1); if (!__pyx_11) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; goto __pyx_L1;}
  Py_INCREF(PyExc_Exception);
  PyTuple_SET_ITEM(__pyx_11, 0, PyExc_Exception);
  __pyx_7 = __Pyx_CreateClass(__pyx_11, __pyx_10, __pyx_n_DnsResultParseError, "coio"); if (!__pyx_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; goto __pyx_L1;}
  Py_DECREF(__pyx_11); __pyx_11 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_DnsResultParseError, __pyx_7) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 152; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  Py_DECREF(__pyx_10); __pyx_10 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":284 */
  __pyx_d46 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":295 */
  __pyx_d47 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":306 */
  __pyx_d48 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":352 */
  __pyx_12 = PyDict_New(); if (!__pyx_12) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 352; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_names_by_ip, __pyx_12) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 352; goto __pyx_L1;}
  Py_DECREF(__pyx_12); __pyx_12 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":355 */
  __pyx_11 = PyDict_New(); if (!__pyx_11) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 355; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_names_by_nameip, __pyx_11) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 355; goto __pyx_L1;}
  Py_DECREF(__pyx_11); __pyx_11 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":358 */
  Py_INCREF(__pyx_k214p);
  __pyx_d49 = __pyx_k214p;
  Py_INCREF(Py_None);
  __pyx_d50 = Py_None;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":499 */
  Py_INCREF(__pyx_k19p);
  __pyx_d51 = __pyx_k19p;

  /* "/home/pts/prg/syncless/trunk/coio_src/evdns.pxi":567 */
  __pyx_d52 = 0;
  __pyx_d53 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/coio.pyx":7 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  if (!(!coio_loaded())) {
    PyErr_SetObject(PyExc_AssertionError, __pyx_k215p);
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 7; goto __pyx_L1;}
  }
  #endif

  /* "/home/pts/prg/syncless/trunk/coio_src/coio.pyx":9 */
  __pyx_7 = __Pyx_Import(__pyx_n_sys, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 9; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_sys, __pyx_7) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 9; goto __pyx_L1;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/coio.pyx":10 */
  __pyx_10 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 10; goto __pyx_L1;}
  __pyx_12 = PyObject_GetAttr(__pyx_10, __pyx_n_modules); if (!__pyx_12) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 10; goto __pyx_L1;}
  Py_DECREF(__pyx_10); __pyx_10 = 0;
  __pyx_8 = PySequence_Contains(__pyx_12, __pyx_k217p); if (__pyx_8 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 10; goto __pyx_L1;}
  Py_DECREF(__pyx_12); __pyx_12 = 0;
  if (__pyx_8) {
    __pyx_11 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_11) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    __pyx_7 = PyObject_GetAttr(__pyx_11, __pyx_n_modules); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    Py_DECREF(__pyx_11); __pyx_11 = 0;
    __pyx_10 = PyObject_GetItem(__pyx_7, __pyx_k217p); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_12 = PyObject_GetAttr(__pyx_10, __pyx_n_get_version); if (!__pyx_12) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    Py_DECREF(__pyx_10); __pyx_10 = 0;
    __pyx_11 = PyObject_CallObject(__pyx_12, 0); if (!__pyx_11) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    Py_DECREF(__pyx_12); __pyx_12 = 0;
    __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_version); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    __pyx_10 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    if (PyObject_Cmp(__pyx_11, __pyx_10, &__pyx_8) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; goto __pyx_L1;}
    __pyx_8 = __pyx_8 == 0;
    Py_DECREF(__pyx_11); __pyx_11 = 0;
    Py_DECREF(__pyx_10); __pyx_10 = 0;
  }
  if (__pyx_8) {
    goto __pyx_L5;
  }
  __pyx_8 = (coio_event_init() != 0);
  if (__pyx_8) {
    __pyx_12 = PyInt_FromLong(EIO); if (!__pyx_12) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 17; goto __pyx_L1;}
    __pyx_7 = PyTuple_New(2); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 17; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_7, 0, __pyx_12);
    Py_INCREF(__pyx_k221p);
    PyTuple_SET_ITEM(__pyx_7, 1, __pyx_k221p);
    __pyx_12 = 0;
    __pyx_11 = PyObject_CallObject(PyExc_OSError, __pyx_7); if (!__pyx_11) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 17; goto __pyx_L1;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __Pyx_Raise(__pyx_11, 0, 0);
    Py_DECREF(__pyx_11); __pyx_11 = 0;
    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 17; goto __pyx_L1;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/pts/prg/syncless/trunk/coio_src/coio.pyx":19 */
  __pyx_f_4coio__setup_sigint();

  /* "/home/pts/prg/syncless/trunk/coio_src/coio.pyx":25 */
  __pyx_10 = __Pyx_GetName(__pyx_m, __pyx_n_stackless); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; goto __pyx_L1;}
  __pyx_12 = PyObject_GetAttr(__pyx_10, __pyx_n_tasklet); if (!__pyx_12) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; goto __pyx_L1;}
  Py_DECREF(__pyx_10); __pyx_10 = 0;
  __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_n_MainLoop); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; goto __pyx_L1;}
  __pyx_11 = PyTuple_New(1); if (!__pyx_11) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_11, 0, __pyx_7);
  __pyx_7 = 0;
  __pyx_10 = PyObject_CallObject(__pyx_12, __pyx_11); if (!__pyx_10) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; goto __pyx_L1;}
  Py_DECREF(__pyx_12); __pyx_12 = 0;
  Py_DECREF(__pyx_11); __pyx_11 = 0;
  __pyx_7 = PyObject_CallObject(__pyx_10, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; goto __pyx_L1;}
  Py_DECREF(__pyx_10); __pyx_10 = 0;
  if (!__Pyx_TypeTest(__pyx_7, __pyx_ptype_4coio_tasklet)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; goto __pyx_L1;}
  Py_DECREF(((PyObject *)__pyx_v_4coio_main_loop_tasklet));
  __pyx_v_4coio_main_loop_tasklet = ((PyTaskletObject *)__pyx_7);
  __pyx_7 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/coio.pyx":27 */
  /*try:*/ {
    __pyx_12 = __Pyx_GetName(__pyx_m, __pyx_n_read_etc_hosts); if (!__pyx_12) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 28; goto __pyx_L6;}
    __pyx_11 = PyObject_CallObject(__pyx_12, 0); if (!__pyx_11) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 28; goto __pyx_L6;}
    Py_DECREF(__pyx_12); __pyx_12 = 0;
    Py_DECREF(__pyx_11); __pyx_11 = 0;
  }
  goto __pyx_L7;
  __pyx_L6:;
  Py_XDECREF(__pyx_10); __pyx_10 = 0;
  Py_XDECREF(__pyx_7); __pyx_7 = 0;
  Py_XDECREF(__pyx_12); __pyx_12 = 0;
  Py_XDECREF(__pyx_11); __pyx_11 = 0;

  /* "/home/pts/prg/syncless/trunk/coio_src/coio.pyx":29 */
  __pyx_8 = PyErr_ExceptionMatches(PyExc_IOError);
  if (__pyx_8) {
    goto __pyx_L7;
  }
  goto __pyx_L1;
  __pyx_L7:;
  return;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  Py_XDECREF(__pyx_11);
  Py_XDECREF(__pyx_12);
  __Pyx_AddTraceback("coio");
}

static char *__pyx_filenames[] = {
  "nbevent.pxi",
  "evdns.pxi",
  "coio.pyx",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    if (value == Py_None)
        value = NULL;
    if (tb == Py_None)
        tb = NULL;
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    #if PY_VERSION_HEX < 0x02050000
    if (!PyClass_Check(type))
    #else
    if (!PyType_Check(type))
    #endif
    {
        /* Raising an instance.  The value should be a dummy. */
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        value = type;
        #if PY_VERSION_HEX < 0x02050000
            if (PyInstance_Check(type)) {
                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
                Py_INCREF(type);
            }
            else {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception must be an old-style class or instance");
                goto raise_error;
            }
        #else
            type = (PyObject*) type->ob_type;
            Py_INCREF(type);
            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception class must be a subclass of BaseException");
                goto raise_error;
            }
        #endif
    }
    PyErr_Restore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed, char *name) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if ((none_allowed && obj == Py_None) || PyObject_TypeCheck(obj, type))
        return 1;
    PyErr_Format(PyExc_TypeError,
        "Argument '%s' has incorrect type (expected %s, got %s)",
        name, type->tp_name, obj->ob_type->tp_name);
    return 0;
}

static void __Pyx_WriteUnraisable(char *name) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    PyGILState_STATE state = PyGILState_Ensure();
    PyErr_Fetch(&old_exc, &old_val, &old_tb);
    ctx = PyString_FromString(name);
    PyErr_Restore(old_exc, old_val, old_tb);
    if (!ctx)
        ctx = Py_None;
    PyErr_WriteUnraisable(ctx);
    PyGILState_Release(state);
}

static int __Pyx_NormalizeException(PyObject **type, PyObject **value, PyObject **tb) {
    PyErr_NormalizeException(type, value, tb);
    if (PyErr_Occurred())
        goto bad;
    if (!*tb) {
        *tb = Py_None;
        Py_INCREF(*tb);
    }
    return 0;
bad:
    Py_XDECREF(*type);
    Py_XDECREF(*value);
    Py_XDECREF(*tb);
    return -1;
}

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (obj == Py_None || PyObject_TypeCheck(obj, type))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %s to %s",
        obj->ob_type->tp_name, type->tp_name);
    return 0;
}

static int __Pyx_GetStarArgs(
    PyObject **args, 
    PyObject **kwds,
    char *kwd_list[], 
    Py_ssize_t nargs,
    PyObject **args2, 
    PyObject **kwds2,
    char rqd_kwds[])
{
    PyObject *x = 0, *args1 = 0, *kwds1 = 0;
    int i;
    char **p;
    
    if (args2)
        *args2 = 0;
    if (kwds2)
        *kwds2 = 0;
    
    if (args2) {
        args1 = PyTuple_GetSlice(*args, 0, nargs);
        if (!args1)
            goto bad;
        *args2 = PyTuple_GetSlice(*args, nargs, PyTuple_GET_SIZE(*args));
        if (!*args2)
            goto bad;
    }
    else if (PyTuple_GET_SIZE(*args) > nargs) {
        int m = nargs;
        int n = PyTuple_GET_SIZE(*args);
        PyErr_Format(PyExc_TypeError,
            "function takes at most %d positional arguments (%d given)",
                m, n);
        goto bad;
    }
    else {
        args1 = *args;
        Py_INCREF(args1);
    }
    
    if (rqd_kwds && !*kwds)
            for (i = 0, p = kwd_list; *p; i++, p++)
                if (rqd_kwds[i])
                    goto missing_kwarg;
    
    if (kwds2) {
        if (*kwds) {
            kwds1 = PyDict_New();
            if (!kwds1)
                goto bad;
            *kwds2 = PyDict_Copy(*kwds);
            if (!*kwds2)
                goto bad;
            for (i = 0, p = kwd_list; *p; i++, p++) {
                x = PyDict_GetItemString(*kwds, *p);
                if (x) {
                    if (PyDict_SetItemString(kwds1, *p, x) < 0)
                        goto bad;
                    if (PyDict_DelItemString(*kwds2, *p) < 0)
                        goto bad;
                }
                else if (rqd_kwds && rqd_kwds[i])
                    goto missing_kwarg;
            }
        }
        else {
            *kwds2 = PyDict_New();
            if (!*kwds2)
                goto bad;
        }
    }
    else {
        kwds1 = *kwds;
        Py_XINCREF(kwds1);
        if (rqd_kwds && *kwds)
            for (i = 0, p = kwd_list; *p; i++, p++)
                if (rqd_kwds[i] && !PyDict_GetItemString(*kwds, *p))
                        goto missing_kwarg;
    }
    
    *args = args1;
    *kwds = kwds1;
    return 0;
missing_kwarg:
    PyErr_Format(PyExc_TypeError,
        "required keyword argument '%s' is missing", *p);
bad:
    Py_XDECREF(args1);
    Py_XDECREF(kwds1);
    if (args2) {
        Py_XDECREF(*args2);
    }
    if (kwds2) {
        Py_XDECREF(*kwds2);
    }
    return -1;
}

static void __Pyx_UnpackError(void) {
    PyErr_SetString(PyExc_ValueError, "unpack sequence of wrong size");
}

static PyObject *__Pyx_UnpackItem(PyObject *iter) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred())
            __Pyx_UnpackError();
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        __Pyx_UnpackError();
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}

static PyObject *__Pyx_GetItemInt(PyObject *o, Py_ssize_t i) {
    PyTypeObject *t = o->ob_type;
    PyObject *r;
    if (t->tp_as_sequence && t->tp_as_sequence->sq_item)
        r = PySequence_GetItem(o, i);
    else {
        PyObject *j = PyInt_FromLong(i);
        if (!j)
            return 0;
        r = PyObject_GetItem(o, j);
        Py_DECREF(j);
    }
    return r;
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        if (!*t->p)
            return -1;
        if (t->i)
            PyString_InternInPlace(t->p);
        ++t;
    }
    return 0;
}

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name, 
    long size) 
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    
    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    result = PyObject_GetAttrString(py_module, class_name);
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError, 
            "%s.%s is not a type object",
            module_name, class_name);
        goto bad;
    }
#ifdef __PYX_CHECK_IMPORTED_TYPES
    if (((PyTypeObject *)result)->tp_basicsize != size) {
        PyErr_Format(PyExc_ValueError, 
            "%s.%s does not appear to be the correct type object",
            module_name, class_name);
        goto bad;
    }
#endif
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(result);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(char *name) {
    PyObject *py_name = 0;
    
    py_name = PyString_FromString(name);
    if (!py_name)
        goto bad;
    return PyImport_Import(py_name);
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = PyObject_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunction(__import__, "OOOO",
        name, global_dict, empty_dict, list);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

static PyObject *__Pyx_CreateClass(
    PyObject *bases, PyObject *dict, PyObject *name, char *modname)
{
    PyObject *py_modname;
    PyObject *result = 0;
    
    py_modname = PyString_FromString(modname);
    if (!py_modname)
        goto bad;
    if (PyDict_SetItemString(dict, "__module__", py_modname) < 0)
        goto bad;
    result = PyClass_New(bases, dict, name);
bad:
    Py_XDECREF(py_modname);
    return result;
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyObject *empty_tuple = 0;
    PyObject *empty_string = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    
    py_srcfile = PyString_FromString(__pyx_filename);
    if (!py_srcfile) goto bad;
    py_funcname = PyString_FromString(funcname);
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    empty_tuple = PyTuple_New(0);
    if (!empty_tuple) goto bad;
    empty_string = PyString_FromString("");
    if (!empty_string) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        empty_string, /*PyObject *code,*/
        empty_tuple,  /*PyObject *consts,*/
        empty_tuple,  /*PyObject *names,*/
        empty_tuple,  /*PyObject *varnames,*/
        empty_tuple,  /*PyObject *freevars,*/
        empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        empty_string  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_Get(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(empty_tuple);
    Py_XDECREF(empty_string);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}
